;/*FB_PKG_DELIM*/

__d("BaseToastContentWrapper.react",["BaseTheme.react","BaseView.react","CometThemeInfraBaseThemeContext.react","CometThemeInfraBaseThemeGated.react","XPlatReactFocusRegion.react","basePushToast","focusScopeQueries","react","useCurrentDisplayMode"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u=e.useContext,c={dark:"__fb-dark-mode ",light:"__fb-light-mode ",type:"CLASSNAMES"};function d(e){var t=e.ariaLabelledBy,n=e.children,a=e.ref,i=e.role,l=e.testid,d=e.themeConfig,m=e.useInvertedDisplayMode,p=e.xstyle,_=r("useCurrentDisplayMode")(),f=_==="dark"?"light":"dark",g=u(r("CometThemeInfraBaseThemeContext.react")),h=m?r("CometThemeInfraBaseThemeGated.react")?s.jsx(r("CometThemeInfraBaseThemeGated.react"),{"aria-labelledby":t,displayMode:f,ref:a,role:i,testid:void 0,themes:g,xstyle:p,children:n}):s.jsx(r("BaseTheme.react"),{"aria-labelledby":t,config:d!=null?d:c,displayMode:f,ref:a,role:i,testid:void 0,xstyle:p,children:n}):s.jsx(r("BaseView.react"),{"aria-labelledby":t,ref:a,role:i,testid:void 0,xstyle:p,children:n});return o("basePushToast").passesNewToastAPIGK()?s.jsx(r("XPlatReactFocusRegion.react"),{containFocusQuery:o("focusScopeQueries").tabbableScopeQuery,children:h}):h}d.displayName=d.name+" [from "+i.id+"]",l.default=d}),98);
__d("BaseToast.react",["BaseInlinePressable.react","BaseToastContentWrapper.react","BaseView.react","XPlatReactFocusRegion.react","basePushToast","focusScopeQueries","react"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u=e,c=u.useId,d=u.useMemo,m={item:{display:"x78zum5",flexDirection:"xdt5ytf",paddingBottom:"x19yoh24",paddingInlineStart:"xa6w9w1",paddingInlineEnd:"x7jv1k3",paddingLeft:null,paddingRight:null,paddingTop:"x6enp1t",$$css:!0},itemText:{flexGrow:"x1iyjqo2",$$css:!0},link:{wordBreak:"xdnwjd9",$$css:!0},root:{alignItems:"x6s0dn4",backgroundColor:"x1wkzo03",borderTopColor:"xlnzwam",borderInlineEndColor:"xuc4ihs",borderBottomColor:"xm9qwu6",borderInlineStartColor:"x38i1re",borderStartStartRadius:"x1ghonvh",borderStartEndRadius:"x1c2sbsd",borderEndEndRadius:"x8tb1rc",borderEndStartRadius:"x609f4j",borderTopStyle:"xhf2mca",borderInlineEndStyle:"xaau5u0",borderBottomStyle:"x13y0ya8",borderInlineStartStyle:"xv6865q",borderTopWidth:"xmqxc35",borderInlineEndWidth:"x1a32di2",borderBottomWidth:"x21fg80",borderInlineStartWidth:"xyi7q43",boxShadow:"xi1c1fh",display:"x78zum5",flexShrink:"x2lah0s",maxWidth:"x1cs6qxi",minWidth:"x1hqenl9",paddingTop:"x192rfv7",paddingBottom:"x13jxccy",paddingInlineStart:"x1rcnc7e",paddingInlineEnd:"x1e7pf15",paddingLeft:null,paddingRight:null,$$css:!0},rootDense:{minWidth:"xktpd3l",$$css:!0},rootFullWidth:{width:"xh8yej3",$$css:!0},toastContentDefaultLayout:{alignItems:"x6s0dn4",display:"x78zum5",flexDirection:"x1q0g3np",flexGrow:"x1iyjqo2",$$css:!0},toastContentVerticalLayout:{alignItems:"x1cy8zhl",display:"x78zum5",flexDirection:"xdt5ytf",flexGrow:"x1iyjqo2",$$css:!0}};function p(e){var t,n,a,i,l,u=e.action,p=e.addOnStart,_=e.canBeAutofocused,f=_===void 0?!0:_,g=e.closeButton,h=e.density,y=e.linkWrapper,C=e.message,b=e.offsetStyles,v=e.onDismiss,S=e.size,R=S===void 0?"full-width":S,L=e.testid,E=e.themeConfigOverride,k=e.toastRef,I=e.useInvertedDisplayMode,T=I===void 0?!0:I,D=e.useVerticalLayout,x=D===void 0?!1:D,$=e.variant,P=c(),N=d(function(){return u!=null?{}:{"aria-atomic":!0,role:"alert"}},[u]),M=u!=null?s.jsx(r("BaseView.react"),{xstyle:[m.item,$==null||(t=$.xstyleConfig)==null?void 0:t.item],children:u.element!=null?u.element:u.labelRenderer&&s.jsx(r("BaseInlinePressable.react"),{onPress:function(t){v(),u.onPress(t)},testid:void 0,xstyle:m.link,children:u.labelRenderer(u.label)})}):null,w=s.jsxs(s.Fragment,{children:[p!=null&&s.jsx(r("BaseView.react"),{xstyle:[m.item,$==null||(n=$.xstyleConfig)==null?void 0:n.item],children:p}),s.jsxs(r("BaseView.react"),{xstyle:[R==="full-width"&&m.rootFullWidth,h==="dense"&&m.rootDense,x?m.toastContentVerticalLayout:m.toastContentDefaultLayout],children:[s.jsx(r("BaseView.react"),babelHelpers.extends({xstyle:[m.item,m.itemText,$==null||(a=$.xstyleConfig)==null?void 0:a.item]},N,{children:C({toastMessageId:P})})),M!=null&&(o("basePushToast").passesNewToastAPIGK()?M:s.jsx(r("XPlatReactFocusRegion.react"),{autoFocusQuery:f?o("focusScopeQueries").tabbableScopeQuery:function(){return!1},children:M}))]}),!!g&&s.jsx(r("BaseView.react"),{xstyle:[m.item,$==null||(i=$.xstyleConfig)==null?void 0:i.item],children:g})]});return w=y!=null?y(w):w,s.jsx(r("BaseToastContentWrapper.react"),{ariaLabelledBy:u!=null&&o("basePushToast").passesNewToastAPIGK?P:void 0,ref:k,role:o("basePushToast").passesNewToastAPIGK()&&(u!=null||g)?"dialog":void 0,testid:void 0,themeConfig:E,useInvertedDisplayMode:T,xstyle:[m.root,R==="full-width"&&m.rootFullWidth,h==="dense"&&m.rootDense,b,$==null||(l=$.xstyleConfig)==null?void 0:l.container],children:w})}p.displayName=p.name+" [from "+i.id+"]",l.default=p}),98);
__d("FBNucleusCrossFilled12Icon.react",["react"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react"));function u(e){return s.jsxs("svg",babelHelpers.extends({viewBox:"0 0 12 12",width:"1em",height:"1em",fill:"currentColor"},e,{children:[e.title!=null&&s.jsx("title",{children:e.title}),e.children!=null&&s.jsx("defs",{children:e.children}),s.jsx("path",{d:"M9.942 2.942a.625.625 0 0 0-.884-.884L6 5.116 2.942 2.058a.625.625 0 1 0-.884.884L5.116 6 2.058 9.058a.625.625 0 1 0 .884.884L6 6.884l3.058 3.058a.625.625 0 0 0 .884-.884L6.884 6l3.058-3.058z"})]}))}u.displayName=u.name+" [from "+i.id+"]",u._size=12,u._isSVG=!0;var c=u;l.default=c}),98);
__d("CometToast.react",["fbt","BaseToast.react","CometPressable.react","FBNucleusCrossFilled12Icon.react","FDSCircleButton.react","FDSText.react","XPlatReactEnvironment","react"],(function(t,n,r,o,a,i,l,s){"use strict";var e=["action","href","icon","impressionLoggingRef","message","onDismiss","target","testid","truncateText","useVerticalLayout","withoutCloseButton"],u,c=u||(u=o("react")),d=u.useMemo,m={pressable:{alignItems:"x6s0dn4",display:"x78zum5",flexDirection:"x1q0g3np",width:"xh8yej3",$$css:!0}};function p(t){var n=t.action,a=t.href,i=t.icon,l=t.impressionLoggingRef,u=t.message,p=t.onDismiss,_=t.target,f=t.testid,g=f===void 0?"Toast":f,h=t.truncateText,y=h===void 0?!0:h,C=t.useVerticalLayout,b=C===void 0?!1:C,v=t.withoutCloseButton,S=v===void 0?!1:v,R=babelHelpers.objectWithoutPropertiesLoose(t,e),L=d(function(){return a!=null?{target:_,url:a}:void 0},[a,_]);return c.jsx(r("BaseToast.react"),{action:n!=null?{label:n.label,labelRenderer:function(t){return c.jsx(r("FDSText.react"),{color:"blueLink",numberOfLines:1,type:o("XPlatReactEnvironment").isWeb()?"bodyLink3":"body3",children:t})},onPress:n.onPress,testid:n.testid}:void 0,addOnStart:i,closeButton:S!==!0&&c.jsx(r("FDSCircleButton.react"),{"aria-label":s._(/*BTDS*/"Close"),icon:r("FBNucleusCrossFilled12Icon.react"),onPress:p,size:24,testid:void 0}),linkWrapper:R.onPress!=null||L!=null?function(e){return c.jsx(r("CometPressable.react"),babelHelpers.extends({},R,{expanding:!0,linkProps:L,xstyle:m.pressable,children:e}))}:void 0,message:function(t){var e=t.toastMessageId;return c.jsx(r("FDSText.react"),{color:"primary",id:e,numberOfLines:y?4:void 0,type:"body3",children:u})},onDismiss:p,testid:void 0,toastRef:l,useVerticalLayout:b})}p.displayName=p.name+" [from "+i.id+"]",l.default=p}),226);
__d("EBAPIMinosVerifySingleEpoch",["EBMinosLogger","EBMinosWasmVerifySingleEpoch","asyncToGeneratorRuntime","getSafeQplErrorMessage"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(e){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){o("EBMinosLogger").minosLogger.DEV(e||(e=babelHelpers.taggedTemplateLiteralLoose(["minosVerifySingleEpoch start"])));var n=t.qplFlow,r=t.minosEpochAnonId,a=t.minosMailboxAuthPublicKey,i=t.minosMailboxEncryptionPublicKey,l=t.minosMailboxSigningPublicKey,u=t.userId,c=t.selfEpochSignature;try{var d={epochNumber:r,mailboxAuthPk:a,mailboxEncryptionPk:i,mailboxSigningPk:l,previousEpochHead:t.previousEpochHead==null?void 0:t.previousEpochHead,userFbid:u};n.addPoint("verify_single_epoch_start");var m=yield o("EBMinosWasmVerifySingleEpoch").verifySingleEpoch({epochPublicData:d,signature:c});return n.addPoint("verify_single_epoch_end"),m.success?(n.endSuccess(),m.value.valid):(o("EBMinosLogger").minosLogger.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Unable to verify epoch - WASM error ",""])),m.error),n.endFailWithError("invalid-result",m.error),!1)}catch(e){return n.endFailWithError("runtime-error",o("getSafeQplErrorMessage").getSafeQPLErrorMessage(e)),!1}}),c.apply(this,arguments)}l.minosVerifySingleEpoch=u}),98);
__d("EBMinosVerifySingleEpoch",["EBAPIMinosVerifySingleEpoch","Promise","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e,t,n,r,o,a,i,l){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r,a,i,l,s,u,c){var d=yield o("EBAPIMinosVerifySingleEpoch").minosVerifySingleEpoch({minosEpochAnonId:t,minosMailboxAuthPublicKey:l,minosMailboxEncryptionPublicKey:i,minosMailboxSigningPublicKey:a,previousEpochHead:s,qplFlow:c,selfEpochSignature:u,userId:r});return(e||(e=n("Promise"))).resolve([d])}),u.apply(this,arguments)}l.minosVerifySingleEpoch=s}),98);
__d("EBWriteMinosMailboxKeysToCache",["EBAPIWriteMinosPublicKeysForRecipient","FBLogger","Promise","cr:12495","getErrorSafe","getSafeQplErrorMessage","promiseDone"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(t){var a=t.contactId,i=t.encryptionPublicKey,l=t.epochAnonId,u=t.epochHead,c=t.epochHeadCreationTime,d=t.publicKeyFbid,m=t.qplFlow;return m.addPoint("write_keys_start",{string:{contactId:a}}),n("cr:12495")!=null&&r("promiseDone")(n("cr:12495").writeStorageAlertAndAdminMessageBridgedAPI(a,u,c)),r("promiseDone")(o("EBAPIWriteMinosPublicKeysForRecipient").writeMinosMailboxKeysForRecipientAPI({contactId:a,encryptionPublicKey:i,epochAnonId:l,epochHead:u,epochHeadCreationTime:c,publicKeyFbid:d}),function(){m.addPoint("write_keys_end"),m.endSuccess()},function(t){var n=r("getErrorSafe")(t);m.addPoint("write_keys_end"),r("FBLogger")("wmi").MUSTFIX(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web minos] error writing minos mailbox keys to cache: ",""])),n.message),m.endFailWithError("runtime-error",o("getSafeQplErrorMessage").getSafeQPLErrorMessage(n))}),(s||(s=n("Promise"))).resolve()}l.writeMinosMailboxKeysToCache=u}),98);
__d("EncryptedBackupUploadFailureFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(t,n,r,o,a,i,l){"use strict";var e=r("getFalcoLogPolicy_DO_NOT_USE")("5728"),s=o("FalcoLoggerInternal").create("encrypted_backup_upload_failure",e),u=s;l.default=u}),98);
__d("LSAppendDataTraceAddonStoredProcedure",["LSAppendDataTraceAddon","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSAppendDataTraceAddon"),a.dataTraceId,a.checkPointId,a.syncChannel,a.errorMessage,a.tags);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("LSDataTraceType",[],(function(t,n,r,o,a,i){var e=Object.freeze({TASK:1,SYNC:2,RECEIVE_MSG:3,RICH_MEDIA_SEND:4,RICH_MEDIA_DOWNLOAD:5,TASK_CLIENT_MODE:6,ENCRYPTED_BACKUPS_FETCH_BACKUP_STATUS:69,ENCRYPTED_BACKUPS_INIT:70,ENCRYPTED_BACKUPS_ADD_DEVICE:71,ENCRYPTED_BACKUPS_UPLOAD:72,ENCRYPTED_BACKUPS_RESTORE:73,ENCRYPTED_BACKUPS_DELETE_BACKUP:75,ENCRYPTED_BACKUPS_CREATE_EXTRA_VIRTUAL_DEVICE:76,ENCRYPTED_BACKUPS_QR_ADD_DEVICE:77,ENCRYPTED_BACKUPS_SYNC_EPOCHS:78,ENCRYPTED_BACKUPS_OPEN_EPOCH:79,ENCRYPTED_BACKUPS_OPT_OUT_OF_BACKUP:80,ENCRYPTED_BACKUPS_MEDIA_BACKUP:81,ENCRYPTED_BACKUPS_MEDIA_RESTORE:82,ENCRYPTED_BACKUPS_THIRD_PARTY_ID_GENERATION:83,ENCRYPTED_BACKUPS_FETCH_BACKUPS_METADATA:86,ENCRYPTED_BACKUPS_REMOVE_VIRTUAL_DEVICE:87,ENCRYPTED_BACKUPS_QR_ADD_DEVICE_RECEIVER:88,ENCRYPTED_BACKUPS_DERIVE_AND_STORE_EPOCHS:89,ENCRYPTED_BACKUPS_GET_OPEN_EPOCH_KEYS:90,ENCRYPTED_BACKUPS_END_TO_END_THREAD_RESTORE:190,SAP_VESTA_REGISTRATION:251,SAP_VESTA_LOGIN:252,ENCRYPTED_BACKUPS_SHADOW_FETCH_BACKUP_STATUS:197,ENCRYPTED_BACKUPS_SHADOW_INIT:198,ENCRYPTED_BACKUPS_SHADOW_ADD_DEVICE:199,ENCRYPTED_BACKUPS_SHADOW_UPLOAD:200,ENCRYPTED_BACKUPS_SHADOW_RESTORE:201,ENCRYPTED_BACKUPS_SHADOW_DELETE_BACKUP:203,ENCRYPTED_BACKUPS_SHADOW_CREATE_EXTRA_VIRTUAL_DEVICE:204,ENCRYPTED_BACKUPS_SHADOW_QR_ADD_DEVICE:205,ENCRYPTED_BACKUPS_SHADOW_SYNC_EPOCHS:206,ENCRYPTED_BACKUPS_SHADOW_OPEN_EPOCH:207,ENCRYPTED_BACKUPS_SHADOW_QR_ADD_DEVICE_RECEIVER:216,ENCRYPTED_BACKUPS_ENCRYPTION_VERSIONING_UPSERT_VERSION_DATA:240,ENCRYPTED_BACKUPS_ENCRYPTION_VERSIONING_DELETE_VERSION_DATA:241,ENCRYPTED_BACKUPS_ENCRYPTION_VERSIONING_SYNC_VERSION_DATA:242,ENCRYPTED_BACKUPS_MESSAGE_INTEGRITY_CHECKER:243});i.default=e}),66);
__d("LSDataTraceFlush",["ArmadilloDataTraceType","I64","LSDataTraceType","LSIntEnum","ODS","Promise","ReQL","asyncToGeneratorRuntime","clearTimeout","gkx","promiseDone","setTimeout"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d=(s||(s=o("I64"))).of_string("120000"),m=s.of_string("600000"),p=new Set(["encrypted_backups_upload","encrypted_backups_media_backup"]);function _(e,t,n){var r=e.length;if(r===0)return[(s||(s=o("I64"))).neg_one,s.neg_one,void 0,void 0,void 0];var a=e.find(function(e){return e.errorMessage!=null}),i=a==null?void 0:a.errorMessage,l=e[e.length-1|0],u=(s||(s=o("I64"))).of_float(Date.now()),c=l.timestampMs,m=s.compare(s.sub(u,n),d)>=0;return!t&&m?[(s||(s=o("I64"))).sub(u,n),l.checkPointId,c,i,"trace expired"]:[s.sub(c,n),l.checkPointId,c,i,i]}function f(e){return e.reduce(function(e,t,n){var r,a=(s||(s=o("I64"))).to_string(t.checkPointId),i=t.timestampMs,l=s.to_string((r=t.syncChannel)!=null?r:(s||(s=o("I64"))).neg_one),u=t.tags,c=u!=null?","+u:"";if(n===0)e.pointsList="".concat("(",a,",",l,c,")");else{var d=String((s||(s=o("I64"))).to_int32(s.sub(i,e.lastCheckPointTimestamp)));e.pointsList=e.pointsList.concat("-",d,"-(",a,",",l,c,")")}return e.lastCheckPointTimestamp=i,e},{lastCheckPointTimestamp:(s||(s=o("I64"))).zero,pointsList:""}).pointsList}var g=s.of_string("2");function h(e){var t=e.traceType,n=(s||(s=o("I64"))).equal(t,(c||(c=o("LSIntEnum"))).ofNumber(r("LSDataTraceType").TASK))?"send":(s||(s=o("I64"))).equal(t,o("ArmadilloDataTraceType").armadilloMessageSend)?"armadillo send":(s||(s=o("I64"))).equal(t,(c||(c=o("LSIntEnum"))).ofNumber(r("LSDataTraceType").ENCRYPTED_BACKUPS_UPLOAD))?"encrypted_backups_upload":(s||(s=o("I64"))).equal(t,(c||(c=o("LSIntEnum"))).ofNumber(r("LSDataTraceType").ENCRYPTED_BACKUPS_RESTORE))?"encrypted_backups_restore":(s||(s=o("I64"))).equal(t,(c||(c=o("LSIntEnum"))).ofNumber(r("LSDataTraceType").ENCRYPTED_BACKUPS_MEDIA_BACKUP))?"encrypted_backups_media_backup":(s||(s=o("I64"))).equal(t,(c||(c=o("LSIntEnum"))).ofNumber(r("LSDataTraceType").SAP_VESTA_LOGIN))?"sap_vesta_login":(s||(s=o("I64"))).equal(t,(c||(c=o("LSIntEnum"))).ofNumber(r("LSDataTraceType").SAP_VESTA_REGISTRATION))?"sap_vesta_registration":(s||(s=o("I64"))).equal(t,(c||(c=o("LSIntEnum"))).ofNumber(r("LSDataTraceType").ENCRYPTED_BACKUPS_MEDIA_RESTORE))?"encrypted_backups_media_restore":(s||(s=o("I64"))).equal(t,(c||(c=o("LSIntEnum"))).ofNumber(r("LSDataTraceType").ENCRYPTED_BACKUPS_SHADOW_INIT))?"shadow_encrypted_backups_init":(s||(s=o("I64"))).equal(t,(c||(c=o("LSIntEnum"))).ofNumber(r("LSDataTraceType").ENCRYPTED_BACKUPS_SHADOW_ADD_DEVICE))?"shadow_encrypted_backups_add_device":(s||(s=o("I64"))).equal(t,(c||(c=o("LSIntEnum"))).ofNumber(r("LSDataTraceType").ENCRYPTED_BACKUPS_SHADOW_UPLOAD))?"shadow_encrypted_backups_upload":(s||(s=o("I64"))).equal(t,(c||(c=o("LSIntEnum"))).ofNumber(r("LSDataTraceType").ENCRYPTED_BACKUPS_SHADOW_RESTORE))?"shadow_encrypted_backups_restore":(s||(s=o("I64"))).equal(t,(c||(c=o("LSIntEnum"))).ofNumber(r("LSDataTraceType").ENCRYPTED_BACKUPS_SHADOW_DELETE_BACKUP))?"shadow_encrypted_backups_delete_backup":e.contextTwo;return n}function y(e,t){var n=t.traceId,r=t.shouldFlush,a=h(t),i=t.traceType,l=(s||(s=o("I64"))).equal(i,o("ArmadilloDataTraceType").armadilloMessageSend)?"tam_message_send":t.contextOne,u=(s||(s=o("I64"))).equal(t.traceType,g)?void 0:t.predefinedId,c=t.initTimestampMs;return o("ReQL").toArrayAsync(o("ReQL").fromTableAscending(e.data_trace_addon.index("traceIdAddonId")).getKeyRange(n)).then(function(e){var t=_(e,r,c),n=t[0],o=t[1],a=t[3],i=t[4],l=e.length,s=f(e)}).then(function(){return e.data_trace_meta.delete(n)})}function C(t,r){return o("ReQL").firstAsync(o("ReQL").fromTableAscending(t.data_trace_meta).getKeyRange(r)).then(function(r){return r!=null?y(t,r):(e||(e=n("Promise"))).resolve()})}var b={contents:void 0};function v(e){return o("ReQL").toArrayAsync(o("ReQL").fromTableAscending(e.data_trace_meta.index("shouldFlushInitTimestampMsTraceId")).getKeyRange(!1).bounds({lt:o("ReQL").key((s||(s=o("I64"))).sub(s.of_float(Date.now()),d))})).then(function(e){if(r("gkx")("23914")){var t=(s||(s=o("I64"))).of_float(Date.now());return e.filter(function(e){var n=h(e);if(n!=null&&p.has(n)){var r=(s||(s=o("I64"))).compare(s.sub(t,e.initTimestampMs),m)>=0;return r}return!0})}return e})}function S(e){return R.apply(this,arguments)}function R(){return R=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var r=yield v(t.tables);if(r.length!==0)return t.runInTransaction(function(t){return v(t).then(function(r){return(e||(e=n("Promise"))).all(r.map(function(e){return y(t,e)}))})},"readwrite",void 0,void 0,i.id+":287")}),R.apply(this,arguments)}function L(){var e=b.contents;if(e!=null){r("clearTimeout")(e);return}}function E(e){return r("promiseDone")(S(e),function(){L();var t=r("setTimeout")(function(){E(e)},6e4);b.contents=t},function(){L(),(u||(u=o("ODS"))).bumpEntityKey(3185,"mw_trace","error")}),L}var k=C,I=E,T={flush:k,flushExpiredDataTraces:I};l.default=T}),98);
__d("LSQplAnnotateInt.nop",["EBMarkerIdToQPLEvent","I64","Promise","QPLUserFlow","WAHashStringToNumber","nullthrows"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=function(a,i,l,u,c,d){try{var t,m=r("nullthrows")(o("EBMarkerIdToQPLEvent").markerIdToQPLEvent(l)),p=o("WAHashStringToNumber").hashStringToNumber(u);return r("QPLUserFlow").addAnnotations(m,{int:(t={},t[c]=(s||(s=o("I64"))).to_int32(d),t)},{instanceKey:p}),(e||(e=n("Promise"))).resolve()}catch(t){return(e||(e=n("Promise"))).resolve()}};u.__nop_name__="LSQplAnnotateInt",l.default=u}),98);
__d("XPlatReactVoprf.shared",[],(function(t,n,r,o,a,i){"use strict";var e=(function(e){function t(t){var n;return n=e.call(this,t)||this,n.message=t,n}return babelHelpers.inheritsLoose(t,e),t})(babelHelpers.wrapNativeSuper(Error));i.VoprfWasmError=e}),66);
__d("mapVoprfWasmError",["XPlatReactVoprf.shared"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e){switch(e){case-1:return new u;case 1:return new c;case 2:return new d;case 3:return new m;case 4:return new p;default:return new _}}var u=(function(e){function t(t){var n;return t===void 0&&(t="Unknown error encountered by VOPRF WASM"),n=e.call(this,t)||this,n.name="VoprfUnknownError",n}return babelHelpers.inheritsLoose(t,e),t})((e=o("XPlatReactVoprf.shared")).VoprfWasmError),c=(function(e){function t(t){var n;return t===void 0&&(t="Incorrect buffer length encountered by VOPRF WASM"),n=e.call(this,t)||this,n.name="VoprfBufferLengthError",n}return babelHelpers.inheritsLoose(t,e),t})(e.VoprfWasmError),d=(function(e){function t(t){var n;return t===void 0&&(t="Error while performing curve operation by VOPRF WASM"),n=e.call(this,t)||this,n.name="VoprfCurveOperationError",n}return babelHelpers.inheritsLoose(t,e),t})(e.VoprfWasmError),m=(function(e){function t(t){var n;return t===void 0&&(t="Error while performing hash operation by VOPRF WASM"),n=e.call(this,t)||this,n.name="VoprfHashOperationError",n}return babelHelpers.inheritsLoose(t,e),t})(e.VoprfWasmError),p=(function(e){function t(t){var n;return t===void 0&&(t="Error while performing proof operation by VOPRF WASM"),n=e.call(this,t)||this,n.name="VoprfProofError",n}return babelHelpers.inheritsLoose(t,e),t})(e.VoprfWasmError),_=(function(e){function t(t){var n;return t===void 0&&(t="Unknown error code received from WASM binary"),n=e.call(this,t)||this,n.name="UnknownErrorCode",n}return babelHelpers.inheritsLoose(t,e),t})(e.VoprfWasmError);l.mapVoprfWasmError=s,l.VoprfUnknownError=u,l.VoprfBufferLengthError=c,l.VoprfCurveOperationError=d,l.VoprfHashOperationError=m,l.VoprfProofError=p,l.UnknownErrorCode=_}),98);
__d("LSVoprfWasmBuilder",["FBLogger","Promise","asyncToGeneratorRuntime","err","getErrorSafe","mapVoprfWasmError"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e){return function(t){var o=t.locateFile!=null?{locateFile:t.locateFile}:{instantiateWasm:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,n){try{var o=yield t.getWasmModule(),a=yield WebAssembly.instantiate(o,e);return n(a),{}}catch(e){var i=r("getErrorSafe")(e);return r("FBLogger")("LSVoprfWasmBuilder").mustfix("instantiateWasm failed with error: %s",i.toString()),!1}});function o(t,n){return e.apply(this,arguments)}return o})()};return u(o,e)}}function u(t,a){return new(e||(e=n("Promise")))(function(e,n){a(t).then(function(t){var a,i=t._sodiumInit();i!==0&&n(r("err")("Failed to initialize Sodium!")),e({createCurveRistretto:function(){var e;try{return e=t._curve_create(),t._curve_init_ristretto(e),e}catch(n){throw e!=null&&t._curve_free(e),n}},freeCurve:function(n){t._curve_free(n)},createVoprfExpTwohashdh:function(n){var e;try{return e=t._voprf_create(),t._voprf_init_exp_twohashdh(e,n),e}catch(n){throw e!=null&&t._voprf_free(e),n}},freeVoprf:function(n){t._voprf_free(n)},getCurveBytes:function(n){return t._get_curve_element_bytes(n.curvePtr)},getCurveScalarBytes:function(n){return t._get_curve_scalar_bytes(n.curvePtr)},blind:function(n,r){var e,a,i;try{var l=t._get_curve_element_bytes(n.curvePtr),s=t._get_curve_scalar_bytes(n.curvePtr);e=t._malloc(l),a=t._malloc(s),i=d(t,r);var u=t._blind(n.voprfPtr,e,l,a,s,i,r.length);if(u!==0)throw o("mapVoprfWasmError").mapVoprfWasmError(u);var m=c(t,e,l),p=c(t,a,s);return{blindedElement:m,blindingFactor:p}}finally{[e,a,i].forEach(function(e){e!=null&&t._free(e)})}},verifiableUnblind:function(n,r,a,i,l,s,u,m){var e,p,_,f,g,h,y;try{e=r?d(t,r):null,p=a?d(t,a):null,_=d(t,s),f=d(t,i),g=d(t,l),h=d(t,u);var C=t._get_curve_element_bytes(n.curvePtr);y=t._malloc(C);var b=t._verifiable_unblind(n.voprfPtr,y,C,e,r?r.length:0,p,a?a.length:0,f,i.length,g,l.length,_,s.length,h,u.length,+m);if(b!==0)throw o("mapVoprfWasmError").mapVoprfWasmError(b);var v=c(t,y,C);return{unblindedElement:v}}finally{[e,p,_,f,g,h,y].forEach(function(e){e!=null&&t._free(e)})}},clientFinalize:function(n,r,a){var e,i,l;try{e=d(t,r),i=d(t,a);var s=t._get_voprf_final_evaluation_bytes(n.voprfPtr);l=t._malloc(s);var u=t._voprf_client_finalize(n.voprfPtr,l,s,e,r.length,i,a.length);if(u!==0)throw o("mapVoprfWasmError").mapVoprfWasmError(u);var m=c(t,l,s);return{finalEvaluation:m}}finally{[e,i,l].forEach(function(e){e!=null&&t._free(e)})}},setup:function(n){var e,r;try{var a=t._get_curve_scalar_bytes(n.curvePtr),i=t._get_curve_element_bytes(n.curvePtr);e=t._malloc(a),r=t._malloc(i);var l=t._voprf_setup(n.voprfPtr,r,i,e,a);if(l!==0)throw o("mapVoprfWasmError").mapVoprfWasmError(l);var s=c(t,r,i),u=c(t,e,a);return{sk:s,pk:u}}finally{[e,r].forEach(function(e){e!=null&&t._free(e)})}},evaluate:function(n,r,a,i){var e,l,s,u,m;try{var p=t._get_curve_element_bytes(n.curvePtr);e=t._malloc(p);var _=i?t._get_curve_scalar_bytes(n.curvePtr):0;l=_>0?t._malloc(_):null;var f=i?t._get_curve_scalar_bytes(n.curvePtr):0;s=f>0?t._malloc(f):null,u=d(t,a),m=d(t,r);var g=t._voprf_evaluate(n.voprfPtr,e,p,l,_,s,f,m,r.length,u,a.length,+i);if(g!==0)throw o("mapVoprfWasmError").mapVoprfWasmError(g);var h=l!==null?c(t,l,_):null,y=s!==null?c(t,s,f):null,C=c(t,e,p);return{proofC:h,proofS:y,evaluatedElement:C}}finally{[e,l,s,u,m].forEach(function(e){e!=null&&t._free(e)})}},serverFinalize:function(n,r,a){var e,i,l;try{e=d(t,r),i=d(t,a);var s=t._get_voprf_final_evaluation_bytes(n.voprfPtr);l=t._malloc(s);var u=t._voprf_server_finalize(n.voprfPtr,l,s,e,r.length,i,a.length);if(u!==0)throw o("mapVoprfWasmError").mapVoprfWasmError(u);var m=c(t,l,s);return{finalEvaluation:m}}finally{[e,i,l].forEach(function(e){e!=null&&t._free(e)})}},wasmMemory:(a=t.wasmMemory)!=null?a:void 0})}).catch(function(e){throw r("err")("Failed to initialize wasm module, "+e)})})}function c(e,t,n){for(var r=new Uint8Array(n),o=0;o<n;++o)r[o]=e.getValue(o+t,"i8");return r}function d(e,t){var n=t.length,r=e._malloc(n);return e.writeArrayToMemory(t,r),r}l.default=s}),98);
__d("LSVoprfWasm",["LSVoprfWasmBuilder","bx","ls_voprf_utils_v2"],(function(t,n,r,o,a,i,l){"use strict";var e=r("bx").getURL(r("bx")("30933")),s=function(){return e},u=r("LSVoprfWasmBuilder")(r("ls_voprf_utils_v2"));l.locateFile=s,l.LSVoprfWasm=u}),98);
__d("LogWebQplNOP",["I64","LSIntEnum","Promise","QPLUserFlow","WAHashStringToNumber","WALogger","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c;function d(e){var t=e==null?null:(c||(c=o("I64"))).to_int32(e);switch(t){case 521476165:return r("qpl")._(521476165,"2432");case 521481602:return r("qpl")._(521481602,"829");default:return null}}function m(t,a,i,l,m,p){return new(s||(s=n("Promise")))(function(n,s){try{var _=m?(u||(u=o("LSIntEnum"))).unwrapIntEnum(m):null,f=d(a);if(f!=null&&i!=null){var g,h={int:{num_messages:(c||(c=o("I64"))).to_int32(l)},string:{message_count:String(l),taskSource:(g=_==null?void 0:_.toString())!=null?g:"unknown"}};p===!0?r("QPLUserFlow").endSuccess(f,{annotations:h,instanceKey:o("WAHashStringToNumber").hashStringToNumber(t)}):p===!1?r("QPLUserFlow").endFailure(f,i,{annotations:h,instanceKey:o("WAHashStringToNumber").hashStringToNumber(t)}):(r("QPLUserFlow").addAnnotations(f,h,{instanceKey:o("WAHashStringToNumber").hashStringToNumber(t)}),r("QPLUserFlow").addPoint(f,i,{instanceKey:o("WAHashStringToNumber").hashStringToNumber(t)}))}n()}catch(t){o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["LSLogWebQpl error: ",""])),t),n()}})}l.call=m}),98);
__d("MAWClientConsistencyRefresh",["ClientConsistencyEventEmitter","CurrentAppID"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=o("CurrentAppID").getAppID();switch(t){case String(772021112871879):r("ClientConsistencyEventEmitter").emit("hardRefresh",e);break;default:r("ClientConsistencyEventEmitter").emit("softRefresh",e)}}l.default=e}),98);
__d("MAWWorkerOnClose",["MAWSetupWorkerAuxStateForLogging","MAWWaitForBackendSetup","MAWWebWorkerSingleton","QPLUserFlow","pageID","promiseDone","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e=r("qpl")._(1056841865,"2862");function s(t,n,a){r("QPLUserFlow").start(e,{annotations:{string:{currentWorkerId:o("MAWWaitForBackendSetup").getCurrentWorkerID(),pageID:r("pageID"),terminationMsgType:n,terminationReason:t,workerID:a},string_array:{pastWorkerTerminationMsgTypes:o("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.restartMessageTypes,pastWorkerTerminationReasons:o("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.restartReasons}}})}function u(t){r("promiseDone")(o("MAWWebWorkerSingleton").getWorkerHealthStatus(),function(n){return r("QPLUserFlow").endSuccess(e,{annotations:{bool:babelHelpers.extends({},n.data),string:{healthStatusAfter:n.tag,outcome:t}}})})}function c(t,n){r("promiseDone")(o("MAWWebWorkerSingleton").getWorkerHealthStatus(),function(o){return r("QPLUserFlow").endFailure(e,t,{annotations:{bool:babelHelpers.extends({},o.data),string:{healthStatusAfter:o.tag}},error:n})})}l.ON_WORKER_CLOSED_HANDLER_QPL=e,l.startQPL=s,l.success=u,l.fail=c}),98);
__d("MAWWorkerWatchdog",["MAWBridgeLoggingUtils","MAWBridgeSendAndReceive","MAWSetupWorkerAuxStateForLogging","MAWWaitForBackendSetup","MAWWebWorkerSingleton","MAWWorkerWatchdogRecovery","Promise","QPLUserFlow","err","justknobx","promiseDone","qpl","setInterval","setTimeout"],(function(t,n,r,o,a,i,l){"use strict";var e,s=r("justknobx")._("4240"),u=s/2,c=r("qpl")._(1056847415,"2909"),d=!1,m=!1,p=["shared_not_exists","shared_exists_not_connected"];function _(){var t;return r("QPLUserFlow").start(c,{annotations:{bool:{workerTerminatedPermanently:(t=o("MAWSetupWorkerAuxStateForLogging")).WorkerLifeCycleState.workerTerminatedPermanently},int:{workerAge:t.WorkerLifeCycleState.getWorkerAge()},string:{currentWorkerId:o("MAWWaitForBackendSetup").getCurrentWorkerID()},string_array:{pastWorkerTerminationMsgTypes:t.WorkerLifeCycleState.restartMessageTypes,pastWorkerTerminationReasons:t.WorkerLifeCycleState.restartReasons}}}),(e||(e=n("Promise"))).race([o("MAWBridgeSendAndReceive").sendAndReceive("backend",o("MAWBridgeLoggingUtils").HEARTBEAT_ROUTE),new e(function(e,t){r("setTimeout")(function(){t(r("err")("Armadillo web worker heartbeat timed out."))},u)})]).then(function(){r("QPLUserFlow").endSuccess(c),o("MAWSetupWorkerAuxStateForLogging").addWorkerHeartbeatToHistory("OK")},function(e){f(),o("MAWSetupWorkerAuxStateForLogging").addWorkerHeartbeatToHistory("ERROR"),r("promiseDone")(o("MAWWebWorkerSingleton").getWorkerHealthStatus(),function(t){return r("QPLUserFlow").endFailure(c,"heartbeat_timeout",{annotations:{bool:babelHelpers.extends({},t.data),string:{workerHealthStatus:t.tag}},error:e})})})}function f(){r("QPLUserFlow").addPoint(c,"starting-lock-based-recovery"),r("promiseDone")(o("MAWWebWorkerSingleton").getWorkerHealthStatus().then(function(e){var t=o("MAWWorkerWatchdogRecovery").getWorkerRecoveryForWatchdog(),n=o("MAWWaitForBackendSetup").getCurrentWorkerID();if(p.includes(e.tag)&&t!=null)return t("locks_based_recovery",n,"locks_based_recovery")}))}function g(){m||(r("setInterval")(function(){d&&r("promiseDone")(_())},s),o("MAWWaitForBackendSetup").runAfterBackendSetup(function(){d=!0},o("MAWBridgeLoggingUtils").HEARTBEAT_ROUTE),m=!0)}l.HEARTBEAT_TIMEOUT_INTERVAL=u,l.MAW_WORKER_HEARTBEAT_QPL=c,l.startWatchdog=g}),98);
__d("MAWSetupWorker",["CurrentAppID","Deferred","IGDWebUtils","MAWBridgeObserver","MAWClientConsistencyRefresh","MAWCommonSetupWorker","MAWCrossWorkerPortal","MAWInit","MAWLoggerUtils","MAWMIC","MAWSetupWorkerAuxStateForLogging","MAWUnrecoverableDbErrors","MAWWaitForBackendSetup","MAWWebWorkerSingleton","MAWWorkerOnClose","MAWWorkerWatchdog","MWFBLogger","QPLUserFlow","SharedWorkerBundleResource","SharedWorkerV2ResourceExperimental","asyncToGeneratorRuntime","cr:6600","gkx","promiseDone","shouldUseMAWSharedWorker"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p=o("MWFBLogger").MWLogger().tags([o("MAWLoggerUtils").Tag.WorkerSetup,o("MAWLoggerUtils").Tag.MAWInit]),_=o("IGDWebUtils").isInstagramWebSupportedApp(Number(o("CurrentAppID").getAppID())),f=_?"IGDAWMainWorker":"MAWMainWorker",g=null,h=!1;function y(e){h=e,o("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.workerTerminatedPermanently=e}function C(){return h}function b(e){switch(e){case"mawInit":return!0;case"mawReinitSetupMutex":case"mawReinitReregDevice":case"bridgeRecovery":case"workerUpgraded":case"rebootRequired":case"workerTerminated":default:return!1}}function v(e,t,n,r,o,a,i){return S.apply(this,arguments)}function S(){return S=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,a,i,l,c,d,m){if(C())throw p.mustfixThrow("Worker is permanently killed.");o("MAWWaitForBackendSetup").markBackendSetupStarted();var _=function(n){return v(t,a,i,l,n,d,m)};(c==="bridgeRecovery"||c==="backendSetupFailure")&&r("QPLUserFlow").addPoint(o("MAWBridgeObserver").BAD_STATE_RECOVERY_QPL,"create_worker_start"),o("MAWWebWorkerSingleton").setOnCloseForWorkerInstance(function(e,t,n){o("MAWWorkerOnClose").startQPL(e,n,t);var a=e!=null?e:"unknown",i=M(a)&&o("MAWWaitForBackendSetup").isBackendSetupSettled();if(o("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.restartReasons.push(a),o("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.restartMessageTypes.push(n!=null?n:"unknown"),o("MAWWaitForBackendSetup").getCurrentWorkerID()==null||t!==o("MAWWaitForBackendSetup").getCurrentWorkerID()){o("MAWInit").MAWInit.logPoint(a+"_worker_termination_skipped"),o("MAWMIC").addPoint(a+"_worker_termination_skipped"),o("MAWWorkerOnClose").success(a+"_worker_restart_skipped"),p.warn("Worker termination skipped %s. Terminate reason: %s, Worker: %s, current worker: %s",c,e,t,o("MAWWaitForBackendSetup").getCurrentWorkerID());return}o("MAWWaitForBackendSetup").resetCurrentWorkerSkipIdCheck(),p.warn("Worker termination started %s. Terminate reason: %s, Worker: %s",c,e,t),o("MAWInit").MAWInit.logPoint(a+"_worker_terminated"),o("MAWMIC").addPoint(a+"_worker_terminated"),o("MAWInit").MAWInit.addStringArrayAnnotation("workerTerminationReason",o("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.restartReasons),o("MAWMIC").addStringArrayAnnotation("workerTerminationReason",o("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.restartReasons),o("MAWInit").MAWInit.addStringArrayAnnotation("workerTerminationMsgType",o("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.restartMessageTypes),o("MAWMIC").addStringArrayAnnotation("workerTerminationMsgType",o("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.restartMessageTypes);var l=e==="requested-upgrade"?"workerUpgraded":a+"_worker_terminated";r("promiseDone")(P(),function(){if(i){y(!0),p.warn("Tab displays soft refresh. Flow: %s",a),o("MAWInit").MAWInit.logPoint(a+"_soft_refresh"),o("MAWMIC").addPoint(a+"_soft_refresh"),r("MAWClientConsistencyRefresh")("maw_request_refresh"),o("MAWWorkerOnClose").success("softRefresh");return}if(a!=="logout")return _(l).then(function(){return o("MAWWorkerOnClose").success(l)}).catch(function(e){o("MAWInit").MAWInit.fail("worker_restart_failed",e),o("MAWWorkerOnClose").fail("workerUpgradeFailed",e),o("MAWWaitForBackendSetup").rejectBackendSetup(e)});o("MAWWorkerOnClose").success("skip_logout")})});var h=yield o("MAWWebWorkerSingleton").createWorkerIfNone(c),b=h.worker,S=h.workerID;o("MAWWaitForBackendSetup").setCurrentWorker(S);var R=new(r("Deferred"));g=R.getPromise(),(c==="bridgeRecovery"||c==="backendSetupFailure")&&r("QPLUserFlow").addPoint(o("MAWBridgeObserver").BAD_STATE_RECOVERY_QPL,"create_worker_end");var L=o("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker();p.DEBUG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["worker setting up with reason: ",", use shared worker: ",""])),c,L),L&&b.addEventListener("message",function(e){var t,n;typeof e.data=="object"&&((t=e.data)==null?void 0:t.type)==="sw-shutdown"&&typeof e.data.response=="object"&&((n=e.data.response)==null?void 0:n.reason)==="maw-request-refresh"&&r("MAWClientConsistencyRefresh")("maw_request_refresh")});var E=new(o("MAWCommonSetupWorker")).BridgeAdapter(b,f);return yield a(E),R.resolve(E),p.DEBUG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["bridge promise resolved"]))),o("MAWMIC").addPoint(c+"_connect_to_backend"),yield o("MAWInit").MAWInit.measurePerformance(c+"-init_backend",n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=function(n){return o("MAWCommonSetupWorker").initWorker({bridge:E,ebState:n,onWorkerAlreadySetup:i,onWorkerRestart:_,reason:c,vaultMaterials:t})},n=L?yield e(m):yield E.fullyConnected.then(function(){return e(m)});o("MAWWaitForBackendSetup").resolveBackendSetup(n),p.DEBUG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["backend setup successful"])))})),o("MAWWaitForBackendSetup").waitForBackendSetup("setup-worker")}),S.apply(this,arguments)}function R(e,t,n,a,i,l,s){var u=v(e,t,n,a,i,l,s);return b(i)&&r("promiseDone")(o("MAWWaitForBackendSetup").waitForBackendSetup("init bridge recovery observer").then(function(){o("MAWBridgeObserver").initUnackedMessagesObserver({onConnectToExistingWorker:n,onTerminateWorker:a,onWorkerConnect:t,updateWorkerState:l,vaultMaterials:e}),o("MAWWorkerWatchdog").startWatchdog()})),u}function L(){return g}function E(e){return k.apply(this,arguments)}function k(){return k=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){return p.debug("Terminating dedicated worker: %s. Bridge Promise: %s",e,!!g),g?(p.DEBUG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["worker terminating: for ",""])),e),yield P(),!0):(p.DEBUG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["worker doesn't exist, no need to terminate"]))),!1)}),k.apply(this,arguments)}function I(){return T.apply(this,arguments)}function T(){return T=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield E("terminateWorkerPermanently"),y(!0)}),T.apply(this,arguments)}function D(e,t){var a=r("gkx")("7313");return a?o("SharedWorkerV2ResourceExperimental").terminateSharedWorker(n("cr:6600"),e?"maw-request-refresh":t!=null?t:"unknown"):o("SharedWorkerBundleResource").terminateSharedWorker(n("cr:6600"),null,e?"maw-request-refresh":t!=null?t:"unknown")}function x(e){return $.apply(this,arguments)}function $(){return $=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=o("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker();if(t){p.debug("Terminating shared worker: %s",e);var n=yield D(!1,e).then(function(){return!0},function(){return!1});p.DEBUG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Shared worker responded to termination request: ",""])),n)}else yield E(e)}),$.apply(this,arguments)}function P(){return N.apply(this,arguments)}function N(){return N=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e;p.debug("Updating worker state on termination"),(e=yield g)==null||e.close(),g=null,o("MAWWaitForBackendSetup").resetBackendSetup(),o("MAWCrossWorkerPortal").killPortalWhenWorkerTerminating(),o("MAWWebWorkerSingleton").resetWorkerCreation()}),N.apply(this,arguments)}function M(e){return!!(e==="MAWEARKeychainDecryptionError"||o("MAWUnrecoverableDbErrors").isUnrecoverableDbErrorByName(e)||e==="update-required-fbid_change"||e==="update-required-vault_materials_change")}l.setPreventWorkerRestart=y,l.getOrSetupWorker=R,l.waitForWorkerSetup=L,l.terminateDedicatedWorker=E,l.terminateWorkerPermanently=I,l.killSharedWorker=D,l.terminateWorker=x}),98);
__d("MAWWorkerReboot",["EBIsEbEnabled","FBLogger","MAWBridgeObserver","MAWSetupWorker","MAWWaitForBackendSetup","ODS","Promise","QPLUserFlow","asyncToGeneratorRuntime","getErrorSafe","gkx","pageID","shouldUseMAWSharedWorker"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(e){(s||(s=o("ODS"))).bumpEntityKey(3185,"armadillo_shared_worker_reboot","shared_worker_reboot_"+e)}var c=o("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker(),d=function(t){switch(t){case"bridge_recovery":return"bridgeRecovery";case"backend_setup_failure":return"backendSetupFailure"}};function m(t,a,i,l,s,m){r("QPLUserFlow").start(o("MAWBridgeObserver").BAD_STATE_RECOVERY_QPL,{annotations:{bool:{isSharedWorker:c},string:{trigger:s,workerInitPageID:r("pageID")}}}),r("FBLogger")("messenger_web").info("Rebooting worker started."),u("start"),o("MAWWaitForBackendSetup").resetBackendSetup();var p=d(s);return r("QPLUserFlow").addPoint(o("MAWBridgeObserver").BAD_STATE_RECOVERY_QPL,"terminate_worker_start"),new(e||(e=n("Promise")))(function(e,s){return o("MAWSetupWorker").terminateWorker(p).then(n("asyncToGeneratorRuntime").asyncToGenerator(function*(){r("QPLUserFlow").addPoint(o("MAWBridgeObserver").BAD_STATE_RECOVERY_QPL,"terminate_worker_end"),r("FBLogger")("messenger_web").info("Reboot process killed existing worker successfully.");var n;if(r("gkx")("1458"))try{n=yield o("EBIsEbEnabled").isEBEnabled()}catch(e){r("FBLogger")("wmi_eb").mustfix("Failed to get EB state during worker reboot: %s",r("getErrorSafe")(e).message),n=void 0}else n=void 0;return o("MAWSetupWorker").getOrSetupWorker(t,a,i,l,p,m,n).then(function(t){r("FBLogger")("messenger_web").info("Rebooting worker success. Reason for reboot: %s",p),u("success"),r("QPLUserFlow").endSuccess(o("MAWBridgeObserver").BAD_STATE_RECOVERY_QPL),a(t),e()})})).catch(function(e){r("FBLogger")("messenger_web").info("Rebooting worker failed. Error message: %s",e.message),u("fail"),r("QPLUserFlow").endFailure(o("MAWBridgeObserver").BAD_STATE_RECOVERY_QPL,e.message),o("MAWWaitForBackendSetup").rejectBackendSetup(e),s(e)})})}l.rebootWorker=m}),98);
__d("MAWBridgeObserver",["FBLogger","MAWWaitForBackendSetup","MAWWorkerReboot","promiseDone","qex","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e=r("qpl")._(1056840252,"808"),s=5,u=[],c=!1,d,m=function(){u=[]},p=function(t){if(h()){if(o("MAWWaitForBackendSetup").isBackendSetupInProgress()){m();return}if(g().length>=s&&!o("MAWWaitForBackendSetup").isBackendSetupInProgress()){r("FBLogger")("messenger_web").info("Minimum threshold of unacked messages reached: %s. Unacked messages: %s",s,JSON.stringify(g()));var e=r("qex")._("440"),n=r("qex")._("468")||s;e===!0&&g().length>=n?(r("FBLogger")("messenger_web").info("QE threshold of unacked messages reached: %s. Unacked messages: %s",s,JSON.stringify(g())),m(),r("promiseDone")(_())):(r("FBLogger")("messenger_web").info("Bridge recovery attempt skipped. Reason for skipped: maw_bridge_recovery_v2_enabled: %s, maw_bridge_recovery_threshold: %s",e,n),u.push(t))}else u.push(t)}},_=function(){return r("FBLogger")("messenger_web").info("Starting bridge recovery attempt."),o("MAWWorkerReboot").rebootWorker(d.vaultMaterials,d.onWorkerConnect,d.onConnectToExistingWorker,d.onTerminateWorker,"bridge_recovery",d.updateWorkerState).then(function(){r("FBLogger")("messenger_web").info("Bridge recovery attempt successful. Worker has restarted.")},function(e){throw r("FBLogger")("messenger_web").info("Bridge recovery attempt failed. Worker has failed to restart. Error: %s",e.message),e})},f=function(t){c=!0,d=t},g=function(){return u},h=function(){return c},y=function(){return d};l.BAD_STATE_RECOVERY_QPL=e,l.MIN_UNACKED_EVENTS_THRESHOLD=s,l.resetUnackedMessages=m,l.notifyUnackedEvent=p,l.attemptRecovery=_,l.initUnackedMessagesObserver=f,l.getUnackedMessages=g,l.getIsObserverActive=h,l.getProps=y}),98);
__d("MAWGetDBVersionForTest",["justknobx"],(function(t,n,r,o,a,i,l){"use strict";function e(){if(r("justknobx")._("1495")){var e=new URL(document.location.href),t=e.searchParams.get("db_version");if(t!=null){if(t==="current"||t==="latest")return t;var n=parseInt(t,10);if(Number.isInteger(n))return Number(n)}}}l.getDbVersionForTest=e}),98);
__d("MAWCommonSetupWorker",["Deferred","FBLogger","MAWCurrentUser","MAWGetDBVersionForTest","MAWInit","MAWMIC","MAWSetupWorker","MAWWaitForBackendSetup","MAWWebWorkerSingleton","MessengerWebInitData","Promise","WADevToolMessageChannel","WALogger","WorkerClient","WorkerMessagePort","err","gkx","pageID","promiseDone","shouldUseMAWSharedWorker"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=r("gkx")("3282"),c=(function(e){function t(t,n){var r;return r=e.call(this,t,n)||this,r.onmessage=null,r.$BridgeAdapter$p_1=t,o("WorkerClient").init(r),r.onUnhandledMessage.add(function(e){r.onmessage&&r.onmessage({data:e})}),r.addMessageListener("worker-setup",function(e){e.status==="worker-ready"&&o("MAWInit").MAWInit.addBoolAnnotation("workerReadyReceived",!0)}),r}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.getBridgePort=function(){return this},t})(o("WorkerMessagePort").WorkerSyncedMessagePort);function d(e){var t=e.bridge,n=e.ebState,a=e.reason,i=e.vaultMaterials,l=new(r("Deferred"));return t.addMessageListener("worker-setup",function(t){return m(e,l,t)}),t.addMessageListener("worker-setup-ack",function(e){return p(e,a)}),f(t,i,n),r("promiseDone")(o("MAWWebWorkerSingleton").doesWorkerExist(),function(e){return o("MAWInit").MAWInit.addBoolAnnotation("workerExistsOnSetup",e)}),r("promiseDone")(o("MAWWebWorkerSingleton").getWorkerHealthStatus(),function(e){return o("MAWInit").MAWInit.addStringAnnotation("workerHealthStatus",e.tag)}),l.getPromise()}function m(e,t,n){var a;if(n.setupHash===r("pageID"))switch(n.status){case"success":t.resolve(e.bridge.getBridgePort());break;case"failure":t.reject(r("err")((a=n.msg)!=null?a:"Error setting up worker"));break;case"already-setup":return _(e,t,n);default:throw o("MAWInit").MAWInit.addBoolAnnotation("invalidSetupMessageReceived",!0),r("FBLogger")("messenger_web").mustfixThrow("Invalid message for worker: "+n.status)}}function p(e,t){var n;if(e.setupHash===r("pageID")){o("MAWInit").MAWInit.logPoint(t+"_backend_setup_ack"),o("MAWMIC").addPoint(t+"_backend_setup_ack");var a=(n=e.backendState)!=null?n:"none";o("MAWInit").MAWInit.addStringAnnotation("backendAckState",a),o("MAWMIC").addStringAnnotation("backendAckState",a)}}function _(t,a,i){var l=t.bridge,u=t.onWorkerAlreadySetup,c=t.onWorkerRestart,d=t.reason;switch(i.action){case"no-action":{a.resolve(l.getBridgePort()),u(),o("MAWInit").MAWInit.logPoint(d+"_backend_already_setup"),o("MAWMIC").addPoint(d+"_backend_already_setup");break}case"reboot-required":{var m;o("WALogger").DEV(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Terminating worker and rebooting..."]))),o("MAWMIC").addPoint(d+"_worker_rebooting"),o("MAWInit").MAWInit.logPoint(d+"_worker_rebooting");var p=(m=i==null?void 0:i.reason)!=null?m:"none";o("MAWInit").MAWInit.addStringAnnotation("workerRebootReason",p),o("MAWMIC").addStringAnnotation("workerRebootReason",p);var _=o("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker()?(s||(s=n("Promise"))).resolve(o("MAWWaitForBackendSetup").resetCurrentWorkerWithId(o("MAWWaitForBackendSetup").getCurrentWorkerID())):o("MAWSetupWorker").terminateDedicatedWorker("reboot required");return _.then(function(){return c("rebootRequired").then(function(e){return a.resolve(e)}).catch(function(e){return a.reject(e)})})}default:throw i.action,r("FBLogger")("messenger_web").mustfixThrow("Invalid action for worker-setup:already-setup: "+i.action)}}function f(e,t,n){var a={content:{createdAt:r("MessengerWebInitData").createdAt,ebState:n,fbId:o("MAWCurrentUser").getID(),sessionId:r("MessengerWebInitData").sessionId,testDbVersion:o("MAWGetDBVersionForTest").getDbVersionForTest(),userKeyBase:r("MessengerWebInitData").userKeyBase,vaultMaterials:t},setupHash:r("pageID"),type:"worker-setup"};if(u){o("MAWInit").MAWInit.addBoolAnnotation("devToolsEnabled",!0);var i=o("WADevToolMessageChannel").createNewChannel();a.content.devToolMessageChannelPort2=i.port2,e.postMessage(a,[i.port2])}else e.postMessage(a)}l.BridgeAdapter=c,l.initWorker=d}),98);
__d("MAWDefaultE2eeOneToOneEligibility",["LSContactBitOffset"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.maybeContact,n=t!=null&&o("LSContactBitOffset").has(83,t);return n}l.isContactDefaultE2eeOneToOneEligible=e}),98);
__d("MAWMainThreadLogger",["CurrentMessengerUser","FBLogger","MAWAppVersion","MAWConsoleLogger","MAWDeleteOldLogsFromDisk","MAWLeakDetection","MAWLoggerUtils","MAWLoggingSwitches","MAWSaveLogToDisk","Promise","WAJids","WATagsLogger","asyncToGeneratorRuntime","err","getErrorSafe","promiseDone"],(function(t,n,r,o,a,i,l){"use strict";var e,s=!1;function u(){s=!1}function c(){s||(s=!0,o("WATagsLogger").initializeWaLogger(S))}var d=function(){return r("FBLogger")("messenger_web")};function m(e,t){var n=p(e);n!=null&&o("MAWLoggerUtils").logToHistory("log",n,t,!1)}function p(e){if(!(!o("CurrentMessengerUser").isEmployee()&&!o("CurrentMessengerUser").isTestUser())){var t=o("WAJids").maybeSanitizeLogLineText(e);return t=o("MAWLeakDetection").maybeReplaceVaultedString(t),t}}function _(e,t){var n=o("WAJids").maybeSanitizeLogLineText(e);n=o("MAWLeakDetection").maybeReplaceVaultedString(n),o("MAWLoggerUtils").logToHistory("log",n,t,!1)}function f(e,t){var n=o("WAJids").maybeSanitizeLogLineText(e);n=o("MAWLeakDetection").maybeReplaceVaultedString(n),o("MAWLoggerUtils").logToHistory("log",n,t,!1)}function g(e,t){var n=o("WAJids").maybeSanitizeLogLineText(e);n=o("MAWLeakDetection").maybeReplaceVaultedString(n),d().tags(t.map(function(e){return String(e)})).warn(n)}function h(e,t,n,o,a,i){var l=r("err")(n);l.stack=o,r("promiseDone")(b(e,t,l,a,i))}function y(e,t){return C.apply(this,arguments)}function C(){return C=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r){var a=o("MAWLeakDetection").maybeReplaceVaultedString(o("WAJids").maybeSanitizeLogLineText(t)),i=o("MAWLoggingSwitches").removeLoggingFromBridge?o("MAWSaveLogToDisk").getLastNEntries(r):(e||(e=n("Promise"))).resolve([]),l=r===0?[]:[].concat((yield i).map(function(e){return e.args}));return{logs:[].concat(l),sanitizedMessage:a}}),C.apply(this,arguments)}function b(e,t,n,r,o){return v.apply(this,arguments)}function v(){return v=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,a,i){var l,s,u=o("MAWLeakDetection").maybeReplaceVaultedString(o("WAJids").maybeSanitizeLogLineText(e)),c=n!=null?n:r("err")(u),m=a!=null?a:n==null?2:0,p=i!=null?i:0,_=yield y(c.message,p),f=_.logs,g=_.sanitizedMessage,h=r("getErrorSafe")(c);try{c.message=g}catch(e){h=r("err")(g,c.fileName,c.lineNumber)}m!==0&&(h.framesToPop=m),(l=d())==null||(s=l.addMetadata("MESSENGER_E2EE_WEB","APP_VERSION",o("MAWAppVersion").getVersionNumber()).tags(t.map(function(e){return String(e)})).catching(h)).mustfix.apply(s,[g].concat(f))}),v.apply(this,arguments)}var S={count:function(t,n){o("MAWConsoleLogger").logToConsole("count",t,n)},debug:function(t,n){o("MAWConsoleLogger").logToConsole("log",t,n)},devConsole:function(t,n,r){for(var e=arguments.length,a=new Array(e>3?e-3:0),i=3;i<e;i++)a[i-3]=arguments[i];switch(t){case"COUNT":o("MAWConsoleLogger").logToConsole.apply(void 0,["count",n,r].concat(a));break;case"DEV":o("MAWConsoleLogger").logToConsole.apply(void 0,["log",n,r].concat(a));break;case"DEV_XMPP":o("MAWConsoleLogger").logToConsole.apply(void 0,["log",n,r].concat(a));break;case"LOG":o("MAWConsoleLogger").logToConsole.apply(void 0,["info",n,r].concat(a));break;case"WARN":o("MAWConsoleLogger").logToConsole.apply(void 0,["warn",n,r].concat(a));break;case"ERROR":o("MAWConsoleLogger").logToConsole.apply(void 0,["error",n,r].concat(a));break;case"CATCHING":o("MAWConsoleLogger").logToConsole.apply(void 0,["error",n,r].concat(a));break}},error:function(t,n,a){r("promiseDone")(b(t,n,a)),o("MAWConsoleLogger").logToConsole("error",t,n)},info:function(t,n){f(t,n),o("MAWConsoleLogger").logToConsole("info",t,n)},logRestricted:function(t,n){m(t,n),o("MAWConsoleLogger").logToConsole("log",t,n)},warn:function(t,n){g(t,n),o("MAWConsoleLogger").logToConsole("warn",t,n)}};function R(){return o("MAWLoggingSwitches").removeLoggingFromBridge?o("MAWSaveLogToDisk").getEntriesFromDb():(e||(e=n("Promise"))).resolve([])}function L(){return E.apply(this,arguments)}function E(){return E=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){o("MAWLoggingSwitches").removeLoggingFromBridge&&(yield o("MAWDeleteOldLogsFromDisk").clearLogs())}),E.apply(this,arguments)}function k(e){return new Date(typeof e=="string"?parseInt(e,10):e).toISOString().replace("T"," ").replace("Z","")}function I(e){return e.map(function(e){try{var t=k(e.date);return[t,e.level,e.category,e.event,e.args].join(" | ")}catch(e){var n=r("getErrorSafe")(e);return[k(Date.now()),"error","LOGGER","Error formatting log: "+((n==null?void 0:n.message)||"")].join(" | ")}}).filter(Boolean).join("\n")}l.__testClearLoggerSetup=u,l.setupMainWaLogger=c,l.logRestricted=m,l.count=_,l.info=f,l.warn=g,l.logError=h,l.getEntries=R,l.clearEntries=L,l.formatEntries=I}),98);
__d("MAWSubscribeToContactNames",["fbt","$InternalEnum","Env","MAWLocalizationType","gkx"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u=n("$InternalEnum").Mirrored(["FIRST_NAME","FULL_NAME"]),c=[o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_MENTIONED_STORY_IG,o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_LEFT_GROUP],d=(e||(e=r("Env"))).isMessengerDotComOnComet?"Messenger":r("gkx")("22979")?"Instagram":"Facebook";function m(){return s._(/*BTDS*/"{Platform Name} User",[s._param("Platform Name",d)]).toString()}function p(e,t){var n;return(n=e.get(t))!=null?n:m()}function _(e){return c.includes(e)?u.FULL_NAME:u.FIRST_NAME}l.ContactNameMode=u,l.getUnknownUser=m,l.getContactNameFromLookup=p,l.getContactNameModeFromLocalizationType=_}),226);
__d("MWGetOtherContactOrSelf",["I64","ReQL","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e,t,n){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n,r){var a=yield o("ReQL").toArrayAsync(o("ReQL").fromTableAscending(r.tables.participants).getKeyRange(t));if(a.length===1){var i=a[0];return o("ReQL").firstAsync(o("ReQL").fromTableAscending(r.tables.contacts).getKeyRange(i.contactId))}if(!(a.length>2)){var l=a.find(function(t){return!(e||(e=o("I64"))).equal(t.contactId,n)});if(l!=null)return o("ReQL").firstAsync(o("ReQL").fromTableAscending(r.tables.contacts).getKeyRange(l.contactId))}}),u.apply(this,arguments)}l.getOtherContactOrSelf=s}),98);
__d("hasDefaultThreadOneToOneCapability",["FBLogger","LSContactBitOffset","MAWDefaultE2eeOneToOneEligibility","MWGetOtherContactOrSelf","ReQL","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){if(e==null)return!1;var n=yield o("ReQL").firstExnAsync(o("ReQL").fromTableAscending(t.tables._user_info).map(function(e){return e.facebookUserId})),a=yield o("ReQL").firstAsync(o("ReQL").fromTableAscending(t.tables.contacts).getKeyRange(n));if(a==null)return r("FBLogger")("messenger_search").warn("Error fetching viewer details"),!1;var i=o("LSContactBitOffset").has(80,a);if(!i)return!1;var l=yield o("ReQL").firstAsync(o("ReQL").fromTableAscending(t.tables.contacts).getKeyRange(e)),s=yield o("MWGetOtherContactOrSelf").getOtherContactOrSelf(e,n,t),u=s!=null?s:l;return o("MAWDefaultE2eeOneToOneEligibility").isContactDefaultE2eeOneToOneEligible({maybeContact:u})}),s.apply(this,arguments)}l.default=e}),98);
/**
 * License: https://www.facebook.com/legal/license/ZMc_bSwzLKC/
 */
__d("ristretto255-0.1.1",["tweetnacl-1.0.3"],(function(t,n,r,o,a,i,l){var e=r("tweetnacl-1.0.3")();Uint8Array.prototype.slice||Object.defineProperty(Uint8Array.prototype,"slice",{value:function(t,n){return new Uint8Array(Array.prototype.slice.call(this,t,n))}});var s={},u=e.lowlevel,c=u.gf([1]);function d(){return[u.gf(),u.gf(),u.gf(),u.gf()]}var m=new Uint8Array([226,242,174,10,106,188,78,113,168,132,169,97,197,0,81,95,88,227,11,106,165,130,221,141,182,166,89,69,224,141,45,118]),p=new Float64Array([235,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function _(e,t,n){for(var r=new Float64Array(64),o=0;o<32;o++)for(var a=0;a<32;a++)r[o+a]+=t[o]*n[a];u.modL(e,r)}function f(e,t){_(e,t,t)}function g(e,t){for(var n=0;n<32;n++)e[n]=t[n];for(var r=251;r>=0;r--)f(e,e),(p[r>>3]>>(r&7)&1)!==0&&_(e,e,t)}var h=u.gf([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]),y=u.gf([11803,18811,63136,32407,21693,7032,36364,44957,53757,12789,64713,3900,18604,11139,12735,14185]),C=u.gf([16618,32861,64938,39368,29374,23105,5655,40239,55360,65025,31633,5826,64674,53167,35077,30828]),b=u.gf([49526,37983,2497,57980,13583,52574,41272,11393,57316,48752,43997,39316,57559,45747,29352,656]),v=u.gf([19744,17645,23210,12717,6553,45086,18988,53918,20203,21147,54063,19676,8769,63084,45946,22888]);function S(e){var t=new Uint8Array(32);u.pack25519(t,e);for(var n=1,r=0;r<32;r++)n&=t[r]===0;return n}function R(e,t,n){for(var r,o=-n,a=0;a<16;a++)r=e[a]^t[a],r&=o,e[a]^=r}function L(e){var t=new Uint8Array(32);return u.pack25519(t,e),t[0]&1}function E(e,t){u.Z(e,u.gf(),t)}function k(e,t,n){var r=u.gf();E(r,t),u.set25519(e,t),R(e,r,n)}function I(e,t){k(e,t,L(t))}function T(e,t,n){var r=u.gf(),o=u.gf(),a=u.gf(),i=u.gf(),l=u.gf(),s=u.gf();u.S(r,n),u.M(r,r,n),u.S(e,r),u.M(e,e,n),u.M(e,e,t),u.pow2523(e,e),u.M(e,e,r),u.M(e,e,t),u.S(o,e),u.M(o,o,n),u.Z(a,o,t),u.A(i,o,t),u.M(l,t,h),u.A(l,o,l);var c=S(a),d=S(i),m=S(l);return u.M(s,e,h),R(e,s,d|m),I(e,e),c|d}function D(e){var t=u.gf(),n=u.gf(),r=u.gf(),o=u.gf(),a=u.gf(),i=u.gf(),l=u.gf(),s=u.gf(),d=u.gf(),m=u.gf(),p=u.gf(),_=u.gf(),f=u.gf(),g=u.gf(),y=u.gf(),b=u.gf(),v=u.gf(),S=0,E=new Uint8Array(32);return u.A(m,e[2],e[1]),u.Z(v,e[2],e[1]),u.M(m,m,v),u.M(p,e[0],e[1]),u.S(_,p),u.M(_,m,_),T(a,c,_),u.M(t,a,m),u.M(n,a,p),u.M(b,t,n),u.M(b,b,e[3]),u.M(i,e[0],h),u.M(l,e[1],h),u.M(o,t,C),u.M(d,e[3],b),S=L(d),f=u.gf(e[0]),g=u.gf(e[1]),r=u.gf(n),R(f,l,S),R(g,i,S),R(r,o,S),u.M(y,f,b),k(g,g,L(y)),u.Z(s,e[2],g),u.M(s,r,s),I(s,s),u.pack25519(E,s),E}function x(e){for(var t=e[31]&127^127,n=30;n>0;n--)t|=e[n]^255;t=(t|0)-1>>8;var r=236-(e[0]|0)>>8;return 1-((t&r|e[0])&1|(e[31]&255)>>7)}function $(e,t){var n=u.gf(),r=u.gf(),o=u.gf(),a=u.gf(),i=u.gf(),l=u.gf(),s=u.gf(),d=u.gf(),m=u.gf(),p=u.gf();if(x(t)===0)return-1;u.unpack25519(o,t),u.S(a,o),u.set25519(i,c),u.Z(i,i,a),u.S(s,i),u.set25519(l,c),u.A(l,l,a),u.S(d,l),u.M(m,u.D,s),E(m,m),u.Z(m,m,d),u.M(p,m,d),u.set25519(r,c);var _=T(n,r,p);return u.M(e[0],n,l),u.M(e[1],n,e[0]),u.M(e[1],e[1],m),u.M(e[0],e[0],o),u.A(e[0],e[0],e[0]),I(e[0],e[0]),u.M(e[1],i,e[1]),u.set25519(e[2],c),u.M(e[3],e[0],e[1]),-(1-_|L(e[3])|S(e[1]))}function P(e,t){var n=u.gf(),r=u.gf(),o=u.gf(),a=u.gf(),i=u.gf(),l=u.gf(),s=u.gf(),d=u.gf(),m=u.gf(),p=u.gf(),_=u.gf(),f=u.gf(),g=u.gf(),C=u.gf();u.set25519(o,c),u.S(a,t),u.M(a,h,a),u.A(m,a,o),u.M(m,m,b),u.set25519(n,c),E(n,n),u.A(i,a,u.D),u.M(p,a,u.D),u.Z(p,n,p),u.M(p,p,i);var S=1-T(l,m,p);u.M(s,l,t),I(s,s),E(s,s),R(l,s,S),R(n,a,S),u.Z(r,a,o),u.M(r,r,n),u.M(r,r,v),u.Z(r,r,p),u.A(_,l,l),u.M(_,_,p),u.M(f,r,y),u.S(d,l),u.Z(g,o,d),u.A(C,o,d),u.M(e[0],_,C),u.M(e[1],g,f),u.M(e[2],f,C),u.M(e[3],_,g)}function N(e){var t=u.gf(),n=u.gf(),r=d(),o=d();return u.unpack25519(t,e.slice(0,32)),u.unpack25519(n,e.slice(32,64)),P(r,t),P(o,n),u.add(r,o),r}function M(e){var t=d();return u.scalarbase(t,e),D(t)}function w(e,t){var n=d(),r=d();if($(n,t)!==0)throw new Error("Invalid argument");return u.scalarmult(r,n,e),D(r)}function A(e){var t=d();return $(t,e)!==-1}function F(e,t){var n=d(),r=d();if($(n,e)===-1)throw new Error("Invalid argument");if($(r,t)===-1)throw new Error("Invalid argument");return[n,r]}function O(e,t){var n=F(e,t),r=n[0],o=n[1];return u.add(r,o),D(r)}function B(e,t){var n=u.gf();E(n,t[3]);var r=u.gf();E(r,t[0]);var o=[r,t[1],t[2],n];u.add(e,o)}function W(e,t){var n=F(e,t),r=n[0],o=n[1];return B(r,o),D(r)}function q(){var t=e.randomBytes(64);return N(t)}function U(e){return D(N(e))}function V(){return D(q())}function H(){var t=new Uint8Array(32),n=0;do{t=e.randomBytes(32),t[31]&=31;var r=32,o=1;do r--,n|=t[r]-u.L[r]>>8&o,o&=(t[r]^u.L[r])-1>>8;while(r!==0)}while(n===0);return t}function G(e){var t=new Uint8Array(32);return g(t,e),t}function z(e){for(var t=new Float64Array(64),n=0;n<32;n++)t[n]=-e[n];var r=new Uint8Array(32);return u.modL(r,t),r}function j(e,t){for(var n=new Float64Array(64),r=0;r<32;r++)n[r]=e[r]+t[r];var o=new Uint8Array(32);return u.modL(o,n),o}function K(e,t){return j(e,z(t))}function Q(e,t){var n=new Uint8Array(32);return _(n,e,t),n}s.scalarMultBase=M,s.scalarMult=w,s.isValid=A,s.add=O,s.sub=W,s.fromHash=U,s.getRandom=V,s.basePoint=m,s.scalar={},s.scalar.getRandom=H,s.scalar.invert=G,s.scalar.negate=z,s.scalar.add=j,s.scalar.sub=K,s.scalar.mul=Q,s.unsafe={},s.unsafe.point={},s.unsafe.point.toBytes=D,s.unsafe.point.fromBytes=$,s.unsafe.point.fromHash=N,s.unsafe.point.sub=B,s.unsafe.point.add=u.add,s.unsafe.point.scalarMultBase=u.scalarbase,s.unsafe.point.scalarMult=u.scalarmult,s.unsafe.point.getRandom=q,s.unsafe.point.alloc=d,s.unsafe.constants={},s.unsafe.constants.LSub2=p,s.unsafe.constants.sqrtm1=h,s.unsafe.constants.sqrtadm1=y,s.unsafe.constants.invsqrtamd=C,s.unsafe.constants.onemsqd=b,s.unsafe.constants.sqdmone=v,i.exports=s}),34);
__d("ristretto255",["ristretto255-0.1.1"],(function(t,n,r,o,a,i){a.exports=n("ristretto255-0.1.1")}),null);