;/*FB_PKG_DELIM*/

__d("ACSCipherSuiteModule",[],(function(t,n,r,o,a,i){"use strict";var e={hash:"SHA-512",name:"HMAC"},l={curveName:"RISTRETTO",macAlgorithm:e,value:1},s=new Map([[l.value,l]]);function u(e){return s.has(e)?s.get(e):null}i.VOPRF_RISTRETTO_HMACSHA512=l,i.getACSCipherSuiteByValue=u}),66);
__d("ACSTokenHmacUtil",["XPlatReactCrypto"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n){return s(e,t).then(function(e){return c(e,n)})}function s(e,t){return o("XPlatReactCrypto").subtleImportKey("raw",t,e,!1,["sign"]).then(function(t){return{algo:e,key:t}})}function u(e){return typeof e.hash=="string"?e.hash:e.hash.name}function c(e,t){var n=e.algo,r=e.key,a={hash:u(n),name:"HMAC"};return o("XPlatReactCrypto").subtleSign(a,r,t).then(function(e){return new Uint8Array(e)})}l.hmac=e}),98);
__d("BinarySearch",["FBLogger"],(function(t,n,r,o,a,i,l){"use strict";var e={GREATEST_LOWER_BOUND:"GREATEST_LOWER_BOUND",GREATEST_STRICT_LOWER_BOUND:"GREATEST_STRICT_LOWER_BOUND",LEAST_STRICT_UPPER_BOUND:"LEAST_STRICT_UPPER_BOUND",LEAST_UPPER_BOUND:"LEAST_UPPER_BOUND",NEAREST:"NEAREST"},s=function(t,n){if(typeof t!="number"||typeof n!="number")throw r("FBLogger")("comet_infra").mustfixThrow("The default comparator can only be used with sequences of numbers.");return t-n},u=e.GREATEST_LOWER_BOUND,c=e.GREATEST_STRICT_LOWER_BOUND,d=e.LEAST_STRICT_UPPER_BOUND,m=e.LEAST_UPPER_BOUND,p=e.NEAREST;function _(e,t,n,r,o){o===void 0&&(o=s);var a=m,i=g(e,t,n,r,o,a);if(n<=i&&i<r){var l=e(i);return o(l,t)===0?l:void 0}else return}function f(e,t,n,r,o){o===void 0&&(o=s);var a=m,i=g(e,t,n,r,o,a);return n<=i&&i<r&&o(e(i),t)===0?i:-1}function g(e,t,n,o,a,i){switch(i){case m:return h(e,t,n,o,a);case u:return y(e,t,n,o,a);case d:return C(e,t,n,o,a);case c:return b(e,t,n,o,a);case p:return v(e,t,n,o,a);default:throw r("FBLogger")("comet_infra").mustfixThrow("Invalid mode %s",i)}}function h(e,t,n,r,o){for(var a=n,i=r;a+1<i;){var l=a+Math.floor((i-a)/2);o(e(l),t)>=0?i=l:a=l}return a<i&&o(e(a),t)>=0?a:i}function y(e,t,n,r,o){return C(e,t,n,r,o)-1}function C(e,t,n,r,o){for(var a=n,i=r;a+1<i;){var l=a+Math.floor((i-a)/2);o(e(l),t)>0?i=l:a=l}return a<i&&o(e(a),t)>0?a:i}function b(e,t,n,r,o){return h(e,t,n,r,o)-1}function v(e,t,n,r,o){var a=y(e,t,n,r,o),i=Math.abs(o(e(a),t)),l=Math.abs(o(e(a+1),t));return i<l?Math.max(a,n):Math.min(a+1,r-1)}function S(e,t,n){return _(function(t){return e[t]},t,0,e.length,n)}function R(e,t,n){return f(function(t){return e[t]},t,0,e.length,n)}function L(e,t,n,r){return g(function(t){return e[t]},t,0,e.length,n,r)}l.GREATEST_LOWER_BOUND=u,l.GREATEST_STRICT_LOWER_BOUND=c,l.LEAST_STRICT_UPPER_BOUND=d,l.LEAST_UPPER_BOUND=m,l.NEAREST=p,l.find=_,l.findIndex=f,l.findBound=g,l.leastUpperBound=h,l.greatestLowerBound=y,l.leastStrictUpperBound=C,l.greatestStrictLowerBound=b,l.nearest=v,l.findInArray=S,l.findIndexInArray=R,l.findBoundInArray=L}),98);
__d("LSMaxInt32",["I64"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(e||(e=o("I64"))).of_int32(2147483647);l.default=s}),98);
__d("CreateDerivedKeys",["CryptoLogger","I64","LSMaxInt32","LSVec","Promise","RetUtil","XPlatReactCrypto"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(t,a,i,l){var u=o("CryptoLogger").CryptoLogger("create_derived_keys");if(l.length<1||l.some(function(e){return(s||(s=o("I64"))).gt(e,r("LSMaxInt32"))}))return u.mustfix("Invalid key lengths for derive keys"),(e||(e=n("Promise"))).resolve(o("RetUtil").getNullableRetResult(void 0));var c=l.map((s||(s=o("I64"))).to_int32),d=l.map(s.to_int32).reduce(function(e,t){return e+t},0),m=function(t){for(var e=[],n=0,a=0,i=c.length;a<i;++a){var l=n+c[a];e.push(t.slice(n,l).buffer),n=l}return o("RetUtil").getNullableRetResult(r("LSVec").ofArray(e))};return o("XPlatReactCrypto").subtleImportKey("raw",i,"HKDF",!1,["deriveBits"]).then(function(e){return o("XPlatReactCrypto").subtleDeriveBits({hash:"SHA-256",info:t,name:"HKDF",salt:a!=null?a:new Uint8Array(10).buffer},e,d*8)}).then(function(e){var t=new Uint8Array(e);return m(t)}).catch(function(e){return u.catching(e).mustfix("Failed to create derived keys"),o("RetUtil").getNullableRetResult()})}l.CreateDerivedKeys=u}),98);
__d("DoubleKeyMap",[],(function(t,n,r,o,a,i){"use strict";var e=(function(){function e(){this.$1=new Map}var t=e.prototype;return t.set=function(t,n,r){var e=this.$1.get(t);e||this.$1.set(t,e=new Map),e.set(n,r)},t.get=function(t,n){var e;return(e=this.$1.get(t))==null?void 0:e.get(n)},t.delete=function(t,n){var e=this.$1.get(t);e&&(e.delete(n),e.size===0&&this.$1.delete(t))},t.getAll=function(t){return this.$1.get(t)},t.deleteAll=function(t){this.$1.delete(t)},e})();i.DoubleKeyMap=e}),66);
__d("EBAPIQPLPoints",["QPLUserFlow"],(function(t,n,r,o,a,i,l){"use strict";var e={CREATE_WORKER_NETWORK_EXECUTE_END:"create_worker_network_execute_end",CREATE_WORKER_NETWORK_EXECUTE_START:"create_worker_network_execute_start",GRAPHQL_QUERY_END:"graphql_query_end",GRAPHQL_QUERY_START:"graphql_query_start"},s={CLIENT_STATE_RETRIEVED:"client_state_retrieved",EB_NOT_ENABLED:"eb_not_enabled",EBLS_NOT_INITIALIZED:"ebls_not_initialized",EMPTY_DECRYPTION_RESPONSE:"empty_decryption_response",INVALID_CLIENT_STATE:"invalid_client_state",INVALID_GRAPHQL_RESPONSE:"invalid_graphql_response",INVALID_PARAMETERS:"invalid_parameters",LSDB_SINGLETON_RETRIEVED:"lsdb_singleton_retrieved",NO_CLIENT_STATE:"no_client_state",NULL_CHAT_JID:"null_chat_jid",RUNTIME_ERROR:"runtime_error",UNSUPPORTED_CONTEXT:"unsupported_context"},u=babelHelpers.extends({},e),c=babelHelpers.extends({},e,s,{BACKUP_ID_NULL:"backup_id_null",BATCH_RESTORE_AND_DECRYPT_FAILURE:"batch_restore_and_decrypt_failure",DELETE_MAILBOX:"delete_mailbox",DERIVE_AND_STORE_EPOCHS_END:"derive_and_store_epochs_end",DERIVE_AND_STORE_EPOCHS_START:"derive_and_store_epochs_start",SERVER_SIDE_EXCEPTION:"server_side_exception"}),d={ADDED_ATTACHMENT_CONTEXT:"added_attachment_context",ADDED_ATTACHMENT_CONTEXT_LEGACY:"added_attachment_context_legacy",DEQUEUE:"added_to_queue_end",ENQUEUE:"added_to_queue_start",ENQUEUE_FAILURE:"enqueue_failure",GENERATE_BACKUP_DIRECTIVE_END:"generate_backup_directive_end",GENERATE_BACKUP_DIRECTIVE_START:"generate_backup_directive_start",GENERATE_REPORTING_META_END:"generate_reporting_meta_end",GENERATE_REPORTING_META_START:"generate_reporting_meta_start",GET_ATTACHMENT_CONTEXT_END:"get_attachment_context_end",GET_ATTACHMENT_CONTEXT_START:"get_attachment_context_start",MESSAGE_RESULT_FAILURE_OR_NULL:"message_result_failure_or_null",NO_INCOMING_MESSAGES:"no_incoming_messages",NO_PROCESSED_MESSAGES:"no_processed_messages",PROCESSED_MESSAGES:"processed_messages",RUNTIME_ERROR:"runtime_error",SUCCESSFULLY_PROCESSED_MESSAGE:"successfully_processed_message",UKNOWN_MESSAGE_VERSION_OR_PROTOCOL:"unknown_message_version_or_protocol",UNABLE_TO_CREATE_BACKUP_DIRECTIVE:"unable_to_create_backup_directive",UNKNOWN_MESSAGE_TYPE:"unknown_message_type",UNSUPPORTED_MESSAGE_TYPE:"unsupported_message_type",UPLOAD_DELETED_MESSAGE:"upload_deleted_message",UPLOAD_PAYLOAD_CREATED:"upload_payload_creation_success",UPLOAD_PAYLOAD_CREATION_FAILURE:"upload_payload_creation_failure",UPLOAD_PAYLOAD_CREATION_START:"upload_payload_creation_start"},m={ADD_DEVICE_CHECK_RC_STATUS:"add_device_check_rc_status",ADD_DEVICE_COULD_NOT_FIND_BACKUP:"add_device_could_not_find_backup",ADD_DEVICE_EBSM_API_START:"add_device_ebsm_api_start",ADD_DEVICE_FAILED_DEVICE_REGISTRATION_ID_NULL:"add_device_failed_device_registration_id_null",ADD_DEVICE_FAILED_TO_GET_RC_STATUS:"add_device_failed_to_get_rc_status",ADD_DEVICE_FAILURE_BACKUP_NOT_FOUND:"add_device_failure_backup_not_found",ADD_DEVICE_OPTIMISTIC_STATUS:"add_device_optimistic_status",ADD_DEVICE_RUNTIME_ERROR:"add_device_runtime_error",ADD_DEVICE_SPROC_END:"add_device_sproc_end",ADD_DEVICE_SPROC_FAILURE:"add_device_sproc_failure",ADD_DEVICE_SPROC_START:"add_device_sproc_start",ADD_DEVICE_SUBSCRIPTION_END:"add_device_subscription_end",ADD_DEVICE_SUBSCRIPTION_START:"add_device_subscription_start",ADD_DEVICE_TASK_END:"add_device_task_end",ADD_DEVICE_TASK_START:"add_device_task_start",ADD_DEVICE_TIMEOUT:"add_device_timeout",ADD_DEVICE_WAIT_FOR_EBLS_END:"add_device_wait_for_ebls_end",ADD_DEVICE_WAIT_FOR_EBLS_START:"add_device_wait_for_ebls_start",INVALID_RECOVERY_CODE:"invalid_recovery_code",ON_START_BEGIN:"on_start_start",ON_START_SUCCESS:"on_start_end",OTC_ADD_DEVICE_SPROC_END:"otc_add_device_sproc_end",OTC_ADD_DEVICE_SPROC_ERROR:"otc_add_device_sproc_error",OTC_ADD_DEVICE_SPROC_FAILURE:"otc_add_device_sproc_failure",OTC_ADD_DEVICE_SPROC_START:"otc_add_device_sproc_start",OTC_ADD_DEVICE_SUCCESS:"otc_add_device_success",OTC_ADD_DEVICE_SYSTEM_ERROR:"otc_add_device_system_error",OTC_ADD_DEVICE_UNEXPECTED_RECOVERY_CODE_STATUS:"otc_add_device_unexpected_rc_status"},p={ADD_DEVICE_FETCH_VD_GRAPHQL_END:"add_device_fetch_vd_graphql_end",ADD_DEVICE_FETCH_VD_GRAPHQL_FAIL:"add_device_fetch_vd_graphql_fail",ADD_DEVICE_FETCH_VD_GRAPHQL_START:"add_device_fetch_vd_graphql_start",ADD_DEVICE_GQL_END:"add_device_gql_end",ADD_DEVICE_GQL_FAIL:"add_device_gql_fail",ADD_DEVICE_GQL_START:"add_device_gql_start",ADD_DEVICE_MISSING_GRAPHQL_FIELDS:"add_device_missing_graphql_fields",ADD_DEVICE_PARSE_RECOVERY_CODE_END:"add_device_parse_recovery_code_end",ADD_DEVICE_PARSE_RECOVERY_CODE_FAIL:"add_device_parse_recovery_code_fail",ADD_DEVICE_PARSE_RECOVERY_CODE_START:"add_device_parse_recovery_code_start",ADD_DEVICE_VIRTUAL_DEVICE_EXISTS:"add_device_virtual_device_exists",ADD_DEVICE_VIRTUAL_DEVICE_KEY_SPROC_END:"add_device_vd_key_sproc_end",ADD_DEVICE_VIRTUAL_DEVICE_KEY_SPROC_FAIL:"add_device_vd_key_sproc_fail",ADD_DEVICE_VIRTUAL_DEVICE_KEY_SPROC_START:"add_device_vd_key_sproc_start"},_={FETCH_BACKUP_IDS_END:"fetch_backup_ids_end",FETCH_BACKUP_IDS_START:"fetch_backup_ids_start",GET_DB_END:"get_db_end",GET_DB_START:"get_db_start",INITIALIZE_BACKUP_END:"initialize_backup_end",INITIALIZE_BACKUP_FAIL:"initialize_backup_fail",INITIALIZE_BACKUP_FAIL_NO_RECOVERY_CODE:"initialize_backup_fail_no_recovery_code",INITIALIZE_BACKUP_RUNNING:"initialize_backup_running",INITIALIZE_BACKUP_SPROC_END:"initialize_backup_sproc_end",INITIALIZE_BACKUP_SPROC_FAIL:"initialize_backup_sproc_fail",INITIALIZE_BACKUP_SPROC_START:"initialize_backup_sproc_start",INITIALIZE_BACKUP_START:"initialize_backup_start",INITIALIZE_BACKUP_SUBSCRIPTION_DELETE:"initialize_backup_subscription_delete",INITIALIZE_BACKUP_TIMEOUT:"initialize_backup_timeout",INITIALIZE_BACKUP_WORKER_START:"initialize_backup_worker_start",OPTIMISTIC_CLIENT_STATE:"optimistic_client_state"},f={DELETE_EB_BRIDGE_CALL_START:"delete_eb_bridge_call_start",DELETE_EB_GET_DB_END:"delete_eb_get_db_end",DELETE_EB_GET_DB_START:"delete_eb_get_db_start",DELETE_EB_NON_DELETE_OPERATION:"delete_eb_non_delete_operation",DELETE_EB_NON_PUT_OPERATION:"delete_eb_non_put_operation",DELETE_EB_SPROC_ERROR:"delete_eb_sproc_error",DELETE_EB_SPROC_FAIL:"delete_eb_sproc_fail",DELETE_EB_SPROC_START:"delete_eb_sproc_start",DELETE_EB_SPROC_SUCCESS:"delete_eb_sproc_success",DELETE_EB_START:"delete_eb_start",DELETE_EB_TASK_FAIL:"delete_eb_task_fail",DELETE_EB_TASK_START:"delete_eb_task_start",DELETE_EB_TASK_SUCCESS:"delete_eb_task_success",DELETE_EB_WORKER_START:"delete_eb_worker_start",FETCH_BACKUP_IDS_END:"fetch_backup_ids_end",FETCH_BACKUP_IDS_START:"fetch_backup_ids_start"},g={FETCH_BACKUP_IDS_END:"fetch_backup_ids_end",FETCH_BACKUP_IDS_START:"fetch_backup_ids_start",OPT_OUT_BACKUP_ROW_EXISTS:"opt_out_backup_row_exists",OPT_OUT_BACKUP_ROW_NULL:"opt_out_backup_row_null",OPT_OUT_BACKUP_SPROC_END:"opt_out_backup_sproc_end",OPT_OUT_BACKUP_SPROC_FAIL:"opt_out_backup_sproc_fail",OPT_OUT_BACKUP_SPROC_START:"opt_out_backup_sproc_start",OPT_OUT_BACKUP_TASK_END:"opt_out_backup_task_end",OPT_OUT_BACKUP_TASK_FAIL:"opt_out_backup_task_fail",OPT_OUT_BACKUP_TASK_START:"opt_out_backup_task_start",OPT_OUT_BACKUP_WORKER_START:"opt_out_backup_worker_start",OPT_OUT_BRIDGE_CALL_START:"opt_out_bridge_call_start",OPT_OUT_START:"opt_out_start"},h={SYNC_EPOCH_SPROC_END:"sync_epoch_sproc_end",SYNC_EPOCH_SPROC_START:"sync_epoch_sproc_start",SYNC_EPOCH_TIMEOUT:"sync_epoch_timeout"},y={REVOKE_VIRTUAL_DEVICE_DB_END:"revoke_virtual_device_get_db_end",REVOKE_VIRTUAL_DEVICE_DB_ERROR:"revoke_virtual_device_get_db_error",REVOKE_VIRTUAL_DEVICE_DB_START:"revoke_virtual_device_get_db_start",REVOKE_VIRTUAL_DEVICE_SPROC_ERROR:"revoke_virtual_device_sproc_error",REVOKE_VIRTUAL_DEVICE_SPROC_FAILURE:"revoke_virtual_device_sproc_failure",REVOKE_VIRTUAL_DEVICE_STATUS_INTERNAL_ERROR:"revoke_virtual_device_get_status_internal_error"},C={DERIVE_AND_STORE_EPOCHS_END:"derive_and_store_epochs_end",DERIVE_AND_STORE_EPOCHS_START:"derive_and_store_epochs_start",FETCH_VIRTUAL_DEVICE_END:"fetch_virtual_device_end",FETCH_VIRTUAL_DEVICE_START:"fetch_virtual_device_start",GET_CLIENT_STATE_END:"get_client_state_end",GET_CLIENT_STATE_START:"get_client_state_start",GET_EPOCHS_END:"get_epochs_end",GET_EPOCHS_START:"get_epochs_start",REPAIR_EPOCH_QUERY_END:"repair_epoch_query_end",REPAIR_EPOCH_QUERY_START:"repair_epoch_query_start",REPAIR_EPOCH_RETRY_END:"repair_epoch_retry_end",REPAIR_EPOCH_RETRY_START:"repair_epoch_retry_start",UNREACHABLE_EPOCH_FALLBACK_START:"unreachable_epoch_fallback_start"},b={CLEAR_CLIENT_STATE_END:"clear_client_state_end",CLEAR_CLIENT_STATE_START:"clear_client_state_start",CLEAR_ENCRYPTED_BACKUPS_END:"clear_encrypted_backups_end",CLEAR_ENCRYPTED_BACKUPS_START:"clear_encrypted_backups_start",CLEAR_EPOCHS_END:"clear_epochs_end",CLEAR_EPOCHS_START:"clear_epochs_start",CLEAR_METADATA_END:"clear_metadata_end",CLEAR_METADATA_START:"clear_metadata_start",CLEAR_PENDING_BACKUPS_END:"clear_pending_backups_end",CLEAR_PENDING_BACKUPS_START:"clear_pending_backups_start",CLEAR_RECOVERY_CODE_END:"clear_recovery_code_end",CLEAR_RECOVERY_CODE_START:"clear_recovery_code_start",CLEAR_RECOVERY_CODE_STATUS_END:"clear_recovery_code_status_end",CLEAR_RECOVERY_CODE_STATUS_START:"clear_recovery_code_status_start",CLEAR_VIRTUAL_DEVICES_END:"clear_virtual_devices_end",CLEAR_VIRTUAL_DEVICES_START:"clear_virtual_devices_start",FETCH_BACKUP_IDS_END:"fetch_backup_ids_end",FETCH_BACKUP_IDS_START:"fetch_backup_ids_start",GET_DB_END:"get_db_end",GET_DB_START:"get_db_start",TRANSACTION_END:"transaction_end",TRANSACTION_START:"transaction_start"};function v(e,t,n,o,a){r("QPLUserFlow").addPoint(t,n,{data:babelHelpers.extends({},o,{bool:{runningInWorker:e}}),instanceKey:a})}function S(e,t,n,o,a){r("QPLUserFlow").endFailure(t,n,{annotations:babelHelpers.extends({},a,{bool:{runningInWorker:e}}),instanceKey:o})}function R(e,t,n,o){r("QPLUserFlow").endSuccess(t,{annotations:babelHelpers.extends({},o,{bool:{runningInWorker:e}}),instanceKey:n})}l.EBAPIQPLCommonPoints=e,l.EBAPIQPLCommonErrorPoints=s,l.EBMessageMetadataQPLPoints=u,l.EBMessageRestoreQueryQPLPoints=c,l.EBUploadQueueQPLPoints=d,l.EBAddDeviceQPLPoints=m,l.EBAddDeviceGraphqlQPLPoints=p,l.EBBackupInitQPLPoints=_,l.EBDeleteEBQPLPoints=f,l.EBOptOutQPLPoints=g,l.EBSyncEpochsQPLPoints=h,l.EBRevokeVirtualDeviceQPLPoints=y,l.EBRepairEpochsQPLPoints=C,l.EBDeleteBackupsOnClientQPLPoints=b,l.ebAPIAddQPLPoint=v,l.ebAPIEndFailure=S,l.ebAPIEndSuccess=R}),98);
__d("EBAPIWorkerCheck",[],(function(t,n,r,o,a,i){"use strict";function e(){try{return WorkerGlobalScope!==void 0&&self instanceof WorkerGlobalScope}catch(e){return!1}}i.runningInWorker=e}),66);
__d("EBMinosHasNewerMailboxKeys",[],(function(t,n,r,o,a,i){"use strict";function e(e,t,n){return t==null||n==null?!1:(e==null?void 0:e.epoch_head)==null||(e==null?void 0:e.epoch_head_creation_time)==null?!0:e.epoch_head_creation_time!==n&&n>e.epoch_head_creation_time}i.hasNewerMailboxKeys=e}),66);
__d("EBMinosLogger",["WATagsLogger"],(function(t,n,r,o,a,i,l){"use strict";var e=o("WATagsLogger").TAGS(["minos"]);l.minosLogger=e}),98);
__d("MAWWormOdsLogger",["WABridge","WAOdsEnums"],(function(t,n,r,o,a,i,l){"use strict";var e={log:function(t){return o("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:o("WAOdsEnums").Entity.WORM,key:t})}};l.wormOdsWorkerLogger=e}),98);
__d("EBMinosDb",["ExecutionEnvironment","MAWCurrentUser","MAWIndexedDbMetadata","MAWWormOdsLogger","MessengerWebInitData","Promise","QPLFlow","WAHex","WALogger","WAResolvable","Worm","WormEAR","WormIDbDriver","asyncToGeneratorRuntime","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c={secure_minos_mailbox_keys:{indexes:{},primaryKey:"contact_id",secure:!0},secure_minos_message_epoch_heads:{indexes:{"[thread_id+message_id]":{fields:["thread_id","message_id"],unique:!0}},primaryKey:"message_id",secure:!0},secure_minos_thread_message_encryption_keys:{indexes:{"[roster_hash+minos_thread_id]":{fields:["roster_hash","minos_thread_id"],unique:!1}},primaryKey:"mek_id_blob",secure:!0},secure_minos_thread_message_encryption_keys_v2:{indexes:{"[roster_hash+minos_thread_id]":{fields:["roster_hash","minos_thread_id"],unique:!1}},primaryKey:"mek_id_blob",secure:!0}},d=null,m=1e4;function p(){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(d!=null)return d.promise;var t=new(o("WAResolvable")).Resolvable;d=t;var n=o("MAWIndexedDbMetadata").ebMinosDbName(o("MAWCurrentUser").getID()),a=r("qpl")._(1056840657,"2716"),i=o("WAHex").parseHex(r("MessengerWebInitData").accountKeyV2),l=o("QPLFlow").startQPLFlow(a,{annotations:{bool:{isInSharedWorker:(u||(u=r("ExecutionEnvironment"))).isInSharedWorker},string:{operationType:"initEBMinosDbSchema"}},timeoutInMs:m});try{var s="ebMinosDev",p=new(o("WormEAR")).WormEAR(c,s,i),_=new(o("Worm")).WormDatabase(new(o("WormIDbDriver")).WormIDbDriver(n,s,c,p,o("MAWWormOdsLogger").wormOdsWorkerLogger,{}),a);return yield _.init({eventFlow:l}),l.endSuccess(),t.resolve(_),_}catch(n){throw l.endFail("error"),d=null,t.reject(n),o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Error performing makeEBMinosDb: ",""])),n),n}}),_.apply(this,arguments)}function f(){return p()}function g(){return h.apply(this,arguments)}function h(){return h=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=Object.keys(c),t=yield f();return t.runInTransaction(e,"readonly",(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var r={};return yield(s||(s=n("Promise"))).all(e.map((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var n=yield t.stores[e].readAll();r[e]=n});return function(t){return e.apply(this,arguments)}})())),r});return function(e){return t.apply(this,arguments)}})(),"EBMinosDb - Dump").catch(function(){return{}})}),h.apply(this,arguments)}l.schema=c,l.makeEBMinosDb=p,l.getEBMinosDb=f,l.getDbDump=g}),98);
__d("EBMinosMailboxKeysCache",["WALRUMap","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";var e=1e3,s=new(o("WALRUMap")).LRUMap({max:e}),u=720*60,c=120;function d(e){var t=s.get(e),n=Math.floor(Date.now()/1e3);if(t!=null&&(n-t.mailboxKeys.epoch_head_creation_time<u||n-t.last_queried_time<c))return t}function m(e,t){s.set(e,{last_queried_time:o("WATimeUtils").castToUnixTime(Math.floor(Date.now()/1e3)),mailboxKeys:t})}function p(e){s.delete(e)}function _(){s.clear()}l.getCachedMailboxKeys=d,l.setCachedMailboxKeys=m,l.invalidateCachedMailboxKeys=p,l.clearMailboxKeysCache=_}),98);
__d("EBMinosSaveNewMailboxKey",["EBMinosDb","EBMinosMailboxKeysCache","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,r,a,i){var l={contact_id:e,encryption_public_key:t,epoch_anon_id:n,epoch_head:r,epoch_head_creation_time:a,public_key_fbid:i},s=yield o("EBMinosDb").getEBMinosDb();yield s.runInTransaction(["secure_minos_mailbox_keys"],"readwrite",function(e){return e.stores.secure_minos_mailbox_keys.bulkPut([l])},"SaveNewMailboxKey"),o("EBMinosMailboxKeysCache").setCachedMailboxKeys(e,l)});return function(n,r,o,a,i,l){return e.apply(this,arguments)}})();l.saveNewMailboxKey=e}),98);
__d("EBMinosLoadMailboxKeys",["EBMinosDb","EBMinosMailboxKeysCache","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=o("EBMinosMailboxKeysCache").getCachedMailboxKeys(e);if(t!=null)return t.mailboxKeys;var n=yield o("EBMinosDb").getEBMinosDb(),r=yield n.runInTransaction(["secure_minos_mailbox_keys"],"readonly",function(t){return t.stores.secure_minos_mailbox_keys.get(e)},"LoadMailboxKeys");return r!=null&&o("EBMinosMailboxKeysCache").setCachedMailboxKeys(e,r),r});return function(n){return e.apply(this,arguments)}})();l.loadMailboxKeys=e}),98);
__d("EBMinosTypes",["$InternalEnum","WAJids","WALongInt"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return e}function s(e){return e.endsWith(o("WAJids").MSGR_USER_DOMAIN)?e.slice(0,-o("WAJids").MSGR_USER_DOMAIN.length):null}var u=o("WAJids").createJidUtils({platform:"msgr"});function c(e){return u.toUserJid(e)}function d(e){return e}function m(e){return e}function p(e){return e}function _(e){return e}function f(e){return e}function g(e){return o("WALongInt").decimalStringToLongInt(new TextDecoder().decode(e))}function h(e){return e}function y(e){return e}function C(e){return e}function b(e){return e}function v(e){return e}function S(e){return e}function R(e){return e}function L(e){return e}function E(e){return e}function k(e){return e}function I(e){return e}function T(e){return e}function D(e){return e}function x(e){return e}function $(e){return e}function P(e){return e}function N(e){return e}function M(e){return e}function w(e){return e}function A(e){return e}function F(e){return e}function O(e){return e}function B(e){return e}function W(e){return e}function q(e){return e}function U(e){return e}function V(e){return e}function H(e){return e}var G=n("$InternalEnum")({INVALID:"-1",IMAGE:"0",PTT:"1",DOCUMENT:"3",VIDEO:"4",GIF:"5",STICKER:"6",XMA:"22",MESSENGER_PREVIEW:"25"});l.unsafeCastToUserFbId=e,l.userJidToUserFbId=s,l.userFbidToUserJid=c,l.unsafeCastToMinosThreadId=d,l.unsafeCastToEpochHead=m,l.unsafeCastToEpochSelfSig=p,l.unsafeCastToEpochPrevSig=_,l.unsafeCastToEpochNumber=f,l.unsafeCastToBase64StringIntToEpochNumber=g,l.unsafeCastToEpochCreationTime=h,l.unsafeCastToExportRootKey=y,l.unsafeCastToMekId=C,l.unsafeCastMekKey=b,l.unsafeCastMekRosterHash=v,l.unsafeCastToEncryptedMek=S,l.unsafeCastToMekFbId=R,l.unsafeCastToMekMiThreadId=L,l.unsafeCastToBackupFbid=E,l.unsafeCastToDeviceId=k,l.unsafeCastToEncryptedMessage=I,l.unsafeCastToEncryptedMessageSignature=T,l.unsafeCastToDecryptedMessage=D,l.unsafeCastToMailboxFbId=x,l.unsafeCastToMailboxSigningPK=$,l.unsafeCastToMailboxSigningSK=P,l.unsafeCastToMailboxEncryptionPK=N,l.unsafeCastToMailboxEncryptionSK=M,l.unsafeCastToMailboxAuthPK=w,l.unsafeCastToMailboxAuthSK=A,l.unsafeCastToTransportSenderEphemeralPK=F,l.unsafeCastToTransportSenderEphemeralKeySig=O,l.unsafeCastToTransportSigningPK=B,l.unsafeCastToTransportSigningSK=W,l.unsafeCastToEpochFbId=q,l.castToSupplementalOpToken=U,l.unsafeCastToAttachmentAccessTokenSecret=V,l.unsafeCastToAttachmentPrimaryKeySecret=H,l.MinosAttachmentMediaType=G}),98);
__d("EBMinosSecureMailboxKeysForContact",["EBMinosLoadMailboxKeys","EBMinosTypes"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return o("EBMinosLoadMailboxKeys").loadMailboxKeys(o("EBMinosTypes").unsafeCastToUserFbId(e))}l.getSecureMailboxKeysForContact=e}),98);
__d("EBMinosWriteMinosPublicKeysForRecipient",["EBMinosHasNewerMailboxKeys","EBMinosLogger","EBMinosSaveNewMailboxKey","EBMinosSecureMailboxKeysForContact","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(e){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=t.contactId,r=t.encryptionPublicKey,a=t.epochAnonId,i=t.epochHead,l=t.epochHeadCreationTime,u=t.publicKeyFbid,c=yield o("EBMinosSecureMailboxKeysForContact").getSecureMailboxKeysForContact(n);if(i==null||l==null){(c==null?void 0:c.epoch_head)!=null&&(c==null?void 0:c.epoch_head_creation_time)!=null&&(o("EBMinosLogger").minosLogger.DEV(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Deleting mailbox keys for contact: ",""])),n),yield o("EBMinosSaveNewMailboxKey").saveNewMailboxKey(n,r,a,i,l,u));return}o("EBMinosHasNewerMailboxKeys").hasNewerMailboxKeys(c,i,l)&&(o("EBMinosLogger").minosLogger.DEV(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Writing new mailbox keys for contact: ",""])),n),yield o("EBMinosSaveNewMailboxKey").saveNewMailboxKey(n,r,a,i,l,u))}),c.apply(this,arguments)}l.writeMinosMailboxKeysForRecipient=u}),98);
__d("EBAPIWriteMinosPublicKeysForRecipient",["EBMinosWriteMinosPublicKeysForRecipient"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.contactId,n=e.encryptionPublicKey,r=e.epochAnonId,a=e.epochHead,i=e.epochHeadCreationTime,l=e.publicKeyFbid;return o("EBMinosWriteMinosPublicKeysForRecipient").writeMinosMailboxKeysForRecipient({contactId:t,encryptionPublicKey:n,epochAnonId:r,epochHead:a,epochHeadCreationTime:i,publicKeyFbid:l})}l.writeMinosMailboxKeysForRecipientAPI=e}),98);
__d("EBBase64Encode",["Base64Utils"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return o("Base64Utils").fromArrayBuffer(e)}l.default=e}),98);
__d("EBDeps",["FBLogger","err"],(function(t,n,r,o,a,i,l){"use strict";var e=null;function s(){if(e==null)throw r("err")("EBDeps is not initialized");return e}function u(t,n){if(e==null){var o={},a=function(a){var e=t[a];if(e==null)return 1;e instanceof Function?o[a]=function(){r("FBLogger")("wmi_eb").info("EBDeps: function %s, reason %s",a,n);for(var o=arguments.length,i=new Array(o),l=0;l<o;l++)i[l]=arguments[l];return e.apply(t,i)}:(r("FBLogger")("wmi_eb").info("EBDeps: %s is not function",a),o[a]=e)};for(var i of Object.keys(t))a(i);e=o}}l.getDeps=s,l.setDeps=u}),98);
__d("EBGetMinosWasm",["WAWasmModuleCache","bx"],(function(t,n,r,o,a,i,l){"use strict";var e=r("bx").getURL(r("bx")("31853")),s=function(){return o("WAWasmModuleCache").loadWasmModule(e)};l.getMinosWasm=s}),98);
__d("LSEncryptedBackupsBackupTenancy",[],(function(t,n,r,o,a,i){var e=Object.freeze({PRODUCTION:1,SHADOW:2,OPEN:3});i.default=e}),66);
__d("MAWEncryptedBackupUtils",["FBLogger","I64","LSAuthorityLevel","LSDict","LSIntEnum","LSShape","LSVec","ReQL"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(e,t){return o("ReQL").firstAsync(o("ReQL").fromTableAscending(e.secure_encrypted_backups_client_state)).then(function(e){return c(e,t)})}function c(t,n){var a;if(t==null){n!=null&&n.addPoint("get_backup_tenancy_null_client_state_row");return}var i=(a=t.backupTenancy)!=null?a:(e||(e=o("I64"))).one,l=t.authorityLevel;if(n!=null&&n.addPoint("get_backup_tenancy",{int:{authorityLevel:(e||(e=o("I64"))).to_int32(l!=null?l:(e||(e=o("I64"))).zero),backupTenancy:e.to_int32(i!=null?i:(e||(e=o("I64"))).zero)}}),i!=null&&(e||(e=o("I64"))).equal((s||(s=o("LSIntEnum"))).ofNumber(r("LSAuthorityLevel").AUTHORITATIVE),l))return i}function d(e,t){var n=new Set,o=e.length;for(var a of e.entries()){var i=a[0],l=a[1];n.has(l)&&r("FBLogger")("wmi_eb").warn("Duplicate messages returned from server for restoreType: %s, index: %s of batchSize: %s",t,i,o),n.add(l)}}function m(t){var n=t.map(function(t){var n=t.toplevelProtobuf,a=o("LSShape").ofRecord({decrypted_protobuf:n.decryptedProtobuf,protobuf_timestamp_ms:(e||(e=o("I64"))).of_float(n.protobufTimestampMS)}),i=new(r("LSDict"));return t.supplementalProtobufs.forEach(function(t,n){i.set(n,o("LSShape").ofRecord({decrypted_protobuf:t.decryptedProtobuf,protobuf_timestamp_ms:(e||(e=o("I64"))).of_float(t.protobufTimestampMS)}))}),o("LSShape").ofRecord({otid:t.otid,supplemental_protobufs:i,tags:t.tags,toplevel_protobuf:a})});return r("LSVec").ofArray(n)}function p(t){var n=r("LSVec").toArray(t),a=n.map(function(e){return o("LSShape").toRecord(e)});return a.map(function(t){var n=o("LSShape").toRecord(t.toplevel_protobuf),r={decryptedProtobuf:n.decrypted_protobuf,protobufTimestampMS:(e||(e=o("I64"))).to_float(n.protobuf_timestamp_ms)},a=new Map,i=t.supplemental_protobufs;return i.forEach(function(t,n){var r=o("LSShape").toRecord(t);a.set(n,{decryptedProtobuf:r.decrypted_protobuf,protobufTimestampMS:(e||(e=o("I64"))).to_float(r.protobuf_timestamp_ms)})}),{otid:t.otid,supplementalProtobufs:a,tags:t.tags,toplevelProtobuf:r}})}l.getBackupTenancy=u,l.getBackupTenancyFromClientStateRow=c,l.logIfDuplicateMessagesFoundInRestore=d,l.convertJSTypesToLSTypesForRestoreJob=m,l.convertLSTypesToJSTypesForRestoreJob=p}),98);
__d("EBIsEbEnabled",["EBDeps","FBLogger","I64","LSEncryptedBackupsBackupTenancy","LSIntEnum","MAWEBSwitch","MAWEncryptedBackupUtils","WAResultOrError","asyncToGeneratorRuntime","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(t,n){return o("MAWEncryptedBackupUtils").getBackupTenancy(t,n).then(function(t){return t!=null&&(e||(e=o("I64"))).equal(t,(s||(s=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsBackupTenancy").PRODUCTION))})}function c(){try{return o("WAResultOrError").makeResult(r("MAWEBSwitch").isEnabled())}catch(e){return r("FBLogger")("wmi_eb").catching(r("getErrorSafe")(e)).mustfix("Failed to check EB enabled"),o("WAResultOrError").makeResult(!1)}}function d(){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=yield o("EBDeps").getDeps().getLSDB();return u(e.tables)}),m.apply(this,arguments)}l.isEbEnabledLS=u,l.isEbEnabledEbSwitch=c,l.isEBEnabled=d}),98);
__d("EBIsEbEnabledSubscriber",["EBDeps","EBIsEbEnabled","I64","LSEncryptedBackupsBackupTenancy","LSIntEnum","Promise","ReQL","WAPubSub","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=(function(){function e(e){this.$1=o("WAPubSub").simplePubSub(),this.$4=e,this.$2=!1}var t=e.prototype;return t.initialize=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){this.$2=yield o("EBIsEbEnabled").isEbEnabledLS(this.$4.tables),this.$5(this.$4)});function t(){return e.apply(this,arguments)}return t})(),t.$6=function(t){this.$2=t,this.$1.publish(t)},t.$5=function(t){var e=this;return this.$3==null&&(this.$3=o("ReQL").fromTableAscending(t.tables.secure_encrypted_backups_client_state).take(1).subscribe(function(t,n){n.operation==="delete"&&e.$6(!1),(n.operation==="add"||n.operation==="put")&&(n.value.backupTenancy!=null&&(s||(s=o("I64"))).equal(n.value.backupTenancy,(u||(u=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsBackupTenancy").PRODUCTION))?e.$6(!0):e.$6(!1))})),this.$3},t.subscribe=function(t){return this.$1.subscribe(t)},t.isEnabled=function(){return this.$2},e})(),d;function m(e){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){if(d!=null)return(e||(e=n("Promise"))).resolve();d=new c(t),yield d.initialize()}),p.apply(this,arguments)}function _(){return f.apply(this,arguments)}function f(){return f=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(d==null){var e=yield o("EBDeps").getDeps().getLSDB();yield m(e)}return d}),f.apply(this,arguments)}function g(e){return h.apply(this,arguments)}function h(){return h=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){if(d==null){var t=yield o("EBDeps").getDeps().getLSDB();yield m(t)}e(d.isEnabled());var n=d.subscribe(e);return n}),h.apply(this,arguments)}function y(){return C.apply(this,arguments)}function C(){return C=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(d==null){var e=yield o("EBDeps").getDeps().getLSDB();yield m(e)}return d.isEnabled()}),C.apply(this,arguments)}l.initIsEbEnabledPubSub=m,l.isEbEnabledSubscriber=_,l.subscribeToEbChanges=g,l.isEBEnabledValueFromSubscriber=y}),98);
__d("EBMinosMessageEncryptionVersion",["$InternalEnum","gkx"],(function(t,n,r,o,a,i,l){"use strict";var e=n("$InternalEnum")({V1:1,V2:2}),s=e.V1,u=r("gkx")("19866")?e.V2:e.V1;l.MinosMessageEncryptionVersion=e,l.INITIAL_VERSION=s,l.MINOS_MESSAGE_ENCRYPTION_CURRENT_VERSION=u}),98);
__d("EBMinosMessageMetadataVersion",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e=n("$InternalEnum")({V1:1,V2:2}),l=e.V1,s=e.V2;i.MinosMessageMetadataVersion=e,i.INITIAL_VERSION=l,i.MESSAGE_METADATA_CURRENT_VERSION=s}),66);
__d("MSGDataclassTypes.flow",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e,l=(e=n("$InternalEnum"))({LlmOutput:"llm_output",SendQuery:"send_query",StartTyping:"start_typing",StopTyping:"stop_typing",VideoAboutToFinish:"video_about_to_finish"}),s=e({SummarizeInboxFnfMessages:"SUMMARIZE_INBOX_FNF_MESSAGES",PsiQueryPlan:"PSI_QUERY_PLAN"}),u=e({Pending:"PENDING",Confirmed:"CONFIRMED",Cancelled:"CANCELLED"}),c=e({Action:"ACTION",Navigation:"NAVIGATION"}),d=e({End:"END",Start:"START"}),m=e({CopyToClipboard:"COPY_TO_CLIPBOARD",SendToChat:"SEND_TO_CHAT",FollowUpPrompt:"FOLLOW_UP_PROMPT"}),p=e({Keyword:"KEYWORD",Method:"METHOD",Str:"STR",Number:"NUMBER",Comment:"COMMENT",Default:"DEFAULT"}),_=e({Follow:"FOLLOW",Unfollow:"UNFOLLOW",Join:"JOIN",Leave:"LEAVE",Message:"MESSAGE"}),f=e({Group:"GROUP",Page:"PAGE",CalendarEvent:"CALENDAR_EVENT",Person:"PERSON"}),g=e({HorizontalLine:"HORIZONTAL_LINE",Dot:"DOT"}),h=e({OpenFullView:"OPEN_FULL_VIEW",CancelReasoning:"CANCEL_REASONING"}),y=e({StartProject:"START_PROJECT"}),C=e({Fetching:"FETCHING",Fetched:"FETCHED",Failed:"FAILED"}),b=e({Generating:"GENERATING",Ready:"READY",Failed:"FAILED"}),v=e({Imagine:"IMAGINE",Animate:"ANIMATE",Memu:"MEMU"}),S=e({Fetching:"FETCHING",Fetched:"FETCHED",Failed:"FAILED"}),R=e({Start:"START",End:"END"}),L=e({Circle:"CIRCLE",Square:"SQUARE",Vertical:"VERTICAL"}),E=e({Top:"TOP",Center:"CENTER"}),k=e({InThread:"IN_THREAD",BottomSheet:"BOTTOM_SHEET"}),I=e({Bing:"BING",Brave:"BRAVE",Google:"GOOGLE",HelpCenter:"HELP_CENTER",InHouse:"IN_HOUSE",Kss:"KSS",Mase:"MASE"}),T=e({Open:"OPEN",Closed:"CLOSED"}),D=e({Cheap:"CHEAP",Moderate:"MODERATE",Expensive:"EXPENSIVE",Splurge:"SPLURGE"}),x=e({Landscape:"LANDSCAPE",Portrait:"PORTRAIT"}),$=e({GroupPost:"GROUP_POST",PagePost:"PAGE_POST"}),P=e({FbSocialSearch:"FB_SOCIAL_SEARCH"}),N=e({Planned:"PLANNED",InProgress:"IN_PROGRESS",Completed:"COMPLETED",Stopped:"STOPPED"}),M=e({FbGroup:"FB_GROUP",FbPage:"FB_PAGE",FbProfile:"FB_PROFILE",IgProfile:"IG_PROFILE",ThreadsProfile:"THREADS_PROFILE"}),w=e({Facebook:"FACEBOOK",Instagram:"INSTAGRAM",Threads:"THREADS"}),A=e({FacebookPost:"FACEBOOK_POST",InstagramPost:"INSTAGRAM_POST",ThreadsPost:"THREADS_POST",ThirdParty:"THIRD_PARTY",VmGenerated:"VM_GENERATED",CatalogProduct:"CATALOG_PRODUCT",WearablesAcsJournal:"WEARABLES_ACS_JOURNAL"}),F=e({Thinking:"THINKING",WebSearch:"WEB_SEARCH",MetaSearch:"META_SEARCH"}),O=e({Details:"DETAILS"}),B=e({Steps:"STEPS",Sources:"SOURCES"}),W=e({Pending:"PENDING",Running:"RUNNING",Done:"DONE"}),q=e({AppleHealth:"APPLE_HEALTH",Gmail:"GMAIL",GoogleCalendar:"GOOGLE_CALENDAR",GoogleHealthConnect:"GOOGLE_HEALTH_CONNECT",OutlookCalendar:"OUTLOOK_CALENDAR",OutlookMail:"OUTLOOK_MAIL"}),U=e({Initiated:"INITIATED",Linked:"LINKED",Unlinked:"UNLINKED"}),V=e({ContextualMenu:"CONTEXTUAL_MENU",AiLookup:"AI_LOOKUP"}),H=e({Restaurant:"RESTAURANT",Movie:"MOVIE",TvShows:"TV_SHOWS",Celebrity:"CELEBRITY",SportsTeam:"SPORTS_TEAM",InfoTerm:"INFO_TERM"}),G=e({Reasoning:"REASONING",Responding:"RESPONDING"}),z=e({Default:"DEFAULT",CriticalUserMessage:"CRITICAL_USER_MESSAGE",NonCriticalAdminXma:"NON_CRITICAL_ADMIN_XMA"}),j=e({ThreadviewSuggestedPrompt:"THREADVIEW_SUGGESTED_PROMPT",TypeaheadSuggestedPrompt:"TYPEAHEAD_SUGGESTED_PROMPT",SuggestedPrompt:"SUGGESTED_PROMPT",NullStatePrompt:"NULL_STATE_PROMPT",UserInputPrompt:"USER_INPUT_PROMPT",GenericPrompt:"GENERIC_PROMPT",ThreadviewUserInputPrompt:"THREADVIEW_USER_INPUT_PROMPT",Icebreakers:"ICEBREAKERS",ThreadSurfingPrompt:"THREAD_SURFING_PROMPT",MetaAiVoiceConversationStarter:"META_AI_VOICE_CONVERSATION_STARTER",MetaAiTextConversationStarter:"META_AI_TEXT_CONVERSATION_STARTER",MetaAiFabHint:"META_AI_FAB_HINT",AiLookup:"AI_LOOKUP"}),K=e({DeleteBackupStateOnClient:"DELETE_BACKUP_STATE_ON_CLIENT",IssueCheckBackupStateTask:"ISSUE_CHECK_BACKUP_STATE_TASK",UpsertStatusTrigger:"UPSERT_STATUS_TRIGGER",UpsertReenrollmentTrigger:"UPSERT_REENROLLMENT_TRIGGER",UpdateInitializeRestoreResult:"UPDATE_INITIALIZE_RESTORE_RESULT",InitializeRestore:"INITIALIZE_RESTORE",DeleteAndInsertPakeMessage:"DELETE_AND_INSERT_PAKE_MESSAGE",RotateDeviceKeysStart:"ROTATE_DEVICE_KEYS_START",LegacyRetroactiveBackup:"LEGACY_RETROACTIVE_BACKUP",UpdatePbqWithNeedsBackupUploadStatus:"UPDATE_PBQ_WITH_NEEDS_BACKUP_UPLOAD_STATUS",SyncDeviceCreationTimestamp:"SYNC_DEVICE_CREATION_TIMESTAMP"}),Q=e({Message:"MESSAGE",Thread:"THREAD"}),X=e({UpsertBackupItem:"UPSERT_BACKUP_ITEM",RemoveBackupItem:"REMOVE_BACKUP_ITEM"}),Y=e({Retroactive:"RETROACTIVE",Realtime:"REALTIME",InfiniteRetroactive:"INFINITE_RETROACTIVE",Retry:"RETRY"}),J=e({Before:"BEFORE",After:"AFTER"}),Z=e({Photo:"PHOTO",Permanent:"PERMANENT",Ephemeral:"EPHEMERAL",Video:"VIDEO",Gif:"GIF",Audio:"AUDIO",File:"FILE",Raven:"RAVEN",UnreadRaven:"UNREAD_RAVEN",ShareIgMedia:"SHARE_IG_MEDIA",ShareLink:"SHARE_LINK",ShareIgClips:"SHARE_IG_CLIPS",Shh:"SHH",StoryReply:"STORY_REPLY",DisappearingMessage:"DISAPPEARING_MESSAGE",RavenSeen:"RAVEN_SEEN",RavenReplayed:"RAVEN_REPLAYED",RavenReadOnce:"RAVEN_READ_ONCE",RavenReplayable:"RAVEN_REPLAYABLE",RavenPermanent:"RAVEN_PERMANENT",ActionLog:"ACTION_LOG"}),ee=e({HistoryRestore:"HISTORY_RESTORE",Reporting:"REPORTING",Fts:"FTS",NewMemberExport:"NEW_MEMBER_EXPORT",MpsReadApis:"MPS_READ_APIS"}),te=e({NotApplicable:"NOT_APPLICABLE",NeedsUpload:"NEEDS_UPLOAD",AlreadyUploaded:"ALREADY_UPLOADED"}),ne=e({Success:"SUCCESS",RetryableException:"RETRYABLE_EXCEPTION",PermanentFailure:"PERMANENT_FAILURE"}),re=e({Fbn:"FBN",Instamadillo:"INSTAMADILLO",Unknown:"UNKNOWN"}),oe=e({GetMealDetails:"GET_MEAL_DETAILS",SuggestSimilarMeals:"SUGGEST_SIMILAR_MEALS",UpdateIngredients:"UPDATE_INGREDIENTS"}),ae=e({Landscape:"LANDSCAPE",Square:"SQUARE",Vertical:"VERTICAL"}),ie=e({NewMessage:"NEW_MESSAGE",EditPrompt:"EDIT_PROMPT",Regenerate:"REGENERATE"}),le=e({User:"USER",Assistant:"ASSISTANT"}),se=e({Copy:"COPY",CanReadAloud:"CAN_READ_ALOUD",CanFeedbackOnBotResponse:"CAN_FEEDBACK_ON_BOT_RESPONSE"}),ue=e({Unknown:"UNKNOWN",Memu:"MEMU",Synthetic:"SYNTHETIC",UserUploaded:"USER_UPLOADED"}),ce=e({AskMetaAi:"ASK_META_AI",Summarize:"SUMMARIZE"}),de=e({GetInfo:"GET_INFO",GetRestaurantInfo:"GET_RESTAURANT_INFO",Reviews:"REVIEWS",MenuHighlights:"MENU_HIGHLIGHTS",Address:"ADDRESS",WhereToWatch:"WHERE_TO_WATCH",LatestNews:"LATEST_NEWS",FindNextGame:"FIND_NEXT_GAME",ResponseCard:"RESPONSE_CARD"}),me=e({Restaurant:"RESTAURANT",Movie:"MOVIE",TvShows:"TV_SHOWS",Celebrity:"CELEBRITY",SportsTeam:"SPORTS_TEAM"}),pe=e({MagicModBackdrop:"MAGIC_MOD_BACKDROP",MagicModRestyle:"MAGIC_MOD_RESTYLE",Imagine:"IMAGINE",Memu:"MEMU",HiddenMetadata:"HIDDEN_METADATA",AiVoiceNotes:"AI_VOICE_NOTES"}),_e=e({XmaWebUrl:"XMA_WEB_URL",XmaOpenNative:"XMA_OPEN_NATIVE",XmaMsgExternalLinkShare:"XMA_MSG_EXTERNAL_LINK_SHARE",XmaGenAiSearchPluginResponseSources:"XMA_GEN_AI_SEARCH_PLUGIN_RESPONSE_SOURCES",XmaSharedAlbumViewer:"XMA_SHARED_ALBUM_VIEWER",XmaMetaAiSingleSubscription:"XMA_META_AI_SINGLE_SUBSCRIPTION",XmaMetaAiSubscriptions:"XMA_META_AI_SUBSCRIPTIONS",XmaMetaAiReminders:"XMA_META_AI_REMINDERS",XmaMetaAiTask:"XMA_META_AI_TASK",XmaGamePlay:"XMA_GAME_PLAY",ViewSingleAiTask:"VIEW_SINGLE_AI_TASK",ViewAllAiTasks:"VIEW_ALL_AI_TASKS",XmaMetaAiLocation:"XMA_META_AI_LOCATION",XmaMetaAiLookupEntity:"XMA_META_AI_LOOKUP_ENTITY",XmaP2POpgTransfer:"XMA_P2P_OPG_TRANSFER",MarketplaceXmaCallFunction:"MARKETPLACE_XMA_CALL_FUNCTION",XmaMetaAiDigestSeeSummary:"XMA_META_AI_DIGEST_SEE_SUMMARY",XmaMusicArtist:"XMA_MUSIC_ARTIST",MarketplaceXmatCallFunction:"MARKETPLACE_XMAT_CALL_FUNCTION"}),fe=e({PaidPartnership:"PAID_PARTNERSHIP",NoBranding:"NO_BRANDING"}),ge=e({Imagine:"IMAGINE",Imaginev2:"IMAGINEV2",Imagineme:"IMAGINEME"}),he=e({Animate:"ANIMATE",AnimateImagineme:"ANIMATE_IMAGINEME"}),ye=e({Mention:"MENTION",SuperReact:"SUPER_REACT",StoryReply:"STORY_REPLY",MessageReply:"MESSAGE_REPLY",ContentReply:"CONTENT_REPLY",ContentMention:"CONTENT_MENTION",ContentShare:"CONTENT_SHARE",OnPlatform:"ON_PLATFORM",OffPlatform:"OFF_PLATFORM",MessageForward:"MESSAGE_FORWARD",Avatar:"AVATAR",SocialSticker:"SOCIAL_STICKER",NoteReply:"NOTE_REPLY",InvokesGenAiResponse:"INVOKES_GEN_AI_RESPONSE",SentFromGenAiBot:"SENT_FROM_GEN_AI_BOT",DisappearingMessage:"DISAPPEARING_MESSAGE",IncludesOnPlatformContent:"INCLUDES_ON_PLATFORM_CONTENT",IncludesOffPlatformContent:"INCLUDES_OFF_PLATFORM_CONTENT",IncludesLink:"INCLUDES_LINK",MultitabEnv:"MULTITAB_ENV",PowerUp:"POWER_UP",MsysSend:"MSYS_SEND",EditMessage:"EDIT_MESSAGE",VanishMode:"VANISH_MODE",Superlative:"SUPERLATIVE",Raven:"RAVEN",Hotlike:"HOTLIKE",IsDialtone:"IS_DIALTONE",MessageReshare:"MESSAGE_RESHARE",PostReply:"POST_REPLY",IsNotDialtone:"IS_NOT_DIALTONE",ThirdPartyReshare:"THIRD_PARTY_RESHARE",ZeroBalanceDetected:"ZERO_BALANCE_DETECTED",ConversationStarter:"CONVERSATION_STARTER",AnimatedAiSticker:"ANIMATED_AI_STICKER",AiGeneratedSticker:"AI_GENERATED_STICKER",AiSummaryBottomSheet:"AI_SUMMARY_BOTTOM_SHEET",MagicModImage:"MAGIC_MOD_IMAGE",ShareOfOriginalUserContent:"SHARE_OF_ORIGINAL_USER_CONTENT",LightweightInteractionAsStoryReply:"LIGHTWEIGHT_INTERACTION_AS_STORY_REPLY",WriteWithMetaAi:"WRITE_WITH_META_AI",AvatarStyle_1:"AVATAR_STYLE_1",AvatarStyle_2:"AVATAR_STYLE_2",MetaAiEntitySuggestedPrompts:"META_AI_ENTITY_SUGGESTED_PROMPTS",ContentConversationStarter:"CONTENT_CONVERSATION_STARTER",MetaAiIntents:"META_AI_INTENTS",QuicksnapReply:"QUICKSNAP_REPLY",ContentBasedSparks:"CONTENT_BASED_SPARKS"}),Ce=e({Memu:"MEMU",Imagine:"IMAGINE",ImagineRestyle:"IMAGINE_RESTYLE"}),be=e({Reminder:"REMINDER",Subscription:"SUBSCRIPTION"}),ve=e({Text:"text",Image:"image",Voice:"voice",Link_1p:"link_1p",Link_3p:"link_3p"}),Se=e({MothersDay:"MOTHERS_DAY",FathersDay:"FATHERS_DAY",Graduation:"GRADUATION",NationalSelfie:"NATIONAL_SELFIE",PhIndependenceDay:"PH_INDEPENDENCE_DAY",JulyFourth:"JULY_FOURTH",FriendshipDay:"FRIENDSHIP_DAY"}),Re=e({Birthday:"BIRTHDAY",Attribution:"ATTRIBUTION"}),Le=e({Note:"NOTE",Story:"STORY",Profile:"PROFILE",Clip:"CLIP",Feed:"FEED",Live:"LIVE",Comment:"COMMENT",LocationShare:"LOCATION_SHARE",ReelsAudio:"REELS_AUDIO",MediaNote:"MEDIA_NOTE",StoryHighlight:"STORY_HIGHLIGHT",SocialContext:"SOCIAL_CONTEXT"}),Ee=e({Mention:"MENTION",Reply:"REPLY"}),ke=e({Share:"SHARE",Reply:"REPLY",React:"REACT",Mention:"MENTION"}),Ie=e({Undefined:"UNDEFINED",Genmoji:"GENMOJI",Metamoji:"METAMOJI",AnimatedEmoji:"ANIMATED_EMOJI"}),Te=e({GenAiGetInfo:"GEN_AI_GET_INFO",GenAiReminder:"GEN_AI_REMINDER",GenAiThreadSurfing:"GEN_AI_THREAD_SURFING"}),De=e({Unknown:"UNKNOWN",AnimatedThankImage:"ANIMATED_THANK_IMAGE",AnimatedThankImageWithTextMessage:"ANIMATED_THANK_IMAGE_WITH_TEXT_MESSAGE"}),xe=e({Unknown:"UNKNOWN",BulkReply:"BULK_REPLY",AutoReply:"AUTO_REPLY"}),$e=e({AttachmentPreviewMedia:"ATTACHMENT_PREVIEW_MEDIA",AttachmentPreviewHeaderMedia:"ATTACHMENT_PREVIEW_HEADER_MEDIA"}),Pe=e({Simple:"SIMPLE",Retro:"RETRO",Messages:"MESSAGES"}),Ne=e({Simple:"SIMPLE",Retro:"RETRO",Messages:"MESSAGES"}),Me=e({Unactioned:"UNACTIONED",Accepted:"ACCEPTED",Deleted:"DELETED"}),we=e({FbmInbox:"FBM_INBOX",Profile:"PROFILE",Feed:"FEED",FbSearch:"FB_SEARCH",Watch:"WATCH",Shorts:"SHORTS",Ufi:"UFI",Ctm:"CTM",Cts:"CTS",Psrib:"PSRIB",Srib:"SRIB",Rta:"RTA",Mp:"MP",CommentMentions:"COMMENT_MENTIONS",ZorroMessage:"ZORRO_MESSAGE",FbHelpCenterXsMetaAi:"FB_HELP_CENTER_XS_META_AI",Dating:"DATING",IgReels:"IG_REELS",IgStory:"IG_STORY",IgFeed:"IG_FEED",IgProfile:"IG_PROFILE",IgNotes:"IG_NOTES",IgLive:"IG_LIVE",IgExternalLink:"IG_EXTERNAL_LINK",IgComment:"IG_COMMENT",FbNotes:"FB_NOTES",FbGroups:"FB_GROUPS",GenAiSuggestedPrompts:"GEN_AI_SUGGESTED_PROMPTS",GenAiMultiModal:"GEN_AI_MULTI_MODAL",GenAiFlAshImagine:"GEN_AI_FlASH_IMAGINE",GenAiAssistant:"GEN_AI_ASSISTANT",GenAiLocation:"GEN_AI_LOCATION",Sharesheet:"SHARESHEET",ProductHighlights:"PRODUCT_HIGHLIGHTS",MagicMessenger:"MAGIC_MESSENGER",SpectraAction:"SPECTRA_ACTION"}),Ae=e({MsgrE2EeGenai:"MSGR_E2EE_GENAI"}),Fe=e({Statusupdate:"STATUSUPDATE",Grouppost:"GROUPPOST",Shareurl:"SHAREURL",Unifiedresponse:"UNIFIEDRESPONSE"}),Oe=e({Single:"SINGLE",Hscroll:"HSCROLL",Xcenter:"XCENTER",Portrait:"PORTRAIT",Layered:"LAYERED",Placeholder:"PLACEHOLDER",ExpiredPlaceholder:"EXPIRED_PLACEHOLDER",PilePrompt:"PILE_PROMPT",Stack:"STACK",SharedStack:"SHARED_STACK",StackCard:"STACK_CARD",StandardDxma:"STANDARD_DXMA",DxmaPlaceholder:"DXMA_PLACEHOLDER",Grid:"GRID"}),Be=e({Share:"SHARE",Reply:"REPLY",Mention:"MENTION",Bump:"BUMP"}),We=e({ThreadsPostShare:"THREADS_POST_SHARE",HorizonWeelXma:"HORIZON_WEEL_XMA"}),qe=e({XmaWebUrl:"XMA_WEB_URL"}),Ue=e({Mention:"MENTION",Reply:"REPLY"}),Ve=e({Note:"NOTE",Prompt:"PROMPT",PromptResponse:"PROMPT_RESPONSE",Status:"STATUS"}),He=e({Video:"VIDEO",Image:"IMAGE",Other:"OTHER"}),Ge=e({Love:"LOVE",Giftwrap:"GIFTWRAP",Celebration:"CELEBRATION",Fire:"FIRE",AvatarLove:"AVATAR_LOVE",AvatarAngry:"AVATAR_ANGRY",AvatarCry:"AVATAR_CRY",AvatarLaugh:"AVATAR_LAUGH",Halloween:"HALLOWEEN",NomNomDash:"NOM_NOM_DASH",NewYears:"NEW_YEARS",ValentinesDay:"VALENTINES_DAY",AntiValentines:"ANTI_VALENTINES"}),ze=e({None:"NONE",BasicSuperReactAnimation:"BASIC_SUPER_REACT_ANIMATION",FbEmoji:"FB_EMOJI",NonDefaultEmoji:"NON_DEFAULT_EMOJI"}),je=e({Text:"TEXT",Media:"MEDIA"}),Ke=e({SenderParent:"SENDER_PARENT",RecipientParent:"RECIPIENT_PARENT",Classifier:"CLASSIFIER",ReactiveEnforcement:"REACTIVE_ENFORCEMENT"}),Qe=e({Takedown:"TAKEDOWN",Restore:"RESTORE"}),Xe=e({Unknown:"UNKNOWN",SoftDeleteWithAppeal:"SOFT_DELETE_WITH_APPEAL",SoftDeleteWithoutAppeal:"SOFT_DELETE_WITHOUT_APPEAL",PermanentDelete:"PERMANENT_DELETE",SoftDeleteWithAppealParentUnviewable:"SOFT_DELETE_WITH_APPEAL_PARENT_UNVIEWABLE",SoftDeleteWithoutAppealParentUnviewable:"SOFT_DELETE_WITHOUT_APPEAL_PARENT_UNVIEWABLE"}),Ye=e({Unknown:"UNKNOWN",TwoOptionCombined:"TWO_OPTION_COMBINED",IgTwoOptionCombined:"IG_TWO_OPTION_COMBINED",FiveOptionStarRating:"FIVE_OPTION_STAR_RATING"}),Je=e({Unknown:"UNKNOWN",Location:"LOCATION",People:"PEOPLE",Event:"EVENT",ResharedPost:"RESHARED_POST",ResharedContent:"RESHARED_CONTENT",Page:"PAGE",Fundraiser:"FUNDRAISER",Product:"PRODUCT",AntiBully:"ANTI_BULLY",Instagram:"INSTAGRAM"}),Ze=e({Unspecified:"UNSPECIFIED",QuickEmoji:"QUICK_EMOJI",Avatar:"AVATAR",SuggestedReply:"SUGGESTED_REPLY",PostLwrSuggestedReply:"POST_LWR_SUGGESTED_REPLY",WriteWithAi:"WRITE_WITH_AI",GifLightWeight:"GIF_LIGHT_WEIGHT",StickerLightWeight:"STICKER_LIGHT_WEIGHT",QuickEmojiPalette:"QUICK_EMOJI_PALETTE",SuggestedText:"SUGGESTED_TEXT",SuggestedEmoji:"SUGGESTED_EMOJI",SuggestedEmojiText:"SUGGESTED_EMOJI_TEXT",AboveKeyboardEmojiLightWeight:"ABOVE_KEYBOARD_EMOJI_LIGHT_WEIGHT",AboveKeyboardSuggestedEmoji:"ABOVE_KEYBOARD_SUGGESTED_EMOJI",AboveKeyboardSuggestedText:"ABOVE_KEYBOARD_SUGGESTED_TEXT",AboveKeyboardSuggestedEmojiText:"ABOVE_KEYBOARD_SUGGESTED_EMOJI_TEXT"}),et=e({RequestStart:"REQUEST_START",Searching:"SEARCHING",Imagining:"IMAGINING",UnderstandingImage:"UNDERSTANDING_IMAGE",Generating:"GENERATING",StreamingImage:"STREAMING_IMAGE"}),tt=e({BanUser:"BAN_USER",RemoveUser:"REMOVE_USER",SuspendUser:"SUSPEND_USER",RemoveMessage:"REMOVE_MESSAGE",ReportMessage:"REPORT_MESSAGE",HideMessage:"HIDE_MESSAGE"}),nt=e({Foo:"FOO",Bar:"BAR",Baz:"BAZ"}),rt=e({Foo:"FOO",Bar:"BAR",Baz:"BAZ"}),ot=e({Untranscribed:"UNTRANSCRIBED",Transcribing:"TRANSCRIBING",Success:"SUCCESS",Error:"ERROR",UnsupportedLanguage:"UNSUPPORTED_LANGUAGE"}),at=e({Unknown:"UNKNOWN",Product:"PRODUCT",Faq:"FAQ",Chat:"CHAT",Post:"POST",Other:"OTHER"}),it=e({Unknown:"UNKNOWN",Product:"PRODUCT",Faq:"FAQ",Chat:"CHAT",Post:"POST",Pricelist:"PRICELIST",Other:"OTHER"}),lt=e({Keyword:"KEYWORD",Method:"METHOD",Str:"STR",Number:"NUMBER",Comment:"COMMENT",Default:"DEFAULT"}),st=e({Chevron:"CHEVRON"}),ut=e({Square:"SQUARE",Circle:"CIRCLE"}),ct=e({Album:"ALBUM",Clips:"CLIPS",Video:"VIDEO"}),dt=e({Test:"TEST",None:"NONE",IgMediaShare:"IG_MEDIA_SHARE",IgMultipostShare:"IG_MULTIPOST_SHARE",IgStoryReply:"IG_STORY_REPLY",IgStoryPhotoShare:"IG_STORY_PHOTO_SHARE",IgStoryPhotoMention:"IG_STORY_PHOTO_MENTION",IgClipsShare:"IG_CLIPS_SHARE",IgSingleVideoPostShare:"IG_SINGLE_VIDEO_POST_SHARE",IgStoryVideoShare:"IG_STORY_VIDEO_SHARE",IgStoryReaction:"IG_STORY_REACTION",IgIgtvShare:"IG_IGTV_SHARE",IgShopShare:"IG_SHOP_SHARE",IgProfileShare:"IG_PROFILE_SHARE",IgStoryPhotoHighlightShare:"IG_STORY_PHOTO_HIGHLIGHT_SHARE",IgStoryVideoHighlightShare:"IG_STORY_VIDEO_HIGHLIGHT_SHARE",IgStoryVideoMention:"IG_STORY_VIDEO_MENTION",IgStoryHighlightReply:"IG_STORY_HIGHLIGHT_REPLY",IgStoryHighlightReaction:"IG_STORY_HIGHLIGHT_REACTION",IgExternalLink:"IG_EXTERNAL_LINK",IgReceiverFetch:"IG_RECEIVER_FETCH",IgTextPostAppShare:"IG_TEXT_POST_APP_SHARE",FbFeedShare:"FB_FEED_SHARE",FbStoryReply:"FB_STORY_REPLY",FbStoryShare:"FB_STORY_SHARE",FbStoryMention:"FB_STORY_MENTION",FbFeedVideoShare:"FB_FEED_VIDEO_SHARE",FbGamingCustomUpdate:"FB_GAMING_CUSTOM_UPDATE",FbProducerStoryReply:"FB_PRODUCER_STORY_REPLY",FbEvent:"FB_EVENT",FbFeedPostPrivateReply:"FB_FEED_POST_PRIVATE_REPLY",FbShort:"FB_SHORT",FbCommentMentionShare:"FB_COMMENT_MENTION_SHARE",FbPostMention:"FB_POST_MENTION",FbFeedPostReactionReply:"FB_FEED_POST_REACTION_REPLY",MsgExternalLinkShare:"MSG_EXTERNAL_LINK_SHARE",MsgP2PPayment:"MSG_P2P_PAYMENT",MsgOpgP2PPayment:"MSG_OPG_P2P_PAYMENT",MsgLocationSharingDeprecated:"MSG_LOCATION_SHARING_DEPRECATED",MsgLocationSharingV2:"MSG_LOCATION_SHARING_V2",MsgReceiverFetch:"MSG_RECEIVER_FETCH",MsgIgMediaShare:"MSG_IG_MEDIA_SHARE",MsgGenAiSearchPluginResponse:"MSG_GEN_AI_SEARCH_PLUGIN_RESPONSE",MsgReelsList:"MSG_REELS_LIST",MsgContact:"MSG_CONTACT",MsgFile:"MSG_FILE",MsgAiContact:"MSG_AI_CONTACT",MsgMemoriesShare:"MSG_MEMORIES_SHARE",MsgEarlyAccessFbShare:"MSG_EARLY_ACCESS_FB_SHARE",MsgSharedAlbum:"MSG_SHARED_ALBUM",MsgPhoneNumber:"MSG_PHONE_NUMBER",MsgPrivateXma:"MSG_PRIVATE_XMA",MsgMusicSticker:"MSG_MUSIC_STICKER",MsgReceiverFetchFallback:"MSG_RECEIVER_FETCH_FALLBACK",MsgAiBotSearchResult:"MSG_AI_BOT_SEARCH_RESULT",MsgGenAiSubscription:"MSG_GEN_AI_SUBSCRIPTION",MsgGenAiReminder:"MSG_GEN_AI_REMINDER",MsgGenAiTask:"MSG_GEN_AI_TASK",MsgGenAi_1PSearchResult:"MSG_GEN_AI_1P_SEARCH_RESULT",MsgGenAiMemuOnboardingResponse:"MSG_GEN_AI_MEMU_ONBOARDING_RESPONSE",MsgGenAiRichResponse:"MSG_GEN_AI_RICH_RESPONSE",RtcAudioCall:"RTC_AUDIO_CALL",RtcVideoCall:"RTC_VIDEO_CALL",RtcMissedAudioCall:"RTC_MISSED_AUDIO_CALL",RtcMissedVideoCall:"RTC_MISSED_VIDEO_CALL",RtcGroupAudioCall:"RTC_GROUP_AUDIO_CALL",RtcGroupVideoCall:"RTC_GROUP_VIDEO_CALL",RtcMissedGroupAudioCall:"RTC_MISSED_GROUP_AUDIO_CALL",RtcMissedGroupVideoCall:"RTC_MISSED_GROUP_VIDEO_CALL",RtcOngoingVideoCall:"RTC_ONGOING_VIDEO_CALL",RtcOngoingAudioCall:"RTC_ONGOING_AUDIO_CALL",LiveLocation:"LIVE_LOCATION",OcAvatarStaticSticker:"OC_AVATAR_STATIC_STICKER"}),mt=e({None:"NONE",Fb:"FB",FbAlwaysWhite:"FB_ALWAYS_WHITE",DotsThreeHorizontal:"DOTS_THREE_HORIZONTAL",ChevronDown:"CHEVRON_DOWN",FbInfoSmall:"FB_INFO_SMALL"}),pt=e({Default:"DEFAULT",P2PPreviewImageWithTextOverlay:"P2P_PREVIEW_IMAGE_WITH_TEXT_OVERLAY",Playable:"PLAYABLE",AutoPlayable:"AUTO_PLAYABLE",BlurredImage:"BLURRED_IMAGE",BlurredPlayable:"BLURRED_PLAYABLE",InformTreatmentWithLabel:"INFORM_TREATMENT_WITH_LABEL",InformTreatmentWithWarningScreen:"INFORM_TREATMENT_WITH_WARNING_SCREEN",YoutubePlayer:"YOUTUBE_PLAYER",ImageWithPlayButton:"IMAGE_WITH_PLAY_BUTTON",Placeholder:"PLACEHOLDER",AutoPlayableWithAspectRatio:"AUTO_PLAYABLE_WITH_ASPECT_RATIO"}),_t=e({Invited:"INVITED",Accepted:"ACCEPTED",Completed:"COMPLETED",Expired:"EXPIRED"}),ft=e({OnTime:"ON_TIME",Delayed:"DELAYED",Cancelled:"CANCELLED",Arrived:"ARRIVED",Departed:"DEPARTED",Unknown:"UNKNOWN"}),gt=e({MediaLabel:"MEDIA_LABEL",Misinformation:"MISINFORMATION",PostCover:"POST_COVER",PostLabel:"POST_LABEL",Private:"PRIVATE",Sensitive:"SENSITIVE",WarningScreens:"WARNING_SCREENS"}),ht=e({None:"NONE",Collage:"COLLAGE",Photo:"PHOTO",Video:"VIDEO",MultiPhoto:"MULTI_PHOTO",MessengerIcon:"MESSENGER_ICON",InstagramIcon:"INSTAGRAM_ICON",ReelsIcon:"REELS_ICON",Live:"LIVE",YoutubeVideo:"YOUTUBE_VIDEO",YoutubeShorts:"YOUTUBE_SHORTS",Blur:"BLUR",Pill:"PILL"}),yt=e({Grid:"GRID",Hscroll:"HSCROLL",Portrait:"PORTRAIT",Single:"SINGLE",Vstack:"VSTACK",SharedStack:"SHARED_STACK"}),Ct=e({Started:"STARTED",Ended:"ENDED",Active:"ACTIVE",Expired:"EXPIRED"}),bt=e({Default:"DEFAULT",Rounded:"ROUNDED",BlurredCircle:"BLURRED_CIRCLE",TemplateAsset:"TEMPLATE_ASSET",DefaultWithGradient:"DEFAULT_WITH_GRADIENT"}),vt=e({Paypal:"PAYPAL",Venmo:"VENMO"}),St=e({Payment:"PAYMENT",Request:"REQUEST"}),Rt=e({None:"NONE",VodVideo:"VOD_VIDEO",LiveVideo:"LIVE_VIDEO",ShortsVideo:"SHORTS_VIDEO"}),Lt=e({Missed:"MISSED",Ended:"ENDED",Started:"STARTED"}),Et=e({Video:"VIDEO",Audio:"AUDIO"}),kt=e({Default:"DEFAULT",Overlay:"OVERLAY"}),It=e({Regular:"REGULAR",Bold:"BOLD"}),Tt=e({Weekly:"WEEKLY",Daily:"DAILY"}),Dt=e({Default:"DEFAULT",ThreadsIcon:"THREADS_ICON",FacebookIcon:"FACEBOOK_ICON",ExternalLinkIcon:"EXTERNAL_LINK_ICON",MessengerIcon:"MESSENGER_ICON",InstagramIcon:"INSTAGRAM_ICON",OculusIcon:"OCULUS_ICON",MetaAiIcon:"META_AI_ICON",MetaHorizonIcon:"META_HORIZON_ICON",VibesIcon:"VIBES_ICON",ManusIcon:"MANUS_ICON"}),xt=e({Left:"LEFT",Center:"CENTER"}),$t=e({Default:"DEFAULT"}),Pt=e({None:"NONE",YoutubeVideo:"YOUTUBE_VIDEO",YoutubeShorts:"YOUTUBE_SHORTS"});i.AiBotEmbodimentTrigger=l,i.ClientInstructionType=s,i.GenAi3PExtCtaState=u,i.GenAiActionListRowType=c,i.GenAiAddonActionAlignment=d,i.GenAiAddonActionType=m,i.GenAiCodeBlockType=p,i.GenAiCompactEntityActionType=_,i.GenAiCompactEntityType=f,i.GenAiDividerType=g,i.GenAiFooterActionType=h,i.GenAiigBloomActionButtonType=y,i.GenAiImageAssetQueryStatus=C,i.GenAiImaginePrimitiveStatus=b,i.GenAiImagineType=v,i.GenAiMapQueryStatus=S,i.GenAiMediaHorizontalAlignment=R,i.GenAiMediaShape=L,i.GenAiMediaVerticalAlignment=E,i.GenAiMultipleResponseLayoutType=k,i.GenAiOrchestratorSearchEngine=I,i.GenAiPlaceDetailsItemOpeningStatus=T,i.GenAiPlaceDetailsItemPriceLevel=D,i.GenAiPostOrientation=x,i.GenAiPostType=$,i.GenAiProductSurface=P,i.GenAiSearchPlannerStepStatus=N,i.GenAiSocialEntityItemType=M,i.GenAiSourceApp=w,i.GenAiSourcedItemType=A,i.GenAiThinkingStatusIcon=F,i.GenAiThinkingStatusSecondaryScreenId=O,i.GenAiThinkingStatusSecondaryScreenTabId=B,i.GenAiThinkingToolStatus=W,i.GenAiThirdPartyAccountLinkingIntegration=q,i.GenAiThirdPartyAccountLinkingIntegrationStatus=U,i.GenAiThreadSurfingActionType=V,i.GenAiThreadSurfingEntityType=H,i.GenAiUnifiedResponseSectionType=G,i.GenAiContextInjectionType=z,i.GenAiPromptType=j,i.MebSplitDatabaseExecutionType=K,i.MpsBackupContentType=Q,i.MpsBackupOperation=X,i.MpsMessageBackupSource=Y,i.MpsMessageRangeQueryDirection=J,i.MpsMessageTag=Z,i.MpsQueryCaller=ee,i.MpsServerAttachmentUploadStatus=te,i.MpsServerMessageUploadStatus=ne,i.MpsUploadType=re,i.SlvBasilConversationStarterType=oe,i.SlvImagineImageOrientation=ae,i.SlvPromptEditType=ie,i.SlvResponseRole=le,i.SlvViewerAction=se,i.XmsgaiBotResponseImagineSource=ue,i.XmsgaiInvocationOptions=ce,i.XmsgaiLookupActionType=de,i.XmsgaiLookupEntityType=me,i.XmsgaiProduct=pe,i.XmsgctaType=_e,i.XmsgContentBrandingOption=fe,i.Xmsge2EeGenAiEncryptedImageProductType=ge,i.Xmsge2EeGenAiEncryptedVideoProductType=he,i.XmsgFeatureTags=ye,i.XmsgGenAiBotResponseProductType=Ce,i.XmsgGenAiBotSubscriptionProductType=be,i.XmsgGenAiMessageType=ve,i.XmsgHighlightsTabMoment=Se,i.XmsgHighlightsTabReplySourceType=Re,i.XmsgIgReceiverFetchContentType=Le,i.XmsgIgReceiverFetchXmaMediaNoteFetchParamsMessageType=Ee,i.XmsgIgXmaActionType=ke,i.XmsgImageGlyphType=Ie,i.XmsgInlineEntityType=Te,i.XmsgMarketplaceLightweightReplyType=De,i.XmsgMarketplaceSmartRepliesTriggerType=xe,i.XmsgMediaDispatchKey=$e,i.XmsgMemoriesE2EeSendTemplateType=Pe,i.XmsgMemoriesTemplateType=Ne,i.XmsgMessageRequestStatus=Me,i.XmsgMessageSendProductType=we,i.XmsgMessageStreamingProductType=Ae,i.XmsgMsgrReceiverFetchContentType=Fe,i.XmsgMsgrReceiverFetchXmaLayoutType=Oe,i.XmsgMsgrXmaActionType=Be,i.XmsgMsgrXmaUnifiedQueryType=We,i.XmsgMustacheCtaType=qe,i.XmsgNoteMessageType=Ue,i.XmsgNoteModelType=Ve,i.XmsgOculusMediaType=He,i.XmsgPowerUpStyle=Ge,i.XmsgReactionStyle=ze,i.XmsgReportedMessageType=je,i.XmsgSpectraActionSource=Ke,i.XmsgSpectraActionType=Qe,i.XmsgSpectraTakeDownActionType=Xe,i.XmsgStoryOverlayPollStyle=Ye,i.XmsgStoryOverlayTagType=Je,i.XmsgStoryReplyType=Ze,i.XmsgStreamStatusType=et,i.XmsgSuggestedModerationActionType=tt,i.XmsgTestEnum=nt,i.XmsgTestMinimalEnum=rt,i.XmsgTranscriptionStatus=ot,i.XmsgXmaBizAiUnifiedResponseAttributionType=at,i.XmsgXmaBizAiUnifiedResponseSourceAttributionType=it,i.XmsgXmaCodeBlockType=lt,i.XmsgXmaCompactGenericTemplateAccessoryType=st,i.XmsgXmaCompactGenericTemplatePreviewStyle=ut,i.XmsgXmaContentAttributionIcon=ct,i.XmsgXmaContentType=dt,i.XmsgXmaCtaIconType=mt,i.XmsgXmaCustomPreviewType=pt,i.XmsgXmaDailyGameChallengePlayerStatus=_t,i.XmsgXmaFlightStatusEnum=ft,i.XmsgXmaGatingType=gt,i.XmsgXmaImageDecorationType=ht,i.XmsgXmaLayoutType=yt,i.XmsgXmaLiveLocationSessionState=Ct,i.XmsgXmaMessagingAttachmentFaviconStyle=bt,i.XmsgXmaOpgP2pPaymentMethodType=vt,i.XmsgXmaOpgP2pTransactionType=St,i.XmsgXmaOverlayContentType=Rt,i.XmsgXmaRtcCallState=Lt,i.XmsgXmaRtcCallType=Et,i.XmsgXmaStandardGenericBodyLayoutType=kt,i.XmsgXmaStandardGenericBodyTitleStyle=It,i.XmsgXmaSubscriptionRecurrenceType=Tt,i.XmsgXmaSubtitleDecorationType=Dt,i.XmsgXmaVStackLayoutHeaderAlignmentType=xt,i.XmsgXmaVerifiedType=$t,i.XmsgXmaYoutubePreviewMediaType=Pt}),66);
__d("MpsTypes",["$InternalEnum","WAStanzaUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return e}function s(e){return e}function u(e){return e}function c(e){return o("WAStanzaUtils").toStanzaId(e)}function d(e){return e}function m(e){return e}var p=n("$InternalEnum").Mirrored(["Send","Receive"]),_=n("$InternalEnum").Mirrored(["InProgress","Completed"]),f=n("$InternalEnum")({Unknown:0,Noop:1,UpsertTopLevel:2,UpsertSupplemental:3,DeleteTopLevel:4,DeleteTopLevelWithPlaceholder:5,Preprocess:6,DeleteSupplemental:7,DeleteThread:8});l.toBytes=e,l.toTimestamp=s,l.toMessageId=u,l.messageIdToStanzaId=c,l.toThreadId=d,l.toSupplementalKey=m,l.InsertionSource=p,l.MawDBMigrationState=_,l.ActionType=f}),98);
__d("WAFrankingTypes",[],(function(t,n,r,o,a,i){"use strict";function e(e){return e}function l(e){return e}function s(e){return e}i.castToFrankingTag=e,i.castToFrankingKey=l,i.castToReportingTag=s}),66);
__d("EBMinosProcessMessages",["Base64Utils","EBMinosLogger","EBMinosMessageEncryptionVersion","EBMinosMessageMetadataVersion","EBMinosTypes","MSGDataclassTypes.flow","MpsTypes","WAFrankingTypes","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g,h,y,C;function b(t){var n=t!=null?t:{},r=n.actor_token,a=n.encrypted_protobuf,i=n.franking_tag,l=n.mek_fbid,c=n.mek_id,d=n.message_encryption_version,m=n.message_metadata_version,p=n.protobuf_timestamp,_=n.reporting_tag,f=n.transport_sender_message_signature,g=n.transport_sender_signing_pk;if(d==null&&o("EBMinosLogger").minosLogger.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["missing message_encryption_version on restore"]))),r==null||a==null||d==null||m==null||l==null||c==null||p==null||f==null||g==null)return o("WAResultOrError").makeError("top-level-missing-fields");var h=o("EBMinosMessageEncryptionVersion").MinosMessageEncryptionVersion.cast(d);if(h==null)return o("EBMinosLogger").minosLogger.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Failed to cast message encryption version: ",""])),d),o("WAResultOrError").makeError("invalid-message-encryption-version");var y=o("EBMinosMessageMetadataVersion").MinosMessageMetadataVersion.cast(m);return y==null?(o("EBMinosLogger").minosLogger.ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Failed to cast message metadata version: ",""])),m),o("WAResultOrError").makeError("invalid-message-metadata-version")):o("WAResultOrError").makeResult({actorToken:o("EBMinosTypes").unsafeCastToUserFbId(r),encryptedProtobuf:o("EBMinosTypes").unsafeCastToEncryptedMessage(o("Base64Utils").toArrayBuffer(a)),frankingTag:i!=null?o("WAFrankingTypes").castToFrankingTag(new Uint8Array(o("Base64Utils").toArrayBuffer(i))):null,mekFbid:o("EBMinosTypes").unsafeCastToMekFbId(l),mekId:o("EBMinosTypes").unsafeCastToMekId(o("Base64Utils").toArrayBuffer(c)),messageEncryptionVersion:h,messageMetadataVersion:y,protobufTimestamp:o("MpsTypes").toTimestamp(parseInt(p,10)),reportingTag:_!=null?o("WAFrankingTypes").castToReportingTag(new Uint8Array(o("Base64Utils").toArrayBuffer(_))):null,transportSenderMessageSignature:o("EBMinosTypes").unsafeCastToEncryptedMessageSignature(o("Base64Utils").toArrayBuffer(f)),transportSenderSigningPk:o("EBMinosTypes").unsafeCastToTransportSigningPK(o("Base64Utils").toArrayBuffer(g))})}function v(e){return e==="PHOTO"?o("MSGDataclassTypes.flow").MpsMessageTag.Photo:e==="PERMANENT"?o("MSGDataclassTypes.flow").MpsMessageTag.Permanent:e==="EPHEMERAL"?o("MSGDataclassTypes.flow").MpsMessageTag.Ephemeral:e==="VIDEO"?o("MSGDataclassTypes.flow").MpsMessageTag.Video:e==="GIF"?o("MSGDataclassTypes.flow").MpsMessageTag.Gif:e==="AUDIO"?o("MSGDataclassTypes.flow").MpsMessageTag.Audio:e==="FILE"?o("MSGDataclassTypes.flow").MpsMessageTag.File:e==="RAVEN"?o("MSGDataclassTypes.flow").MpsMessageTag.Raven:e==="UNREAD_RAVEN"?o("MSGDataclassTypes.flow").MpsMessageTag.UnreadRaven:e==="SHARE_IG_MEDIA"?o("MSGDataclassTypes.flow").MpsMessageTag.ShareIgMedia:e==="SHARE_LINK"?o("MSGDataclassTypes.flow").MpsMessageTag.ShareLink:e==="SHARE_IG_CLIPS"?o("MSGDataclassTypes.flow").MpsMessageTag.ShareIgClips:e==="SHH"?o("MSGDataclassTypes.flow").MpsMessageTag.Shh:e==="STORY_REPLY"?o("MSGDataclassTypes.flow").MpsMessageTag.StoryReply:e==="DISAPPEARING_MESSAGE"?o("MSGDataclassTypes.flow").MpsMessageTag.DisappearingMessage:e==="RAVEN_SEEN"?o("MSGDataclassTypes.flow").MpsMessageTag.RavenSeen:e==="RAVEN_REPLAYED"?o("MSGDataclassTypes.flow").MpsMessageTag.RavenReplayed:e==="RAVEN_READ_ONCE"?o("MSGDataclassTypes.flow").MpsMessageTag.RavenReadOnce:e==="RAVEN_REPLAYABLE"?o("MSGDataclassTypes.flow").MpsMessageTag.RavenReplayable:e==="RAVEN_PERMANENT"?o("MSGDataclassTypes.flow").MpsMessageTag.RavenPermanent:e==="ACTION_LOG"?o("MSGDataclassTypes.flow").MpsMessageTag.ActionLog:null}function S(e){if(e==null)return[];var t=[];for(var n of e){var r=v(n);r==null?o("EBMinosLogger").minosLogger.ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["processMinosMessages: protobuf_stanzas is null"]))):t.push(r)}return t}function R(e){var t=e!=null?e:{},n=t.actor_token,r=t.encrypted_protobuf,a=t.franking_tag,i=t.mek_fbid,l=t.mek_id,s=t.message_encryption_version,u=t.message_metadata_version,c=t.protobuf_timestamp,_=t.reporting_tag,f=t.supplemental_key,g=t.supplemental_otid,h=t.transport_sender_message_signature,y=t.transport_sender_signing_pk;if(s==null&&o("EBMinosLogger").minosLogger.ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["missing message_encryption_version on restore"]))),n==null||r==null||s==null||u==null||i==null||l==null||c==null||h==null||y==null||f==null||g==null)return null;var C=o("EBMinosMessageEncryptionVersion").MinosMessageEncryptionVersion.cast(s);if(C==null)return o("EBMinosLogger").minosLogger.ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Failed to cast message encryption version: ",""])),s),null;var b=o("EBMinosMessageMetadataVersion").MinosMessageMetadataVersion.cast(u);return b==null?(o("EBMinosLogger").minosLogger.ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Failed to cast message metadata version: ",""])),u),null):{actorToken:o("EBMinosTypes").unsafeCastToUserFbId(n),encryptedProtobuf:o("EBMinosTypes").unsafeCastToEncryptedMessage(o("Base64Utils").toArrayBuffer(r)),frankingTag:a!=null?o("WAFrankingTypes").castToFrankingTag(new Uint8Array(o("Base64Utils").toArrayBuffer(a))):null,mekFbid:o("EBMinosTypes").unsafeCastToMekFbId(i),mekId:o("EBMinosTypes").unsafeCastToMekId(o("Base64Utils").toArrayBuffer(l)),messageEncryptionVersion:C,messageMetadataVersion:b,protobufTimestamp:o("MpsTypes").toTimestamp(parseInt(c,10)),reportingTag:_!=null?o("WAFrankingTypes").castToReportingTag(new Uint8Array(o("Base64Utils").toArrayBuffer(_))):null,supplementalKey:o("MpsTypes").toSupplementalKey(f),supplementalOtid:o("MpsTypes").toMessageId(g),transportSenderMessageSignature:o("EBMinosTypes").unsafeCastToEncryptedMessageSignature(o("Base64Utils").toArrayBuffer(h)),transportSenderSigningPk:o("EBMinosTypes").unsafeCastToTransportSigningPK(o("Base64Utils").toArrayBuffer(y))}}function L(e){return e==null?[]:e.map(function(e){var t=e.echo_document,n=e.otid,r=e.protobuf_stanzas;if(n==null)return o("EBMinosLogger").minosLogger.ERROR(_||(_=babelHelpers.taggedTemplateLiteralLoose(["processMinosMessages: otid is null"]))),null;if(r==null)return t==null&&o("EBMinosLogger").minosLogger.ERROR(f||(f=babelHelpers.taggedTemplateLiteralLoose(["processMinosMessages: protobuf_stanzas and echo_documents are null"]))),null;var a=r.message_tags,i=r.supplemental_protobufs_v2,l=i===void 0?[]:i,s=r.top_level_protobuf_v2;if(s==null)return null;var u=b(s);if(!u.success)return o("EBMinosLogger").minosLogger.ERROR(g||(g=babelHelpers.taggedTemplateLiteralLoose(["processMinosMessages: top_level_protobuf_v2 conversion failed"]))),null;var c=l.map(function(e){var t=e==null?void 0:e.supplemental_key,n=R(e);if(t==null){o("EBMinosLogger").minosLogger.LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["processMinosMessages: minos supplementalKey is null"])));return}if(n==null){o("EBMinosLogger").minosLogger.LOG(y||(y=babelHelpers.taggedTemplateLiteralLoose(["processMinosMessages: minosSupplementalProtobuf is null"])));return}return n}).filter(Boolean),d=o("MpsTypes").toMessageId(n);return{messageTags:S(a),otid:d,supplementalProtobufsV2:c,topLevelProtobufV2:u.value}}).filter(Boolean)}function E(e,t,n){return t===o("EBMinosMessageMetadataVersion").MinosMessageMetadataVersion.V1?e:isNaN(n)?(o("EBMinosLogger").minosLogger.ERROR(C||(C=babelHelpers.taggedTemplateLiteralLoose(["createMessageTimestamp: otid is not a number"]))),o("MpsTypes").toTimestamp(0)):k(n)}function k(e){return o("MpsTypes").toTimestamp(Number(BigInt(e)>>BigInt(22)))}l.convertArrayToMpsMessageTags=S,l.processMinosMessages=L,l.createMessageTimestamp=E,l.extractTimestampFromOtid=k}),98);
__d("EBMinosInterfaceTypes",["EBMinosProcessMessages","EBMinosTypes"],(function(t,n,r,o,a,i,l){"use strict";var e;l.unsafeCastToBackupFbid=(e=o("EBMinosTypes")).unsafeCastToBackupFbid,l.unsafeCastToBase64StringIntToEpochNumber=e.unsafeCastToBase64StringIntToEpochNumber,l.unsafeCastToEpochHead=e.unsafeCastToEpochHead,l.unsafeCastToEpochSelfSig=e.unsafeCastToEpochSelfSig,l.unsafeCastToMailboxAuthPK=e.unsafeCastToMailboxAuthPK,l.unsafeCastToDeviceId=e.unsafeCastToDeviceId,l.unsafeCastToMailboxEncryptionPK=e.unsafeCastToMailboxEncryptionPK,l.processMinosMessages=o("EBMinosProcessMessages").processMinosMessages,l.unsafeCastToMekMiThreadId=e.unsafeCastToMekMiThreadId,l.unsafeCastToMailboxSigningPK=e.unsafeCastToMailboxSigningPK,l.convertArrayToMpsMessageTags=o("EBMinosProcessMessages").convertArrayToMpsMessageTags,l.userJidToUserFbId=e.userJidToUserFbId,l.unsafeCastToUserFbId=e.unsafeCastToUserFbId,l.unsafeCastToMailboxFbId=e.unsafeCastToMailboxFbId,l.unsafeCastToEpochCreationTime=e.unsafeCastToEpochCreationTime,l.unsafeCastToDecryptedMessage=e.unsafeCastToDecryptedMessage}),98);
__d("EBMinosQplFlow",["QPLUserFlow","Random","gkx","justknobx","qpl"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.threadId;return u({annotations:{string:{threadId:t}},event:r("qpl")._(521473369,"2834")})}function s(e){var t=e.threadId;return u({annotations:{bool:{minos_as_a_transport_enabled:r("gkx")("8208"),publish_no_await_enabled:r("gkx")("1922")},string:{threadId:t}},event:r("qpl")._(521485893,"2835")})}function u(e){var t=e.annotations,n=e.event,a=o("Random").uint32();return r("QPLUserFlow").start(n,{annotations:babelHelpers.extends({},t,{bool:babelHelpers.extends({},t==null?void 0:t.bool,{minos_rollout_enabled:r("gkx")("20911"),occam_only_mailbox_users:r("gkx")("16674"),use_minos_thread_id:!0}),int:babelHelpers.extends({},t==null?void 0:t.int,{instanceKey:a,retryCount:0})}),instanceKey:a,timeoutInMs:r("justknobx")._("1405")}),_(n,a)}function c(){return u({annotations:{bool:{write_minos_public_keys_v2_enabled:r("gkx")("20208")}},event:r("qpl")._(521473150,"2143")})}function d(e){var t=e.entryPoint;return u({annotations:{string:{entryPoint:t}},event:r("qpl")._(521482880,"16")})}function m(){return u({event:r("qpl")._(521479165,"3055")})}function p(){return u({event:r("qpl")._(521479667,"3154")})}function _(e,t){return{addAnnotations:function(o){r("QPLUserFlow").addAnnotations(e,o,{instanceKey:t})},addPoint:function(o,a){a&&r("QPLUserFlow").addAnnotations(e,a,{instanceKey:t}),r("QPLUserFlow").addPoint(e,o,{instanceKey:t})},endFailWithError:function(o,a,i){var n=babelHelpers.extends({},i,{string:babelHelpers.extends({},i==null?void 0:i.string,{failReason:a})});r("QPLUserFlow").endFailure(e,o,{annotations:n,instanceKey:t})},endSuccess:function(o){r("QPLUserFlow").endSuccess(e,{annotations:o,instanceKey:t})},getInstanceKey:function(){return t}}}l.startMinosMessageEnqueueQpl=e,l.startMinosMessageUploadQpl=s,l.startMinosWritePublicKeysQpl=c,l.startMinosVerifySingleEpochQpl=d,l.startMinosCreateEpochParamsQpl=m,l.startMinosMailboxKeyFetchQpl=p}),98);
__d("EBMinosWasm.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={},u={},c={},d={},m={},p={},_={},f={},g={},h={},y={},C={},b={},v={},S={},R={},L={},E={},k={},I={},T={},D={},x={},$={},P={},N={},M={},w={},A={},F={},O={},B={},W={},q={},U={},V={},H={},G={},z={},j={},K={},Q={},X={},Y={},J={},Z={},ee={},te={},ne={},re={},oe={},ae={},ie={},le={},se={},ue={},ce={},de={},me={},pe={},_e={},fe={},ge={},he={},ye={},Ce={},be={},ve={},Se={},Re={},Le={},Ee={},ke={},Ie={},Te={},De={},xe={},$e={},Pe={};s.name="MinosMessageMetadata",s.internalSpec={mekId:[1,(e=o("WAProtoConst")).FLAGS.REQUIRED|e.TYPES.BYTES],timestamp:[2,e.FLAGS.REQUIRED|e.TYPES.UINT64],messageId:[3,e.FLAGS.REQUIRED|e.TYPES.STRING],threadId:[4,e.FLAGS.REQUIRED|e.TYPES.BYTES]},u.name="MinosClientConfig",u.internalSpec={preferredMessageEncryptionVersion:[1,e.FLAGS.REQUIRED|e.TYPES.INT32],preferredMekEncryptionVersion:[2,e.FLAGS.REQUIRED|e.TYPES.INT32]},c.name="MinosEncryptAndSignMessageInput",c.internalSpec={transportSigningSk:[1,e.FLAGS.REQUIRED|e.TYPES.BYTES],mek:[2,e.FLAGS.REQUIRED|e.TYPES.BYTES],plaintext:[3,e.FLAGS.REQUIRED|e.TYPES.BYTES],metadata:[4,e.FLAGS.REQUIRED|e.TYPES.MESSAGE,s],transportSigningPk:[5,e.TYPES.BYTES],conf:[6,e.TYPES.MESSAGE,u]},d.name="MinosEncryptAndSignMessageResult",d.internalSpec={ciphertext:[1,e.FLAGS.REQUIRED|e.TYPES.BYTES],signature:[2,e.FLAGS.REQUIRED|e.TYPES.BYTES],version:[3,e.FLAGS.REQUIRED|e.TYPES.INT32]},m.name="MinosDecryptAndVerifyMessageInput",m.internalSpec={transportSigningPk:[1,e.FLAGS.REQUIRED|e.TYPES.BYTES],mek:[2,e.FLAGS.REQUIRED|e.TYPES.BYTES],encryptedMessageCiphertext:[3,e.FLAGS.REQUIRED|e.TYPES.BYTES],encryptedMessageSignature:[4,e.FLAGS.REQUIRED|e.TYPES.BYTES],metadata:[5,e.FLAGS.REQUIRED|e.TYPES.MESSAGE,s],messageEncryptionVersion:[6,e.TYPES.INT32],conf:[7,e.TYPES.MESSAGE,u]},p.name="MinosDecryptAndVerifyMessageResult",p.internalSpec={success:[1,e.TYPES.MESSAGE,_],errorMessage:[2,e.TYPES.STRING],__oneofs__:{result:["success","errorMessage"]}},_.name="MinosDecryptAndVerifyMessageSuccess",_.internalSpec={plaintext:[1,e.FLAGS.REQUIRED|e.TYPES.BYTES]},f.name="MekBundle",f.internalSpec={key:[1,e.FLAGS.REQUIRED|e.TYPES.BYTES],mekId:[2,e.FLAGS.REQUIRED|e.TYPES.BYTES],rosterHash:[3,e.FLAGS.REQUIRED|e.TYPES.BYTES]},g.name="GenerateMekInput",g.internalSpec={epochHeads:[1,e.FLAGS.REPEATED|e.TYPES.BYTES]},h.name="GenerateMekResult",h.internalSpec={mek:[1,e.FLAGS.REQUIRED|e.TYPES.MESSAGE,f]},y.name="GenerateMekRosterHashInput",y.internalSpec={epochHeads:[1,e.FLAGS.REPEATED|e.TYPES.BYTES]},C.name="GenerateMekRosterHashResult",C.internalSpec={rosterHash:[1,e.FLAGS.REQUIRED|e.TYPES.BYTES]},b.name="EncryptMekForDistributionInput",b.internalSpec={senderEpochHead:[1,e.FLAGS.REQUIRED|e.TYPES.BYTES],toMailboxPk:[2,e.FLAGS.REQUIRED|e.TYPES.BYTES],fromKeypair:[3,e.FLAGS.REQUIRED|e.TYPES.MESSAGE,v],mek:[4,e.FLAGS.REQUIRED|e.TYPES.MESSAGE,f],toEpochHead:[5,e.TYPES.BYTES],conf:[6,e.TYPES.MESSAGE,u]},v.name="EncryptMekForDistributionInput$MailboxAuthKP",v.internalSpec={sk:[1,e.FLAGS.REQUIRED|e.TYPES.BYTES],pk:[2,e.FLAGS.REQUIRED|e.TYPES.BYTES]},S.name="EncryptMekForDistributionResult",S.internalSpec={ciphertext:[1,e.FLAGS.REQUIRED|e.TYPES.BYTES],version:[2,e.FLAGS.REQUIRED|e.TYPES.UINT64]},R.name="DecryptMekForDistributionInput",R.internalSpec={toMailboxSk:[1,e.FLAGS.REQUIRED|e.TYPES.BYTES],fromPk:[2,e.FLAGS.REQUIRED|e.TYPES.BYTES],mekId:[3,e.FLAGS.REQUIRED|e.TYPES.BYTES],senderEpochHead:[4,e.FLAGS.REQUIRED|e.TYPES.BYTES],rosterHash:[5,e.FLAGS.REQUIRED|e.TYPES.BYTES],ciphertext:[6,e.FLAGS.REQUIRED|e.TYPES.BYTES],toEpochHead:[7,e.TYPES.BYTES],mekEncryptionVersion:[8,e.TYPES.INT32],conf:[9,e.TYPES.MESSAGE,u]},L.name="DecryptMekForDistributionResult",L.internalSpec={success:[1,e.TYPES.MESSAGE,E],errorMessage:[2,e.TYPES.STRING],__oneofs__:{result:["success","errorMessage"]}},E.name="DecryptMekForDistributionSuccess",E.internalSpec={mek:[1,e.FLAGS.REQUIRED|e.TYPES.BYTES]},k.name="EncryptMeksForDistributionFromTransportSenderInput",k.internalSpec={mek:[1,e.FLAGS.REQUIRED|e.TYPES.MESSAGE,f],transportSigningKp:[2,e.FLAGS.REQUIRED|e.TYPES.MESSAGE,I],recipientMailboxEncryptionPks:[3,e.FLAGS.REPEATED|e.TYPES.BYTES],recipientEpochHeads:[4,e.FLAGS.REPEATED|e.TYPES.BYTES],conf:[5,e.TYPES.MESSAGE,u]},I.name="EncryptMeksForDistributionFromTransportSenderInput$TransportSigningKP",I.internalSpec={sk:[1,e.FLAGS.REQUIRED|e.TYPES.BYTES],pk:[2,e.FLAGS.REQUIRED|e.TYPES.BYTES]},T.name="EncryptMeksForDistributionFromTransportSenderResult",T.internalSpec={encryptedMeks:[1,e.FLAGS.REPEATED|e.TYPES.BYTES],ephemeralEncryptionPk:[2,e.FLAGS.REQUIRED|e.TYPES.BYTES],signingPk:[3,e.FLAGS.REQUIRED|e.TYPES.BYTES],signature:[4,e.FLAGS.REQUIRED|e.TYPES.BYTES],version:[5,e.FLAGS.REQUIRED|e.TYPES.UINT64]},D.name="DecryptMekForDistributionFromTransportSenderInput",D.internalSpec={mekDistribution:[1,e.FLAGS.REQUIRED|e.TYPES.MESSAGE,x],mekId:[2,e.FLAGS.REQUIRED|e.TYPES.BYTES],rosterHash:[3,e.FLAGS.REQUIRED|e.TYPES.BYTES],recipientEncSk:[4,e.FLAGS.REQUIRED|e.TYPES.BYTES],version:[5,e.FLAGS.REQUIRED|e.TYPES.UINT64],conf:[6,e.TYPES.MESSAGE,u]},x.name="DecryptMekForDistributionFromTransportSenderInput$TransportSenderMEKDistributionSingleRecipient",x.internalSpec={encryptedMek:[1,e.FLAGS.REQUIRED|e.TYPES.BYTES],ephemeralEncryptionPk:[2,e.FLAGS.REQUIRED|e.TYPES.BYTES],signingPk:[3,e.FLAGS.REQUIRED|e.TYPES.BYTES],signature:[4,e.FLAGS.REQUIRED|e.TYPES.BYTES],recipientEpochHead:[5,e.TYPES.BYTES]},$.name="DecryptMekForDistributionFromTransportSenderResult",$.internalSpec={success:[1,e.TYPES.MESSAGE,P],errorMessage:[2,e.TYPES.STRING],__oneofs__:{result:["success","errorMessage"]}},P.name="DecryptMekForDistributionFromTransportSenderSuccess",P.internalSpec={mek:[1,e.FLAGS.REQUIRED|e.TYPES.BYTES]},N.name="WrapTransportSigningPublicKeyInput",N.internalSpec={keyBytes:[1,e.FLAGS.REQUIRED|e.TYPES.BYTES]},M.name="WrapTransportSigningPublicKeyResult",M.internalSpec={prefixedKey:[1,e.FLAGS.REQUIRED|e.TYPES.BYTES]},w.name="WrapTransportSigningSecretKeyInput",w.internalSpec={keyBytes:[1,e.FLAGS.REQUIRED|e.TYPES.BYTES]},A.name="WrapTransportSigningSecretKeyResult",A.internalSpec={prefixedKey:[1,e.FLAGS.REQUIRED|e.TYPES.BYTES]},F.name="DeriveMailboxSigningKeypairInput",F.internalSpec={exportRootKey:[1,e.FLAGS.REQUIRED|e.TYPES.BYTES],epochNumber:[2,e.FLAGS.REQUIRED|e.TYPES.UINT64]},O.name="DeriveMailboxSigningKeypairResult",O.internalSpec={mailboxSigningPublicKey:[1,e.FLAGS.REQUIRED|e.TYPES.BYTES],mailboxSigningPrivateKey:[2,e.FLAGS.REQUIRED|e.TYPES.BYTES]},B.name="DeriveMailboxEncryptionKeypairInput",B.internalSpec={exportRootKey:[1,e.FLAGS.REQUIRED|e.TYPES.BYTES],epochNumber:[2,e.FLAGS.REQUIRED|e.TYPES.UINT64]},W.name="DeriveMailboxEncryptionKeypairResult",W.internalSpec={mailboxEncryptionPublicKey:[1,e.FLAGS.REQUIRED|e.TYPES.BYTES],mailboxEncryptionPrivateKey:[2,e.FLAGS.REQUIRED|e.TYPES.BYTES]},q.name="DeriveMailboxAuthKeypairInput",q.internalSpec={exportRootKey:[1,e.FLAGS.REQUIRED|e.TYPES.BYTES],epochNumber:[2,e.FLAGS.REQUIRED|e.TYPES.UINT64]},U.name="DeriveMailboxAuthKeypairResult",U.internalSpec={mailboxAuthPublicKey:[1,e.FLAGS.REQUIRED|e.TYPES.BYTES],mailboxAuthPrivateKey:[2,e.FLAGS.REQUIRED|e.TYPES.BYTES]},V.name="DeriveAttachmentAccessTokenSecretInput",V.internalSpec={mediaKey:[1,e.FLAGS.REQUIRED|e.TYPES.BYTES]},H.name="DeriveAttachmentAccessTokenSecretResult",H.internalSpec={attachmentAccessTokenSecret:[1,e.FLAGS.REQUIRED|e.TYPES.BYTES]},G.name="DeriveAttachmentPrimaryKeySecretInput",G.internalSpec={mediaKey:[1,e.FLAGS.REQUIRED|e.TYPES.BYTES]},z.name="DeriveAttachmentPrimaryKeySecretResult",z.internalSpec={attachmentPrimaryKeySecret:[1,e.FLAGS.REQUIRED|e.TYPES.BYTES]},j.name="EpochPublicData",j.internalSpec={epochNumber:[1,e.FLAGS.REQUIRED|e.TYPES.UINT64],userFbid:[2,e.FLAGS.REQUIRED|e.TYPES.STRING],mailboxSigningPk:[3,e.FLAGS.REQUIRED|e.TYPES.BYTES],mailboxEncryptionPk:[4,e.FLAGS.REQUIRED|e.TYPES.BYTES],mailboxAuthPk:[5,e.FLAGS.REQUIRED|e.TYPES.BYTES],previousEpochHead:[6,e.TYPES.BYTES]},K.name="EpochSignatures",K.internalSpec={selfSignature:[1,e.FLAGS.REQUIRED|e.TYPES.BYTES],prevSignature:[2,e.TYPES.BYTES]},Q.name="MinosSignedEpoch",Q.internalSpec={epochPublicData:[1,e.FLAGS.REQUIRED|e.TYPES.MESSAGE,j],signatures:[2,e.FLAGS.REQUIRED|e.TYPES.MESSAGE,K],epochHead:[3,e.FLAGS.REQUIRED|e.TYPES.BYTES]},X.name="MinosOpenInitialEpochInput",X.internalSpec={userFbid:[1,e.FLAGS.REQUIRED|e.TYPES.STRING],epochNumber:[2,e.FLAGS.REQUIRED|e.TYPES.UINT64],exportRootKey:[3,e.FLAGS.REQUIRED|e.TYPES.BYTES]},Y.name="MinosOpenInitialEpochResult",Y.internalSpec={minosSignedEpoch:[1,e.FLAGS.REQUIRED|e.TYPES.MESSAGE,Q]},J.name="MinosOpenEpochInput",J.internalSpec={userFbid:[1,e.FLAGS.REQUIRED|e.TYPES.STRING],epochNumber:[2,e.FLAGS.REQUIRED|e.TYPES.UINT64],exportRootKey:[3,e.FLAGS.REQUIRED|e.TYPES.BYTES],previousExportRootKey:[4,e.FLAGS.REQUIRED|e.TYPES.BYTES],previousEpochNumber:[5,e.FLAGS.REQUIRED|e.TYPES.UINT64],previousEpochHead:[6,e.FLAGS.REQUIRED|e.TYPES.BYTES]},Z.name="MinosOpenEpochResult",Z.internalSpec={minosSignedEpoch:[1,e.FLAGS.REQUIRED|e.TYPES.MESSAGE,Q]},ee.name="MinosValidateEpochInput",ee.internalSpec={epochPublicData:[1,e.FLAGS.REQUIRED|e.TYPES.MESSAGE,j],previousEpochPublicData:[2,e.FLAGS.REQUIRED|e.TYPES.MESSAGE,j],signatures:[3,e.FLAGS.REQUIRED|e.TYPES.MESSAGE,K]},te.name="MinosValidateEpochResult",te.internalSpec={valid:[1,e.TYPES.BOOL],errorMessage:[2,e.TYPES.STRING],__oneofs__:{result:["valid","errorMessage"]}},ne.name="MinosVerifySingleEpochInput",ne.internalSpec={epochPublicData:[1,e.FLAGS.REQUIRED|e.TYPES.MESSAGE,j],signature:[2,e.FLAGS.REQUIRED|e.TYPES.BYTES]},re.name="MinosVerifySingleEpochResult",re.internalSpec={valid:[1,e.FLAGS.REQUIRED|e.TYPES.BOOL]},oe.name="MinosThreadIdFromOneToOneThreadInput",oe.internalSpec={actThreadId:[1,e.FLAGS.REQUIRED|e.TYPES.STRING],selfFbid:[2,e.FLAGS.REQUIRED|e.TYPES.STRING]},ae.name="MinosThreadIdFromOneToOneThreadResult",ae.internalSpec={threadId:[1,e.FLAGS.REQUIRED|e.TYPES.BYTES]},ie.name="MinosThreadIdFromActThreadIdInput",ie.internalSpec={actThreadId:[1,e.FLAGS.REQUIRED|e.TYPES.STRING]},le.name="MinosThreadIdFromActThreadIdResult",le.internalSpec={threadId:[1,e.FLAGS.REQUIRED|e.TYPES.BYTES]},se.name="MessagingMailboxPublicData",se.internalSpec={epochHead:[1,e.FLAGS.REQUIRED|e.TYPES.BYTES],deviceRosterHash:[2,e.FLAGS.REQUIRED|e.TYPES.BYTES],sequenceNumber:[3,e.FLAGS.REQUIRED|e.TYPES.UINT64],sigPk:[4,e.FLAGS.REQUIRED|e.TYPES.BYTES],encPk:[5,e.FLAGS.REQUIRED|e.TYPES.BYTES],authPk:[6,e.FLAGS.REQUIRED|e.TYPES.BYTES]},ue.name="DetachedDevicePublicData",ue.internalSpec={deviceId:[1,e.FLAGS.REQUIRED|e.TYPES.UINT64],name:[2,e.FLAGS.REQUIRED|e.TYPES.BYTES],sigPk:[3,e.FLAGS.REQUIRED|e.TYPES.BYTES],authPk:[4,e.FLAGS.REQUIRED|e.TYPES.BYTES],encPk:[5,e.FLAGS.REQUIRED|e.TYPES.BYTES],signature:[6,e.FLAGS.REQUIRED|e.TYPES.BYTES]},ce.name="MmkDistributionToDetachedDevice",ce.internalSpec={encryptedMmk:[1,e.FLAGS.REQUIRED|e.TYPES.BYTES],recipDeviceHash:[2,e.FLAGS.REQUIRED|e.TYPES.BYTES]},de.name="MmkDistributionToMailbox",de.internalSpec={encryptedMmk:[1,e.FLAGS.REQUIRED|e.TYPES.BYTES],recipMailboxHeadHash:[2,e.FLAGS.REQUIRED|e.TYPES.BYTES]},me.name="MmkDistribution",me.internalSpec={toDetachedDevices:[1,e.FLAGS.REPEATED|e.TYPES.MESSAGE,ce],toMailbox:[2,e.FLAGS.REQUIRED|e.TYPES.MESSAGE,de],version:[3,e.FLAGS.REQUIRED|e.TYPES.UINT64]},pe.name="SignedMmkDistributionFromMailbox",pe.internalSpec={mmkDistribution:[1,e.FLAGS.REQUIRED|e.TYPES.MESSAGE,me],signature:[2,e.FLAGS.REQUIRED|e.TYPES.BYTES],fromMailbox:[3,e.FLAGS.REQUIRED|e.TYPES.MESSAGE,se]},_e.name="MandrakeMekBundle",_e.internalSpec={key:[1,e.FLAGS.REQUIRED|e.TYPES.BYTES],mekId:[2,e.FLAGS.REQUIRED|e.TYPES.BYTES],mailboxHeadHash:[3,e.FLAGS.REQUIRED|e.TYPES.BYTES]},fe.name="MandrakeOpenEpochInput",fe.internalSpec={userFbid:[1,e.FLAGS.REQUIRED|e.TYPES.STRING],epochNumber:[2,e.FLAGS.REQUIRED|e.TYPES.UINT64],exportRootKey:[3,e.FLAGS.REQUIRED|e.TYPES.BYTES],previousExportRootKey:[4,e.FLAGS.REQUIRED|e.TYPES.BYTES],previousEpochNumber:[5,e.FLAGS.REQUIRED|e.TYPES.UINT64],previousEpochHead:[6,e.FLAGS.REQUIRED|e.TYPES.BYTES],previousMmk:[7,e.FLAGS.REQUIRED|e.TYPES.MESSAGE,se],detachedDevices:[8,e.FLAGS.REPEATED|e.TYPES.MESSAGE,ue]},ge.name="MandrakeOpenEpochResult",ge.internalSpec={success:[1,e.TYPES.MESSAGE,he],errorMessage:[2,e.TYPES.STRING],__oneofs__:{result:["success","errorMessage"]}},he.name="MandrakeOpenEpochSuccess",he.internalSpec={minosSignedEpoch:[1,e.FLAGS.REQUIRED|e.TYPES.MESSAGE,Q],signedMmkDistribution:[2,e.FLAGS.REQUIRED|e.TYPES.MESSAGE,pe]},ye.name="MandrakeOpenInitialEpochInput",ye.internalSpec={userFbid:[1,e.FLAGS.REQUIRED|e.TYPES.STRING],epochNumber:[2,e.FLAGS.REQUIRED|e.TYPES.UINT64],exportRootKey:[3,e.FLAGS.REQUIRED|e.TYPES.BYTES],detachedDevices:[4,e.FLAGS.REPEATED|e.TYPES.MESSAGE,ue]},Ce.name="MandrakeOpenInitialEpochResult",Ce.internalSpec={success:[1,e.TYPES.MESSAGE,he],errorMessage:[2,e.TYPES.STRING],__oneofs__:{result:["success","errorMessage"]}},be.name="MandrakeEncryptMekInput",be.internalSpec={mek:[1,e.FLAGS.REQUIRED|e.TYPES.MESSAGE,_e],recipients:[2,e.FLAGS.REPEATED|e.TYPES.MESSAGE,se],conf:[5,e.TYPES.MESSAGE,u],mmkSender:[3,e.TYPES.MESSAGE,Re],epochSender:[4,e.TYPES.MESSAGE,Se],detachedDeviceSender:[6,e.TYPES.MESSAGE,ve],__oneofs__:{sender:["mmkSender","epochSender","detachedDeviceSender"]}},ve.name="MandrakeEncryptMekInput$DetachedDeviceSender",ve.internalSpec={detachedDevicePublicData:[1,e.FLAGS.REQUIRED|e.TYPES.MESSAGE,ue],authSk:[2,e.FLAGS.REQUIRED|e.TYPES.BYTES],authPk:[3,e.FLAGS.REQUIRED|e.TYPES.BYTES]},Se.name="MandrakeEncryptMekInput$EpochSender",Se.internalSpec={epochPublicData:[1,e.FLAGS.REQUIRED|e.TYPES.MESSAGE,j],authSk:[2,e.FLAGS.REQUIRED|e.TYPES.BYTES],authPk:[3,e.FLAGS.REQUIRED|e.TYPES.BYTES]},Re.name="MandrakeEncryptMekInput$MmkSender",Re.internalSpec={mmkPublicData:[1,e.FLAGS.REQUIRED|e.TYPES.MESSAGE,se],authSk:[2,e.FLAGS.REQUIRED|e.TYPES.BYTES],authPk:[3,e.FLAGS.REQUIRED|e.TYPES.BYTES]},Le.name="MandrakeEncryptMekResult",Le.internalSpec={success:[1,e.TYPES.MESSAGE,Ee],errorMessage:[2,e.TYPES.STRING],__oneofs__:{result:["success","errorMessage"]}},Ee.name="MandrakeEncryptMekSuccess",Ee.internalSpec={distributions:[1,e.FLAGS.REPEATED|e.TYPES.MESSAGE,ke],recipientsHash:[2,e.FLAGS.REQUIRED|e.TYPES.BYTES],version:[3,e.FLAGS.REQUIRED|e.TYPES.UINT64]},ke.name="MandrakeEncryptMekSuccess$MekDistributionSingleRecipient",ke.internalSpec={encryptedMek:[1,e.FLAGS.REQUIRED|e.TYPES.BYTES],toMmk:[2,e.FLAGS.REQUIRED|e.TYPES.MESSAGE,se]},Ie.name="MandrakeDecryptMekInput",Ie.internalSpec={encryptedMek:[1,e.FLAGS.REQUIRED|e.TYPES.BYTES],recipientsHash:[4,e.FLAGS.REQUIRED|e.TYPES.BYTES],recipientEncSk:[5,e.FLAGS.REQUIRED|e.TYPES.BYTES],mekEncryptionVersion:[6,e.TYPES.UINT64],conf:[7,e.TYPES.MESSAGE,u],recipientMmk:[8,e.FLAGS.REQUIRED|e.TYPES.MESSAGE,se],mmkSender:[2,e.TYPES.MESSAGE,De],epochSender:[3,e.TYPES.MESSAGE,Te],__oneofs__:{senderPublicData:["mmkSender","epochSender"]}},Te.name="MandrakeDecryptMekInput$EpochSenderPublicData",Te.internalSpec={epochPublicData:[1,e.FLAGS.REQUIRED|e.TYPES.MESSAGE,j]},De.name="MandrakeDecryptMekInput$MmkSenderPublicData",De.internalSpec={mmkPublicData:[1,e.FLAGS.REQUIRED|e.TYPES.MESSAGE,se]},xe.name="MandrakeDecryptMekResult",xe.internalSpec={success:[1,e.TYPES.MESSAGE,$e],errorMessage:[2,e.TYPES.STRING],__oneofs__:{result:["success","errorMessage"]}},$e.name="MandrakeDecryptMekSuccess",$e.internalSpec={mek:[1,e.FLAGS.REQUIRED|e.TYPES.BYTES]},Pe.name="MinosCommand",Pe.internalSpec={encryptAndSignMessage:[1,e.TYPES.MESSAGE,c],decryptAndVerifyMessage:[2,e.TYPES.MESSAGE,m],generateMek:[3,e.TYPES.MESSAGE,g],generateMekRosterHash:[4,e.TYPES.MESSAGE,y],encryptMekForDistribution:[5,e.TYPES.MESSAGE,b],decryptMekForDistribution:[6,e.TYPES.MESSAGE,R],encryptMeksForDistributionFromTransportSender:[7,e.TYPES.MESSAGE,k],decryptMekForDistributionFromTransportSender:[8,e.TYPES.MESSAGE,D],wrapTransportSigningPublicKey:[9,e.TYPES.MESSAGE,N],wrapTransportSigningSecretKey:[10,e.TYPES.MESSAGE,w],deriveMailboxSigningKeypair:[11,e.TYPES.MESSAGE,F],deriveMailboxEncryptionKeypair:[12,e.TYPES.MESSAGE,B],deriveMailboxAuthKeypair:[13,e.TYPES.MESSAGE,q],deriveAttachmentAccessTokenSecret:[14,e.TYPES.MESSAGE,V],deriveAttachmentPrimaryKeySecret:[15,e.TYPES.MESSAGE,G],minosOpenInitialEpoch:[16,e.TYPES.MESSAGE,X],minosOpenEpoch:[17,e.TYPES.MESSAGE,J],minosValidateEpoch:[18,e.TYPES.MESSAGE,ee],minosVerifySingleEpoch:[19,e.TYPES.MESSAGE,ne],minosThreadIdFromOneToOneThread:[20,e.TYPES.MESSAGE,oe],minosThreadIdFromActThreadId:[21,e.TYPES.MESSAGE,ie],mandrakeOpenEpoch:[22,e.TYPES.MESSAGE,fe],mandrakeEncryptMek:[23,e.TYPES.MESSAGE,be],mandrakeDecryptMek:[24,e.TYPES.MESSAGE,Ie],mandrakeOpenInitialEpoch:[25,e.TYPES.MESSAGE,ye],__oneofs__:{commandInput:["encryptAndSignMessage","decryptAndVerifyMessage","generateMek","generateMekRosterHash","encryptMekForDistribution","decryptMekForDistribution","encryptMeksForDistributionFromTransportSender","decryptMekForDistributionFromTransportSender","wrapTransportSigningPublicKey","wrapTransportSigningSecretKey","deriveMailboxSigningKeypair","deriveMailboxEncryptionKeypair","deriveMailboxAuthKeypair","deriveAttachmentAccessTokenSecret","deriveAttachmentPrimaryKeySecret","minosOpenInitialEpoch","minosOpenEpoch","minosValidateEpoch","minosVerifySingleEpoch","minosThreadIdFromOneToOneThread","minosThreadIdFromActThreadId","mandrakeOpenEpoch","mandrakeEncryptMek","mandrakeDecryptMek","mandrakeOpenInitialEpoch"]}},l.MinosMessageMetadataSpec=s,l.MinosClientConfigSpec=u,l.MinosEncryptAndSignMessageInputSpec=c,l.MinosEncryptAndSignMessageResultSpec=d,l.MinosDecryptAndVerifyMessageInputSpec=m,l.MinosDecryptAndVerifyMessageResultSpec=p,l.MinosDecryptAndVerifyMessageSuccessSpec=_,l.MekBundleSpec=f,l.GenerateMekInputSpec=g,l.GenerateMekResultSpec=h,l.GenerateMekRosterHashInputSpec=y,l.GenerateMekRosterHashResultSpec=C,l.EncryptMekForDistributionInputSpec=b,l.EncryptMekForDistributionInput$MailboxAuthKPSpec=v,l.EncryptMekForDistributionResultSpec=S,l.DecryptMekForDistributionInputSpec=R,l.DecryptMekForDistributionResultSpec=L,l.DecryptMekForDistributionSuccessSpec=E,l.EncryptMeksForDistributionFromTransportSenderInputSpec=k,l.EncryptMeksForDistributionFromTransportSenderInput$TransportSigningKPSpec=I,l.EncryptMeksForDistributionFromTransportSenderResultSpec=T,l.DecryptMekForDistributionFromTransportSenderInputSpec=D,l.DecryptMekForDistributionFromTransportSenderInput$TransportSenderMEKDistributionSingleRecipientSpec=x,l.DecryptMekForDistributionFromTransportSenderResultSpec=$,l.DecryptMekForDistributionFromTransportSenderSuccessSpec=P,l.WrapTransportSigningPublicKeyInputSpec=N,l.WrapTransportSigningPublicKeyResultSpec=M,l.WrapTransportSigningSecretKeyInputSpec=w,l.WrapTransportSigningSecretKeyResultSpec=A,l.DeriveMailboxSigningKeypairInputSpec=F,l.DeriveMailboxSigningKeypairResultSpec=O,l.DeriveMailboxEncryptionKeypairInputSpec=B,l.DeriveMailboxEncryptionKeypairResultSpec=W,l.DeriveMailboxAuthKeypairInputSpec=q,l.DeriveMailboxAuthKeypairResultSpec=U,l.DeriveAttachmentAccessTokenSecretInputSpec=V,l.DeriveAttachmentAccessTokenSecretResultSpec=H,l.DeriveAttachmentPrimaryKeySecretInputSpec=G,l.DeriveAttachmentPrimaryKeySecretResultSpec=z,l.EpochPublicDataSpec=j,l.EpochSignaturesSpec=K,l.MinosSignedEpochSpec=Q,l.MinosOpenInitialEpochInputSpec=X,l.MinosOpenInitialEpochResultSpec=Y,l.MinosOpenEpochInputSpec=J,l.MinosOpenEpochResultSpec=Z,l.MinosValidateEpochInputSpec=ee,l.MinosValidateEpochResultSpec=te,l.MinosVerifySingleEpochInputSpec=ne,l.MinosVerifySingleEpochResultSpec=re,l.MinosThreadIdFromOneToOneThreadInputSpec=oe,l.MinosThreadIdFromOneToOneThreadResultSpec=ae,l.MinosThreadIdFromActThreadIdInputSpec=ie,l.MinosThreadIdFromActThreadIdResultSpec=le,l.MessagingMailboxPublicDataSpec=se,l.DetachedDevicePublicDataSpec=ue,l.MmkDistributionToDetachedDeviceSpec=ce,l.MmkDistributionToMailboxSpec=de,l.MmkDistributionSpec=me,l.SignedMmkDistributionFromMailboxSpec=pe,l.MandrakeMekBundleSpec=_e,l.MandrakeOpenEpochInputSpec=fe,l.MandrakeOpenEpochResultSpec=ge,l.MandrakeOpenEpochSuccessSpec=he,l.MandrakeOpenInitialEpochInputSpec=ye,l.MandrakeOpenInitialEpochResultSpec=Ce,l.MandrakeEncryptMekInputSpec=be,l.MandrakeEncryptMekInput$DetachedDeviceSenderSpec=ve,l.MandrakeEncryptMekInput$EpochSenderSpec=Se,l.MandrakeEncryptMekInput$MmkSenderSpec=Re,l.MandrakeEncryptMekResultSpec=Le,l.MandrakeEncryptMekSuccessSpec=Ee,l.MandrakeEncryptMekSuccess$MekDistributionSingleRecipientSpec=ke,l.MandrakeDecryptMekInputSpec=Ie,l.MandrakeDecryptMekInput$EpochSenderPublicDataSpec=Te,l.MandrakeDecryptMekInput$MmkSenderPublicDataSpec=De,l.MandrakeDecryptMekResultSpec=xe,l.MandrakeDecryptMekSuccessSpec=$e,l.MinosCommandSpec=Pe}),98);
__d("PromiseQueue",["Promise","emptyFunction"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(function(){function t(t){t===void 0&&(t=-1),this.$1=(e||(e=n("Promise"))).resolve(),this.$3=0,this.$2=t}var r=t.prototype;return r.wait=function(){return this.$1},r.enqueueHandlers=function(t,n,r){var e=this;this.$3++;var o=this.$1.then(function(){return t}).then(n,r),a=o.then();return this.$1=u(o,this.$2).finally(function(){e.$3--}),a},r.enqueue=function(t){var e=this;this.$3++;var n=this.$1.then(t),r=n.then();return this.$1=u(n,this.$2).finally(function(){e.$3--}),r},r.size=function(){return this.$3},t})();function u(t,o){return o>=0?new(e||(e=n("Promise")))(function(e){var n=function(){return void e()};t.then(n,n),globalThis.setTimeout(n,o)}):t.then(r("emptyFunction"),r("emptyFunction"))}l.PromiseQueue=s,l.wrapPromiseInTimeout=u}),98);
__d("WAPromiseQueue",["Promise","PromiseQueue"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(function(){function t(e){e===void 0&&(e=-1),this.$1=new Map,this.$2=e}var r=t.prototype;return r.waitIfPending=function(t){return this.$1.get(t)},r.wait=function(r){return this.$1.get(r)||(e||(e=n("Promise"))).resolve()},r.enqueueHandlers=function(t,n,r,o){var e=this.wait(t).then(function(){return n}).then(r,o);return this.$3(t,e)},r.enqueue=function(t,n){var e=this.wait(t).then(n);return this.$3(t,e)},r.$3=function(t,n){var e=this,r=n.then(),a,i=function(){e.$1.get(t)===a&&e.$1.delete(t)};return a=o("PromiseQueue").wrapPromiseInTimeout(n,this.$2).then(i,i),this.$1.set(t,a),r},t})();l.PromiseQueue=o("PromiseQueue").PromiseQueue,l.PromiseQueueMap=s}),98);
__d("WASIContext",[],(function(t,n,r,o,a,i){"use strict";var e=function(t){var e,n,r,o,a,i;this.fs=(e=t==null?void 0:t.fs)!=null?e:{},this.args=(n=t==null?void 0:t.args)!=null?n:[],this.env=(r=t==null?void 0:t.env)!=null?r:{},this.stdin=(o=t==null?void 0:t.stdin)!=null?o:function(){return null},this.stdout=(a=t==null?void 0:t.stdout)!=null?a:function(){},this.stderr=(i=t==null?void 0:t.stderr)!=null?i:function(){},this.debug=t==null?void 0:t.debug,this.isTTY=!!(t!=null&&t.isTTY)};i.WASIContext=e}),66);
__d("WASISnapshotPreview1",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e,l=Object.freeze({SUCCESS:0,E2BIG:1,EACCESS:2,EADDRINUSE:3,EADDRNOTAVAIL:4,EAFNOSUPPORT:5,EAGAIN:6,EALREADY:7,EBADF:8,EBADMSG:9,EBUSY:10,ECANCELED:11,ECHILD:12,ECONNABORTED:13,ECONNREFUSED:14,ECONNRESET:15,EDEADLK:16,EDESTADDRREQ:17,EDOM:18,EDQUOT:19,EEXIST:20,EFAULT:21,EFBIG:22,EHOSTUNREACH:23,EIDRM:24,EILSEQ:25,EINPROGRESS:26,EINTR:27,EINVAL:28,EIO:29,EISCONN:30,EISDIR:31,ELOOP:32,EMFILE:33,EMLINK:34,EMSGSIZE:35,EMULTIHOP:36,ENAMETOOLONG:37,ENETDOWN:38,ENETRESET:39,ENETUNREACH:40,ENFILE:41,ENOBUFS:42,ENODEV:43,ENOENT:44,ENOEXEC:45,ENOLCK:46,ENOLINK:47,ENOMEM:48,ENOMSG:49,ENOPROTOOPT:50,ENOSPC:51,ENOSYS:52,ENOTCONN:53,ENOTDIR:54,ENOTEMPTY:55,ENOTRECOVERABLE:56,ENOTSOCK:57,ENOTSUP:58,ENOTTY:59,ENXIO:60,EOVERFLOW:61,EOWNERDEAD:62,EPERM:63,EPIPE:64,EPROTO:65,EPROTONOSUPPORT:66,EPROTOTYPE:67,ERANGE:68,EROFS:69,ESPIPE:70,ESRCH:71,ESTALE:72,ETIMEDOUT:73,ETXTBSY:74,EXDEV:75,ENOTCAPABLE:76}),s=(e=n("$InternalEnum"))({REALTIME:0,MONOTONIC:1,PROCESS_CPUTIME_ID:2,THREAD_CPUTIME_ID:3}),u=e({SET:0,CUR:1,END:2}),c=e({UNKNOWN:0,BLOCK_DEVICE:1,CHARACTER_DEVICE:2,DIRECTORY:3,REGULAR_FILE:4,SOCKET_DGRAM:5,SOCKET_STREAM:6,SYMBOLIC_LINK:7}),d=e({DIR:0}),m=e({CLOCK:0,FD_READ:1,FD_WRITE:2}),p={SYMLINK_FOLLOW:1},_={CREAT:1,DIRECTORY:2,EXCL:4,TRUNC:8},f={APPEND:1,DSYNC:2,NONBLOCK:4,RSYNC:8,SYNC:16},g={FD_DATASYNC:BigInt(1)<<BigInt(0),FD_READ:BigInt(1)<<BigInt(1),FD_SEEK:BigInt(1)<<BigInt(2),FD_FDSTAT_SET_FLAGS:BigInt(1)<<BigInt(3),FD_SYNC:BigInt(1)<<BigInt(4),FD_TELL:BigInt(1)<<BigInt(5),FD_WRITE:BigInt(1)<<BigInt(6),FD_ADVISE:BigInt(1)<<BigInt(7),FD_ALLOCATE:BigInt(1)<<BigInt(8),PATH_CREATE_DIRECTORY:BigInt(1)<<BigInt(9),PATH_CREATE_FILE:BigInt(1)<<BigInt(10),PATH_LINK_SOURCE:BigInt(1)<<BigInt(11),PATH_LINK_TARGET:BigInt(1)<<BigInt(12),PATH_OPEN:BigInt(1)<<BigInt(13),FD_READDIR:BigInt(1)<<BigInt(14),PATH_READLINK:BigInt(1)<<BigInt(15),PATH_RENAME_SOURCE:BigInt(1)<<BigInt(16),PATH_RENAME_TARGET:BigInt(1)<<BigInt(17),PATH_FILESTAT_GET:BigInt(1)<<BigInt(18),PATH_FILESTAT_SET_SIZE:BigInt(1)<<BigInt(19),PATH_FILESTAT_SET_TIMES:BigInt(1)<<BigInt(20),FD_FILESTAT_GET:BigInt(1)<<BigInt(21),FD_FILESTAT_SET_SIZE:BigInt(1)<<BigInt(22),FD_FILESTAT_SET_TIMES:BigInt(1)<<BigInt(23),PATH_SYMLINK:BigInt(1)<<BigInt(24),PATH_REMOVE_DIRECTORY:BigInt(1)<<BigInt(25),PATH_UNLINK_FILE:BigInt(1)<<BigInt(26),POLL_FD_READWRITE:BigInt(1)<<BigInt(27),SOCK_SHUTDOWN:BigInt(1)<<BigInt(28),SOCK_ACCEPT:BigInt(1)<<BigInt(29)},h={ATIM:1,ATIM_NOW:2,MTIM:4,MTIM_NOW:8},y={SUBSCRIPTION_CLOCK_ABSTIME:1},C={FD_READWRITE_HANGUP:1},b=64,v=48,S=32;i.RESULT=l,i.Clock=s,i.Whence=u,i.FileType=c,i.PreopenType=d,i.EventType=m,i.LookupFlags=p,i.OpenFlags=_,i.FileDescriptorFlags=f,i.RightsFlags=g,i.FileStatTimestampFlags=h,i.SubscriptionClockFlags=y,i.EventReadWriteFlags=C,i.FILESTAT_SIZE=b,i.SUBSCRIPTION_SIZE=v,i.EVENT_SIZE=S}),66);
__d("WATextEncoding",[],(function(t,n,r,o,a,i){"use strict";var e=TextEncoder,l=TextDecoder,s=e,u=l;function c(){return new s}function d(){return new u}function m(e){s=e}function p(e){u=e}i.newTextEncoder=c,i.newTextDecoder=d,i.setTextEncoderClass=m,i.setTextDecoderClass=p}),66);
__d("WASIDrive",["WASISnapshotPreview1","WATextEncoding"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e){this.nextFD=10,this.openMap=new Map,this.fs=babelHelpers.extends({},e),this.openMap.set(3,new c(this.fs,"/"))}var t=e.prototype;return t.$1=function(t,n,r){var e=new s(t,r);n&&(e.buffer=new Uint8Array(new ArrayBuffer(1024),0,0));var a=this.nextFD;return this.openMap.set(a,e),this.nextFD++,[o("WASISnapshotPreview1").RESULT.SUCCESS,a]},t.$2=function(t,n){var e=new c(t,n),r=this.nextFD;return this.openMap.set(r,e),this.nextFD++,[o("WASISnapshotPreview1").RESULT.SUCCESS,r]},t.$3=function(t,n){return n==="."?!0:t.containsDirectory(n)},t.open=function(t,n,r,a){var e,i=!!(r&(e=o("WASISnapshotPreview1")).OpenFlags.CREAT),l=!!(r&e.OpenFlags.DIRECTORY),s=!!(r&e.OpenFlags.EXCL),u=!!(r&e.OpenFlags.TRUNC),d=this.openMap.get(t);if(!(d instanceof c))return[o("WASISnapshotPreview1").RESULT.EBADF];if(d.containsFile(n)){if(l)return[o("WASISnapshotPreview1").RESULT.ENOTDIR];if(s)return[o("WASISnapshotPreview1").RESULT.EEXIST];var m=d.get(n);return this.$1(m,u,a)}else if(this.$3(d,n)){if(n===".")return this.$2(this.fs,"/");var p="/"+n+"/",_=Object.entries(this.fs).filter(function(e){var t=e[0];return t.startsWith(p)});return this.$2(Object.fromEntries(_),p)}else{if(i){var f=d.fullPath(n);return this.fs[f]={path:f,mode:"binary",content:new Uint8Array(0),timestamps:{access:new Date,modification:new Date,change:new Date}},this.$1(this.fs[f],u,a)}return[o("WASISnapshotPreview1").RESULT.ENOTCAPABLE]}},t.close=function(t){if(!this.openMap.has(t))return o("WASISnapshotPreview1").RESULT.EBADF;var e=this.openMap.get(t);return e instanceof s&&e.sync(),this.openMap.delete(t),o("WASISnapshotPreview1").RESULT.SUCCESS},t.read=function(t,n){var e=this.openMap.get(t);return!e||e instanceof c?[o("WASISnapshotPreview1").RESULT.EBADF]:[o("WASISnapshotPreview1").RESULT.SUCCESS,e.read(n)]},t.pread=function(t,n,r){var e=this.openMap.get(t);return!e||e instanceof c?[o("WASISnapshotPreview1").RESULT.EBADF]:[o("WASISnapshotPreview1").RESULT.SUCCESS,e.pread(n,r)]},t.write=function(t,n){var e=this.openMap.get(t);return!e||e instanceof c?o("WASISnapshotPreview1").RESULT.EBADF:(e.write(n),o("WASISnapshotPreview1").RESULT.SUCCESS)},t.pwrite=function(t,n,r){var e=this.openMap.get(t);return!e||e instanceof c?o("WASISnapshotPreview1").RESULT.EBADF:(e.pwrite(n,r),o("WASISnapshotPreview1").RESULT.SUCCESS)},t.sync=function(t){var e=this.openMap.get(t);return!e||e instanceof c?o("WASISnapshotPreview1").RESULT.EBADF:(e.sync(),o("WASISnapshotPreview1").RESULT.SUCCESS)},t.seek=function(t,n,r){var e=this.openMap.get(t);return!e||e instanceof c?[o("WASISnapshotPreview1").RESULT.EBADF]:[o("WASISnapshotPreview1").RESULT.SUCCESS,e.seek(n,r)]},t.tell=function(t){var e=this.openMap.get(t);return!e||e instanceof c?[o("WASISnapshotPreview1").RESULT.EBADF]:[o("WASISnapshotPreview1").RESULT.SUCCESS,e.tell()]},t.renumber=function(t,n){if(!this.exists(t)||!this.exists(n))return o("WASISnapshotPreview1").RESULT.EBADF;if(t===n)return o("WASISnapshotPreview1").RESULT.SUCCESS;this.close(n);var e=this.openMap.get(t);return this.openMap.set(n,e),o("WASISnapshotPreview1").RESULT.SUCCESS},t.unlink=function(t,n){var e=this.openMap.get(t);if(!(e instanceof c))return o("WASISnapshotPreview1").RESULT.EBADF;if(!e.contains(n))return o("WASISnapshotPreview1").RESULT.ENOENT;for(var r of Object.keys(this.fs))(r===e.fullPath(n)||r.startsWith(e.fullPath(n)+"/"))&&delete this.fs[r];return o("WASISnapshotPreview1").RESULT.SUCCESS},t.rename=function(t,n,r,a){var e=this.openMap.get(t),i=this.openMap.get(r);if(!(e instanceof c)||!(i instanceof c))return o("WASISnapshotPreview1").RESULT.EBADF;if(!e.contains(n))return o("WASISnapshotPreview1").RESULT.ENOENT;if(i.contains(a))return o("WASISnapshotPreview1").RESULT.EEXIST;var l=e.fullPath(n),s=i.fullPath(a);for(var u of Object.keys(this.fs))if(u.startsWith(l)){var d=u.replace(l,s);this.fs[d]=this.fs[u],this.fs[d].path=d,delete this.fs[u]}return o("WASISnapshotPreview1").RESULT.SUCCESS},t.list=function(t){var e=this.openMap.get(t);return e instanceof c?[o("WASISnapshotPreview1").RESULT.SUCCESS,e.list()]:[o("WASISnapshotPreview1").RESULT.EBADF]},t.stat=function(t){var e=this.openMap.get(t);return e instanceof s?[o("WASISnapshotPreview1").RESULT.SUCCESS,e.stat()]:[o("WASISnapshotPreview1").RESULT.EBADF]},t.pathStat=function(t,n){var e=this.openMap.get(t);if(!(e instanceof c))return[o("WASISnapshotPreview1").RESULT.EBADF];if(e.containsFile(n)){var r=e.fullPath(n),a=new s(this.fs[r],0).stat();return[o("WASISnapshotPreview1").RESULT.SUCCESS,a]}else if(this.$3(e,n)){if(n===".")return[o("WASISnapshotPreview1").RESULT.SUCCESS,new c(this.fs,"/").stat()];var i="/"+n+"/",l=Object.entries(this.fs).filter(function(e){var t=e[0];return t.startsWith(i)}),u=new c(Object.fromEntries(l),i).stat();return[o("WASISnapshotPreview1").RESULT.SUCCESS,u]}else return[o("WASISnapshotPreview1").RESULT.ENOTCAPABLE]},t.setFlags=function(t,n){var e=this.openMap.get(t);return e instanceof s?(e.setFlags(n),o("WASISnapshotPreview1").RESULT.SUCCESS):o("WASISnapshotPreview1").RESULT.EBADF},t.setSize=function(t,n){var e=this.openMap.get(t);return e instanceof s?(e.setSize(Number(n)),o("WASISnapshotPreview1").RESULT.SUCCESS):o("WASISnapshotPreview1").RESULT.EBADF},t.setAccessTime=function(t,n){var e=this.openMap.get(t);return e instanceof s?(e.setAccessTime(n),o("WASISnapshotPreview1").RESULT.SUCCESS):o("WASISnapshotPreview1").RESULT.EBADF},t.setModificationTime=function(t,n){var e=this.openMap.get(t);return e instanceof s?(e.setModificationTime(n),o("WASISnapshotPreview1").RESULT.SUCCESS):o("WASISnapshotPreview1").RESULT.EBADF},t.pathSetAccessTime=function(t,n,r){var e=this.openMap.get(t);if(!(e instanceof c))return o("WASISnapshotPreview1").RESULT.EBADF;var a=e.get(n);if(a==null)return o("WASISnapshotPreview1").RESULT.ENOTCAPABLE;var i=new s(a,0);return i.setAccessTime(r),i.sync(),o("WASISnapshotPreview1").RESULT.SUCCESS},t.pathSetModificationTime=function(t,n,r){var e=this.openMap.get(t);if(!(e instanceof c))return o("WASISnapshotPreview1").RESULT.EBADF;var a=e.get(n);if(a==null)return o("WASISnapshotPreview1").RESULT.ENOTCAPABLE;var i=new s(a,0);return i.setModificationTime(r),i.sync(),o("WASISnapshotPreview1").RESULT.SUCCESS},t.pathCreateDir=function(t,n){var e=this.openMap.get(t);if(!(e instanceof c))return o("WASISnapshotPreview1").RESULT.EBADF;if(e.contains(n))return o("WASISnapshotPreview1").RESULT.ENOTCAPABLE;var r=e.fullPath(n)+"/.runno";return this.fs[r]={path:r,timestamps:{access:new Date,modification:new Date,change:new Date},mode:"string",content:""},o("WASISnapshotPreview1").RESULT.SUCCESS},t.exists=function(t){return this.openMap.has(t)},t.fileType=function(t){var e=this.openMap.get(t);return e?e instanceof s?o("WASISnapshotPreview1").FileType.REGULAR_FILE:o("WASISnapshotPreview1").FileType.DIRECTORY:o("WASISnapshotPreview1").FileType.UNKNOWN},t.fileFdflags=function(t){var e=this.openMap.get(t);return e instanceof s?e.fdflags:0},e})(),s=(function(){function e(e,t){if(this.$1=BigInt(0),this.isDirty=!1,this.file=e,this.file.mode==="string"){var n=this.file.content,r=o("WATextEncoding").newTextEncoder();this.buffer=r.encode(n)}else this.buffer=this.file.content;this.fdflags=t,this.flagAppend=!!(t&o("WASISnapshotPreview1").FileDescriptorFlags.APPEND),this.flagDSync=!!(t&o("WASISnapshotPreview1").FileDescriptorFlags.DSYNC),this.flagNonBlock=!!(t&o("WASISnapshotPreview1").FileDescriptorFlags.NONBLOCK),this.flagRSync=!!(t&o("WASISnapshotPreview1").FileDescriptorFlags.RSYNC),this.flagSync=!!(t&o("WASISnapshotPreview1").FileDescriptorFlags.SYNC)}var t=e.prototype;return t.getOffset=function(){return Number(this.$1)},t.read=function(t){var e=this.buffer.subarray(this.getOffset(),this.getOffset()+t);return this.$1+=BigInt(e.length),e},t.pread=function(t,n){return this.buffer.subarray(n,n+t)},t.write=function(t){if(this.isDirty=!0,this.flagAppend){var e=this.buffer.length;this.$2(e+t.byteLength),this.buffer.set(t,e)}else{var n=Math.max(this.getOffset()+t.byteLength,this.buffer.byteLength);this.$2(n),this.buffer.set(t,this.getOffset()),this.$1+=BigInt(t.byteLength)}(this.flagDSync||this.flagSync)&&this.sync()},t.pwrite=function(t,n){if(this.isDirty=!0,this.flagAppend){var e=this.buffer.length;this.$2(e+t.byteLength),this.buffer.set(t,e)}else{var r=Math.max(n+t.byteLength,this.buffer.byteLength);this.$2(r),this.buffer.set(t,n)}(this.flagDSync||this.flagSync)&&this.sync()},t.sync=function(){if(this.isDirty){if(this.isDirty=!1,this.file.mode==="binary"){this.file.content=new Uint8Array(this.buffer);return}var e=o("WATextEncoding").newTextDecoder();this.file.content=e.decode(this.buffer)}},t.seek=function(t,n){switch(n){case o("WASISnapshotPreview1").Whence.SET:this.$1=t;break;case o("WASISnapshotPreview1").Whence.CUR:this.$1+=t;break;case o("WASISnapshotPreview1").Whence.END:this.$1=BigInt(this.buffer.length)+t;break}return this.$1},t.tell=function(){return this.$1},t.stat=function(){return{path:this.file.path,timestamps:this.file.timestamps,type:o("WASISnapshotPreview1").FileType.REGULAR_FILE,byteLength:this.buffer.length}},t.setFlags=function(t){this.fdflags=t},t.setSize=function(t){this.$2(t)},t.setAccessTime=function(t){this.file.timestamps.access=t},t.setModificationTime=function(t){this.file.timestamps.modification=t},t.$2=function(t){if(t<=this.buffer.buffer.byteLength){this.buffer=new Uint8Array(this.buffer.buffer,0,t);return}var e;this.buffer.buffer.byteLength===0?e=new ArrayBuffer(t<1024?1024:t*2):t>this.buffer.buffer.byteLength*2?e=new ArrayBuffer(t*2):e=new ArrayBuffer(this.buffer.buffer.byteLength*2);var n=new Uint8Array(e,0,t);n.set(this.buffer),this.buffer=n},e})();function u(e,t){var n=t.replace(/[/\-\\^$*+?.()|[\]{}]/g,"\\$&"),r=new RegExp("^"+n);return e.replace(r,"")}var c=(function(){function e(e,t){this.dir=e,this.prefix=t}var t=e.prototype;return t.containsFile=function(t){for(var e of Object.keys(this.dir)){var n=u(e,this.prefix);if(n===t)return!0}return!1},t.containsDirectory=function(t){for(var e of Object.keys(this.dir)){var n=u(e,this.prefix);if(n.startsWith(t+"/"))return!0}return!1},t.contains=function(t){for(var e of Object.keys(this.dir)){var n=u(e,this.prefix);if(n===t||n.startsWith(t+"/"))return!0}return!1},t.get=function(t){return this.dir[this.fullPath(t)]},t.fullPath=function(t){return""+this.prefix+t},t.list=function(){var e=[],t=new Set;for(var n of Object.keys(this.dir)){var r=u(n,this.prefix);if(r.includes("/")){var a=r.split("/")[0];if(t.has(a))continue;t.add(a),e.push({name:a,type:o("WASISnapshotPreview1").FileType.DIRECTORY})}else e.push({name:r,type:o("WASISnapshotPreview1").FileType.REGULAR_FILE})}return e},t.stat=function(){return{path:this.prefix,timestamps:{access:new Date,modification:new Date,change:new Date},type:o("WASISnapshotPreview1").FileType.DIRECTORY,byteLength:0}},e})();l.WASIDrive=e}),98);
__d("WASMMemoryLogger",["FBLogger","QPLFlow","WAHashStringToNumber","justknobx","qpl","uuidv4"],(function(t,n,r,o,a,i,l){"use strict";var e=r("justknobx")._("168"),s=(function(){function e(){var e=this;this.$1=new FinalizationRegistry(function(t){e.$3-=t.numBytes;var n=t.wasmModule;if(n!=null){var r=e.$2.get(n);if(r!=null){var o=r-t.numBytes;o<=0?e.$2.delete(n):e.$2.set(n,o)}}}),this.$3=0,this.$2=new Map}var t=e.prototype;return t.addWasmInstanceToSet=function(t,n){var e=t.buffer.byteLength;if(this.$1.register(t,{numBytes:e,wasmModule:n}),this.$3+=e,n!=null){var r,o=(r=this.$2.get(n))!=null?r:0;this.$2.set(n,o+e)}},t.getCurrentWasmMemoryUsage=function(){return this.$3},t.getWasmMemoryUsagePerModuleAnnotationsObject=function(){var e={};return this.$2.forEach(function(t,n){e["wasm_memory_usage_"+n]=t}),e},e})(),u;function c(){if(u==null){if(typeof FinalizationRegistry!="function"){r("FBLogger")("wmi").warn("unable to run wasm memory logger - finalization registry not supported in browser");return}u=new s,window.setInterval(function(){var e=r("qpl")._(994782764,"418"),t=o("WAHashStringToNumber").hashStringToNumber(r("uuidv4")()),n=u.getWasmMemoryUsagePerModuleAnnotationsObject(),a=o("QPLFlow").startQPLFlow(e,{annotations:{int:babelHelpers.extends({},n,{wasm_total_memory_usage:u.getCurrentWasmMemoryUsage()})},instanceKey:t});a.endSuccess()},e)}return u}l.getOrInitWasmMemoryLogger=c}),98);
__d("WASI",["WACryptoDependencies","WASIContext","WASIDrive","WASISnapshotPreview1","WASMMemoryLogger","WATextEncoding","err","gkx"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e){var t,n=new(o("WASIContext")).WASIContext(e),a=new(o("WASIDrive")).WASIDrive(n.fs);function i(){return Object.entries(n.env).map(function(e){var t=e[0],n=e[1];return t+"="+n})}var l={args_get:function(r,a){var e=r,i=a,l=new DataView(t.buffer);for(var s of n.args){l.setUint32(e,i,!0),e+=4;var u=o("WATextEncoding").newTextEncoder().encode(s+"\0"),c=new Uint8Array(t.buffer,i,u.byteLength);c.set(u),i+=u.byteLength}return o("WASISnapshotPreview1").RESULT.SUCCESS},args_sizes_get:function(r,a){var e=n.args,i=e.reduce(function(e,t){return e+o("WATextEncoding").newTextEncoder().encode(t+"\0").byteLength},0),l=new DataView(t.buffer);return l.setUint32(r,e.length,!0),l.setUint32(a,i,!0),o("WASISnapshotPreview1").RESULT.SUCCESS},clock_res_get:function(){throw r("err")("clock_res_get is not implemented")},clock_time_get:function(n,r,a){var e=o("WASISnapshotPreview1").Clock.cast(n);if(e==null)return o("WASISnapshotPreview1").RESULT.EINVAL;switch(e){case o("WASISnapshotPreview1").Clock.REALTIME:case o("WASISnapshotPreview1").Clock.MONOTONIC:case o("WASISnapshotPreview1").Clock.PROCESS_CPUTIME_ID:case o("WASISnapshotPreview1").Clock.THREAD_CPUTIME_ID:{var i=new DataView(t.buffer);return i.setBigUint64(a,f(new Date),!0),o("WASISnapshotPreview1").RESULT.SUCCESS}}},environ_get:function(n,r){var e=n,a=r,l=new DataView(t.buffer);for(var s of i()){l.setUint32(e,a,!0),e+=4;var u=o("WATextEncoding").newTextEncoder().encode(s+"\0"),c=new Uint8Array(t.buffer,a,u.byteLength);c.set(u),a+=u.byteLength}return o("WASISnapshotPreview1").RESULT.SUCCESS},environ_sizes_get:function(n,r){var e=i().reduce(function(e,t){return e+o("WATextEncoding").newTextEncoder().encode(t+"\0").byteLength},0),a=new DataView(t.buffer);return a.setUint32(n,i().length,!0),a.setUint32(r,e,!0),o("WASISnapshotPreview1").RESULT.SUCCESS},fd_advise:function(){throw r("err")("fd_advise is not implemented")},fd_allocate:function(){throw r("err")("fd_allocate is not implemented")},fd_close:function(t){return a.close(t)},fd_datasync:function(){throw r("err")("fd_datasync is not implemented")},fd_fdstat_get:function(r,i){if(r<3){var e;if(n.isTTY){var l=c^o("WASISnapshotPreview1").RightsFlags.FD_SEEK^o("WASISnapshotPreview1").RightsFlags.FD_TELL;e=p(o("WASISnapshotPreview1").FileType.CHARACTER_DEVICE,0,l)}else e=p(o("WASISnapshotPreview1").FileType.CHARACTER_DEVICE,0);var s=new Uint8Array(t.buffer,i,e.byteLength);return s.set(e),o("WASISnapshotPreview1").RESULT.SUCCESS}if(!a.exists(r))return o("WASISnapshotPreview1").RESULT.EBADF;var u=a.fileType(r),d=a.fileFdflags(r),m=p(u,d),_=new Uint8Array(t.buffer,i,m.byteLength);return _.set(m),o("WASISnapshotPreview1").RESULT.SUCCESS},fd_fdstat_set_flags:function(t,n){return a.setFlags(t,n)},fd_fdstat_set_rights:function(){return o("WASISnapshotPreview1").RESULT.SUCCESS},fd_filestat_get:function(n,r){if(n<3){var e;switch(n){case 0:e="/dev/stdin";break;case 1:e="/dev/stdout";break;case 2:e="/dev/stderr";break;default:e="/dev/undefined";break}var i=m({path:e,byteLength:0,timestamps:{access:new Date,modification:new Date,change:new Date},type:o("WASISnapshotPreview1").FileType.CHARACTER_DEVICE}),l=new Uint8Array(t.buffer,r,i.byteLength);return l.set(i),o("WASISnapshotPreview1").RESULT.SUCCESS}var s=a.stat(n);if(s.length===1)return s[0];var u=s[1],c=m(u),d=new Uint8Array(t.buffer,r,c.byteLength);return d.set(c),o("WASISnapshotPreview1").RESULT.SUCCESS},fd_filestat_set_size:function(){throw r("err")("fd_filestat_set_size is not implemented")},fd_filestat_set_times:function(){throw r("err")("fd_filestat_set_times is not implemented")},fd_pread:function(){throw r("err")("fd_pread is not implemented")},fd_prestat_dir_name:function(n,r,a){if(n!==3)return o("WASISnapshotPreview1").RESULT.EBADF;var e=o("WATextEncoding").newTextEncoder().encode("/"),i=new Uint8Array(t.buffer,r,a);return i.set(e.subarray(0,a)),o("WASISnapshotPreview1").RESULT.SUCCESS},fd_prestat_get:function(n,r){if(n!==3)return o("WASISnapshotPreview1").RESULT.EBADF;var e=o("WATextEncoding").newTextEncoder().encode("."),a=new DataView(t.buffer,r);return a.setUint8(0,o("WASISnapshotPreview1").PreopenType.DIR),a.setUint32(4,e.byteLength,!0),o("WASISnapshotPreview1").RESULT.SUCCESS},fd_pwrite:function(){throw r("err")("fd_pwrite is not implemented")},fd_read:function(r,i,l,s){if(r===1||r===2)return o("WASISnapshotPreview1").RESULT.ENOTSUP;var e=new DataView(t.buffer),u=d(e,i,l),c=o("WATextEncoding").newTextEncoder(),m=0,p=o("WASISnapshotPreview1").RESULT.SUCCESS;for(var _ of u){var f=void 0;if(r===0){var g=n.stdin(_.byteLength);if(g==null)break;f=c.encode(g)}else{var h=a.read(r,_.byteLength);if(h.length===1){p=h[0];break}else f=h[1]}var y=Math.min(_.byteLength,f.byteLength);_.set(f.subarray(0,y)),m+=y}return e.setUint32(s,m,!0),p},fd_readdir:function(){throw r("err")("fd_readdir is not implemented")},fd_renumber:function(){throw r("err")("fd_renumber is not implemented")},fd_seek:function(n,i,l,s){var e=o("WASISnapshotPreview1").Whence.cast(l);if(e==null)throw r("err")("fd_seek: invalid whence");var u=a.seek(n,i,e);if(u.length===1)return u[0];var c=u[0],d=u[1],m=new DataView(t.buffer);return m.setBigUint64(s,d,!0),c},fd_sync:function(){throw r("err")("fd_sync is not implemented")},fd_tell:function(n,r){var e=a.tell(n);if(e.length===1)return e[0];var o=e[0],i=e[1],l=new DataView(t.buffer);return l.setBigUint64(r,i,!0),o},fd_write:function(r,i,l,s){if(r===0)return o("WASISnapshotPreview1").RESULT.ENOTSUP;var e=new DataView(t.buffer),u=d(e,i,l),c=o("WATextEncoding").newTextDecoder(),m=0,p=o("WASISnapshotPreview1").RESULT.SUCCESS;for(var _ of u)if(_.byteLength!==0){if(r===1||r===2){var f=r===1?n.stdout:n.stderr,g=c.decode(_);f(g)}else if(p=a.write(r,_),p!==o("WASISnapshotPreview1").RESULT.SUCCESS)break;m+=_.byteLength}return e.setUint32(s,m,!0),p},path_create_directory:function(){throw r("err")("path_create_directory is not implemented")},path_filestat_get:function(){throw r("err")("path_filestat_get is not implemented")},path_filestat_set_times:function(){throw r("err")("path_filestat_set_times is not implemented")},path_link:function(){throw r("err")("path_link is not implemented")},path_open:function(n,r,o,i,l,s,u,c,d){var e=new DataView(t.buffer),m=_(t,o,i),p=a.open(n,m,l,c);if(p.length===1)return p[0];var f=p[0],g=p[1];return e.setUint32(d,g,!0),f},path_readlink:function(){throw r("err")("path_readlink is not implemented")},path_remove_directory:function(){throw r("err")("path_remove_directory is not implemented")},path_rename:function(){throw r("err")("path_rename is not implemented")},path_symlink:function(){throw r("err")("path_symlink is not implemented")},path_unlink_file:function(){throw r("err")("path_unlink_file is not implemented")},poll_oneoff:function(){throw r("err")("poll_oneoff is not implemented")},proc_exit:function(t){throw new u(t)},proc_raise:function(){throw r("err")("proc_raise is not implemented")},random_get:function(n,r){var e=new Uint8Array(t.buffer,n,r);return o("WACryptoDependencies").getCrypto().getRandomValues(e),o("WASISnapshotPreview1").RESULT.SUCCESS},sched_yield:function(){throw r("err")("sched_yield is not implemented")},sock_accept:function(){throw r("err")("sock_accept is not implemented")},sock_recv:function(){throw r("err")("sock_recv is not implemented")},sock_send:function(){throw r("err")("sock_send is not implemented")},sock_shutdown:function(){throw r("err")("sock_shutdown is not implemented")}};return{getImportObject:function(){return{wasi_snapshot_preview1:l}},start:function(i){var n=i.exports.memory;if(n instanceof WebAssembly.Memory){if(t=n,r("gkx")("4444")){var l=o("WASMMemoryLogger").getOrInitWasmMemoryLogger();l!=null&&l.addWasmInstanceToSet(t,e.moduleName)}}else throw r("err")("Expected memory object");var s=i.exports._start;try{s()}catch(e){if(e instanceof u)return{exitCode:e.code,fs:a.fs};if(e instanceof WebAssembly.RuntimeError)return{exitCode:134,fs:a.fs};throw e}return{exitCode:0,fs:a.fs}},initialize:function(n){var e=n.exports.memory;if(e instanceof WebAssembly.Memory)t=e;else throw r("err")("Expected memory object");var o=n.exports;if("_initialize"in o){var i=o._initialize;i()}return{exports:o,drive:a}}}}var u=(function(e){function t(t){var n;return n=e.call(this)||this,n.code=t,n}return babelHelpers.inheritsLoose(t,e),t})(babelHelpers.wrapNativeSuper(Error)),c=(e=o("WASISnapshotPreview1")).RightsFlags.FD_DATASYNC|e.RightsFlags.FD_READ|e.RightsFlags.FD_SEEK|e.RightsFlags.FD_FDSTAT_SET_FLAGS|e.RightsFlags.FD_SYNC|e.RightsFlags.FD_TELL|e.RightsFlags.FD_WRITE|e.RightsFlags.FD_ADVISE|e.RightsFlags.FD_ALLOCATE|e.RightsFlags.PATH_CREATE_DIRECTORY|e.RightsFlags.PATH_CREATE_FILE|e.RightsFlags.PATH_LINK_SOURCE|e.RightsFlags.PATH_LINK_TARGET|e.RightsFlags.PATH_OPEN|e.RightsFlags.FD_READDIR|e.RightsFlags.PATH_READLINK|e.RightsFlags.PATH_RENAME_SOURCE|e.RightsFlags.PATH_RENAME_TARGET|e.RightsFlags.PATH_FILESTAT_GET|e.RightsFlags.PATH_FILESTAT_SET_SIZE|e.RightsFlags.PATH_FILESTAT_SET_TIMES|e.RightsFlags.FD_FILESTAT_GET|e.RightsFlags.FD_FILESTAT_SET_SIZE|e.RightsFlags.FD_FILESTAT_SET_TIMES|e.RightsFlags.PATH_SYMLINK|e.RightsFlags.PATH_REMOVE_DIRECTORY|e.RightsFlags.PATH_UNLINK_FILE|e.RightsFlags.POLL_FD_READWRITE|e.RightsFlags.SOCK_SHUTDOWN|e.RightsFlags.SOCK_ACCEPT;function d(e,t,n){for(var r=new Array(n),o=t,a=0;a<n;a++){var i=e.getUint32(o,!0);o+=4;var l=e.getUint32(o,!0);o+=4,r[a]=new Uint8Array(e.buffer,i,l)}return r}function m(e){var t=new Uint8Array(o("WASISnapshotPreview1").FILESTAT_SIZE),n=new DataView(t.buffer);return n.setBigUint64(0,BigInt(0),!0),n.setBigUint64(8,BigInt(g(e.path)),!0),n.setUint8(16,e.type),n.setBigUint64(24,BigInt(1),!0),n.setBigUint64(32,BigInt(e.byteLength),!0),n.setBigUint64(40,f(e.timestamps.access),!0),n.setBigUint64(48,f(e.timestamps.modification),!0),n.setBigUint64(56,f(e.timestamps.change),!0),t}function p(e,t,n){var r=n!=null?n:c,o=n!=null?n:c,a=new Uint8Array(24),i=new DataView(a.buffer,0,24);return i.setUint8(0,e),i.setUint32(2,t,!0),i.setBigUint64(8,r,!0),i.setBigUint64(16,o,!0),a}function _(e,t,n){return o("WATextEncoding").newTextDecoder().decode(new Uint8Array(e.buffer,t,n))}function f(e){return BigInt(e.getTime())*BigInt(1e6)}function g(e,t){t===void 0&&(t=0);for(var n=3735928559^t,r=1103547991^t,o=0,a;o<e.length;o++)a=e.charCodeAt(o),n=Math.imul(n^a,2654435761),r=Math.imul(r^a,1597334677);return n=Math.imul(n^n>>>16,2246822507)^Math.imul(r^r>>>13,3266489909),r=Math.imul(r^r>>>16,2246822507)^Math.imul(n^n>>>13,3266489909),4294967296*(2097151&r)+(n>>>0)}l.createWasi=s}),98);
__d("WAWasmReactor",["FBLogger","WAPromiseQueue","WAResultOrError","WASI","WASISnapshotPreview1","WASMMemoryLogger","asyncToGeneratorRuntime","decodeProtobuf","encodeProtobuf","getErrorSafe","gkx"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p=function(){return r("FBLogger")("wmi").tags(["WasmReactor"])},_=3e4;function f(e){var t=e.stderr,n=e.stdout;return{stderr:t,stdout:n}}var g=(function(){function t(e,t){this.$1=null,this.$4=e,this.$3=t}var a=t.prototype;return a.init=(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=this,a=function(r){p().tags([n.$4]).MUSTFIX(e||(e=babelHelpers.taggedTemplateLiteralLoose(["",""])),r)},i=function(t){p().INFO(s||(s=babelHelpers.taggedTemplateLiteralLoose(["",""])),t)},l=o("WASI").createWasi(f({stderr:a,stdout:i})),u=l.getImportObject,c=l.initialize,d=yield t(),m=yield WebAssembly.instantiate(d,u()),_=m.exports.memory,g=r("gkx")("4444"),h=o("WASMMemoryLogger").getOrInitWasmMemoryLogger();_ instanceof WebAssembly.Memory&&g&&h!=null&&h.addWasmInstanceToSet(_,this.$4),this.$1=yield c(m)});function a(e){return t.apply(this,arguments)}return a})(),a.createWasmCommand=function(a){var e=a.InputSpec,i=a.ResultSpec,l=a.validateResult,s=this;return function(d){return s.$3.enqueue(n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var n=s.$1;if(n==null)return p().tags([s.$4]).MUSTFIX(u||(u=babelHelpers.taggedTemplateLiteralLoose(["WAWasmReactor not initialized"]))),o("WAResultOrError").makeError({errorName:"wasm-internal-not-initialized",failReason:null});var a=n.drive,m="input",_="output";try{var f=o("encodeProtobuf").encodeProtobuf(e,d).readBuffer();t.$5(a,m,new Uint8Array(f),s.$4),t.$5(a,_,new Uint8Array(0),s.$4),yield n.exports.execute_command();var g=t.$6(a,_,s.$4);if(g.length===0)return o("WAResultOrError").makeError({errorName:"wasm-internal-runtime-error",failReason:null});var h=o("decodeProtobuf").decodeProtobuf(i,g);return l(h)}catch(e){var y=r("getErrorSafe")(e);return p().tags([s.$4]).catching(y).MUSTFIX(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Unexpected runtime error: ",""])),y.message),o("WAResultOrError").makeError({errorName:"wasm-internal-runtime-error",failReason:null})}finally{var C=t.$2;a.unlink(C,m),a.unlink(C,_)}}))}},a.DEPRECATED_createWasmCommand=function(a){var e=a.InputSpec,i=a.ResultSpec,l=a.validateResult,s=this;return function(u){return s.$3.enqueue(n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var n=s.$1;if(n==null)return p().tags([s.$4]).MUSTFIX(d||(d=babelHelpers.taggedTemplateLiteralLoose(["WAWasmReactor not initialized"]))),o("WAResultOrError").makeError("wasm-internal-not-initialized");var a=n.drive,c="input",_="output";try{var f=o("encodeProtobuf").encodeProtobuf(e,u).readBuffer();t.$5(a,c,new Uint8Array(f),s.$4),t.$5(a,_,new Uint8Array(0),s.$4),yield n.exports.execute_command();var g=t.$6(a,_,s.$4);if(g.length===0)return o("WAResultOrError").makeError("wasm-internal-runtime-error");var h=o("decodeProtobuf").decodeProtobuf(i,g);return l(h)}catch(e){var y=r("getErrorSafe")(e);return p().tags([s.$4]).catching(y).MUSTFIX(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Unexpected runtime error: ",""])),y.message),o("WAResultOrError").makeError("wasm-internal-runtime-error")}finally{var C=t.$2;a.unlink(C,c),a.unlink(C,_)}}))}},t.$5=function(n,r,a,i){var e=n.open(t.$2,r,o("WASISnapshotPreview1").OpenFlags.CREAT||o("WASISnapshotPreview1").OpenFlags.TRUNC,0);if(e[0]!==o("WASISnapshotPreview1").RESULT.SUCCESS)throw p().tags([i]).mustfixThrow("Failed to open file for writing: ",r);var l=e[1];n.write(l,a),n.close(l)},t.$6=function(n,r,a){var e=n.open(t.$2,r,0,0);if(e[0]!==o("WASISnapshotPreview1").RESULT.SUCCESS)throw p().tags([a]).mustfixThrow("Failed to open file for reading: ",r);var i=e[1],l=n.stat(i);if(l[0]!==o("WASISnapshotPreview1").RESULT.SUCCESS)throw n.close(i),p().tags([a]).mustfixThrow("Failed to stat file: ",r);var s=l[1].byteLength,u=n.read(i,s);if(n.close(i),u[0]!==o("WASISnapshotPreview1").RESULT.SUCCESS)throw p().tags([a]).mustfixThrow("Failed to read from file ",r);return u[1]},t})();g.$2=3;function h(e,t){return y.apply(this,arguments)}function y(){return y=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=new(o("WAPromiseQueue")).PromiseQueue(_),r=new g(t,n);return yield r.init(e),r}),y.apply(this,arguments)}l.WAWasmReactor=g,l.createWasmInstance=h}),98);
__d("EBMinosWasmReactorSingleton",["EBGetMinosWasm","WAWasmReactor","asyncToGeneratorRuntime","memoizeWithArgs"],(function(t,n,r,o,a,i,l){"use strict";var e="Minos_REPL",s=r("memoizeWithArgs")(function(){return o("WAWasmReactor").createWasmInstance(o("EBGetMinosWasm").getMinosWasm,e)},function(){return"cache"}),u=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=e.InputSpec,r=e.ResultSpec,o=e.validateResult,a=yield s();return a.createWasmCommand({InputSpec:n,ResultSpec:r,validateResult:o})(t)});return function(n,r){return e.apply(this,arguments)}})(),c=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=e.InputSpec,r=e.ResultSpec,o=e.validateResult,a=yield s();return a.DEPRECATED_createWasmCommand({InputSpec:n,ResultSpec:r,validateResult:o})(t)});return function(n,r){return e.apply(this,arguments)}})();l.minosCommand=u,l.DEPRECATED_minosCommand=c}),98);
__d("EBMinosWasmVerifySingleEpoch",["EBMinosWasm.pb","EBMinosWasmReactorSingleton","WAResultOrError","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";function e(){function e(e){var t=e.valid;return o("WAResultOrError").makeResult({valid:t})}return(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=t.epochPublicData,r=t.signature;return yield o("EBMinosWasmReactorSingleton").DEPRECATED_minosCommand({InputSpec:o("EBMinosWasm.pb").MinosCommandSpec,ResultSpec:o("EBMinosWasm.pb").MinosVerifySingleEpochResultSpec,validateResult:e},{minosVerifySingleEpoch:{epochPublicData:n,signature:r}})});function r(e){return t.apply(this,arguments)}return r})()}var s=e();l.verifySingleEpoch=s}),98);
__d("EncryptedBackupsSymmetricEncryptionUtils",[],(function(t,n,r,o,a,i){"use strict";var e=16,l=28,s=16,u=128;i.hChaCha20SubKeyNonceLengthInBytes=e,i.totalNonceLengthInBytes=l,i.aesGcmTagLengthInBytes=s,i.aesGcmTagLength=u}),66);
__d("FuncChannel",["FBLogger","Promise"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(function(){function t(t){var o=this,a;this.$2=[],this.callMessageHandler=function(t){return new(e||(e=n("Promise")))(function(e,n){t.result={resolveFunc:e,rejectFunc:n},o.$2.push(t)})},this.messageToCall=function(e){var t,n,a=o.proxyMethods[e.method];if(typeof a!="function"){r("FBLogger")("worker").mustfix("proxyMethods[%s] is not a functions",e.method);return}var i=(t=e.result)==null?void 0:t.resolveFunc,l=(n=e.result)==null?void 0:n.rejectFunc;if(typeof i=="function"&&typeof l=="function")try{var s=a.apply(e.thisArg,e.argList);i(s)}catch(e){l(e)}else return a.apply(e.thisArg,e.argList)};var i=this,l={},s=(a=t==null?void 0:t(l))!=null?a:{},u=babelHelpers.extends({},l);function c(e){u[e]=function(){var t={type:"call",method:e,thisArg:null,argList:Array.from(arguments)};return i.callMessageHandler(t)},l[e]=function(){var t=i.$1[e];if(typeof t!="function"){r("FBLogger")("worker").mustfix("_backend[%s] is not a functions",e);return}return t.apply(i.$1,arguments)},s[e]==null&&(s[e]=l[e])}if(this.$1=u,t!=null){var d=Object.keys(s);d.forEach(c),this.proxyMethods=s}else this.proxyMethods=new Proxy(s,{get:function(t,n){var e=n;return s[e]==null&&c(e),s[e]}})}var o=t.prototype;return o.flushBuffer=function(){var e=this.$2;this.$2=[],e.forEach(this.messageToCall)},o.setBackend=function(t){return this.$1!==t&&(this.$1=t,this.flushBuffer()),this},o.setCallMessageHandler=function(t){this.callMessageHandler=t,this.flushBuffer()},t})();l.default=s}),98);
__d("GetBlobFromInt64BE",["I64","LSResult","Promise"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(t){var a=new Uint8Array(8);return a.reduceRight(function(e,t,n){var r=(s||(s=o("I64"))).to_int32(s.mod_(e,s.of_string("256")));return a[n]=r,s.div(e,s.of_string("256"))},t),(e||(e=n("Promise"))).resolve(r("LSResult")(a.buffer))}l.GetBlobFromInt64BE=u}),98);
__d("HChaCha20",["err"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(){}e.fromHexString=function(t){var e=t.match(/[A-Fa-f0-9]{1,2}/g);if(t.length===0||t.length%2!==0||e==null)throw r("err")('The string "'+t+'" is not valid hex.');return new Uint8Array(e.map(function(e){return parseInt(e,16)}))},e.bufferToUint32Array=function(t){for(var e=new DataView(t),n=[],r=t.byteLength/4,o=0;o<r;o++)n.push(new DataView(e.buffer.slice(o*4,o*4+4)).getInt32(0));return Uint32Array.from(n)},e.rotate=function(t,n){var e=t&4294967295,r=n&31;return(e<<r|e>>>32-r)>>>0},e.quarterRound=function(n,r,o,a){var t=n,i=r,l=o,s=a;return t=t+i&4294967295,s=e.rotate(s^t,16),l=l+s&4294967295,i=e.rotate(i^l,12),t=t+i&4294967295,s=e.rotate(s^t,8),l=l+s&4294967295,i=e.rotate(i^l,7),[t>>>0,i>>>0,l>>>0,s>>>0]};var t=e.prototype;return t.createHCtx=function(n,o){var t=new Uint32Array(16),a=e.fromHexString("657870616e642033322d62797465206b");if(a.byteLength!==16)throw r("err")("Could not create context. Invalid constant buffer length of "+a.byteLength+". Expected a length of 16");if(n.byteLength!==32)throw r("err")("Could not create context. Invalid key buffer length of "+n.byteLength+". Expected a length of 32");if(o.byteLength!==16)throw r("err")("Could not create context. Invalid nonce buffer length of "+o.byteLength+". Expected a length of 16");var i=e.bufferToUint32Array(a.buffer),l=e.bufferToUint32Array(n),s=e.bufferToUint32Array(o);return t.set(i),t.set(l,i.length),t.set(s,i.length+l.length),t.buffer},t.hChaCha20Bytes=function(n,r){for(var t=new DataView(this.createHCtx(r,n)),o=t.getInt32(0),a=t.getInt32(4),i=t.getInt32(8),l=t.getInt32(12),s=t.getInt32(16),u=t.getInt32(20),c=t.getInt32(24),d=t.getInt32(28),m=t.getInt32(32),p=t.getInt32(36),_=t.getInt32(40),f=t.getInt32(44),g=t.getInt32(48),h=t.getInt32(52),y=t.getInt32(56),C=t.getInt32(60),b=0;b<10;b++){var v=e.quarterRound(o,s,m,g);o=v[0],s=v[1],m=v[2],g=v[3];var S=e.quarterRound(a,u,p,h);a=S[0],u=S[1],p=S[2],h=S[3];var R=e.quarterRound(i,c,_,y);i=R[0],c=R[1],_=R[2],y=R[3];var L=e.quarterRound(l,d,f,C);l=L[0],d=L[1],f=L[2],C=L[3];var E=e.quarterRound(o,u,_,C);o=E[0],u=E[1],_=E[2],C=E[3];var k=e.quarterRound(a,c,f,g);a=k[0],c=k[1],f=k[2],g=k[3];var I=e.quarterRound(i,d,m,h);i=I[0],d=I[1],m=I[2],h=I[3];var T=e.quarterRound(l,s,p,y);l=T[0],s=T[1],p=T[2],y=T[3]}return Uint32Array.from([o,a,i,l,g,h,y,C]).buffer},e})();l.HChaCha20=e}),98);
__d("PakeCpaceUtils",[],(function(t,n,r,o,a,i){"use strict";function e(e){return e.buffer.slice(e.byteOffset,e.byteLength+e.byteOffset)}function l(e,t){var n=new e.VectorInt;return t.forEach(function(e){n.push_back(e)}),n}i.typedArrayToBuffer=e,i.uint8ArrayToVectorInt=l}),66);
__d("Hmac_v2",["CryptoLogger","LSResult","PakeCpaceUtils","Promise","WACryptoSha256HmacBuilder"],(function(t,n,r,o,a,i,l){"use strict";var e,s=function(a,i){try{var t=new(o("WACryptoSha256HmacBuilder")).Sha256HMacBuilder(new Uint8Array(a)).update(new Uint8Array(i)).finish();return(e||(e=n("Promise"))).resolve(r("LSResult")(o("PakeCpaceUtils").typedArrayToBuffer(t)))}catch(e){throw o("CryptoLogger").captureError(o("CryptoLogger").CryptoLogger("hmac_v2"),e).mustfix("Crypto signing failed: data length: %s, was_timeout: %s",i==null?void 0:i.byteLength,!1),e}};l.default=s}),98);
__d("LSACSExperimentCapability",[],(function(t,n,r,o,a,i){var e=Object.freeze({RETRY_AFTER_TASK_SERIALIZATION_FAILURE_EXPONENTIAL_BACKOFF:0,BUMP_TOKEN_SYNC_TASK_AT_TASK_SERIALIZATION:1,INSERT_PENDING_TASK_PARENT_ROW_WHEN_NO_ACS_TOKENS_AT_TASK_INSERTION:2});i.default=e}),66);
__d("LSBase64Encode.nop",["EBBase64Encode","LSResult","LSSynchronousPromise"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t,n,a){return o("LSSynchronousPromise").makeSynchronousPromise(r("LSResult")(a?r("EBBase64Encode")(a):void 0))};e.__nop_name__="LSBase64Encode",l.default=e}),98);
__d("LSBeginHandlingFireForgetTasksForQueue",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(o){return t.sequence([function(r){return n[0]=t.createArray(),t.forEach(t.filter(t.db.table(5).fetch(),function(t){return t.queueName===e[0]}),function(e){var r=e.item;return n[3]=new t.Map,n[3].set("label",r.context),n[3].set("payload",r.taskValue),n[3].set("queue_name",r.queueName),n[3].set("task_id",r.taskId),n[3].set("failure_count",t.i64.eq(t.i64.cast([0,0]),t.i64.cast([0,0]))?void 0:t.i64.cast([0,0])),n[4]=(n[0].push(n[3]),n[0])})},function(o){return n[1]=new t.Map,n[1].set("tasks",n[0]),n[1].set("epoch_id",void 0),n[2]=new t.Map,n[2].set("queue_name",e[0]),n[2].set("next_sync_ms",void 0),n[2].set("work_item_type",t.i64.cast([0,5])),n[2].set("network_payload",n[1]),n[2].set("http_url_override",void 0),n[2].set("skip_realtime_gateway",!1),r[0]=n[2]}])},function(e){return t.resolve(r)}])}e.__sproc_name__="LSCoreBeginHandlingFireForgetTasksForQueueStoredProcedure",e.__tables__=["pending_fire_and_forget_tasks"],a.exports=e}),null);
__d("LSBeginHandlingFireForgetTasksForQueueStoredProcedure",["LSBeginHandlingFireForgetTasksForQueue","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSBeginHandlingFireForgetTasksForQueue"),a.queueName);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("LSForceTaskExecutionImmediately",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(r){return t.db.table(2).fetch([[[e[0]]]]).next().then(function(r,o){var a=r.done,i=r.value;return a?0:(o=i.item,n[1]=t.i64.of_float(Date.now()),t.i64.lt(n[1],o.minTimeToSyncTimestampMs)?t.forEach(t.db.table(2).fetch([[[e[0]]]]),function(e){var n=e.update,r=e.item;return n({minTimeToSyncTimestampMs:t.i64.cast([0,0]),failureCount:t.i64.add(r.failureCount,t.i64.cast([0,1]))})}):t.resolve())})},function(e){return t.resolve(r)}])}e.__sproc_name__="LSCoreForceTaskExecutionImmediatelyStoredProcedure",e.__tables__=["pending_tasks"],a.exports=e}),null);
__d("LSRemoveUsedTokens",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(e){return t.forEach(t.filter(t.db.table(309).fetch(),function(e){return t.i64.le(e.redeemLimit,t.i64.cast([0,0]))}),function(e){return e.delete()})},function(e){return t.resolve(r)}])}e.__sproc_name__="LSAnonymousCredentialsRemoveUsedTokensStoredProcedure",e.__tables__=["secure_acs_tokens"],a.exports=e}),null);
__d("LSGetCurrentTokenPoolState",["LSArrayGetObjectAt","LSRemoveBlindedTokens","LSRemoveUsedTokens"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(n){return r[0]=t.i64.of_float(Date.now()),r[1]=t.createArray(),t.count(t.filter(t.db.table(307).fetch(),function(t){return t.projectName===e[0]})).then(function(e){return r[2]=e})},function(n){return t.forEach(t.filter(t.db.table(307).fetch(),function(t){return t.projectName===e[0]}),function(e){var n=e.item;return r[7]=n.configId,t.i64.gt(r[0],n.expirationTimestampMs)?t.forEach(t.db.table(307).fetch([[[r[7]]]]),function(e){return e.delete()}):t.resolve(r[8]=(r[1].push(r[7]),r[1]))})},function(e){return t.storedProcedure(n("LSRemoveUsedTokens"))},function(e){return r[3]=t.i64.cast([0,0]),r[4]=t.i64.of_int32(r[1].length),t.i64.gt(r[4],t.i64.cast([0,0]))?t.loopAsync(r[4],function(e){return r[7]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[1],r[7]).then(function(e){var t;return t=e,r[8]=t[0],r[9]=t[1],t})},function(e){return t.count(t.filter(t.db.table(309).fetch(),function(e){return e.configId===r[8]})).then(function(e){return r[10]=e})},function(e){return r[3]=t.i64.add(r[10],r[3]),t.storedProcedure(n("LSRemoveBlindedTokens"),r[8])}])}):t.resolve()},function(e){var n;return t.i64.gt(r[2],t.i64.cast([0,0]))?(r[7]=t.i64.of_int32(r[1].length),r[5]=t.i64.ge(r[7],t.i64.cast([0,1]))):r[5]=void 0,r[5]!==void 0?(r[5]?(t.i64.gt(r[3],t.i64.cast([0,0]))?r[8]=t.i64.cast([0,3]):r[8]=t.i64.cast([0,2]),r[7]=r[8]):r[7]=t.i64.cast([0,1]),r[6]=r[7]):r[6]=t.i64.cast([0,0]),n=[r[6],r[3]],o[0]=n[0],o[1]=n[1]}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSAnonymousCredentialsGetCurrentTokenPoolStateStoredProcedure",e.__tables__=["secure_acs_configurations","secure_acs_tokens"],a.exports=e}),null);
__d("LSVoprfBlind.nop",["XPlatReactVoprf","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var r=yield o("XPlatReactVoprf").loadXPlatReactVoprf(),a=r.voprfInstance,i=a.voprfInfo,l=a.voprfWasm;try{var s=l.blind(i,new Uint8Array(n));return[s.blindedElement.buffer,s.blindingFactor.buffer]}catch(e){throw e}finally{o("XPlatReactVoprf").freeVoprfInstance(a)}});function t(t,n,r){return e.apply(this,arguments)}return t})();e.__nop_name__="LSVoprfBlind",l.default=e}),98);
__d("LSVoprfCreateNonce.nop",["LSSynchronousPromise","XPlatReactCrypto"],(function(t,n,r,o,a,i,l){"use strict";var e=32,s=function(n,r){var t=e,a=new Uint8Array(t);return o("XPlatReactCrypto").getRandomValues(a),o("LSSynchronousPromise").makeSynchronousPromise([a.buffer])};s.__nop_name__="LSVoprfCreateNonce",l.default=s}),98);
__d("LSTaskSerializerAcsIssueNextSync",["LSBase64Encode.nop","LSGetCurrentTokenPoolState","LSIssueNextSync","LSVoprfBlind.nop","LSVoprfCreateNonce.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(o){return t.db.table(310).fetch([[[e[0]]]]).next().then(function(e,o){var a,i=e.done,l=e.value;return i?((function(e){t.logger(e).mustfix(e)})("Request context for the passed task_id was not found"),a=[void 0,void 0,void 0],r[0]=a[0],r[1]=a[1],r[2]=a[2]):(o=l.item,t.sequence([function(e){return r[9]=o.projectName,r[10]=o.maxClientTokenPoolSize,t.storedProcedure(n("LSGetCurrentTokenPoolState"),r[9]).then(function(e){var t;return t=e,r[4]=t[0],r[5]=t[1],t})},function(e){var o;return t.i64.eq(r[4],t.i64.cast([0,0]))||t.i64.eq(r[4],t.i64.cast([0,1]))?t.resolve((r[11]=new t.Map,r[11].set("project_name",r[9]),r[12]=t.toJSON(r[11]),o=[r[12],t.i64.cast([0,351]),void 0],r[6]=o[0],r[7]=o[1],r[8]=o[2])):t.sequence([function(e){return r[11]=t.i64.of_float(Date.now()),t.islc(t.sortBy(t.filter(t.db.table(307).fetch(),function(e){return e.projectName===r[9]&&t.i64.gt(e.expirationTimestampMs,r[11])}),[["expirationTimestampMs","DESC"]]),0,t.i64.to_float(t.i64.cast([0,1]))).next().then(function(e,o){var a,i=e.done,l=e.value;return i?((function(e){t.logger(e).mustfix(e)})("A config for the passed project name was not found"),r[16]=new t.Map,r[16].set("project_name",r[9]),r[16].set("max_client_token_pool_size",r[10]),r[17]=t.toJSON(r[16]),a=[r[17],t.i64.cast([0,362]),void 0],r[12]=a[0],r[13]=a[1],r[14]=a[2]):(o=l.item,t.sequence([function(e){return r[24]=o.configId,r[16]=o.maxEvals,r[26]=o.tokenPollFrequencyMs,r[25]=o.maxClientTokenPoolSize,r[17]=t.i64.sub(r[10],r[5]),r[23]=t.i64.lt(r[16],r[17])?r[16]:r[17],r[18]=t.createArray(),t.i64.gt(r[23],t.i64.cast([0,0]))?t.loopAsync(r[23],function(e){return r[27]=e,t.sequence([function(e){return t.nativeOperation(n("LSVoprfCreateNonce.nop")).then(function(e){var t;return t=e,r[28]=t[0],t})},function(e){return t.blobs.neq(r[28],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSVoprfBlind.nop"),r[28]).then(function(e){var t;return t=e,r[29]=t[0],r[30]=t[1],t})},function(e){return t.blobs.neq(r[29],void 0)&&t.blobs.neq(r[30],void 0)?t.sequence([function(e){return r[31]=t.i64.cast([-1,4294967295]),t.db.table(308).peekNextAutoIncrementId().then(function(e){return r[31]=e})},function(e){return t.db.table(308).add({tokenId:void 0,blindedNonce:r[29],blindingFactor:r[30],nonce:r[28],configId:r[24]})},function(e){return t.db.table(308).fetch([[[r[31]]]]).next().then(function(e,n){var o=e.done,a=e.value;return o?r[32]=t.i64.cast([-1,4294967295]):(n=a.item,r[32]=n.tokenId)})},function(e){return t.i64.eq(r[32],t.i64.cast([-1,4294967295]))?t.sequence([function(e){return t.islc(t.db.table(308).fetchDesc([[[{gt:t.i64.cast([0,0])}]]]),0,t.i64.to_float(t.i64.cast([0,1]))).next().then(function(e,n){var o=e.done,a=e.value;return o?r[37]=t.i64.cast([-1,4294967295]):(n=a.item,r[37]=n.tokenId)})},function(e){return r[34]=r[37]}]):t.resolve(r[34]=r[32])},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[29]).then(function(e){var t;return t=e,r[35]=t[0],t})},function(e){return r[36]=new t.Map,r[36].set("id",r[34]),r[36].set("data",r[35]==null?"":r[35]),r[37]=(r[18].push(r[36]),r[18])}]):t.resolve()}]):t.resolve()}])}):t.resolve()},function(e){var o;return r[19]=t.i64.of_int32(r[18].length),t.i64.gt(r[19],t.i64.cast([0,0]))?t.resolve((r[27]=new t.Map,r[27].set("project_name",r[9]),r[27].set("config_id",r[24]),r[27].set("blinded_nonces",r[18]),r[28]=t.toJSON(r[27]),o=[r[28],t.i64.cast([0,354]),void 0],r[20]=o[0],r[21]=o[1],r[22]=o[2])):t.sequence([function(e){var o;return t.i64.neq(r[26],void 0)?t.sequence([function(e){var o;return t.i64.neq(r[25],void 0)?t.sequence([function(e){return(function(e){t.logger(e).info(e)})(["Already have the max number of tokens. Scheduling next ACS token sync locally for project: ",r[9]].join("")),t.storedProcedure(n("LSIssueNextSync"),r[25],r[9],r[26],!1)},function(e){var t;return t=[void 0,void 0,void 0],r[30]=t[0],r[31]=t[1],r[32]=t[2],t}]):t.resolve(((function(e){t.logger(e).info(e)})(["token_poll_frequency is nonnull but max_client_token_pool_size is null. Already have the max number of tokens. Scheduling the next ACS token sync for project: ",r[9]].join("")),r[33]=new t.Map,r[33].set("project_name",r[9]),r[33].set("max_client_token_pool_size",r[10]),r[34]=t.toJSON(r[33]),o=[r[34],t.i64.cast([0,362]),void 0],r[30]=o[0],r[31]=o[1],r[32]=o[2]))},function(e){var t;return t=[r[30],r[31],r[32]],r[27]=t[0],r[28]=t[1],r[29]=t[2],t}]):t.resolve(((function(e){t.logger(e).info(e)})(["Already have the max number of tokens. Scheduling the next ACS token sync for project: ",r[9]].join("")),r[30]=new t.Map,r[30].set("project_name",r[9]),r[30].set("max_client_token_pool_size",r[10]),r[31]=t.toJSON(r[30]),o=[r[31],t.i64.cast([0,362]),void 0],r[27]=o[0],r[28]=o[1],r[29]=o[2]))},function(e){var t;return t=[r[27],r[28],r[29]],r[20]=t[0],r[21]=t[1],r[22]=t[2],t}])},function(e){var t;return t=[r[20],r[21],r[22]],r[12]=t[0],r[13]=t[1],r[14]=t[2],t}]))})},function(e){var t;return t=[r[12],r[13],r[14]],r[6]=t[0],r[7]=t[1],r[8]=t[2],t}])},function(e){var t;return t=[r[6],r[7],r[8]],r[0]=t[0],r[1]=t[1],r[2]=t[2],t}]))})},function(e){var t;return t=[r[0],r[1],r[2]],o[0]=t[0],o[1]=t[1],o[2]=t[2],t}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSAnonymousCredentialsTaskSerializerAcsIssueNextSyncStoredProcedure",e.__tables__=["acs_request_context","secure_acs_configurations","secure_acs_blinded_tokens"],a.exports=e}),null);
__d("LSTaskSerializerDeleteChatHistory",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(o){return t.sequence([function(r){return t.db.table(32).fetch([[[e[0]]]]).next().then(function(r,o){var a,i=r.done,l=r.value;return i?(n[4]=t.createArray(),n[5]=(n[4].push("taskSerializerDeleteChatHistory: Task ID not found"),n[4]),n[6]=(n[4].push(e[0]),n[4]),n[7]=t.toJSON(n[4]),(function(e){t.logger(e).mustfix(e)})(n[7]),a=[void 0,void 0,void 0],n[0]=a[0],n[1]=a[1],n[2]=a[2]):(o=l.item,t.sequence([function(e){return n[8]=o.threadKey,t.db.table(9).fetch([[[n[8]]]]).next().then(function(e,r){var o,a=e.done,i=e.value;return a?(n[9]=t.createArray(),n[10]=(n[9].push("taskSerializerDeleteChatHistory: Thread not found"),n[9]),n[11]=(n[9].push(n[8]),n[9]),n[12]=t.toJSON(n[9]),(function(e){t.logger(e).mustfix(e)})(n[12]),o=[void 0,void 0,void 0],n[4]=o[0],n[5]=o[1],n[6]=o[2]):(r=i.item,t.sequence([function(e){return t.db.table(9).fetch([[[n[8]]]]).next().then(function(e,r){var o=e.done,a=e.value;return o?n[9]=t.i64.cast([0,1]):(r=a.item,n[14]=r.syncGroup,t.i64.neq(n[14],void 0)?n[13]=n[14]:n[13]=t.i64.cast([0,1]),n[9]=n[13])})},function(e){var r;return n[11]=new t.Map,n[11].set("thread_key",n[8]),n[11].set("sync_group",n[9]),n[12]=t.toJSON(n[11]),r=[n[12],t.i64.cast([0,903]),void 0],n[4]=r[0],n[5]=r[1],n[6]=r[2]}]))})},function(e){var t;return t=[n[4],n[5],n[6]],n[0]=t[0],n[1]=t[1],n[2]=t[2],t}]))})},function(e){var t;return t=[n[0],n[1],n[2]],r[0]=t[0],r[1]=t[1],r[2]=t[2],t}])},function(e){return t.resolve(r)}])}e.__sproc_name__="LSMailboxTaskSerializerDeleteChatHistoryStoredProcedure",e.__tables__=["threads_optimistic_context","threads"],a.exports=e}),null);
__d("LSTaskSerializerE2eeMessageIntegrityCheckV2",[],(function(t,n,r,o,a,i){function e(){var e,t=arguments,n=t[t.length-1],r=[],o=[];return e=[void 0,n.i64.cast([0,705]),void 0],o[0]=e[0],o[1]=e[1],o[2]=e[2],n.resolve(o)}e.__sproc_name__="LSEncryptedBackupsTaskSerializerE2eeMessageIntegrityCheckV2StoredProcedure",e.__tables__=[],a.exports=e}),null);
__d("LSTaskSerializerE2eeMetadataThreadIntegrityCheck",[],(function(t,n,r,o,a,i){function e(){var e,t=arguments,n=t[t.length-1],r=[],o=[];return e=[void 0,n.i64.cast([0,700]),void 0],o[0]=e[0],o[1]=e[1],o[2]=e[2],n.resolve(o)}e.__sproc_name__="LSE2EEMessagingMetadataMailboxTaskSerializerE2eeMetadataThreadIntegrityCheckStoredProcedure",e.__tables__=[],a.exports=e}),null);
__d("LSTaskSerializerEncryptedBackupAction",[],(function(t,n,r,o,a,i){function e(){var e,t=arguments,n=t[t.length-1],r=[],o=[];return e=[void 0,n.i64.cast([0,319]),void 0],o[0]=e[0],o[1]=e[1],o[2]=e[2],n.resolve(o)}e.__sproc_name__="LSEncryptedBackupsTaskSerializerEncryptedBackupActionStoredProcedure",e.__tables__=[],a.exports=e}),null);
__d("LSTaskSerializerEncryptedBackupsLoopingUpload",["LSLogMebClientEvent.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(e){return t.sequence([function(e){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][taskSerializerEncryptedBackupsLoopingUpload] Beginning execution."),r[1]=t.i64.of_float(Date.now()),(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsTaskSerializerEncryptedBackupsLoopingUploadStoredProcedure] LSEncryptedBackupsLoopingUploadPayloadsTable table not found"),r[3]="LSEncryptedBackupsLoopingUploadPayloadsTable table not found",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsTaskSerializerEncryptedBackupsLoopingUploadStoredProcedure] ","",r[3]].join("")),r[2]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsTaskSerializerEncryptedBackupsLoopingUploadStoredProcedure",r[3],r[2],t.i64.cast([0,3]))},function(e){return r[4]=t.i64.of_float(Date.now()),r[5]=t.i64.random(),r[7]="Finishing execution. Execution time: ",r[8]=t.i64.to_string(t.i64.sub(r[4],r[0])),r[9]=" ms",r[6]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][taskSerializerEncryptedBackupsLoopingUpload] ",r[6],r[7],r[6],r[8],r[6],r[9]].join("")),t.i64.eq(t.i64.mod_(r[5],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[10]=",",r[11]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"taskSerializerEncryptedBackupsLoopingUpload",[r[7],r[10],r[8],r[10],r[9]].join(""),r[11],t.i64.cast([0,4]))):t.resolve()},function(e){var n;return n=['{"request_id":"unknown","upload_type":"FBN","payload":{"error_code":2,"operation":"","error_message":"","__typename":"MPSUploadFailurePayload"}}',t.i64.cast([0,50043]),void 0],o[0]=n[0],o[1]=n[1],o[2]=n[2],n}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsTaskSerializerEncryptedBackupsLoopingUploadStoredProcedure",e.__tables__=[],a.exports=e}),null);
__d("LSGetBlobFromString.nop",["CryptoLogger","LSResult","LSSynchronousPromise","XPlatReactTextEncoder","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t,n,a){var e=new(o("XPlatReactTextEncoder")).TextEncoder;try{var i=e.encode(a).buffer;return o("LSSynchronousPromise").makeSynchronousPromise(r("LSResult")(i))}catch(e){var l=r("getErrorSafe")(e),s=o("CryptoLogger").CryptoLogger("get_blob_from_string");throw s.catching(l).mustfix(l.message),l}};e.__nop_name__="LSGetBlobFromString",l.default=e}),98);
__d("LSQueryLocalPersistenceStoreForBackup.nop",["Promise","ReQL","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r,a,i){var l=yield o("ReQL").toArrayAsync(o("ReQL").fromTableDescending(t.local_message_persistence_store).filter(function(e){var t=e.offlineThreadingId,n=e.threadId;return n===a&&i===t}));if(l.length===0)return(e||(e=n("Promise"))).resolve([void 0,void 0,!1]);var s=l[0];return(e||(e=n("Promise"))).resolve([s.messagePayload,s.messageTimestampMs,!1])});function r(e,n,r,o){return t.apply(this,arguments)}return r})();s.__nop_name__="LSQueryLocalPersistenceStoreForBackup",l.default=s}),98);
__d("LSQueryLocalPersistenceStoreSupplementalForBackup.nop",["Promise","ReQL","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r,a,i,l){var s=yield o("ReQL").firstAsync(o("ReQL").fromTableDescending(t.local_message_persistence_store_supplemental).filter(function(e){var t=e.supplementalKey,n=e.threadId,r=e.toplevelOfflineThreadingId;return n===a&&r===i&&t===l}));return s==null?(e||(e=n("Promise"))).resolve([void 0,void 0]):(e||(e=n("Promise"))).resolve([s.messagePayload,s.messageTimestampMs])});function r(e,n,r,o,a){return t.apply(this,arguments)}return r})();s.__nop_name__="LSQueryLocalPersistenceStoreSupplementalForBackup",l.default=s}),98);
__d("LSQueryLocalPersistenceStoreTagsForBackup.nop",["LSVec","Promise","ReQL","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=":",u=(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,a,i,l){var u=yield o("ReQL").firstAsync(o("ReQL").fromTableDescending(t.local_message_persistence_store_tag_index.index("offlineThreadingId")).getKeyRange(l,i));if(u==null)return(e||(e=n("Promise"))).resolve([r("LSVec").ofArray([])]);var c=u.tag;return(e||(e=n("Promise"))).resolve([r("LSVec").ofArray(c.split(s))])});function a(e,n,r,o){return t.apply(this,arguments)}return a})();u.__nop_name__="LSQueryLocalPersistenceStoreTagsForBackup",l.default=u}),98);
__d("LSLoadUnencryptedProtobufWithInputs",["LSBase64Encode.nop","LSGetBlobFromString.nop","LSLogMebClientEvent.nop","LSQueryLocalPersistenceStoreForBackup.nop","LSQueryLocalPersistenceStoreSupplementalForBackup.nop","LSQueryLocalPersistenceStoreTagsForBackup.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(o){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][loadUnencryptedProtobufWithInputs] Beginning execution."),r[1]=t.i64.of_float(Date.now()),t.i64.eq(e[0],t.i64.cast([0,1]))?t.sequence([function(o){return t.nativeOperation(n("LSQueryLocalPersistenceStoreForBackup.nop"),e[1],e[2]).then(function(e){var t;return t=e,r[10]=t[0],r[11]=t[1],r[12]=t[2],t})},function(o){return t.nativeOperation(n("LSQueryLocalPersistenceStoreTagsForBackup.nop"),e[1],e[2]).then(function(e){var t;return t=e,r[13]=t[0],t})},function(o){var a,i,l;return t.blobs.neq(r[10],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[10]).then(function(e){var t;return t=e,r[16]=t[0],t})},function(n){var o,a,i;return r[16]!==void 0?(r[13]!==void 0?(r[21]=new t.Map,r[21].set("message_tags",r[13]),r[22]=t.toJSON(r[21]),r[19]=r[22]):r[19]=void 0,r[20]=new t.Map,r[20].set("backup_action",e[0]),r[20].set("protobuf_encrypted",r[16]),r[20].set("supplemental_data_encrypted",void 0),r[20].set("timestamp_ms",e[4]),r[20].set("message_tags",r[19]),o=[r[20],void 0],r[17]=o[0],r[18]=o[1]):((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure] Returning error PROTOBUF_FORMATTING_FAILED"),r[19]=new t.Map,r[19].set("error_code",t.i64.cast([0,68])),r[19].set("stored_procedure","LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure"),r[19].set("error_message",""),a=[void 0,r[19]],r[17]=a[0],r[18]=a[1]),i=[r[17],r[18]],r[14]=i[0],r[15]=i[1]}]):t.resolve((r[12]?((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure] Returning error PROTOBUF_ALREADY_DELETED"),r[18]=new t.Map,r[18].set("error_code",t.i64.cast([0,70])),r[18].set("stored_procedure","LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure"),r[18].set("error_message",""),a=[void 0,r[18]],r[16]=a[0],r[17]=a[1]):((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure] Returning error PROTOBUF_NOT_FOUND_IN_TOPLEVEL_TABLE"),r[18]=new t.Map,r[18].set("error_code",t.i64.cast([0,63])),r[18].set("stored_procedure","LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure"),r[18].set("error_message",""),i=[void 0,r[18]],r[16]=i[0],r[17]=i[1]),l=[r[16],r[17]],r[14]=l[0],r[15]=l[1]))},function(e){var t;return t=[r[14],r[15]],r[2]=t[0],r[3]=t[1],t}]):t.sequence([function(o){var a,i,l;return t.i64.eq(e[0],t.i64.cast([0,2]))?t.sequence([function(o){var a;return e[3]!==void 0?t.sequence([function(o){return t.nativeOperation(n("LSQueryLocalPersistenceStoreSupplementalForBackup.nop"),e[1],e[2],e[3]).then(function(e){var t;return t=e,r[14]=t[0],r[15]=t[1],t})},function(o){return t.nativeOperation(n("LSQueryLocalPersistenceStoreTagsForBackup.nop"),e[1],e[2]).then(function(e){var t;return t=e,r[16]=t[0],t})},function(o){var a;return t.blobs.neq(r[14],void 0)?t.sequence([function(o){return t.nativeOperation(n("LSGetBlobFromString.nop"),e[3]).then(function(e){var t;return t=e,r[19]=t[0],t})},function(o){var a;return t.blobs.neq(r[19],void 0)?t.sequence([function(e){return r[22]=new t.Map,r[22].set("sk_ciphertext",r[19]),r[22].set("sk_hash",r[19]),t.nativeOperation(n("LSBase64Encode.nop"),r[14]).then(function(e){var t;return t=e,r[23]=t[0],t})},function(n){var o,a,i;return r[23]!==void 0?(r[16]!==void 0?(r[28]=new t.Map,r[28].set("message_tags",r[16]),r[29]=t.toJSON(r[28]),r[26]=r[29]):r[26]=void 0,r[27]=new t.Map,r[27].set("backup_action",e[0]),r[27].set("protobuf_encrypted",r[23]),r[27].set("supplemental_data_encrypted",r[22]),r[27].set("timestamp_ms",e[4]),r[27].set("message_tags",r[26]),o=[r[27],void 0],r[24]=o[0],r[25]=o[1]):((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure] Returning error PROTOBUF_FORMATTING_FAILED"),r[26]=new t.Map,r[26].set("error_code",t.i64.cast([0,68])),r[26].set("stored_procedure","LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure"),r[26].set("error_message",""),a=[void 0,r[26]],r[24]=a[0],r[25]=a[1]),i=[r[24],r[25]],r[20]=i[0],r[21]=i[1]}]):t.resolve(((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure] Returning error SUPPLEMENTAL_FORMATTING_FAILED"),r[22]=new t.Map,r[22].set("error_code",t.i64.cast([0,69])),r[22].set("stored_procedure","LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure"),r[22].set("error_message",""),a=[void 0,r[22]],r[20]=a[0],r[21]=a[1]))},function(e){var t;return t=[r[20],r[21]],r[17]=t[0],r[18]=t[1],t}]):t.resolve(((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure] Returning error PROTOBUF_NOT_FOUND_IN_SUPPLEMENTAL_TABLE"),r[19]=new t.Map,r[19].set("error_code",t.i64.cast([0,64])),r[19].set("stored_procedure","LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure"),r[19].set("error_message",""),a=[void 0,r[19]],r[17]=a[0],r[18]=a[1]))},function(e){var t;return t=[r[17],r[18]],r[12]=t[0],r[13]=t[1],t}]):t.resolve(((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure] Returning error SUPPLEMENTAL_KEY_NOT_SET_IN_CONTEXT_TABLE"),r[14]=new t.Map,r[14].set("error_code",t.i64.cast([0,65])),r[14].set("stored_procedure","LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure"),r[14].set("error_message",""),a=[void 0,r[14]],r[12]=a[0],r[13]=a[1]))},function(e){var t;return t=[r[12],r[13]],r[10]=t[0],r[11]=t[1],t}]):t.resolve((t.i64.eq(e[0],t.i64.cast([0,3]))?(r[14]=new t.Map,r[14].set("backup_action",e[0]),r[14].set("protobuf_encrypted",void 0),r[14].set("supplemental_data_encrypted",void 0),r[14].set("timestamp_ms",e[4]),r[14].set("message_tags",void 0),a=[r[14],void 0],r[12]=a[0],r[13]=a[1]):((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure] Returning error INVALID_BACKUP_OPERATION"),r[14]=new t.Map,r[14].set("error_code",t.i64.cast([-1,4294967289])),r[14].set("stored_procedure","LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure"),r[14].set("error_message",""),i=[void 0,r[14]],r[12]=i[0],r[13]=i[1]),l=[r[12],r[13]],r[10]=l[0],r[11]=l[1]))},function(e){var t;return t=[r[10],r[11]],r[2]=t[0],r[3]=t[1],t}])},function(e){return r[4]=t.i64.of_float(Date.now()),r[5]=t.i64.random(),r[7]="Finishing execution. Execution time: ",r[8]=t.i64.to_string(t.i64.sub(r[4],r[0])),r[9]=" ms",r[6]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][loadUnencryptedProtobufWithInputs] ",r[6],r[7],r[6],r[8],r[6],r[9]].join("")),t.i64.eq(t.i64.mod_(r[5],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[10]=",",r[11]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"loadUnencryptedProtobufWithInputs",[r[7],r[10],r[8],r[10],r[9]].join(""),r[11],t.i64.cast([0,4]))):t.resolve()},function(e){var t;return t=[r[2],r[3]],o[0]=t[0],o[1]=t[1],t}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure",e.__tables__=[],a.exports=e}),null);
__d("LSLoadUnencryptedProtobufBackupSerializedPayloadData",["LSLoadUnencryptedProtobufWithInputs","LSLogMebClientEvent.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(n){var o;return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][loadUnencryptedProtobufBackupSerializedPayloadData] Beginning execution."),r[1]=t.i64.of_float(Date.now()),r[18]=t.i64.mul(r[1],t.i64.cast([0,1e6])),t.sequence([function(n){return t.db.table(2).fetch([[[e[0]]]]).next().then(function(n,o){var a,i,l=n.done,s=n.value;return l?(r[30]=t.i64.of_float(Date.now()),a=[e[0],void 0,void 0,void 0,void 0,t.i64.sub(t.i64.mul(r[30],t.i64.cast([0,1e6])),r[18]),void 0],r[22]=a[0],r[23]=a[1],r[24]=a[2],r[25]=a[3],r[26]=a[4],r[27]=a[5],r[28]=a[6]):(o=s.item,r[30]=t.i64.of_float(Date.now()),i=[e[0],o.queueName,o.enqueueTimestampMs,o.priority,o.firstExecutedTimestampMs,t.i64.sub(t.i64.mul(r[30],t.i64.cast([0,1e6])),r[18]),void 0],r[22]=i[0],r[23]=i[1],r[24]=i[2],r[25]=i[3],r[26]=i[4],r[27]=i[5],r[28]=i[6])})},function(e){var t;return t=[r[22],r[23],r[24],r[25],r[26],r[27],r[28]],r[2]=t[0],r[3]=t[1],r[4]=t[2],r[5]=t[3],r[6]=t[4],r[7]=t[5],r[8]=t[6],t}])},function(o){return r[9]=new t.Map,r[9].set("task_id",r[2]),r[9].set("queue_name",r[3]),r[9].set("enqueue_timestamp_ms",r[4]),r[9].set("priority",r[5]),r[9].set("first_executed_timestamp_ms",r[6]),r[9].set("execution_time_ns",r[7]),r[9].set("echo_encoding_execution_time_ns",r[8]),r[10]=new t.Map,r[10].set("task_metadata",r[9]),r[10].set("action_type",void 0),r[10].set("content_type",void 0),r[10].set("identifiers",void 0),r[10].set("identifiers_v2",void 0),r[10].set("task_creation_source",void 0),r[10].set("message_payload_source",t.i64.cast([0,2])),t.filter(t.db.table(305).fetch(),function(n){return t.i64.eq(n.pendingBackupTaskId,e[0])}).next().then(function(o,a){var i,l=o.done,s=o.value;return l?(r[22]=new t.Map,r[22].set("error_code",t.i64.cast([0,5])),r[22].set("stored_procedure","LSEncryptedBackupsLoadUnencryptedProtobufBackupSerializedPayloadDataStoredProcedure"),r[22].set("error_message",""),i=[void 0,r[22],r[10]],r[11]=i[0],r[12]=i[1],r[13]=i[2]):(a=s.item,t.sequence([function(n){var o;return r[39]=a.actThreadId,r[40]=a.toplevelOfflineThreadingId,r[23]=a.messageTimestampMs,r[22]=new t.Map,r[22].set("backup_id","openEbUploadGenericBackupId"),r[22].set("act_thread_id",r[39]),r[22].set("server_thread_id",r[39]),r[22].set("timestamp",t.i64.to_string(r[23])),r[22].set("otid",r[40]),r[24]=new t.Map,r[24].set("backup_id","openEbUploadGenericBackupId"),r[24].set("act_thread_id",r[39]),r[24].set("timestamp",t.i64.to_string(r[23])),r[24].set("otid",r[40]),t.sequence([function(n){return t.db.table(2).fetch([[[e[0]]]]).next().then(function(n,o){var a,i,l=n.done,s=n.value;return l?(r[49]=t.i64.of_float(Date.now()),a=[e[0],void 0,void 0,void 0,void 0,t.i64.sub(t.i64.mul(r[49],t.i64.cast([0,1e6])),r[18]),void 0],r[41]=a[0],r[42]=a[1],r[43]=a[2],r[44]=a[3],r[45]=a[4],r[46]=a[5],r[47]=a[6]):(o=s.item,r[49]=t.i64.of_float(Date.now()),i=[e[0],o.queueName,o.enqueueTimestampMs,o.priority,o.firstExecutedTimestampMs,t.i64.sub(t.i64.mul(r[49],t.i64.cast([0,1e6])),r[18]),void 0],r[41]=i[0],r[42]=i[1],r[43]=i[2],r[44]=i[3],r[45]=i[4],r[46]=i[5],r[47]=i[6])})},function(e){var t;return t=[r[41],r[42],r[43],r[44],r[45],r[46],r[47]],r[25]=t[0],r[26]=t[1],r[27]=t[2],r[28]=t[3],r[29]=t[4],r[30]=t[5],r[31]=t[6],t}])},function(e){return r[32]=new t.Map,r[32].set("task_id",r[25]),r[32].set("queue_name",r[26]),r[32].set("enqueue_timestamp_ms",r[27]),r[32].set("priority",r[28]),r[32].set("first_executed_timestamp_ms",r[29]),r[32].set("execution_time_ns",r[30]),r[32].set("echo_encoding_execution_time_ns",r[31]),r[33]=new t.Map,r[33].set("task_metadata",r[32]),r[33].set("action_type",void 0),r[33].set("content_type",void 0),r[33].set("identifiers",void 0),r[33].set("identifiers_v2",r[24]),r[33].set("task_creation_source",void 0),r[33].set("message_payload_source",t.i64.cast([0,2])),t.storedProcedure(n("LSLoadUnencryptedProtobufWithInputs"),a.backupAction,r[39],r[40],a.supplementalKey,r[23],r[22]).then(function(e){var t;return t=e,r[34]=t[0],r[35]=t[1],t})},function(e){var n,o,i;return r[34]!==void 0?(r[41]=new t.Map,r[41].set("unencrypted_protobuf_backup_payload",r[34]),r[41].set("message_identifiers",r[22]),r[41].set("attachment_backup_payload",a.attachmentPayload),r[41].set("sender_id",a.senderId),r[41].set("extra_data_for_eb_upload",void 0),n=[r[41],void 0,r[33]],r[36]=n[0],r[37]=n[1],r[38]=n[2]):(o=[void 0,r[35],r[33]],r[36]=o[0],r[37]=o[1],r[38]=o[2]),i=[r[36],r[37],r[38]],r[11]=i[0],r[12]=i[1],r[13]=i[2]}]))})},function(e){return r[15]=t.i64.of_float(Date.now()),r[16]=t.i64.random(),r[19]="Finishing execution. Execution time: ",r[20]=t.i64.to_string(t.i64.sub(r[15],r[0])),r[21]=" ms",r[17]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][loadUnencryptedProtobufBackupSerializedPayloadData] ",r[17],r[19],r[17],r[20],r[17],r[21]].join("")),t.i64.eq(t.i64.mod_(r[16],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[22]=",",r[23]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"loadUnencryptedProtobufBackupSerializedPayloadData",[r[19],r[22],r[20],r[22],r[21]].join(""),r[23],t.i64.cast([0,4]))):t.resolve()},function(e){var t;return t=[r[11],r[12],r[13]],o[0]=t[0],o[1]=t[1],o[2]=t[2],t}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsLoadUnencryptedProtobufBackupSerializedPayloadDataStoredProcedure",e.__tables__=["pending_tasks","pending_protobuf_backups_context"],a.exports=e}),null);
__d("LSTaskSerializerEncryptedBackupsOpenUpload",["LSArrayGetObjectAt","LSBase64Encode.nop","LSDeserializeFromJsonIntoDictionaryV2.nop","LSLoadUnencryptedProtobufBackupSerializedPayloadData","LSLogMebClientEvent.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(o){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][taskSerializerEncryptedBackupsOpenUpload] Beginning execution."),r[1]=t.i64.of_float(Date.now()),t.storedProcedure(n("LSLoadUnencryptedProtobufBackupSerializedPayloadData"),e[0]).then(function(e){var t;return t=e,r[2]=t[0],r[3]=t[1],r[4]=t[2],t})},function(e){var o,a,i;return r[2]!==void 0?t.sequence([function(e){return r[15]=r[2].get("message_identifiers"),r[16]=r[2].get("unencrypted_protobuf_backup_payload"),r[17]=r[15].get("server_thread_id"),r[18]=r[15].get("timestamp"),r[19]=r[15].get("otid"),r[20]=r[15].get("act_thread_id"),r[21]=new t.Map,r[21].set("server_thread_key",r[17]),r[21].set("timestamp",r[18]),r[21].set("otid",r[19]),r[21].set("wa_thread_id",t.i64.from_string(r[20])),r[22]=new t.Map,r[22].set("message_identifiers",r[21]),r[23]=r[2].get("extra_data_for_eb_upload"),r[23]!==void 0?t.sequence([function(e){return t.nativeOperation(n("LSDeserializeFromJsonIntoDictionaryV2.nop"),r[23]).then(function(e){var t;return t=e,r[32]=t[0],t})},function(e){return r[33]=new t.Map,r[34]=r[32].keys(),r[35]=t.i64.of_int32(r[34].length),t.i64.gt(r[35],t.i64.cast([0,0]))?t.loopAsync(r[35],function(e){return r[36]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[34],r[36]).then(function(e){var t;return t=e,r[37]=t[0],r[38]=t[1],t})},function(e){return r[39]=r[32].get(r[37]),r[33].set(r[37],r[39])}])}):t.resolve()},function(e){return r[24]=r[33]}]):t.resolve(r[24]=void 0)},function(e){return r[24]!==void 0?t.sequence([function(e){return r[32]=r[24].get("mt"),r[32]?r[33]=!1:r[33]=!0,r[33]?t.resolve(r[34]=void 0):t.sequence([function(e){return r[36]=new t.Map,r[37]=r[32].keys(),r[38]=t.i64.of_int32(r[37].length),t.i64.gt(r[38],t.i64.cast([0,0]))?t.loopAsync(r[38],function(e){return r[39]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[37],r[39]).then(function(e){var t;return t=e,r[40]=t[0],r[41]=t[1],t})},function(e){return r[42]=r[32].get(r[40]),r[36].set(r[40],r[42])}])}):t.resolve()},function(e){return r[34]=r[36]}])},function(e){return r[34]!==void 0?(r[36]=t.toJSON(r[34]),r[35]=r[36]):r[35]=void 0,r[25]=r[35]}]):t.resolve(r[25]=void 0)},function(e){return r[26]=r[16].get("supplemental_data_encrypted"),r[26]!==void 0?t.sequence([function(e){return r[32]=r[16].get("protobuf_encrypted"),r[33]=r[16].get("backup_action"),r[34]=r[16].get("timestamp_ms"),r[35]=r[26].get("sk_ciphertext"),t.nativeOperation(n("LSBase64Encode.nop"),r[35]).then(function(e){var t;return t=e,r[36]=t[0],t})},function(e){return r[37]=r[26].get("sk_hash"),t.nativeOperation(n("LSBase64Encode.nop"),r[37]).then(function(e){var t;return t=e,r[38]=t[0],t})},function(e){return r[39]=new t.Map,r[39].set("supplementary_data_key",void 0),r[39].set("encrypted_protobuf",r[32]),r[39].set("key_value_backup_action",r[33]),r[39].set("protobuf_ts_ms",r[34]),r[39].set("supplemental_key_ciphertext",r[36]),r[39].set("supplemental_key_hash",r[38]),r[39].set("message_tags",r[25]),r[27]=r[39]}]):t.resolve((r[32]=r[16].get("protobuf_encrypted"),r[33]=r[16].get("backup_action"),r[34]=r[16].get("timestamp_ms"),r[35]=new t.Map,r[35].set("supplementary_data_key",void 0),r[35].set("encrypted_protobuf",r[32]),r[35].set("key_value_backup_action",r[33]),r[35].set("protobuf_ts_ms",r[34]),r[35].set("message_tags",r[25]),r[27]=r[35]))},function(e){return r[22].set("key_value_backup_unencrypted_payload",r[27]),r[28]=r[2].get("sender_id"),r[22].set("sender_id",r[28]),r[29]=r[2].get("attachment_backup_payload"),r[29]!==void 0&&r[22].set("attachment_backup_payload",r[29]),r[24]!==void 0?t.sequence([function(e){return r[32]=r[24].get("ttd"),r[32]?r[33]=!1:r[33]=!0,r[33]?t.resolve(r[34]=void 0):t.sequence([function(e){return r[36]=new t.Map,r[37]=r[32].keys(),r[38]=t.i64.of_int32(r[37].length),t.i64.gt(r[38],t.i64.cast([0,0]))?t.loopAsync(r[38],function(e){return r[39]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[37],r[39]).then(function(e){var t;return t=e,r[40]=t[0],r[41]=t[1],t})},function(e){return r[42]=r[32].get(r[40]),r[36].set(r[40],r[42])}])}):t.resolve()},function(e){return r[34]=r[36]}])},function(e){return r[34]!==void 0?(r[36]=t.toJSON(r[34]),r[35]=r[36]):r[35]=void 0,r[30]=r[35]}]):t.resolve(r[30]=void 0)},function(e){var n;return r[30]!==void 0&&r[22].set("tags_to_delete",r[30]),r[31]=t.toJSON(r[22]),n=[r[31],void 0,r[4]],r[5]=n[0],r[6]=n[1],r[7]=n[2]}]):t.resolve((r[3]?r[15]=!1:r[15]=!0,r[15]?(a=[void 0,void 0,r[4]],r[16]=a[0],r[17]=a[1],r[18]=a[2]):(o=[void 0,r[3],r[4]],r[16]=o[0],r[17]=o[1],r[18]=o[2]),i=[r[16],r[17],r[18]],r[5]=i[0],r[6]=i[1],r[7]=i[2]))},function(e){return r[15]=new t.Map,r[16]=r[15].set("success",r[5]),r[17]=r[15].set("failure",r[6]),r[18]=r[15].set("context",r[7]),r[19]=t.toJSON(r[15]),r[8]=r[19],r[9]=t.i64.of_float(Date.now()),r[10]=t.i64.random(),r[12]="Finishing execution. Execution time: ",r[13]=t.i64.to_string(t.i64.sub(r[9],r[0])),r[14]=" ms",r[11]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][taskSerializerEncryptedBackupsOpenUpload] ",r[11],r[12],r[11],r[13],r[11],r[14]].join("")),t.i64.eq(t.i64.mod_(r[10],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[15]=",",r[16]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"taskSerializerEncryptedBackupsOpenUpload",[r[12],r[15],r[13],r[15],r[14]].join(""),r[16],t.i64.cast([0,4]))):t.resolve()},function(e){var n;return n=[r[8],t.i64.cast([0,50048])],o[0]=n[0],o[1]=n[1],n}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsTaskSerializerEncryptedBackupsOpenUploadStoredProcedure",e.__tables__=[],a.exports=e}),null);
__d("LSTaskSerializerEncryptedBackupsRestoreWithSerializer",[],(function(t,n,r,o,a,i){function e(){var e,t=arguments,n=t[t.length-1],r=[],o=[];return e=[void 0,void 0,void 0],o[0]=e[0],o[1]=e[1],o[2]=e[2],n.resolve(o)}e.__sproc_name__="LSEncryptedBackupsTaskSerializerEncryptedBackupsRestoreWithSerializerStoredProcedure",e.__tables__=[],a.exports=e}),null);
__d("LSCreateDerivedKeys.nop",["CreateDerivedKeys","LSVec"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t,n,a,i,l,s){return o("CreateDerivedKeys").CreateDerivedKeys(a,i,l,r("LSVec").toArray(s))};e.__nop_name__="LSCreateDerivedKeys",l.default=e}),98);
__d("LSDeriveValueSecretRefV2",["LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDerivedKeys.nop","LSGetBlobFromString.nop","LSLogMebClientEvent.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(o){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][deriveValueSecretRefV2] Beginning execution."),r[1]=t.i64.of_float(Date.now()),r[2]=e[2].get("message_payload_encryption_keys"),r[3]=r[2].get("encryption_version"),r[4]=r[2].get("epoch_anon_id"),r[5]=r[2].get("epoch_root_key"),r[6]=r[2].get("payload_key"),r[7]=t.createArray(),r[41]=(r[7].push(t.i64.cast([0,6])),r[7]),t.nativeOperation(n("LSGetBlobFromString.nop"),"epoch_anon_id_debug").then(function(e){var t;return t=e,r[8]=t[0],t})},function(e){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),r[8],void 0,r[4],r[7]).then(function(e){var t;return t=e,r[9]=t[0],t})},function(e){return r[9]?r[10]=!1:r[10]=!0,r[10]?t.resolve(r[11]=""):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[9],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[41]=t[0],r[42]=t[1],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[41]).then(function(e){var t;return t=e,r[43]=t[0],t})},function(e){return r[11]=r[43]==null?"":r[43]}])},function(e){return r[12]=t.createArray(),r[41]=(r[12].push(t.i64.cast([0,6])),r[12]),t.nativeOperation(n("LSGetBlobFromString.nop"),"epoch_root_key_debug").then(function(e){var t;return t=e,r[13]=t[0],t})},function(e){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),r[13],void 0,r[5],r[12]).then(function(e){var t;return t=e,r[14]=t[0],t})},function(e){return r[14]?r[15]=!1:r[15]=!0,r[15]?t.resolve(r[16]=""):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[14],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[41]=t[0],r[42]=t[1],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[41]).then(function(e){var t;return t=e,r[43]=t[0],t})},function(e){return r[16]=r[43]==null?"":r[43]}])},function(e){return r[17]=t.createArray(),r[41]=(r[17].push(t.i64.cast([0,6])),r[17]),t.nativeOperation(n("LSGetBlobFromString.nop"),"message_key_debug").then(function(e){var t;return t=e,r[18]=t[0],t})},function(e){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),r[18],void 0,r[6],r[17]).then(function(e){var t;return t=e,r[19]=t[0],t})},function(e){return r[19]?r[20]=!1:r[20]=!0,r[20]?t.resolve(r[21]=""):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[19],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[41]=t[0],r[42]=t[1],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[41]).then(function(e){var t;return t=e,r[43]=t[0],t})},function(e){return r[21]=r[43]==null?"":r[43]}])},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[5]).then(function(e){var t;return t=e,r[22]=t[0],t})},function(o){return t.nativeOperation(n("LSGetBlobFromString.nop"),[r[22]==null?"":r[22],e[0]].join("")).then(function(e){var t;return t=e,r[23]=t[0],t})},function(e){return r[24]=t.createArray(),r[41]=(r[24].push(t.i64.cast([0,6])),r[24]),t.nativeOperation(n("LSGetBlobFromString.nop"),"epoch_root_key_thread_id_debug").then(function(e){var t;return t=e,r[25]=t[0],t})},function(e){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),r[25],void 0,r[23],r[24]).then(function(e){var t;return t=e,r[26]=t[0],t})},function(e){return r[26]?r[27]=!1:r[27]=!0,r[27]?t.resolve(r[28]=""):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[26],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[41]=t[0],r[42]=t[1],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[41]).then(function(e){var t;return t=e,r[43]=t[0],t})},function(e){return r[28]=r[43]==null?"":r[43]}])},function(e){return r[29]=":",t.blobs.neq(r[5],void 0)?t.sequence([function(e){return r[41]=t.createArray(),r[47]=(r[41].push(t.i64.cast([0,18])),r[41]),t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,r[5],r[41]).then(function(e){var t;return t=e,r[42]=t[0],t})},function(e){return r[42]!==void 0?t.sequence([function(e){return r[47]=t.i64.of_int32(r[42].length),t.i64.ge(r[47],t.i64.cast([0,1]))?t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[42],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[49]=t[0],r[50]=t[1],t})},function(e){return r[48]=r[49]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),r[50]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBFingerprint] ","",r[50]].join("")),r[49]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBFingerprint",r[50],r[49],t.i64.cast([0,3]))},function(e){return r[48]=void 0}])},function(e){return r[43]=r[48]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),r[48]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBFingerprint] ","",r[48]].join("")),r[47]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBFingerprint",r[48],r[47],t.i64.cast([0,3]))},function(e){return r[43]=void 0}])},function(e){return t.blobs.neq(r[43],void 0)?r[44]=!0:r[44]=!1,r[44]||((function(e){t.logger(e).mustfix(e)})("LS::assert is failed. Attempting to coerce a null value to nonnull."),t.throw("LS::assert is failed. Attempting to coerce a null value to nonnull.")),t.nativeOperation(n("LSBase64Encode.nop"),r[43]).then(function(e){var t;return t=e,r[45]=t[0],t})},function(e){return r[45]!==void 0?r[46]=r[45]:r[46]="encodingfailed",r[30]=r[46]}]):t.resolve(r[30]="null")},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[4]).then(function(e){var t;return t=e,r[31]=t[0],t})},function(o){return r[32]=new t.Map,r[32].set("encryption_version",r[3]),r[32].set("epoch_anon_id",r[31]==null?"":r[31]),r[32].set("message_encryption_values",[r[11],r[29],r[16],r[29],r[21],r[29],r[28]].join("")),r[32].set("root_key_fingerprint",r[30]),r[32].set("backup_id",e[1]),r[33]=t.toJSON(r[32]),r[34]=new t.Map,r[34].set("value_secret_ref",r[33]),r[35]=t.i64.of_float(Date.now()),r[36]=t.i64.random(),r[38]="Finishing execution. Execution time: ",r[39]=t.i64.to_string(t.i64.sub(r[35],r[0])),r[40]=" ms",r[37]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][deriveValueSecretRefV2] ",r[37],r[38],r[37],r[39],r[37],r[40]].join("")),t.i64.eq(t.i64.mod_(r[36],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[41]=",",r[42]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"deriveValueSecretRefV2",[r[38],r[41],r[39],r[41],r[40]].join(""),r[42],t.i64.cast([0,4]))):t.resolve()},function(e){var t;return t=[r[34],void 0],o[0]=t[0],o[1]=t[1],t}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsDeriveValueSecretRefV2StoredProcedure",e.__tables__=[],a.exports=e}),null);
__d("LSBinaryToHex.nop",["LSResult","Promise"],(function(t,n,r,o,a,i,l){"use strict";var e,s=function(o,a,i){var t=Array.from(new Uint8Array(i)),l=t.map(function(e){return e.toString(16).padStart(2,"0")}),s=l.join("").toUpperCase();return(e||(e=n("Promise"))).resolve(r("LSResult")(s))};s.__nop_name__="LSBinaryToHex",l.default=s}),98);
__d("LSGetBlobFromInt64BE.nop",["GetBlobFromInt64BE"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t,n,r){return o("GetBlobFromInt64BE").GetBlobFromInt64BE(r)};e.__nop_name__="LSGetBlobFromInt64BE",l.default=e}),98);
__d("LSHmac_v2.nop",["Hmac_v2"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t,n,o,a){return r("Hmac_v2")(o,a)};e.__nop_name__="LSHmac_v2",l.default=e}),98);
__d("LSCryptoUtils",["FBLogger","XPlatReactTextDecoder","XPlatReactTextEncoder"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return new Uint8Array(e)}function s(e){var t=new(o("XPlatReactTextEncoder")).TextEncoder;return t.encode(e)}function u(e){var t=new(o("XPlatReactTextDecoder")).TextDecoder;return t.decode(e)}function c(e){return u(new Uint8Array(e))}function d(e){return s(e).buffer}function m(e,t){var n=e.byteLength,o=t.byteLength;if(n!==o)throw r("FBLogger")("messenger_web").mustfixThrow("[LS] Mismatched lengths for modAdd, %d != %d",n,o);var a=new Uint8Array(n);return new Uint8Array(n).reduceRight(function(n,r,o){var i=e[o],l=t[o],s=i+l+n,u=s>255?[s-256,1]:[s,0];return a[o]=u[0],u[1]},0),a}l.bufToUint8=e,l.strToUint8=s,l.uint8ToStr=u,l.bufToStr=c,l.strToBuf=d,l.modAddBytes=m}),98);
__d("OcmfClientMap",["CryptoLogger","LSCryptoUtils","Promise","requireDeferred","tweetnacl"],(function(t,n,r,o,a,i,l){"use strict";var e,s=r("requireDeferred")("ristretto255").__setRef("OcmfClientMap"),u=function(r,a){var t=o("tweetnacl").hash(o("LSCryptoUtils").bufToUint8(a));return(e||(e=n("Promise"))).all([t,s.load()]).then(function(e){var t=e[0],n=e[1],o=n.fromHash(new Uint8Array(t)),a=n.scalarMult(new Uint8Array(r),o);return a.buffer}).catch(function(e){throw o("CryptoLogger").captureError(o("CryptoLogger").CryptoLogger("ocmf_client_map"),e).mustfix("Failed OcmfClientMap."),e})};l.default=u}),98);
__d("LSOcmfClientMap.nop",["LSResult","OcmfClientMap"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t,n,o,a){return r("OcmfClientMap")(o,a).then(function(e){return r("LSResult")(e)})};e.__nop_name__="LSOcmfClientMap",l.default=e}),98);
__d("UInt8Array",["XPlatReactCrypto"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.length;if(t>0&&t%2===0&&/^[\da-f]+$/gi.test(e)){for(var n=[],r=0,o=t/2|0;r<o;++r){var a=parseInt(e.substring(r<<1,(r<<1)+2|0),16);n.push(a)}return new Uint8Array(n)}}function s(e){return o("XPlatReactCrypto").getRandomValues(new Uint8Array(e)).buffer}function u(e){var t=e.filter(function(e){return e.byteLength!==0}),n=t.reduce(function(e,t){return e+t.byteLength|0},0),r=new Uint8Array(n);return t.reduce(function(e,t){return r.set(t,e),e+t.byteLength|0},0),r}l.fromHexString=e,l.getBufferWithRandomValuesFromLength=s,l.concatBytes=u}),98);
__d("OrderPreservingEncryption",["FBLogger","LSCryptoUtils","Promise","UInt8Array","XPlatReactCrypto"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(){return o("XPlatReactCrypto").getRandomValues(new Uint8Array(32)).buffer}function u(e){var t=e.length;return t%2!==0?"0"+e:e}function c(e){for(var t=BigInt(e),n=u(t.toString(16)),r=n.length,o=r/2,a=[],i=0;i<o;++i)a.push(i*2);return new Uint8Array(a.map(function(e){var t=e+2;return n.slice(e,t)}).map(function(e){return parseInt(e,16)}))}function d(e){var t=e.map(function(e){return e._0});return{_0:o("UInt8Array").concatBytes(t)}}function m(e){return"OPE key has length "+String(e)+", expected  "+String(32)}function p(e,t,n){var r=new ArrayBuffer(0);return o("XPlatReactCrypto").subtleImportKey("raw",e.buffer,"HKDF",!1,["deriveKey","deriveBits"]).then(function(e){return o("XPlatReactCrypto").subtleDeriveBits({hash:"SHA-256",info:t.buffer,name:"HKDF",salt:r},e,n*8)}).then(function(e){return{_0:new Uint8Array(e)}})}function _(e,t){return{_0:o("LSCryptoUtils").modAddBytes(e._0,t)}}function f(t,a,i,l){var s=i.byteLength;if(s!==32)throw r("FBLogger")("wmi_eb").mustfixThrow(m(s));var u=l.byteLength,c=function(t,n){var e=new Uint8Array(1+u),r=new Uint8Array(u-n).fill(0);return e.set([n]),e.set(t.subarray(0,n),1),e.set(r,n+1),e};if(u>=255)throw r("FBLogger")("wmi_eb").mustfixThrow("Input is too large");var f=Array.from(l).map(function(e,n){var r=c(l,n),o=new Uint8Array(t);o[t-1]=e;var a=new Uint8Array(i);return p(a,r,t).then(function(e){return _(e,o)})});return(e||(e=n("Promise"))).all(f).then(function(e){return o("UInt8Array").concatBytes([new Uint8Array([a]),d(e)._0])})}function g(e,t,n,r){var o=c(r);return f(e,t,n,o)}l.keyGen=s,l.intStringToBEBytes=c,l.buildKeyLengthErrorMsg=m,l.encryptBigEndianBytes=f,l.encryptIntString=g}),98);
__d("OpeEncrypt",["CryptoLogger","I64","LSResult","OrderPreservingEncryption"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t,n,a){var i=o("CryptoLogger").CryptoLogger("ope_encrypt");return o("OrderPreservingEncryption").encryptBigEndianBytes((e||(e=o("I64"))).to_int32(a),1,t,new Uint8Array(n)).then(function(e){return r("LSResult")(e.buffer)},function(e){throw o("CryptoLogger").captureError(i,e).mustfix("OpeEncrypt_impl failed"),e})}l.OpeEncrypt=s}),98);
__d("LSOpeEncrypt.nop",["OpeEncrypt"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t,n,r,a,i){return o("OpeEncrypt").OpeEncrypt(r,a,i)};e.__nop_name__="LSOpeEncrypt",l.default=e}),98);
__d("TruncateSortKey",["CryptoLogger","LSResult","Promise"],(function(t,n,r,o,a,i,l){"use strict";var e,s=o("CryptoLogger").CryptoLogger("truncate_sort_key");function u(t){if(t.byteLength!==8)throw s.mustfixThrow("Bad length on sort key for truncation");var o=new Uint8Array(t),a=o.subarray(0,2);if(a.some(function(e){return e!==0}))throw s.mustfixThrow("Bad prefix on sort key for truncation");return(e||(e=n("Promise"))).resolve(r("LSResult")(t.slice(2)))}l.TruncateSortKey=u}),98);
__d("LSTruncateSortKey.nop",["TruncateSortKey"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t,n,r){return o("TruncateSortKey").TruncateSortKey(r)};e.__nop_name__="LSTruncateSortKey",l.default=e}),98);
__d("LSEncryptIdentifiersV2",["LSBase64Encode.nop","LSBinaryToHex.nop","LSGetBlobFromInt64BE.nop","LSGetBlobFromString.nop","LSHmac_v2.nop","LSLogMebClientEvent.nop","LSOcmfClientMap.nop","LSOpeEncrypt.nop","LSTruncateSortKey.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(o){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][encryptIdentifiersV2] Beginning execution."),r[1]=t.i64.of_float(Date.now()),r[2]=e[6].get("ocmf_shared_key"),t.nativeOperation(n("LSGetBlobFromString.nop"),e[2]).then(function(e){var t;return t=e,r[3]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("bWFpbGJveF9pZF9zY29wZQ=="),r[3]).then(function(e){var t;return t=e,r[4]=t[0],t})},function(e){return t.nativeOperation(n("LSOcmfClientMap.nop"),r[2],r[4]).then(function(e){var t;return t=e,r[5]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[5]).then(function(e){var t;return t=e,r[6]=t[0],t})},function(o){return t.i64.eq(e[0],t.i64.cast([0,2]))&&t.i64.eq(e[1],t.i64.cast([0,2]))?r[7]=e[5]:r[7]=e[3],r[8]=e[6].get("ocmf_shared_key"),t.nativeOperation(n("LSGetBlobFromString.nop"),r[7]).then(function(e){var t;return t=e,r[9]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("dGhyZWFkX2lkX3Njb3Bl"),r[9]).then(function(e){var t;return t=e,r[10]=t[0],t})},function(e){return t.nativeOperation(n("LSOcmfClientMap.nop"),r[8],r[10]).then(function(e){var t;return t=e,r[11]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[11]).then(function(e){var t;return t=e,r[12]=t[0],t})},function(o){return r[13]=e[6].get("ope_key"),t.nativeOperation(n("LSGetBlobFromInt64BE.nop"),e[4]).then(function(e){var t;return t=e,r[14]=t[0],t})},function(e){return t.nativeOperation(n("LSTruncateSortKey.nop"),r[14]).then(function(e){var t;return t=e,r[15]=t[0],t})},function(e){return t.nativeOperation(n("LSOpeEncrypt.nop"),r[13],r[15],t.i64.cast([0,16])).then(function(e){var t;return t=e,r[16]=t[0],t})},function(e){return t.nativeOperation(n("LSBinaryToHex.nop"),r[16]).then(function(e){var t;return t=e,r[17]=t[0],t})},function(o){return r[18]=e[6].get("ocmf_shared_key"),t.nativeOperation(n("LSGetBlobFromString.nop"),e[5]).then(function(e){var t;return t=e,r[19]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("bWVzc2FnZV9pZF9zY29wZQ=="),r[19]).then(function(e){var t;return t=e,r[20]=t[0],t})},function(e){return t.nativeOperation(n("LSOcmfClientMap.nop"),r[18],r[20]).then(function(e){var t;return t=e,r[21]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[21]).then(function(e){var t;return t=e,r[22]=t[0],t})},function(e){return r[23]=new t.Map,r[23].set("backup_id_ocmf_partial",r[6]==null?"":r[6]),r[23].set("act_thread_id_ocmf_partial",r[12]==null?"":r[12]),r[23].set("timestamp_encrypted",r[17]==null?"":r[17]),r[23].set("otid_ocmf_partial",r[22]==null?"":r[22]),r[24]=t.i64.of_float(Date.now()),r[25]=t.i64.random(),r[27]="Finishing execution. Execution time: ",r[28]=t.i64.to_string(t.i64.sub(r[24],r[0])),r[29]=" ms",r[26]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][encryptIdentifiersV2] ",r[26],r[27],r[26],r[28],r[26],r[29]].join("")),t.i64.eq(t.i64.mod_(r[25],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[30]=",",r[31]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"encryptIdentifiersV2",[r[27],r[30],r[28],r[30],r[29]].join(""),r[31],t.i64.cast([0,4]))):t.resolve()},function(e){var t;return t=[r[23],void 0],o[0]=t[0],o[1]=t[1],t}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsEncryptIdentifiersV2StoredProcedure",e.__tables__=[],a.exports=e}),null);
__d("SymmetricEncryptionPaddingUtils",["XPlatReactTextEncoder"],(function(t,n,r,o,a,i,l){"use strict";function e(e){if(e<10)return 10-e;var t=Math.floor(Math.log2(e)),n=Math.floor(Math.log2(t))+1,r=t-n,o=(1<<r)-1,a=e+o&(o^-1);return a-e}function s(t){var n=Uint32Array.BYTES_PER_ELEMENT,r=t.byteLength,o=e(r),a=n+r+o,i=new DataView(new ArrayBuffer(a));i.setUint32(0,r);var l=new Uint8Array(i.buffer);return l.set(new Uint8Array(t),n),l.buffer}function u(e){var t=new(o("XPlatReactTextEncoder")).TextEncoder,n=t.encode(e).buffer;return s(n)}function c(e){var t=Uint32Array.BYTES_PER_ELEMENT,n=new DataView(e);if(!(n.byteLength<t)){var r=e.byteLength,o=n.getUint32(0),a=r-t;if(o>=0&&o<=a)return e.slice(t,t+o)}}l.getPaddingLength=e,l.padData=s,l.pad=u,l.stripPadding=c}),98);
__d("SymmetricEncryptionCreateEncryptedData",["CryptoLogger","EncryptedBackupsSymmetricEncryptionUtils","HChaCha20","Promise","RetUtil","SymmetricEncryptionPaddingUtils","XPlatReactCrypto"],(function(t,n,r,o,a,i,l){"use strict";var e,s=function(r,a,i){var t=o("CryptoLogger").CryptoLogger("symmetric_encryption_create_encrypted_data"),l=o("SymmetricEncryptionPaddingUtils").padData(i),s=o("XPlatReactCrypto").getRandomValues(new Uint8Array(o("EncryptedBackupsSymmetricEncryptionUtils").totalNonceLengthInBytes)),u=new(o("HChaCha20")).HChaCha20,c=u.hChaCha20Bytes(s.slice(0,o("EncryptedBackupsSymmetricEncryptionUtils").hChaCha20SubKeyNonceLengthInBytes).buffer,r);return o("XPlatReactCrypto").subtleImportKey("raw",c,"AES-GCM",!1,["encrypt"]).then(function(e){return o("XPlatReactCrypto").subtleEncrypt({additionalData:a,iv:new Uint8Array(s.slice(o("EncryptedBackupsSymmetricEncryptionUtils").hChaCha20SubKeyNonceLengthInBytes).buffer),name:"AES-GCM",tagLength:o("EncryptedBackupsSymmetricEncryptionUtils").aesGcmTagLength},e,l)}).then(function(t){var r=s.byteLength+t.byteLength,a=new Uint8Array(r);return a.set(s),a.set(new Uint8Array(t),o("EncryptedBackupsSymmetricEncryptionUtils").totalNonceLengthInBytes),(e||(e=n("Promise"))).resolve(o("RetUtil").getNullableRetResult(a.buffer))}).catch(function(r){return o("CryptoLogger").captureError(t,r).mustfix("symmetric data encryption failed"),(e||(e=n("Promise"))).resolve(o("RetUtil").getNullableRetResult())})};l.default=s}),98);
__d("LSSymmetricEncryptionCreateEncryptedData.nop",["SymmetricEncryptionCreateEncryptedData"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t,n,o,a,i){return r("SymmetricEncryptionCreateEncryptedData")(o,a,i)};e.__nop_name__="LSSymmetricEncryptionCreateEncryptedData",l.default=e}),98);
__d("LSSymmetricEncryptionCreateEncryptedString.nop",["Base64Utils","CryptoLogger","LSCryptoUtils","LSSymmetricEncryptionCreateEncryptedData.nop","Promise","RetUtil"],(function(t,n,r,o,a,i,l){"use strict";var e,s=function(a,i,l,s,u){var t=o("CryptoLogger").CryptoLogger("symmetric_encryption_create_encrypted_string");return r("LSSymmetricEncryptionCreateEncryptedData.nop")(a,i,l,s,o("LSCryptoUtils").strToBuf(u)).then(function(e){return e[0]}).then(function(t){return(e||(e=n("Promise"))).resolve(o("RetUtil").getNullableRetResult(t?o("Base64Utils").fromArrayBuffer(t):void 0))}).catch(function(r){return o("CryptoLogger").captureError(t,r).mustfix("symmetric string encryption failed"),(e||(e=n("Promise"))).resolve(o("RetUtil").getNullableRetResult())})};s.__nop_name__="LSSymmetricEncryptionCreateEncryptedString",l.default=s}),98);
__d("LSEncryptMessagePayloadV2",["LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDerivedKeys.nop","LSGetBlobFromString.nop","LSLogMebClientEvent.nop","LSSymmetricEncryptionCreateEncryptedString.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(o){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][encryptMessagePayloadV2] Beginning execution."),r[1]=t.i64.of_float(Date.now()),r[2]=e[2].get("message_payload_encryption_keys"),r[3]=r[2].get("payload_key"),t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),r[3],t.blobs.of_string(["message_thread","_",e[1]].join("")),e[3]).then(function(e){var t;return t=e,r[4]=t[0],t})},function(o){var a;return r[4]!==void 0?t.sequence([function(e){return r[13]=r[2].get("encryption_version"),r[14]=r[2].get("epoch_anon_id"),r[15]=r[2].get("epoch_root_key"),r[16]=r[2].get("payload_key"),r[17]=t.createArray(),r[45]=(r[17].push(t.i64.cast([0,6])),r[17]),t.nativeOperation(n("LSGetBlobFromString.nop"),"epoch_anon_id_debug").then(function(e){var t;return t=e,r[18]=t[0],t})},function(e){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),r[18],void 0,r[14],r[17]).then(function(e){var t;return t=e,r[19]=t[0],t})},function(e){return r[19]?r[20]=!1:r[20]=!0,r[20]?t.resolve(r[21]=""):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[19],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[45]=t[0],r[46]=t[1],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[45]).then(function(e){var t;return t=e,r[47]=t[0],t})},function(e){return r[21]=r[47]==null?"":r[47]}])},function(e){return r[22]=t.createArray(),r[45]=(r[22].push(t.i64.cast([0,6])),r[22]),t.nativeOperation(n("LSGetBlobFromString.nop"),"epoch_root_key_debug").then(function(e){var t;return t=e,r[23]=t[0],t})},function(e){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),r[23],void 0,r[15],r[22]).then(function(e){var t;return t=e,r[24]=t[0],t})},function(e){return r[24]?r[25]=!1:r[25]=!0,r[25]?t.resolve(r[26]=""):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[24],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[45]=t[0],r[46]=t[1],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[45]).then(function(e){var t;return t=e,r[47]=t[0],t})},function(e){return r[26]=r[47]==null?"":r[47]}])},function(e){return r[27]=t.createArray(),r[45]=(r[27].push(t.i64.cast([0,6])),r[27]),t.nativeOperation(n("LSGetBlobFromString.nop"),"message_key_debug").then(function(e){var t;return t=e,r[28]=t[0],t})},function(e){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),r[28],void 0,r[16],r[27]).then(function(e){var t;return t=e,r[29]=t[0],t})},function(e){return r[29]?r[30]=!1:r[30]=!0,r[30]?t.resolve(r[31]=""):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[29],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[45]=t[0],r[46]=t[1],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[45]).then(function(e){var t;return t=e,r[47]=t[0],t})},function(e){return r[31]=r[47]==null?"":r[47]}])},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[15]).then(function(e){var t;return t=e,r[32]=t[0],t})},function(o){return t.nativeOperation(n("LSGetBlobFromString.nop"),[r[32]==null?"":r[32],e[1]].join("")).then(function(e){var t;return t=e,r[33]=t[0],t})},function(e){return r[34]=t.createArray(),r[45]=(r[34].push(t.i64.cast([0,6])),r[34]),t.nativeOperation(n("LSGetBlobFromString.nop"),"epoch_root_key_thread_id_debug").then(function(e){var t;return t=e,r[35]=t[0],t})},function(e){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),r[35],void 0,r[33],r[34]).then(function(e){var t;return t=e,r[36]=t[0],t})},function(e){return r[36]?r[37]=!1:r[37]=!0,r[37]?t.resolve(r[38]=""):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[36],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[45]=t[0],r[46]=t[1],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[45]).then(function(e){var t;return t=e,r[47]=t[0],t})},function(e){return r[38]=r[47]==null?"":r[47]}])},function(e){return r[39]=":",t.blobs.neq(r[15],void 0)?t.sequence([function(e){return r[45]=t.createArray(),r[51]=(r[45].push(t.i64.cast([0,18])),r[45]),t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,r[15],r[45]).then(function(e){var t;return t=e,r[46]=t[0],t})},function(e){return r[46]!==void 0?t.sequence([function(e){return r[51]=t.i64.of_int32(r[46].length),t.i64.ge(r[51],t.i64.cast([0,1]))?t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[46],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[53]=t[0],r[54]=t[1],t})},function(e){return r[52]=r[53]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),r[54]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBFingerprint] ","",r[54]].join("")),r[53]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBFingerprint",r[54],r[53],t.i64.cast([0,3]))},function(e){return r[52]=void 0}])},function(e){return r[47]=r[52]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),r[52]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBFingerprint] ","",r[52]].join("")),r[51]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBFingerprint",r[52],r[51],t.i64.cast([0,3]))},function(e){return r[47]=void 0}])},function(e){return t.blobs.neq(r[47],void 0)?r[48]=!0:r[48]=!1,r[48]||((function(e){t.logger(e).mustfix(e)})("LS::assert is failed. Attempting to coerce a null value to nonnull."),t.throw("LS::assert is failed. Attempting to coerce a null value to nonnull.")),t.nativeOperation(n("LSBase64Encode.nop"),r[47]).then(function(e){var t;return t=e,r[49]=t[0],t})},function(e){return r[49]!==void 0?r[50]=r[49]:r[50]="encodingfailed",r[40]=r[50]}]):t.resolve(r[40]="null")},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[14]).then(function(e){var t;return t=e,r[41]=t[0],t})},function(n){var o;return r[42]=new t.Map,r[42].set("encryption_version",r[13]),r[42].set("epoch_anon_id",r[41]==null?"":r[41]),r[42].set("message_encryption_values",[r[21],r[39],r[26],r[39],r[31],r[39],r[38]].join("")),r[42].set("root_key_fingerprint",r[40]),r[42].set("backup_id",e[0]),r[43]=t.toJSON(r[42]),r[44]=new t.Map,r[44].set("encrypted_message_payload",r[4]),r[44].set("value_secret_ref",r[43]),o=[r[44],void 0],r[5]=o[0],r[6]=o[1]}]):t.resolve((r[13]=new t.Map,r[13].set("error_code",t.i64.cast([0,40])),r[13].set("stored_procedure","LSEncryptedBackupsEncryptMessagePayloadV2StoredProcedure"),r[13].set("error_message",""),a=[void 0,r[13]],r[5]=a[0],r[6]=a[1]))},function(e){return r[7]=t.i64.of_float(Date.now()),r[8]=t.i64.random(),r[10]="Finishing execution. Execution time: ",r[11]=t.i64.to_string(t.i64.sub(r[7],r[0])),r[12]=" ms",r[9]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][encryptMessagePayloadV2] ",r[9],r[10],r[9],r[11],r[9],r[12]].join("")),t.i64.eq(t.i64.mod_(r[8],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[13]=",",r[14]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"encryptMessagePayloadV2",[r[10],r[13],r[11],r[13],r[12]].join(""),r[14],t.i64.cast([0,4]))):t.resolve()},function(e){var t;return t=[r[5],r[6]],o[0]=t[0],o[1]=t[1],t}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsEncryptMessagePayloadV2StoredProcedure",e.__tables__=[],a.exports=e}),null);
__d("LSGetLatestEpochKeys",["LSLogMebClientEvent.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(n){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][getLatestEpochKeys] Beginning execution."),r[1]=t.i64.of_float(Date.now()),r[2]="",r[3]=void 0,r[4]=void 0,r[5]=void 0,e[0]?t.resolve(0):(r[15]=void 0,t.i64.neq(r[15],void 0)?t.sequence([function(e){return t.count(t.db.table(169).fetch([[[r[15]]]])).then(function(e){return r[16]=e})},function(e){return t.i64.le(r[16],t.i64.cast([0,1]))?t.sequence([function(e){return t.db.table(169).fetch([[[r[15]]]]).next().then(function(e,n){var o,a,i=e.done,l=e.value;return i?(r[26]=new t.Map,r[26].set("error_msg","Expected a nonempty query result"),r[26].set("code",t.i64.cast([0,3])),r[26].set("src_line","MEBEpochClientUtils.php:313 MEBEpochClientUtils::requireEpochReturnShapeFromPersistentEpochsTableDirectly()"),r[27]=t.createArray(),r[28]=(r[27].push(r[26]),r[27]),o=[void 0,r[27]],r[22]=o[0],r[23]=o[1]):(n=l.item,r[26]=new t.Map,r[26].set("epoch_id",n.epochId),r[26].set("backup_id",n.backupId),r[26].set("epoch_anon_id_blob",n.epochAnonIdBlob),r[26].set("epoch_root_key_blob",n.epochRootKeyBlob),r[26].set("epoch_status",n.epochStatus),r[26].set("epoch_head",n.epochHead),r[26].set("authority_level",n.authorityLevel),a=[r[26],void 0],r[22]=a[0],r[23]=a[1])})},function(e){return r[25]=new t.Map,r[25].set("value",r[22]),r[25].set("errors",r[23]),r[17]=r[25]}]):t.resolve((r[22]=new t.Map,r[22].set("error_msg","Expected at most one result"),r[22].set("code",t.i64.cast([0,4])),r[22].set("src_line","MEBEpochClientUtils.php:313 MEBEpochClientUtils::requireEpochReturnShapeFromPersistentEpochsTableDirectly()"),r[23]=t.createArray(),r[25]=(r[23].push(r[22]),r[23]),r[24]=new t.Map,r[24].set("value",void 0),r[24].set("errors",r[23]),r[17]=r[24]))},function(e){return r[18]=r[17].get("value"),r[18]!==void 0?(r[22]=r[18].get("epoch_id"),r[23]=r[18].get("backup_id"),r[24]=r[18].get("epoch_anon_id_blob"),r[25]=r[18].get("epoch_root_key_blob"),r[26]=r[18].get("epoch_status"),r[27]=r[18].get("epoch_head"),r[28]=r[18].get("authority_level"),r[29]=r[17],r[19]=r[29]):(r[22]=r[17].get("errors"),r[23]=r[17].get("errors"),r[24]=new t.Map,r[24].set("value",void 0),r[24].set("errors",r[22]),r[19]=r[24]),r[20]=r[19].get("value"),r[20]!==void 0?(r[22]=r[20].get("epoch_id"),r[23]=r[20].get("backup_id"),r[24]=r[20].get("epoch_anon_id_blob"),r[25]=r[20].get("epoch_root_key_blob"),r[26]=r[20].get("epoch_status"),r[27]=r[20].get("epoch_head"),r[28]=r[20].get("authority_level"),r[2]=t.blobs.to_string(r[24]),r[3]=r[22],r[4]=r[25],t.blobs.neq(r[27],void 0)&&(r[5]=r[27]),r[21]=!0):(r[22]=r[19].get("errors"),r[23]=r[19].get("errors"),r[21]=!1)}]):t.resolve())},function(n){return t.i64.neq(r[3],void 0)?t.resolve(0):t.sequence([function(n){return r[15]=void 0,r[16]="",r[17]=void 0,r[18]=void 0,t.forEach(t.filter(t.db.table(169).fetch(),function(n){return e[0]||t.i64.eq(n.authorityLevel,t.i64.cast([0,80]))}),function(e){var n=e.item;return r[20]=t.blobs.to_string(n.epochAnonIdBlob),t.i64.eq([0,r[20].length],[0,r[16].length])?r[19]=r[20]>r[16]:r[19]=t.i64.gt([0,r[20].length],[0,r[16].length]),r[19]?(r[15]=n.epochId,r[16]=r[20],r[17]=n.epochRootKeyBlob,r[18]=n.epochHead):0})},function(e){return t.i64.neq(r[15],void 0)&&(r[2]=r[16],r[3]=r[15],r[4]=r[17],t.blobs.neq(r[18],void 0)&&(r[5]=r[18]),r[19]=t.i64.of_float(Date.now())),0}])},function(e){var o,a,i,l,s,u;return r[11]=t.blobs.of_string(r[2]),t.i64.neq(r[3],void 0)?(t.blobs.neq(r[11],void 0)?(t.blobs.neq(r[4],void 0)?(r[19]=new t.Map,r[19].set("epoch_id",r[3]),r[19].set("epoch_root_key",r[4]),r[19].set("epoch_anon_id",r[11]),r[19].set("epoch_head",r[5]),r[20]=new t.Map,r[20].set("epoch_keys",r[19]),o=[r[20],void 0],r[17]=o[0],r[18]=o[1]):(r[19]=new t.Map,r[19].set("error_code",t.i64.cast([0,402])),r[19].set("error_message","failed to query latest epoch"),r[19].set("stored_procedure","LSEncryptedBackupsGetLatestEpochKeysStoredProcedure"),a=[void 0,r[19]],r[17]=a[0],r[18]=a[1]),i=[r[17],r[18]],r[15]=i[0],r[16]=i[1]):(r[17]=new t.Map,r[17].set("error_code",t.i64.cast([0,403])),r[17].set("error_message","failed to query latest epoch"),r[17].set("stored_procedure","LSEncryptedBackupsGetLatestEpochKeysStoredProcedure"),l=[void 0,r[17]],r[15]=l[0],r[16]=l[1]),s=[r[15],r[16]],r[6]=s[0],r[7]=s[1]):(r[15]=new t.Map,r[15].set("error_code",t.i64.cast([0,400])),r[15].set("error_message","failed to query latest epoch"),r[15].set("stored_procedure","LSEncryptedBackupsGetLatestEpochKeysStoredProcedure"),u=[void 0,r[15]],r[6]=u[0],r[7]=u[1]),r[8]=t.i64.of_float(Date.now()),r[9]=t.i64.random(),r[12]="Finishing execution. Execution time: ",r[13]=t.i64.to_string(t.i64.sub(r[8],r[0])),r[14]=" ms",r[10]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][getLatestEpochKeys] ",r[10],r[12],r[10],r[13],r[10],r[14]].join("")),t.i64.eq(t.i64.mod_(r[9],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[15]=",",r[16]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"getLatestEpochKeys",[r[12],r[15],r[13],r[15],r[14]].join(""),r[16],t.i64.cast([0,4]))):t.resolve()},function(e){var t;return t=[r[6],r[7]],o[0]=t[0],o[1]=t[1],t}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsGetLatestEpochKeysStoredProcedure",e.__tables__=["secure_encrypted_backups_epochs"],a.exports=e}),null);
__d("LSLoadAndEncryptProtobufWithInputsV2",["LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDerivedKeys.nop","LSGetBlobFromString.nop","LSHmac_v2.nop","LSLogMebClientEvent.nop","LSQueryLocalPersistenceStoreForBackup.nop","LSQueryLocalPersistenceStoreSupplementalForBackup.nop","LSQueryLocalPersistenceStoreTagsForBackup.nop","LSSymmetricEncryptionCreateEncryptedData.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(o){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][loadAndEncryptProtobufWithInputsV2] Beginning execution."),r[1]=t.i64.of_float(Date.now()),t.i64.eq(e[0],t.i64.cast([0,1]))?t.sequence([function(o){return t.nativeOperation(n("LSQueryLocalPersistenceStoreForBackup.nop"),e[1],e[2]).then(function(e){var t;return t=e,r[10]=t[0],r[11]=t[1],r[12]=t[2],t})},function(o){return t.nativeOperation(n("LSQueryLocalPersistenceStoreTagsForBackup.nop"),e[1],e[2]).then(function(e){var t;return t=e,r[13]=t[0],t})},function(o){var a,i,l;return r[14]=new t.Map,r[14].set("message_tags",r[13]),r[15]=new t.Map,r[15].set("mt",r[14]),t.blobs.neq(r[10],void 0)?t.sequence([function(o){return r[18]=e[5].get("message_payload_encryption_keys"),r[19]=r[18].get("payload_key"),t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedData.nop"),r[19],t.blobs.of_string(["message_thread","_",e[1]].join("")),r[10]).then(function(e){var t;return t=e,r[20]=t[0],t})},function(e){return t.blobs.neq(r[20],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[20]).then(function(e){var t;return t=e,r[24]=t[0],t})},function(e){return r[21]=r[24]}]):t.resolve(r[21]=void 0)},function(o){var a;return r[21]!==void 0?t.sequence([function(e){return r[15]!==void 0?t.sequence([function(e){return r[27]=r[15].get("mt"),r[27]?r[28]=!1:r[28]=!0,r[28]?t.resolve(r[29]=void 0):t.sequence([function(e){return r[31]=new t.Map,r[32]=r[27].keys(),r[33]=t.i64.of_int32(r[32].length),t.i64.gt(r[33],t.i64.cast([0,0]))?t.loopAsync(r[33],function(e){return r[34]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[32],r[34]).then(function(e){var t;return t=e,r[35]=t[0],r[36]=t[1],t})},function(e){return r[37]=r[27].get(r[35]),r[31].set(r[35],r[37])}])}):t.resolve()},function(e){return r[29]=r[31]}])},function(e){return r[29]!==void 0?(r[31]=t.toJSON(r[29]),r[30]=r[31]):r[30]=void 0,r[24]=r[30]}]):t.resolve(r[24]=void 0)},function(n){var o;return r[15]!==void 0?(r[27]=r[15].get("mooos"),r[25]=r[27]):r[25]=void 0,r[26]=new t.Map,r[26].set("backup_action",e[0]),r[26].set("protobuf_encrypted",r[21]),r[26].set("supplemental_data_encrypted",void 0),r[26].set("timestamp_ms",e[4]),r[26].set("message_tags",r[24]),r[26].set("serialized_attachment_backup_payload",void 0),r[26].set("maybe_ooo_supplemental_upload",r[25]),o=[r[26],void 0],r[22]=o[0],r[23]=o[1]}]):t.resolve(((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error PROTOBUF_ENCRYPTION_FAILED"),r[24]=new t.Map,r[24].set("error_code",t.i64.cast([0,62])),r[24].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),r[24].set("error_message",""),a=[void 0,r[24]],r[22]=a[0],r[23]=a[1]))},function(e){var t;return t=[r[22],r[23]],r[16]=t[0],r[17]=t[1],t}]):t.resolve((r[12]?((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error PROTOBUF_ALREADY_DELETED"),r[20]=new t.Map,r[20].set("error_code",t.i64.cast([0,70])),r[20].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),r[20].set("error_message",""),a=[void 0,r[20]],r[18]=a[0],r[19]=a[1]):((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error PROTOBUF_NOT_FOUND_IN_TOPLEVEL_TABLE"),r[20]=new t.Map,r[20].set("error_code",t.i64.cast([0,63])),r[20].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),r[20].set("error_message",""),i=[void 0,r[20]],r[18]=i[0],r[19]=i[1]),l=[r[18],r[19]],r[16]=l[0],r[17]=l[1]))},function(e){var t;return t=[r[16],r[17]],r[2]=t[0],r[3]=t[1],t}]):t.sequence([function(o){return t.i64.eq(e[0],t.i64.cast([0,2]))?t.sequence([function(o){var a;return e[3]!==void 0?t.sequence([function(o){return t.nativeOperation(n("LSQueryLocalPersistenceStoreSupplementalForBackup.nop"),e[1],e[2],e[3]).then(function(e){var t;return t=e,r[14]=t[0],r[15]=t[1],t})},function(o){return t.nativeOperation(n("LSQueryLocalPersistenceStoreTagsForBackup.nop"),e[1],e[2]).then(function(e){var t;return t=e,r[16]=t[0],t})},function(o){var a;return r[17]=new t.Map,r[17].set("message_tags",r[16]),r[18]=new t.Map,r[18].set("mt",r[17]),t.blobs.neq(r[14],void 0)?t.sequence([function(o){var a;return e[3]!==void 0?t.sequence([function(o){var a;return r[23]=e[5].get("mailbox_root_key_v2"),t.blobs.neq(r[23],void 0)?t.sequence([function(o){return r[26]=e[5].get("message_payload_encryption_keys"),r[27]=r[26].get("epoch_root_key"),r[28]=t.createArray(),r[41]=(r[28].push(t.i64.cast([0,32])),r[28]),t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blob("a2RmX2luZm86bWFpbGJveF9yb290X2tleV92Mj5zdXBwbGVtZW50YWxfcHJmX2tleQ=="),void 0,r[23],r[28]).then(function(e){var t;return t=e,r[29]=t[0],t})},function(e){return r[29]!==void 0?t.sequence([function(e){return r[41]=t.i64.of_int32(r[29].length),t.i64.ge(r[41],t.i64.cast([0,1]))?t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[29],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[43]=t[0],r[44]=t[1],t})},function(e){return r[42]=r[43]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),r[44]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoUtils] ","",r[44]].join("")),r[43]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoUtils",r[44],r[43],t.i64.cast([0,3]))},function(e){return r[42]=void 0}])},function(e){return r[30]=r[42]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),r[42]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoUtils] ","",r[42]].join("")),r[41]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoUtils",r[42],r[41],t.i64.cast([0,3]))},function(e){return r[30]=void 0}])},function(e){return t.blobs.neq(r[30],void 0)?r[31]=!0:r[31]=!1,r[31]||((function(e){t.logger(e).mustfix(e)})("LS::assert is failed. Attempting to coerce a null value to nonnull."),t.throw("LS::assert is failed. Attempting to coerce a null value to nonnull.")),r[32]=t.createArray(),r[41]=(r[32].push(t.i64.cast([0,32])),r[32]),t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blob("a2RmX2luZm86bWFpbGJveF9yb290X2tleV92Mj5zdXBwbGVtZW50YWxfZW5jX2tleQ=="),void 0,r[27],r[32]).then(function(e){var t;return t=e,r[33]=t[0],t})},function(e){return r[33]!==void 0?t.sequence([function(e){return r[41]=t.i64.of_int32(r[33].length),t.i64.ge(r[41],t.i64.cast([0,1]))?t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[33],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[43]=t[0],r[44]=t[1],t})},function(e){return r[42]=r[43]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),r[44]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoUtils] ","",r[44]].join("")),r[43]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoUtils",r[44],r[43],t.i64.cast([0,3]))},function(e){return r[42]=void 0}])},function(e){return r[34]=r[42]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),r[42]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoUtils] ","",r[42]].join("")),r[41]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoUtils",r[42],r[41],t.i64.cast([0,3]))},function(e){return r[34]=void 0}])},function(o){return t.blobs.neq(r[34],void 0)?r[35]=!0:r[35]=!1,r[35]||((function(e){t.logger(e).mustfix(e)})("LS::assert is failed. Attempting to coerce a null value to nonnull."),t.throw("LS::assert is failed. Attempting to coerce a null value to nonnull.")),t.nativeOperation(n("LSGetBlobFromString.nop"),e[3]).then(function(e){var t;return t=e,r[36]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),r[30],r[36]).then(function(e){var t;return t=e,r[37]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedData.nop"),r[34],t.blob("c3VwcGxlbWVudGFsX2VuY19hYWQ="),r[36]).then(function(e){var t;return t=e,r[38]=t[0],t})},function(o){var a;return t.blobs.neq(r[38],void 0)?t.sequence([function(o){return r[41]=new t.Map,r[41].set("sk_ciphertext",r[38]),r[41].set("sk_hash",r[37]),r[42]=e[5].get("message_payload_encryption_keys"),r[43]=r[42].get("payload_key"),t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedData.nop"),r[43],t.blobs.of_string(["message_thread","_",e[1]].join("")),r[14]).then(function(e){var t;return t=e,r[44]=t[0],t})},function(e){return t.blobs.neq(r[44],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[44]).then(function(e){var t;return t=e,r[48]=t[0],t})},function(e){return r[45]=r[48]}]):t.resolve(r[45]=void 0)},function(o){var a;return r[45]!==void 0?t.sequence([function(e){return r[18]!==void 0?t.sequence([function(e){return r[51]=r[18].get("mt"),r[51]?r[52]=!1:r[52]=!0,r[52]?t.resolve(r[53]=void 0):t.sequence([function(e){return r[55]=new t.Map,r[56]=r[51].keys(),r[57]=t.i64.of_int32(r[56].length),t.i64.gt(r[57],t.i64.cast([0,0]))?t.loopAsync(r[57],function(e){return r[58]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[56],r[58]).then(function(e){var t;return t=e,r[59]=t[0],r[60]=t[1],t})},function(e){return r[61]=r[51].get(r[59]),r[55].set(r[59],r[61])}])}):t.resolve()},function(e){return r[53]=r[55]}])},function(e){return r[53]!==void 0?(r[55]=t.toJSON(r[53]),r[54]=r[55]):r[54]=void 0,r[48]=r[54]}]):t.resolve(r[48]=void 0)},function(n){var o;return r[18]!==void 0?(r[51]=r[18].get("mooos"),r[49]=r[51]):r[49]=void 0,r[50]=new t.Map,r[50].set("backup_action",e[0]),r[50].set("protobuf_encrypted",r[45]),r[50].set("supplemental_data_encrypted",r[41]),r[50].set("timestamp_ms",e[4]),r[50].set("message_tags",r[48]),r[50].set("serialized_attachment_backup_payload",void 0),r[50].set("maybe_ooo_supplemental_upload",r[49]),o=[r[50],void 0],r[46]=o[0],r[47]=o[1]}]):t.resolve(((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error PROTOBUF_ENCRYPTION_FAILED"),r[48]=new t.Map,r[48].set("error_code",t.i64.cast([0,62])),r[48].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),r[48].set("error_message",""),a=[void 0,r[48]],r[46]=a[0],r[47]=a[1]))},function(e){var t;return t=[r[46],r[47]],r[39]=t[0],r[40]=t[1],t}]):t.resolve(((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error SUPPLEMENTAL_ENCRYPTION_FAILED"),r[41]=new t.Map,r[41].set("error_code",t.i64.cast([0,66])),r[41].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),r[41].set("error_message",""),a=[void 0,r[41]],r[39]=a[0],r[40]=a[1]))},function(e){var t;return t=[r[39],r[40]],r[24]=t[0],r[25]=t[1],t}]):t.resolve(((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error NULL_MAILBOX_ROOT_KEY_V2"),r[26]=new t.Map,r[26].set("error_code",t.i64.cast([0,27])),r[26].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),r[26].set("error_message",""),a=[void 0,r[26]],r[24]=a[0],r[25]=a[1]))},function(e){var t;return t=[r[24],r[25]],r[21]=t[0],r[22]=t[1],t}]):t.resolve(((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error SUPPLEMENTAL_KEY_NOT_SET_IN_CONTEXT_TABLE"),r[23]=new t.Map,r[23].set("error_code",t.i64.cast([0,65])),r[23].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),r[23].set("error_message",""),a=[void 0,r[23]],r[21]=a[0],r[22]=a[1]))},function(e){var t;return t=[r[21],r[22]],r[19]=t[0],r[20]=t[1],t}]):t.resolve(((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error PROTOBUF_NOT_FOUND_IN_SUPPLEMENTAL_TABLE"),r[21]=new t.Map,r[21].set("error_code",t.i64.cast([0,64])),r[21].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),r[21].set("error_message",""),a=[void 0,r[21]],r[19]=a[0],r[20]=a[1]))},function(e){var t;return t=[r[19],r[20]],r[12]=t[0],r[13]=t[1],t}]):t.resolve(((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error SUPPLEMENTAL_KEY_NOT_SET_IN_CONTEXT_TABLE"),r[14]=new t.Map,r[14].set("error_code",t.i64.cast([0,65])),r[14].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),r[14].set("error_message",""),a=[void 0,r[14]],r[12]=a[0],r[13]=a[1]))},function(e){var t;return t=[r[12],r[13]],r[10]=t[0],r[11]=t[1],t}]):t.sequence([function(o){return t.i64.eq(e[0],t.i64.cast([0,4]))?t.sequence([function(o){return t.nativeOperation(n("LSQueryLocalPersistenceStoreForBackup.nop"),e[1],e[2]).then(function(e){var t;return t=e,r[14]=t[0],r[15]=t[1],r[16]=t[2],t})},function(o){return t.nativeOperation(n("LSQueryLocalPersistenceStoreTagsForBackup.nop"),e[1],e[2]).then(function(e){var t;return t=e,r[17]=t[0],t})},function(o){var a,i,l;return r[18]=new t.Map,r[18].set("message_tags",r[17]),r[19]=new t.Map,r[19].set("mt",r[18]),t.blobs.neq(r[14],void 0)?t.sequence([function(o){return r[22]=e[5].get("message_payload_encryption_keys"),r[23]=r[22].get("payload_key"),t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedData.nop"),r[23],t.blobs.of_string(["message_thread","_",e[1]].join("")),r[14]).then(function(e){var t;return t=e,r[24]=t[0],t})},function(e){return t.blobs.neq(r[24],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[24]).then(function(e){var t;return t=e,r[28]=t[0],t})},function(e){return r[25]=r[28]}]):t.resolve(r[25]=void 0)},function(o){var a;return r[25]!==void 0?t.sequence([function(e){return r[19]!==void 0?t.sequence([function(e){return r[31]=r[19].get("mt"),r[31]?r[32]=!1:r[32]=!0,r[32]?t.resolve(r[33]=void 0):t.sequence([function(e){return r[35]=new t.Map,r[36]=r[31].keys(),r[37]=t.i64.of_int32(r[36].length),t.i64.gt(r[37],t.i64.cast([0,0]))?t.loopAsync(r[37],function(e){return r[38]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[36],r[38]).then(function(e){var t;return t=e,r[39]=t[0],r[40]=t[1],t})},function(e){return r[41]=r[31].get(r[39]),r[35].set(r[39],r[41])}])}):t.resolve()},function(e){return r[33]=r[35]}])},function(e){return r[33]!==void 0?(r[35]=t.toJSON(r[33]),r[34]=r[35]):r[34]=void 0,r[28]=r[34]}]):t.resolve(r[28]=void 0)},function(n){var o;return r[19]!==void 0?(r[31]=r[19].get("mooos"),r[29]=r[31]):r[29]=void 0,r[30]=new t.Map,r[30].set("backup_action",e[0]),r[30].set("protobuf_encrypted",r[25]),r[30].set("supplemental_data_encrypted",void 0),r[30].set("timestamp_ms",e[4]),r[30].set("message_tags",r[28]),r[30].set("serialized_attachment_backup_payload",void 0),r[30].set("maybe_ooo_supplemental_upload",r[29]),o=[r[30],void 0],r[26]=o[0],r[27]=o[1]}]):t.resolve(((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error PROTOBUF_ENCRYPTION_FAILED"),r[28]=new t.Map,r[28].set("error_code",t.i64.cast([0,62])),r[28].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),r[28].set("error_message",""),a=[void 0,r[28]],r[26]=a[0],r[27]=a[1]))},function(e){var t;return t=[r[26],r[27]],r[20]=t[0],r[21]=t[1],t}]):t.resolve((r[16]?((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error PROTOBUF_ALREADY_DELETED"),r[24]=new t.Map,r[24].set("error_code",t.i64.cast([0,70])),r[24].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),r[24].set("error_message",""),a=[void 0,r[24]],r[22]=a[0],r[23]=a[1]):((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error PROTOBUF_NOT_FOUND_IN_TOPLEVEL_TABLE"),r[24]=new t.Map,r[24].set("error_code",t.i64.cast([0,63])),r[24].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),r[24].set("error_message",""),i=[void 0,r[24]],r[22]=i[0],r[23]=i[1]),l=[r[22],r[23]],r[20]=l[0],r[21]=l[1]))},function(e){var t;return t=[r[20],r[21]],r[12]=t[0],r[13]=t[1],t}]):t.sequence([function(n){var o;return t.i64.eq(e[0],t.i64.cast([0,3]))?t.sequence([function(e){return t.resolve(r[16]=void 0)},function(n){var o;return r[17]=void 0,r[18]=new t.Map,r[18].set("backup_action",e[0]),r[18].set("protobuf_encrypted",void 0),r[18].set("supplemental_data_encrypted",void 0),r[18].set("timestamp_ms",e[4]),r[18].set("message_tags",r[16]),r[18].set("serialized_attachment_backup_payload",void 0),r[18].set("maybe_ooo_supplemental_upload",r[17]),o=[r[18],void 0],r[14]=o[0],r[15]=o[1]}]):t.resolve(((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error UNKNOWN_PROTOBUF_TYPE"),r[16]=new t.Map,r[16].set("error_code",t.i64.cast([0,60])),r[16].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),r[16].set("error_message",""),o=[void 0,r[16]],r[14]=o[0],r[15]=o[1]))},function(e){var t;return t=[r[14],r[15]],r[12]=t[0],r[13]=t[1],t}])},function(e){var t;return t=[r[12],r[13]],r[10]=t[0],r[11]=t[1],t}])},function(e){var t;return t=[r[10],r[11]],r[2]=t[0],r[3]=t[1],t}])},function(e){return r[4]=t.i64.of_float(Date.now()),r[5]=t.i64.random(),r[7]="Finishing execution. Execution time: ",r[8]=t.i64.to_string(t.i64.sub(r[4],r[0])),r[9]=" ms",r[6]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][loadAndEncryptProtobufWithInputsV2] ",r[6],r[7],r[6],r[8],r[6],r[9]].join("")),t.i64.eq(t.i64.mod_(r[5],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[10]=",",r[11]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"loadAndEncryptProtobufWithInputsV2",[r[7],r[10],r[8],r[10],r[9]].join(""),r[11],t.i64.cast([0,4]))):t.resolve()},function(e){var t;return t=[r[2],r[3]],o[0]=t[0],o[1]=t[1],t}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure",e.__tables__=[],a.exports=e}),null);
__d("LSLoadAndEncryptProtobufV2",["LSLoadAndEncryptProtobufWithInputsV2","LSLogMebClientEvent.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(o){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][loadAndEncryptProtobufV2] Beginning execution."),r[1]=t.i64.of_float(Date.now()),t.filter(t.db.table(305).fetch(),function(n){return t.i64.eq(n.pendingBackupTaskId,e[0])}).next().then(function(o,a){var i,l=o.done,s=o.value;return l?((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufV2StoredProcedure] Returning error PROTOBUF_CONTEXT_ROW_NOT_FOUND"),r[11]=new t.Map,r[11].set("error_code",t.i64.cast([0,67])),r[11].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufV2StoredProcedure"),r[11].set("error_message",""),i=[void 0,r[11]],r[2]=i[0],r[3]=i[1]):(a=s.item,t.sequence([function(o){return t.storedProcedure(n("LSLoadAndEncryptProtobufWithInputsV2"),a.backupAction,e[2],a.toplevelOfflineThreadingId,a.supplementalKey,a.messageTimestampMs,e[1]).then(function(e){var t;return t=e,r[11]=t[0],r[12]=t[1],t})},function(e){var t;return t=[r[11],r[12]],r[2]=t[0],r[3]=t[1],t}]))})},function(e){return r[5]=t.i64.of_float(Date.now()),r[6]=t.i64.random(),r[8]="Finishing execution. Execution time: ",r[9]=t.i64.to_string(t.i64.sub(r[5],r[0])),r[10]=" ms",r[7]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][loadAndEncryptProtobufV2] ",r[7],r[8],r[7],r[9],r[7],r[10]].join("")),t.i64.eq(t.i64.mod_(r[6],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[11]=",",r[12]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"loadAndEncryptProtobufV2",[r[8],r[11],r[9],r[11],r[10]].join(""),r[12],t.i64.cast([0,4]))):t.resolve()},function(e){var t;return t=[r[2],r[3]],o[0]=t[0],o[1]=t[1],t}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsLoadAndEncryptProtobufV2StoredProcedure",e.__tables__=["pending_protobuf_backups_context"],a.exports=e}),null);
__d("LSLogWebQpl.nop",["requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e=r("requireDeferred")("LogWebQplNOP").__setRef("LSLogWebQpl.nop"),s=function(n,r,o,a,i,l,s,u){return e.load().then(function(e){return e.call(o,a,i,l,s,u)})};s.__nop_name__="LSLogWebQpl",l.default=s}),98);
__d("LSQplAnnotateBool.nop",["EBMarkerIdToQPLEvent","Promise","QPLUserFlow","WAHashStringToNumber","nullthrows"],(function(t,n,r,o,a,i,l){"use strict";var e,s=function(a,i,l,s,u,c){try{var t,d=r("nullthrows")(o("EBMarkerIdToQPLEvent").markerIdToQPLEvent(l)),m=o("WAHashStringToNumber").hashStringToNumber(s);return r("QPLUserFlow").addAnnotations(d,{bool:(t={},t[u]=c,t)},{instanceKey:m}),(e||(e=n("Promise"))).resolve()}catch(t){return(e||(e=n("Promise"))).resolve()}};s.__nop_name__="LSQplAnnotateBool",l.default=s}),98);
__d("LSSerializeBackupPayloadV2",["LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDerivedKeys.nop","LSDeriveValueSecretRefV2","LSEncryptIdentifiersV2","LSEncryptMessagePayloadV2","LSGetBlobFromString.nop","LSGetLatestEpochKeys","LSIsEncryptionVersionSecure","LSLoadAndEncryptProtobufV2","LSLogMebClientEvent.nop","LSLogWebQpl.nop","LSQplAnnotateBool.nop","LSQplAnnotateString.nop","LSQplMarkEnd.nop","LSQplMarkPoint.nop","LSQplStartTrace.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(n){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][serializeBackupPayloadV2] Beginning execution."),r[1]=t.i64.of_float(Date.now()),r[19]=t.i64.mul(r[1],t.i64.cast([0,1e6])),r[2]=t.i64.random(),r[6]=t.i64.to_string(r[2]),t.db.table(2).fetch([[[e[0]]]]).next().then(function(e,t){var n=e.done,o=e.value;return n?r[3]=void 0:(t=o.item,r[3]=t.dataTraceId)})},function(e){return r[3]!==void 0?r[5]=r[3]:r[5]=void 0,r[6]!==void 0?t.nativeOperation(n("LSQplStartTrace.nop"),t.i64.cast([0,637746317]),r[6],!0,r[5]):t.resolve()},function(e){return r[6]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,637746317]),r[6],"LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure_start"):t.resolve()},function(e){return t.islc(t.filter(t.db.table(168).fetch(),function(e){return t.i64.eq(e.authorityLevel,t.i64.cast([0,80]))||!1}),0,t.i64.to_float(t.i64.cast([0,1]))).next().then(function(e,n){var o,a,i=e.done,l=e.value;return i?(r[23]=new t.Map,r[23].set("error_msg","Expected a nonempty query result"),r[23].set("code",t.i64.cast([0,3])),r[23].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),r[24]=t.createArray(),r[25]=(r[24].push(r[23]),r[24]),o=[void 0,r[24]],r[7]=o[0],r[8]=o[1]):(n=l.item,r[23]=new t.Map,r[23].set("backup_id",n.backupId),r[23].set("device_public_key_blob",n.devicePublicKeyBlob),r[23].set("device_private_key_blob",n.devicePrivateKeyBlob),r[23].set("epoch_storage_public_key_blob",n.epochStoragePublicKeyBlob),r[23].set("epoch_storage_private_key_blob",n.epochStoragePrivateKeyBlob),r[23].set("epoch_auth_public_key_blob",n.epochAuthPublicKeyBlob),r[23].set("epoch_auth_private_key_blob",n.epochAuthPrivateKeyBlob),r[23].set("mailbox_root_key_blob",n.mailboxRootKeyBlob),r[23].set("ocmf_client_state_blob",n.ocmfClientStateBlob),r[23].set("orf_client_state_v2_blob",void 0),r[23].set("orf_v2_authority_level",void 0),r[23].set("oblivious_validation_token_blob",n.obliviousValidationTokenBlob),r[23].set("device_id",n.deviceId),r[23].set("backup_tenancy",n.backupTenancy),r[23].set("encryption_version",n.encryptionVersion),r[23].set("revision_version",n.revisionVersion),r[23].set("initialize_restore_result",void 0),r[23].set("device_creation_timestamp_sec",void 0),r[23].set("authority_level",n.authorityLevel),a=[r[23],void 0],r[7]=a[0],r[8]=a[1])})},function(o){return r[10]=new t.Map,r[10].set("value",r[7]),r[10].set("errors",r[8]),r[11]=r[10].get("value"),r[11]!==void 0?t.sequence([function(o){return r[23]=r[11].get("backup_id"),r[24]=r[11].get("device_public_key_blob"),r[25]=r[11].get("device_private_key_blob"),r[26]=r[11].get("epoch_storage_public_key_blob"),r[27]=r[11].get("epoch_storage_private_key_blob"),r[28]=r[11].get("epoch_auth_public_key_blob"),r[29]=r[11].get("epoch_auth_private_key_blob"),r[30]=r[11].get("mailbox_root_key_blob"),r[31]=r[11].get("ocmf_client_state_blob"),r[32]=r[11].get("orf_client_state_v2_blob"),r[33]=r[11].get("orf_v2_authority_level"),r[34]=r[11].get("oblivious_validation_token_blob"),r[35]=r[11].get("device_id"),r[36]=r[11].get("backup_tenancy"),r[37]=r[11].get("encryption_version"),r[38]=r[11].get("revision_version"),r[39]=r[11].get("initialize_restore_result"),r[40]=r[11].get("device_creation_timestamp_sec"),r[41]=r[11].get("authority_level"),t.i64.neq(r[35],void 0)?t.sequence([function(e){return r[46]=void 0,t.i64.neq(r[46],void 0)?t.resolve(r[47]=r[46]):t.sequence([function(e){return r[55]=t.createArray(),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,0])).then(function(e){var t;return t=e,r[56]=t[0],t})},function(e){return r[56]&&(r[65]=(r[55].push(t.i64.cast([0,0])),r[55])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,2])).then(function(e){var t;return t=e,r[57]=t[0],t})},function(e){return r[57]&&(r[65]=(r[55].push(t.i64.cast([0,2])),r[55])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,3])).then(function(e){var t;return t=e,r[58]=t[0],t})},function(e){return r[58]&&(r[65]=(r[55].push(t.i64.cast([0,3])),r[55])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,4])).then(function(e){var t;return t=e,r[59]=t[0],t})},function(e){return r[59]&&(r[65]=(r[55].push(t.i64.cast([0,4])),r[55])),r[60]=t.createArray(),r[61]=t.i64.of_int32(r[55].length),t.i64.gt(r[61],t.i64.cast([0,0]))?t.loopAsync(r[61],function(e){return r[65]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[55],r[65]).then(function(e){var t;return t=e,r[66]=t[0],r[67]=t[1],t})},function(e){return r[68]=(r[60].push(r[66]),r[60])}])}):t.resolve()},function(e){return t.sequence([function(e){return r[65]=t.createArray(),r[66]=t.i64.of_int32(r[60].length),t.i64.gt(r[66],t.i64.cast([0,0]))?t.loopAsync(r[66],function(e){return r[68]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[60],r[68]).then(function(e){var t;return t=e,r[69]=t[0],r[70]=t[1],t})},function(e){return r[71]=(r[65].push(t.i64.to_string(r[69])),r[65])}])}):t.resolve()},function(e){return r[67]=r[65].join(","),r[62]=r[67]}])},function(e){return r[60].some(function(e){return t.i64.eq(r[37],e)})?r[63]=r[37]:r[63]=void 0,t.i64.neq(r[63],void 0)?r[64]=r[63]:r[64]=void 0,r[47]=r[64]}])},function(o){return t.i64.neq(r[47],void 0)?r[48]=r[47]:r[48]=t.i64.cast([0,0]),t.i64.neq(r[36],void 0)?r[49]=r[36]:r[49]=t.i64.cast([0,1]),t.db.table(177).fetch([[[e[0]]],"fk_pending_tasks"]).next().then(function(o,a){var i=o.done,l=o.value;return i?t.sequence([function(n){return t.db.table(2).fetch([[[e[0]]]]).next().then(function(n,o){var a,i,l=n.done,s=n.value;return l?(r[67]=t.i64.of_float(Date.now()),a=[e[0],void 0,void 0,void 0,void 0,t.i64.sub(t.i64.mul(r[67],t.i64.cast([0,1e6])),r[19]),void 0],r[55]=a[0],r[56]=a[1],r[57]=a[2],r[58]=a[3],r[59]=a[4],r[60]=a[5],r[61]=a[6]):(o=s.item,r[67]=t.i64.of_float(Date.now()),i=[e[0],o.queueName,o.enqueueTimestampMs,void 0,o.firstExecutedTimestampMs,t.i64.sub(t.i64.mul(r[67],t.i64.cast([0,1e6])),r[19]),void 0],r[55]=i[0],r[56]=i[1],r[57]=i[2],r[58]=i[3],r[59]=i[4],r[60]=i[5],r[61]=i[6])})},function(e){return r[63]=new t.Map,r[63].set("task_id",r[55]),r[63].set("queue_name",r[56]),r[63].set("enqueue_timestamp_ms",r[57]),r[63].set("priority",r[58]),r[63].set("first_executed_timestamp_ms",r[59]),r[63].set("execution_time_ns",r[60]),r[63].set("echo_encoding_execution_time_ns",r[61]),r[64]=new t.Map,r[64].set("task_metadata",r[63]),r[64].set("action_type",void 0),r[64].set("content_type",void 0),r[64].set("identifiers",void 0),r[64].set("identifiers_v2",void 0),r[64].set("task_creation_source",void 0),r[64].set("message_payload_source",t.i64.cast([0,2])),r[65]=new t.Map,r[65].set("error_code",t.i64.cast([0,5])),r[65].set("stored_procedure","LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure"),r[65].set("error_message","Pending backup context row not found"),r[65]!==void 0?(r[67]=r[65].get("stored_procedure"),r[68]=r[65].get("error_code"),r[69]=r[65].get("error_message"),r[70]=".",r[71]=[r[67],r[70],t.i64.to_string(r[68]),r[70],r[69]].join(""),r[6]!==void 0&&r[71]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,637746317]),r[6],"exception_error",r[71]):t.resolve()):t.resolve()},function(e){return t.resolve()},function(e){return r[6]!==void 0?t.nativeOperation(n("LSQplMarkEnd.nop"),t.i64.cast([0,637746317]),r[6],!1):t.resolve()},function(e){var n;return r[66]=t.createArray(),n=[void 0,r[65],r[64],r[66]],r[50]=n[0],r[51]=n[1],r[52]=n[2],r[53]=n[3]}]):(a=l.item,t.sequence([function(n){return r[62]=a.actionType,r[63]=a.contentType,r[68]=a.echoContent,r[69]=a.lsTraceId,r[67]=a.echoEncodingLatencyNs,r[66]=a.attachmentPayload,r[72]=a.attachmentErrorCode,r[70]=a.tamThreadSubtype,r[71]=a.isInstamadillo,r[55]=new t.Map,r[55].set("backup_id",t.i64.to_string(r[23])),r[55].set("act_thread_id",a.listKey),r[55].set("timestamp",a.sortKey),r[55].set("otid",a.uniqueKey),t.filter(t.db.table(305).fetch(),function(n){return t.i64.eq(n.pendingBackupTaskId,e[0])}).next().then(function(e,t){var n=e.done,o=e.value;return n?r[56]=!1:(t=o.item,r[55].set("supplemental_otid",t.supplementalOfflineThreadingId),r[55].set("deletion_otid",t.deletionOfflineThreadingId),r[56]=!0)})},function(e){return r[65]=t.i64.eq(void 0,void 0),r[6]!==void 0?t.nativeOperation(n("LSQplAnnotateBool.nop"),t.i64.cast([0,637746317]),r[6],"should_run_device_timestamp_sync",r[65]):t.resolve()},function(o){return r[64]=a.error==null?t.i64.cast([0,0]):a.error,[t.i64.cast([0,0]),t.i64.cast([0,32])].some(function(e){return t.i64.eq(r[64],e)})?t.sequence([function(e){return r[73]=r[55].get("act_thread_id"),r[74]=r[55].get("otid"),t.storedProcedure(n("LSGetLatestEpochKeys"),!1).then(function(e){var t;return t=e,r[75]=t[0],r[76]=t[1],t})},function(e){var o;return r[75]!==void 0?t.sequence([function(e){return t.i64.eq(r[63],t.i64.cast([0,1]))?t.sequence([function(e){return r[86]=t.createArray(),r[91]=(r[86].push(t.i64.cast([0,32])),r[86]),t.nativeOperation(n("LSGetBlobFromString.nop"),["thread_ope_key","_",r[73]].join("")).then(function(e){var t;return t=e,r[87]=t[0],t})},function(e){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),r[87],void 0,r[30],r[86]).then(function(e){var t;return t=e,r[88]=t[0],t})},function(e){return r[88]?r[89]=!1:r[89]=!0,r[89]?t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoUtils] Got null keys while deriving message list OPE key. Returning null blobish"),r[92]="Got null keys while deriving message list OPE key. Returning null blobish",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoUtils] ","",r[92]].join("")),r[91]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoUtils",r[92],r[91],t.i64.cast([0,3]))},function(e){return r[90]=void 0}]):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[88],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[91]=t[0],r[92]=t[1],t})},function(e){return r[90]=r[91]}])},function(e){return r[83]=r[90]}]):t.sequence([function(e){return t.i64.eq(r[62],t.i64.cast([0,2]))?t.sequence([function(e){return r[87]=t.createArray(),r[92]=(r[87].push(t.i64.cast([0,32])),r[87]),t.nativeOperation(n("LSGetBlobFromString.nop"),["thread_ope_key","_",r[74]].join("")).then(function(e){var t;return t=e,r[88]=t[0],t})},function(e){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),r[88],void 0,r[30],r[87]).then(function(e){var t;return t=e,r[89]=t[0],t})},function(e){return r[89]?r[90]=!1:r[90]=!0,r[90]?t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoUtils] Got null keys while deriving message list OPE key. Returning null blobish"),r[93]="Got null keys while deriving message list OPE key. Returning null blobish",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoUtils] ","",r[93]].join("")),r[92]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoUtils",r[93],r[92],t.i64.cast([0,3]))},function(e){return r[91]=void 0}]):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[89],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[92]=t[0],r[93]=t[1],t})},function(e){return r[91]=r[92]}])},function(e){return r[86]=r[91]}]):t.resolve(r[86]=void 0)},function(e){return r[83]=r[86]}])},function(e){var o;return t.blobs.neq(r[83],void 0)?t.sequence([function(e){return r[86]=r[75].get("epoch_keys"),r[87]=r[86].get("epoch_anon_id"),r[88]=r[86].get("epoch_root_key"),r[89]=t.createArray(),r[104]=(r[89].push(t.i64.cast([0,32])),r[89]),t.i64.ge(r[48],t.i64.cast([0,3]))?t.resolve(r[90]=void 0):t.sequence([function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),r[73]).then(function(e){var t;return t=e,r[104]=t[0],t})},function(e){return r[90]=r[104]}])},function(e){return t.i64.ge(r[48],t.i64.cast([0,4]))?(r[104]="_",r[91]=["message_key_in_epoch",r[104],t.blobs.to_string(r[87]),r[104],"cipher_version",r[104],t.i64.to_string(r[48]),r[104],"thread",r[104],r[73]==null?"":r[73]].join("")):(t.i64.ge(r[48],t.i64.cast([0,3]))?(r[105]="_",r[104]=["message_key_in_epoch",r[105],t.blobs.to_string(r[87]),r[105],"cipher_version",r[105],t.i64.to_string(r[48]),r[105],"thread",r[105],r[73]==null?"":r[73]].join("")):(t.i64.ge(r[48],t.i64.cast([0,2]))?(r[106]="_",r[105]=["message_key_in_epoch",r[106],t.blobs.to_string(r[87]),r[106],"cipher_version",r[106],t.i64.to_string(r[48])].join("")):r[105]=["message_key_in_epoch","_",t.blobs.to_string(r[87])].join(""),r[104]=r[105]),r[91]=r[104]),t.nativeOperation(n("LSGetBlobFromString.nop"),r[91]).then(function(e){var t;return t=e,r[92]=t[0],t})},function(e){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),r[92],r[90],r[88],r[89]).then(function(e){var t;return t=e,r[93]=t[0],t})},function(e){return r[93]?r[94]=!1:r[94]=!0,r[94]?t.resolve(r[95]=void 0):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[93],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[104]=t[0],r[105]=t[1],t})},function(e){return r[95]=r[104]}])},function(e){return t.filter(t.db.table(169).fetch(),function(e){return t.blobs.eq(e.epochAnonIdBlob,t.blob("MA=="))}).next().then(function(e,n){var o,a,i=e.done,l=e.value;return i?(r[104]=new t.Map,r[104].set("error_msg","Expected a nonempty query result"),r[104].set("code",t.i64.cast([0,3])),r[104].set("src_line","MEBEpochClientUtils.php:556 MEBEpochClientUtils::maybeEpochWithAnonIDFromPersistentEpochsTableDirectly()"),r[105]=t.createArray(),r[106]=(r[105].push(r[104]),r[105]),o=[void 0,r[105]],r[96]=o[0],r[97]=o[1]):(n=l.item,r[104]=new t.Map,r[104].set("epoch_id",n.epochId),r[104].set("backup_id",n.backupId),r[104].set("epoch_anon_id_blob",n.epochAnonIdBlob),r[104].set("epoch_root_key_blob",n.epochRootKeyBlob),r[104].set("epoch_status",n.epochStatus),r[104].set("epoch_head",n.epochHead),r[104].set("authority_level",n.authorityLevel),a=[r[104],void 0],r[96]=a[0],r[97]=a[1])})},function(e){return r[99]=new t.Map,r[99].set("value",r[96]),r[99].set("errors",r[97]),r[100]=r[99].get("value"),r[100]!==void 0?t.sequence([function(e){return r[104]=r[100].get("epoch_id"),r[105]=r[100].get("backup_id"),r[106]=r[100].get("epoch_anon_id_blob"),r[107]=r[100].get("epoch_root_key_blob"),r[108]=r[100].get("epoch_status"),r[109]=r[100].get("epoch_head"),r[110]=r[100].get("authority_level"),r[111]=t.createArray(),r[119]=(r[111].push(t.i64.cast([0,32])),r[111]),t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blob("a2RmX2luZm86bWFpbGJveF9yb290X2tleT5zYWx0X21haWxib3hfcm9vdF9rZXlfdjI="),void 0,r[30],r[111]).then(function(e){var t;return t=e,r[112]=t[0],t})},function(e){return r[112]!==void 0?t.sequence([function(e){return r[119]=t.i64.of_int32(r[112].length),t.i64.ge(r[119],t.i64.cast([0,1]))?t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[112],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[121]=t[0],r[122]=t[1],t})},function(e){return r[120]=r[121]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),r[122]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoUtils] ","",r[122]].join("")),r[121]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoUtils",r[122],r[121],t.i64.cast([0,3]))},function(e){return r[120]=void 0}])},function(e){return r[113]=r[120]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),r[120]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoUtils] ","",r[120]].join("")),r[119]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoUtils",r[120],r[119],t.i64.cast([0,3]))},function(e){return r[113]=void 0}])},function(e){return t.blobs.neq(r[113],void 0)?r[114]=!0:r[114]=!1,r[114]||((function(e){t.logger(e).mustfix(e)})("LS::assert is failed. Attempting to coerce a null value to nonnull."),t.throw("LS::assert is failed. Attempting to coerce a null value to nonnull.")),r[115]=t.createArray(),r[119]=(r[115].push(t.i64.cast([0,32])),r[115]),t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blob("a2RmX2luZm86bWFpbGJveF9yb290X2tleT5tYWlsYm94X3Jvb3Rfa2V5X3Yy"),r[113],r[107],r[115]).then(function(e){var t;return t=e,r[116]=t[0],t})},function(e){return r[116]!==void 0?t.sequence([function(e){return r[119]=t.i64.of_int32(r[116].length),t.i64.ge(r[119],t.i64.cast([0,1]))?t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[116],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[121]=t[0],r[122]=t[1],t})},function(e){return r[120]=r[121]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),r[122]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoUtils] ","",r[122]].join("")),r[121]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoUtils",r[122],r[121],t.i64.cast([0,3]))},function(e){return r[120]=void 0}])},function(e){return r[117]=r[120]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),r[120]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoUtils] ","",r[120]].join("")),r[119]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoUtils",r[120],r[119],t.i64.cast([0,3]))},function(e){return r[117]=void 0}])},function(e){return t.blobs.neq(r[117],void 0)?r[118]=!0:r[118]=!1,r[118]||((function(e){t.logger(e).mustfix(e)})("LS::assert is failed. Attempting to coerce a null value to nonnull."),t.throw("LS::assert is failed. Attempting to coerce a null value to nonnull.")),r[101]=r[117]}]):t.sequence([function(e){return r[104]=r[99].get("errors"),r[105]=r[99].get("errors"),(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBEpochClientUtils] Failed to get mailbox_root_key_v2: epoch 0 is not available."),r[107]="Failed to get mailbox_root_key_v2: epoch 0 is not available.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBEpochClientUtils] ","",r[107]].join("")),r[106]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBEpochClientUtils",r[107],r[106],t.i64.cast([0,3]))},function(e){return r[101]=void 0}])},function(e){var o;return t.blobs.neq(r[95],void 0)?t.sequence([function(e){return t.blobs.neq(r[101],void 0)?t.sequence([function(e){return r[110]=t.createArray(),r[114]=(r[110].push(t.i64.cast([0,32])),r[110]),t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blob("a2RmX2luZm86bWFpbGJveF9yb290X2tleV92Mj5mYWxsYmFja19rZXk="),void 0,r[101],r[110]).then(function(e){var t;return t=e,r[111]=t[0],t})},function(e){return r[111]!==void 0?t.sequence([function(e){return r[114]=t.i64.of_int32(r[111].length),t.i64.ge(r[114],t.i64.cast([0,1]))?t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[111],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[116]=t[0],r[117]=t[1],t})},function(e){return r[115]=r[116]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),r[117]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoUtils] ","",r[117]].join("")),r[116]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoUtils",r[117],r[116],t.i64.cast([0,3]))},function(e){return r[115]=void 0}])},function(e){return r[112]=r[115]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),r[115]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoUtils] ","",r[115]].join("")),r[114]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoUtils",r[115],r[114],t.i64.cast([0,3]))},function(e){return r[112]=void 0}])},function(e){return t.blobs.neq(r[112],void 0)?r[113]=!0:r[113]=!1,r[113]||((function(e){t.logger(e).mustfix(e)})("LS::assert is failed. Attempting to coerce a null value to nonnull."),t.throw("LS::assert is failed. Attempting to coerce a null value to nonnull.")),r[104]=r[112]}]):t.resolve(r[104]=void 0)},function(e){var n;return r[105]=r[86].get("epoch_root_key"),r[106]=r[86].get("epoch_anon_id"),r[107]=r[86].get("epoch_id"),r[108]=new t.Map,r[108].set("payload_key",r[95]),r[108].set("payload_fallback_key",r[104]),r[108].set("encryption_version",r[48]),r[108].set("epoch_root_key",r[105]),r[108].set("epoch_anon_id",r[106]),r[108].set("epoch_id",r[107]),r[109]=new t.Map,r[109].set("ope_key",r[83]),r[109].set("message_payload_encryption_keys",r[108]),r[109].set("ocmf_shared_key",r[31]),r[109].set("mailbox_base_salt",r[30]),r[109].set("mailbox_root_key_v2",r[101]),n=[r[109],void 0],r[102]=n[0],r[103]=n[1]}]):t.resolve((r[104]=new t.Map,r[104].set("error_code",t.i64.cast([0,26])),r[104].set("stored_procedure","MEBKeyDeriver"),r[104].set("error_message",""),o=[void 0,r[104]],r[102]=o[0],r[103]=o[1]))},function(e){var t;return t=[r[102],r[103]],r[84]=t[0],r[85]=t[1],t}]):t.resolve((r[86]=new t.Map,r[86].set("error_code",t.i64.cast([0,25])),r[86].set("stored_procedure","MEBKeyDeriver"),r[86].set("error_message",""),o=[void 0,r[86]],r[84]=o[0],r[85]=o[1]))},function(e){var t;return t=[r[84],r[85]],r[77]=t[0],r[78]=t[1],t}]):t.resolve((o=[void 0,r[76]],r[77]=o[0],r[78]=o[1],o))},function(o){return r[77]!==void 0?t.sequence([function(e){return r[83]=r[55].get("backup_id"),r[84]=r[55].get("act_thread_id"),r[85]=r[55].get("timestamp"),r[86]=r[55].get("otid"),t.storedProcedure(n("LSEncryptIdentifiersV2"),r[62],r[63],r[83],r[84],t.i64.from_string(r[85]),r[86],r[77]).then(function(e){var t;return t=e,r[87]=t[0],r[88]=t[1],t})},function(o){return r[87]!==void 0?t.sequence([function(o){return r[93]=r[55].get("act_thread_id"),t.storedProcedure(n("LSLoadAndEncryptProtobufV2"),e[0],r[77],r[93]).then(function(e){var t;return t=e,r[94]=t[0],r[95]=t[1],t})},function(o){return r[100]=t.i64.eq(r[64],t.i64.cast([0,32]))||!1||!0,r[101]=r[94]!==void 0,r[100]&&r[101]?t.sequence([function(e){return r[102]=r[55].get("act_thread_id"),r[103]=r[55].get("backup_id"),t.storedProcedure(n("LSDeriveValueSecretRefV2"),r[102],r[103],r[77]).then(function(e){var t;return t=e,r[104]=t[0],r[105]=t[1],t})},function(o){return r[94]!==void 0?t.sequence([function(o){return r[104]!==void 0?t.sequence([function(e){return r[114]=r[104].get("value_secret_ref"),r[115]=r[87].get("act_thread_id_ocmf_partial"),r[116]=r[87].get("otid_ocmf_partial"),r[117]=r[87].get("timestamp_encrypted"),r[118]=new t.Map,r[118].set("list_key",r[115]),r[118].set("unique_key",r[116]),r[118].set("sort_key",r[117]),r[119]=void 0,r[120]=new t.Map,r[120].set("list_item_id",r[118]),r[120].set("list_item",r[119]),r[120].set("action_type",r[62]),r[121]=r[55].get("timestamp"),r[122]=r[55].get("otid"),r[123]=r[55].get("act_thread_id"),r[124]=r[55].get("supplemental_otid"),r[125]=r[55].get("deletion_otid"),r[126]=new t.Map,r[126].set("timestamp",r[121]),r[126].set("otid",r[122]),r[126].set("wa_thread_id",t.i64.from_string(r[123])),r[126].set("supplemental_otid",r[124]),r[126].set("deletion_otid",r[125]),r[127]=r[77].get("mailbox_base_salt"),t.nativeOperation(n("LSBase64Encode.nop"),r[127]).then(function(e){var t;return t=e,r[128]=t[0],t})},function(e){return r[129]=r[77].get("ocmf_shared_key"),t.nativeOperation(n("LSBase64Encode.nop"),r[129]).then(function(e){var t;return t=e,r[130]=t[0],t})},function(e){return r[131]=new t.Map,r[131].set("mailbox_root_key",r[128]==null?"":r[128]),r[131].set("ocmf_client_state_blob",r[130]==null?"":r[130]),r[132]=r[87].get("backup_id_ocmf_partial"),r[133]=r[77].get("message_payload_encryption_keys"),r[134]=r[133].get("epoch_id"),r[135]=r[77].get("message_payload_encryption_keys"),r[136]=r[135].get("encryption_version"),r[151]=r[69]==null?"":r[69],r[137]=new t.Map,r[137].set("mailbox_partial_id",r[132]),r[137].set("action",r[120]),r[137].set("device_id",r[35]),r[137].set("echo_version",t.i64.cast([0,0])),r[137].set("epoch_id",r[134]),r[137].set("trace_id",void 0),r[137].set("encryption_version",r[136]),r[137].set("is_thread",t.i64.eq(r[63],t.i64.cast([0,2]))),r[137].set("raw_identifiers",r[126]),r[137].set("raw_tokens",r[131]),r[137].set("request_id",r[151]),r[137].set("tam_thread_subtype",r[70]==null?t.i64.cast([0,0]):r[70]),r[137].set("is_instamadillo",r[71]==null?!1:r[71]),r[137].set("should_run_device_creation_timestamp_sync",r[65]),r[137].set("value_secret_ref",r[114]),r[137].set("empty_echo_payload_reason",t.i64.cast([0,1])),r[94]!==void 0?t.sequence([function(e){return r[152]=r[94].get("supplemental_data_encrypted"),r[152]!==void 0?t.sequence([function(e){return r[154]=r[94].get("protobuf_encrypted"),r[155]=r[94].get("backup_action"),r[156]=r[94].get("timestamp_ms"),r[157]=r[152].get("sk_ciphertext"),t.nativeOperation(n("LSBase64Encode.nop"),r[157]).then(function(e){var t;return t=e,r[158]=t[0],t})},function(e){return r[159]=r[152].get("sk_hash"),t.nativeOperation(n("LSBase64Encode.nop"),r[159]).then(function(e){var t;return t=e,r[160]=t[0],t})},function(e){return r[161]=r[94].get("message_tags"),r[162]=r[94].get("maybe_ooo_supplemental_upload"),r[163]=new t.Map,r[163].set("supplementary_data_key",void 0),r[163].set("encrypted_protobuf",r[154]),r[163].set("key_value_backup_action",r[155]),r[163].set("protobuf_ts_ms",r[156]),r[163].set("supplemental_key_ciphertext",r[158]),r[163].set("supplemental_key_hash",r[160]),r[163].set("message_tags",r[161]),r[163].set("maybe_ooo_supplemental_upload",r[162]),r[153]=r[163]}]):t.resolve((r[154]=r[94].get("protobuf_encrypted"),r[155]=r[94].get("backup_action"),r[156]=r[94].get("timestamp_ms"),r[157]=r[94].get("message_tags"),r[158]=new t.Map,r[158].set("supplementary_data_key",void 0),r[158].set("encrypted_protobuf",r[154]),r[158].set("key_value_backup_action",r[155]),r[158].set("protobuf_ts_ms",r[156]),r[158].set("message_tags",r[157]),r[153]=r[158]))},function(e){return r[137].set("key_value_backup_payload",r[153])}]):t.resolve()},function(e){return r[66]!==void 0?t.resolve(r[137].set("attachment_backup_payload",r[66])):((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure] attachment_payload is null."),r[152]=["payload_null",".",t.i64.to_string(r[72])==null?"null":t.i64.to_string(r[72])].join(""),r[6]!==void 0&&r[152]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,637746317]),r[6],"attachment_info",r[152]):t.resolve())},function(e){return r[151]!==void 0?t.nativeOperation(n("LSLogWebQpl.nop"),r[151],t.i64.cast([0,521481602]),"upload_start",t.i64.cast([0,0]),void 0,void 0):t.resolve()},function(n){return r[138]=t.toJSON(r[137]),t.db.table(2).fetch([[[e[0]]]]).next().then(function(n,o){var a,i,l=n.done,s=n.value;return l?(r[152]=t.i64.of_float(Date.now()),t.i64.eq(r[67],t.i64.cast([0,0]))||t.i64.eq(r[67],void 0)?r[153]=void 0:r[153]=r[67],a=[e[0],void 0,void 0,void 0,void 0,t.i64.sub(t.i64.mul(r[152],t.i64.cast([0,1e6])),r[19]),r[153]],r[139]=a[0],r[140]=a[1],r[141]=a[2],r[142]=a[3],r[143]=a[4],r[144]=a[5],r[145]=a[6]):(o=s.item,r[152]=t.i64.of_float(Date.now()),t.i64.eq(r[67],t.i64.cast([0,0]))||t.i64.eq(r[67],void 0)?r[153]=void 0:r[153]=r[67],i=[e[0],o.queueName,o.enqueueTimestampMs,void 0,o.firstExecutedTimestampMs,t.i64.sub(t.i64.mul(r[152],t.i64.cast([0,1e6])),r[19]),r[153]],r[139]=i[0],r[140]=i[1],r[141]=i[2],r[142]=i[3],r[143]=i[4],r[144]=i[5],r[145]=i[6])})},function(e){return r[147]=new t.Map,r[147].set("task_id",r[139]),r[147].set("queue_name",r[140]),r[147].set("enqueue_timestamp_ms",r[141]),r[147].set("priority",r[142]),r[147].set("first_executed_timestamp_ms",r[143]),r[147].set("execution_time_ns",r[144]),r[147].set("echo_encoding_execution_time_ns",r[145]),r[148]=new t.Map,r[148].set("task_metadata",r[147]),r[148].set("action_type",r[62]),r[148].set("content_type",r[63]),r[148].set("identifiers",void 0),r[148].set("identifiers_v2",r[55]),r[148].set("task_creation_source",void 0),r[148].set("message_payload_source",t.i64.cast([0,2])),t.resolve()},function(e){return t.resolve()},function(e){return r[6]!==void 0?t.nativeOperation(n("LSQplMarkEnd.nop"),t.i64.cast([0,637746317]),r[6],!0):t.resolve()},function(e){var n;return r[149]=new t.Map,r[149].set("payload",r[138]),r[150]=t.createArray(),r[152]=(r[150].push(void 0),r[150]),n=[r[149],void 0,r[148],r[150]],r[110]=n[0],r[111]=n[1],r[112]=n[2],r[113]=n[3]}]):t.sequence([function(n){return t.db.table(2).fetch([[[e[0]]]]).next().then(function(n,o){var a,i,l=n.done,s=n.value;return l?(r[125]=t.i64.of_float(Date.now()),t.i64.eq(r[67],t.i64.cast([0,0]))||t.i64.eq(r[67],void 0)?r[126]=void 0:r[126]=r[67],a=[e[0],void 0,void 0,void 0,void 0,t.i64.sub(t.i64.mul(r[125],t.i64.cast([0,1e6])),r[19]),r[126]],r[114]=a[0],r[115]=a[1],r[116]=a[2],r[117]=a[3],r[118]=a[4],r[119]=a[5],r[120]=a[6]):(o=s.item,r[125]=t.i64.of_float(Date.now()),t.i64.eq(r[67],t.i64.cast([0,0]))||t.i64.eq(r[67],void 0)?r[126]=void 0:r[126]=r[67],i=[e[0],o.queueName,o.enqueueTimestampMs,void 0,o.firstExecutedTimestampMs,t.i64.sub(t.i64.mul(r[125],t.i64.cast([0,1e6])),r[19]),r[126]],r[114]=i[0],r[115]=i[1],r[116]=i[2],r[117]=i[3],r[118]=i[4],r[119]=i[5],r[120]=i[6])})},function(e){return r[122]=new t.Map,r[122].set("task_id",r[114]),r[122].set("queue_name",r[115]),r[122].set("enqueue_timestamp_ms",r[116]),r[122].set("priority",r[117]),r[122].set("first_executed_timestamp_ms",r[118]),r[122].set("execution_time_ns",r[119]),r[122].set("echo_encoding_execution_time_ns",r[120]),r[123]=new t.Map,r[123].set("task_metadata",r[122]),r[123].set("action_type",r[62]),r[123].set("content_type",r[63]),r[123].set("identifiers",void 0),r[123].set("identifiers_v2",r[55]),r[123].set("task_creation_source",void 0),r[123].set("message_payload_source",t.i64.cast([0,2])),r[105]!==void 0?(r[125]=r[105].get("stored_procedure"),r[126]=r[105].get("error_code"),r[127]=r[105].get("error_message"),r[128]=".",r[129]=[r[125],r[128],t.i64.to_string(r[126]),r[128],r[127]].join(""),r[6]!==void 0&&r[129]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,637746317]),r[6],"exception_error",r[129]):t.resolve()):t.resolve()},function(e){return t.resolve()},function(e){return r[6]!==void 0?t.nativeOperation(n("LSQplMarkEnd.nop"),t.i64.cast([0,637746317]),r[6],!1):t.resolve()},function(e){var n;return r[124]=t.createArray(),r[125]=(r[124].push(void 0),r[124]),n=[void 0,r[105],r[123],r[124]],r[110]=n[0],r[111]=n[1],r[112]=n[2],r[113]=n[3]}])},function(e){var t;return t=[r[110],r[111],r[112],r[113]],r[106]=t[0],r[107]=t[1],r[108]=t[2],r[109]=t[3],t}]):t.sequence([function(n){return t.db.table(2).fetch([[[e[0]]]]).next().then(function(n,o){var a,i,l=n.done,s=n.value;return l?(r[121]=t.i64.of_float(Date.now()),t.i64.eq(r[67],t.i64.cast([0,0]))||t.i64.eq(r[67],void 0)?r[122]=void 0:r[122]=r[67],a=[e[0],void 0,void 0,void 0,void 0,t.i64.sub(t.i64.mul(r[121],t.i64.cast([0,1e6])),r[19]),r[122]],r[110]=a[0],r[111]=a[1],r[112]=a[2],r[113]=a[3],r[114]=a[4],r[115]=a[5],r[116]=a[6]):(o=s.item,r[121]=t.i64.of_float(Date.now()),t.i64.eq(r[67],t.i64.cast([0,0]))||t.i64.eq(r[67],void 0)?r[122]=void 0:r[122]=r[67],i=[e[0],o.queueName,o.enqueueTimestampMs,void 0,o.firstExecutedTimestampMs,t.i64.sub(t.i64.mul(r[121],t.i64.cast([0,1e6])),r[19]),r[122]],r[110]=i[0],r[111]=i[1],r[112]=i[2],r[113]=i[3],r[114]=i[4],r[115]=i[5],r[116]=i[6])})},function(e){return r[118]=new t.Map,r[118].set("task_id",r[110]),r[118].set("queue_name",r[111]),r[118].set("enqueue_timestamp_ms",r[112]),r[118].set("priority",r[113]),r[118].set("first_executed_timestamp_ms",r[114]),r[118].set("execution_time_ns",r[115]),r[118].set("echo_encoding_execution_time_ns",r[116]),r[119]=new t.Map,r[119].set("task_metadata",r[118]),r[119].set("action_type",r[62]),r[119].set("content_type",r[63]),r[119].set("identifiers",void 0),r[119].set("identifiers_v2",r[55]),r[119].set("task_creation_source",void 0),r[119].set("message_payload_source",t.i64.cast([0,2])),t.resolve()},function(e){return r[95]!==void 0?(r[121]=r[95].get("stored_procedure"),r[122]=r[95].get("error_code"),r[123]=r[95].get("error_message"),r[124]=".",r[125]=[r[121],r[124],t.i64.to_string(r[122]),r[124],r[123]].join(""),r[6]!==void 0&&r[125]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,637746317]),r[6],"exception_error",r[125]):t.resolve()):t.resolve()},function(e){return r[6]!==void 0?t.nativeOperation(n("LSQplMarkEnd.nop"),t.i64.cast([0,637746317]),r[6],!1):t.resolve()},function(e){var n;return r[120]=t.createArray(),r[121]=(r[120].push(r[95]),r[120]),n=[void 0,void 0,r[119],r[120]],r[106]=n[0],r[107]=n[1],r[108]=n[2],r[109]=n[3]}])},function(e){var t;return t=[r[106],r[107],r[108],r[109]],r[96]=t[0],r[97]=t[1],r[98]=t[2],r[99]=t[3],t}]):t.sequence([function(o){return r[100]===!0&&r[101]===!1?t.sequence([function(n){return t.db.table(2).fetch([[[e[0]]]]).next().then(function(n,o){var a,i,l=n.done,s=n.value;return l?(r[117]=t.i64.of_float(Date.now()),t.i64.eq(r[67],t.i64.cast([0,0]))||t.i64.eq(r[67],void 0)?r[118]=void 0:r[118]=r[67],a=[e[0],void 0,void 0,void 0,void 0,t.i64.sub(t.i64.mul(r[117],t.i64.cast([0,1e6])),r[19]),r[118]],r[106]=a[0],r[107]=a[1],r[108]=a[2],r[109]=a[3],r[110]=a[4],r[111]=a[5],r[112]=a[6]):(o=s.item,r[117]=t.i64.of_float(Date.now()),t.i64.eq(r[67],t.i64.cast([0,0]))||t.i64.eq(r[67],void 0)?r[118]=void 0:r[118]=r[67],i=[e[0],o.queueName,o.enqueueTimestampMs,void 0,o.firstExecutedTimestampMs,t.i64.sub(t.i64.mul(r[117],t.i64.cast([0,1e6])),r[19]),r[118]],r[106]=i[0],r[107]=i[1],r[108]=i[2],r[109]=i[3],r[110]=i[4],r[111]=i[5],r[112]=i[6])})},function(e){return r[114]=new t.Map,r[114].set("task_id",r[106]),r[114].set("queue_name",r[107]),r[114].set("enqueue_timestamp_ms",r[108]),r[114].set("priority",r[109]),r[114].set("first_executed_timestamp_ms",r[110]),r[114].set("execution_time_ns",r[111]),r[114].set("echo_encoding_execution_time_ns",r[112]),r[115]=new t.Map,r[115].set("task_metadata",r[114]),r[115].set("action_type",r[62]),r[115].set("content_type",r[63]),r[115].set("identifiers",void 0),r[115].set("identifiers_v2",r[55]),r[115].set("task_creation_source",void 0),r[115].set("message_payload_source",t.i64.cast([0,2])),t.resolve()},function(e){return r[95]!==void 0?(r[117]=r[95].get("stored_procedure"),r[118]=r[95].get("error_code"),r[119]=r[95].get("error_message"),r[120]=".",r[121]=[r[117],r[120],t.i64.to_string(r[118]),r[120],r[119]].join(""),r[6]!==void 0&&r[121]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,637746317]),r[6],"exception_error",r[121]):t.resolve()):t.resolve()},function(e){return r[6]!==void 0?t.nativeOperation(n("LSQplMarkEnd.nop"),t.i64.cast([0,637746317]),r[6],!1):t.resolve()},function(e){var n;return r[116]=t.createArray(),r[117]=(r[116].push(r[95]),r[116]),n=[void 0,void 0,r[115],r[116]],r[102]=n[0],r[103]=n[1],r[104]=n[2],r[105]=n[3]}]):t.sequence([function(o){var a,i,l,s;return t.i64.eq(r[62],t.i64.cast([0,1]))?(r[114]=r[68]===""?void 0:r[68],r[114]!==void 0?(a=[r[114],void 0],r[112]=a[0],r[113]=a[1]):(r[115]=new t.Map,r[115].set("error_code",t.i64.cast([0,30])),r[115].set("stored_procedure","LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure"),r[115].set("error_message",""),i=[void 0,r[115]],r[112]=i[0],r[113]=i[1]),l=[r[112],r[113]],r[106]=l[0],r[107]=l[1]):(s=["",void 0],r[106]=s[0],r[107]=s[1]),r[106]!==void 0?t.sequence([function(e){var o;return t.i64.eq(r[62],t.i64.cast([0,1]))?t.sequence([function(e){return r[118]=r[55].get("backup_id"),r[119]=r[55].get("act_thread_id"),t.storedProcedure(n("LSEncryptMessagePayloadV2"),r[118],r[119],r[77],r[106]).then(function(e){var t;return t=e,r[120]=t[0],r[121]=t[1],t})},function(e){var t;return t=[r[120],r[121]],r[112]=t[0],r[113]=t[1],t}]):t.resolve((r[118]=new t.Map,r[118].set("encrypted_message_payload",""),r[118].set("value_secret_ref",""),o=[r[118],void 0],r[112]=o[0],r[113]=o[1]))},function(o){return r[112]!==void 0?t.sequence([function(e){return r[94]!==void 0&&t.i64.eq(r[62],t.i64.cast([0,2]))?t.sequence([function(e){return r[156]=r[55].get("act_thread_id"),r[157]=r[55].get("backup_id"),t.storedProcedure(n("LSDeriveValueSecretRefV2"),r[156],r[157],r[77]).then(function(e){var t;return t=e,r[158]=t[0],r[159]=t[1],t})},function(e){return r[158]!==void 0?(r[161]=r[158].get("value_secret_ref"),r[160]=r[161]):r[160]="",r[118]=r[160]}]):t.resolve(r[118]="")},function(e){return r[119]=r[87].get("act_thread_id_ocmf_partial"),r[120]=r[87].get("otid_ocmf_partial"),r[121]=r[87].get("timestamp_encrypted"),r[122]=new t.Map,r[122].set("list_key",r[119]),r[122].set("unique_key",r[120]),r[122].set("sort_key",r[121]),r[112]!==void 0?(r[156]=r[112].get("encrypted_message_payload"),r[157]=r[112].get("value_secret_ref"),r[158]=new t.Map,r[158].set("value",r[156]),r[158].set("value_secret_ref",r[157]),r[123]=r[158]):r[123]=void 0,r[124]=new t.Map,r[124].set("list_item_id",r[122]),r[124].set("list_item",r[123]),r[124].set("action_type",r[62]),r[125]=r[55].get("timestamp"),r[126]=r[55].get("otid"),r[127]=r[55].get("act_thread_id"),r[128]=r[55].get("supplemental_otid"),r[129]=r[55].get("deletion_otid"),r[130]=new t.Map,r[130].set("timestamp",r[125]),r[130].set("otid",r[126]),r[130].set("wa_thread_id",t.i64.from_string(r[127])),r[130].set("supplemental_otid",r[128]),r[130].set("deletion_otid",r[129]),r[131]=r[77].get("mailbox_base_salt"),t.nativeOperation(n("LSBase64Encode.nop"),r[131]).then(function(e){var t;return t=e,r[132]=t[0],t})},function(e){return r[133]=r[77].get("ocmf_shared_key"),t.nativeOperation(n("LSBase64Encode.nop"),r[133]).then(function(e){var t;return t=e,r[134]=t[0],t})},function(e){return r[135]=new t.Map,r[135].set("mailbox_root_key",r[132]==null?"":r[132]),r[135].set("ocmf_client_state_blob",r[134]==null?"":r[134]),r[136]=r[87].get("backup_id_ocmf_partial"),r[137]=r[77].get("message_payload_encryption_keys"),r[138]=r[137].get("epoch_id"),r[139]=r[77].get("message_payload_encryption_keys"),r[140]=r[139].get("encryption_version"),r[155]=r[69]==null?"":r[69],r[141]=new t.Map,r[141].set("mailbox_partial_id",r[136]),r[141].set("action",r[124]),r[141].set("device_id",r[35]),r[141].set("echo_version",t.i64.cast([0,0])),r[141].set("epoch_id",r[138]),r[141].set("trace_id",void 0),r[141].set("encryption_version",r[140]),r[141].set("is_thread",t.i64.eq(r[63],t.i64.cast([0,2]))),r[141].set("raw_identifiers",r[130]),r[141].set("raw_tokens",r[135]),r[141].set("request_id",r[155]),r[141].set("tam_thread_subtype",r[70]==null?t.i64.cast([0,0]):r[70]),r[141].set("is_instamadillo",r[71]==null?!1:r[71]),r[141].set("should_run_device_creation_timestamp_sync",r[65]),r[141].set("value_secret_ref",r[118]),r[94]!==void 0?t.sequence([function(e){return r[156]=r[94].get("supplemental_data_encrypted"),r[156]!==void 0?t.sequence([function(e){return r[158]=r[94].get("protobuf_encrypted"),r[159]=r[94].get("backup_action"),r[160]=r[94].get("timestamp_ms"),r[161]=r[156].get("sk_ciphertext"),t.nativeOperation(n("LSBase64Encode.nop"),r[161]).then(function(e){var t;return t=e,r[162]=t[0],t})},function(e){return r[163]=r[156].get("sk_hash"),t.nativeOperation(n("LSBase64Encode.nop"),r[163]).then(function(e){var t;return t=e,r[164]=t[0],t})},function(e){return r[165]=r[94].get("message_tags"),r[166]=r[94].get("maybe_ooo_supplemental_upload"),r[167]=new t.Map,r[167].set("supplementary_data_key",void 0),r[167].set("encrypted_protobuf",r[158]),r[167].set("key_value_backup_action",r[159]),r[167].set("protobuf_ts_ms",r[160]),r[167].set("supplemental_key_ciphertext",r[162]),r[167].set("supplemental_key_hash",r[164]),r[167].set("message_tags",r[165]),r[167].set("maybe_ooo_supplemental_upload",r[166]),r[157]=r[167]}]):t.resolve((r[158]=r[94].get("protobuf_encrypted"),r[159]=r[94].get("backup_action"),r[160]=r[94].get("timestamp_ms"),r[161]=r[94].get("message_tags"),r[162]=new t.Map,r[162].set("supplementary_data_key",void 0),r[162].set("encrypted_protobuf",r[158]),r[162].set("key_value_backup_action",r[159]),r[162].set("protobuf_ts_ms",r[160]),r[162].set("message_tags",r[161]),r[157]=r[162]))},function(e){return r[141].set("key_value_backup_payload",r[157])}]):t.resolve()},function(e){return r[66]!==void 0?t.resolve(r[141].set("attachment_backup_payload",r[66])):((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure] attachment_payload is null."),r[156]=["payload_null",".",t.i64.to_string(r[72])==null?"null":t.i64.to_string(r[72])].join(""),r[6]!==void 0&&r[156]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,637746317]),r[6],"attachment_info",r[156]):t.resolve())},function(e){return r[155]!==void 0?t.nativeOperation(n("LSLogWebQpl.nop"),r[155],t.i64.cast([0,521481602]),"upload_start",t.i64.cast([0,0]),void 0,void 0):t.resolve()},function(n){return r[142]=t.toJSON(r[141]),t.db.table(2).fetch([[[e[0]]]]).next().then(function(n,o){var a,i,l=n.done,s=n.value;return l?(r[156]=t.i64.of_float(Date.now()),t.i64.eq(r[67],t.i64.cast([0,0]))||t.i64.eq(r[67],void 0)?r[157]=void 0:r[157]=r[67],a=[e[0],void 0,void 0,void 0,void 0,t.i64.sub(t.i64.mul(r[156],t.i64.cast([0,1e6])),r[19]),r[157]],r[143]=a[0],r[144]=a[1],r[145]=a[2],r[146]=a[3],r[147]=a[4],r[148]=a[5],r[149]=a[6]):(o=s.item,r[156]=t.i64.of_float(Date.now()),t.i64.eq(r[67],t.i64.cast([0,0]))||t.i64.eq(r[67],void 0)?r[157]=void 0:r[157]=r[67],i=[e[0],o.queueName,o.enqueueTimestampMs,void 0,o.firstExecutedTimestampMs,t.i64.sub(t.i64.mul(r[156],t.i64.cast([0,1e6])),r[19]),r[157]],r[143]=i[0],r[144]=i[1],r[145]=i[2],r[146]=i[3],r[147]=i[4],r[148]=i[5],r[149]=i[6])})},function(e){return r[151]=new t.Map,r[151].set("task_id",r[143]),r[151].set("queue_name",r[144]),r[151].set("enqueue_timestamp_ms",r[145]),r[151].set("priority",r[146]),r[151].set("first_executed_timestamp_ms",r[147]),r[151].set("execution_time_ns",r[148]),r[151].set("echo_encoding_execution_time_ns",r[149]),r[152]=new t.Map,r[152].set("task_metadata",r[151]),r[152].set("action_type",r[62]),r[152].set("content_type",r[63]),r[152].set("identifiers",void 0),r[152].set("identifiers_v2",r[55]),r[152].set("task_creation_source",void 0),r[152].set("message_payload_source",t.i64.cast([0,2])),t.resolve()},function(e){return r[95]!==void 0?(r[156]=r[95].get("stored_procedure"),r[157]=r[95].get("error_code"),r[158]=r[95].get("error_message"),r[159]=".",r[160]=[r[156],r[159],t.i64.to_string(r[157]),r[159],r[158]].join(""),r[6]!==void 0&&r[160]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,637746317]),r[6],"exception_error",r[160]):t.resolve()):t.resolve()},function(e){return r[6]!==void 0?t.nativeOperation(n("LSQplMarkEnd.nop"),t.i64.cast([0,637746317]),r[6],!0):t.resolve()},function(e){var n;return r[153]=new t.Map,r[153].set("payload",r[142]),r[154]=t.createArray(),r[156]=(r[154].push(r[95]),r[154]),n=[r[153],void 0,r[152],r[154]],r[114]=n[0],r[115]=n[1],r[116]=n[2],r[117]=n[3]}]):t.sequence([function(n){return t.db.table(2).fetch([[[e[0]]]]).next().then(function(n,o){var a,i,l=n.done,s=n.value;return l?(r[129]=t.i64.of_float(Date.now()),t.i64.eq(r[67],t.i64.cast([0,0]))||t.i64.eq(r[67],void 0)?r[130]=void 0:r[130]=r[67],a=[e[0],void 0,void 0,void 0,void 0,t.i64.sub(t.i64.mul(r[129],t.i64.cast([0,1e6])),r[19]),r[130]],r[118]=a[0],r[119]=a[1],r[120]=a[2],r[121]=a[3],r[122]=a[4],r[123]=a[5],r[124]=a[6]):(o=s.item,r[129]=t.i64.of_float(Date.now()),t.i64.eq(r[67],t.i64.cast([0,0]))||t.i64.eq(r[67],void 0)?r[130]=void 0:r[130]=r[67],i=[e[0],o.queueName,o.enqueueTimestampMs,void 0,o.firstExecutedTimestampMs,t.i64.sub(t.i64.mul(r[129],t.i64.cast([0,1e6])),r[19]),r[130]],r[118]=i[0],r[119]=i[1],r[120]=i[2],r[121]=i[3],r[122]=i[4],r[123]=i[5],r[124]=i[6])})},function(e){return r[126]=new t.Map,r[126].set("task_id",r[118]),r[126].set("queue_name",r[119]),r[126].set("enqueue_timestamp_ms",r[120]),r[126].set("priority",r[121]),r[126].set("first_executed_timestamp_ms",r[122]),r[126].set("execution_time_ns",r[123]),r[126].set("echo_encoding_execution_time_ns",r[124]),r[127]=new t.Map,r[127].set("task_metadata",r[126]),r[127].set("action_type",r[62]),r[127].set("content_type",r[63]),r[127].set("identifiers",void 0),r[127].set("identifiers_v2",r[55]),r[127].set("task_creation_source",void 0),r[127].set("message_payload_source",t.i64.cast([0,2])),r[113]!==void 0?(r[129]=r[113].get("stored_procedure"),r[130]=r[113].get("error_code"),r[131]=r[113].get("error_message"),r[132]=".",r[133]=[r[129],r[132],t.i64.to_string(r[130]),r[132],r[131]].join(""),r[6]!==void 0&&r[133]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,637746317]),r[6],"exception_error",r[133]):t.resolve()):t.resolve()},function(e){return r[95]!==void 0?(r[129]=r[95].get("stored_procedure"),r[130]=r[95].get("error_code"),r[131]=r[95].get("error_message"),r[132]=".",r[133]=[r[129],r[132],t.i64.to_string(r[130]),r[132],r[131]].join(""),r[6]!==void 0&&r[133]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,637746317]),r[6],"exception_error",r[133]):t.resolve()):t.resolve()},function(e){return r[6]!==void 0?t.nativeOperation(n("LSQplMarkEnd.nop"),t.i64.cast([0,637746317]),r[6],!1):t.resolve()},function(e){var n;return r[128]=t.createArray(),r[129]=(r[128].push(r[95]),r[128]),n=[void 0,r[113],r[127],r[128]],r[114]=n[0],r[115]=n[1],r[116]=n[2],r[117]=n[3]}])},function(e){var t;return t=[r[114],r[115],r[116],r[117]],r[108]=t[0],r[109]=t[1],r[110]=t[2],r[111]=t[3],t}]):t.sequence([function(n){return t.db.table(2).fetch([[[e[0]]]]).next().then(function(n,o){var a,i,l=n.done,s=n.value;return l?(r[123]=t.i64.of_float(Date.now()),t.i64.eq(r[67],t.i64.cast([0,0]))||t.i64.eq(r[67],void 0)?r[124]=void 0:r[124]=r[67],a=[e[0],void 0,void 0,void 0,void 0,t.i64.sub(t.i64.mul(r[123],t.i64.cast([0,1e6])),r[19]),r[124]],r[112]=a[0],r[113]=a[1],r[114]=a[2],r[115]=a[3],r[116]=a[4],r[117]=a[5],r[118]=a[6]):(o=s.item,r[123]=t.i64.of_float(Date.now()),t.i64.eq(r[67],t.i64.cast([0,0]))||t.i64.eq(r[67],void 0)?r[124]=void 0:r[124]=r[67],i=[e[0],o.queueName,o.enqueueTimestampMs,void 0,o.firstExecutedTimestampMs,t.i64.sub(t.i64.mul(r[123],t.i64.cast([0,1e6])),r[19]),r[124]],r[112]=i[0],r[113]=i[1],r[114]=i[2],r[115]=i[3],r[116]=i[4],r[117]=i[5],r[118]=i[6])})},function(e){return r[120]=new t.Map,r[120].set("task_id",r[112]),r[120].set("queue_name",r[113]),r[120].set("enqueue_timestamp_ms",r[114]),r[120].set("priority",r[115]),r[120].set("first_executed_timestamp_ms",r[116]),r[120].set("execution_time_ns",r[117]),r[120].set("echo_encoding_execution_time_ns",r[118]),r[121]=new t.Map,r[121].set("task_metadata",r[120]),r[121].set("action_type",r[62]),r[121].set("content_type",r[63]),r[121].set("identifiers",void 0),r[121].set("identifiers_v2",r[55]),r[121].set("task_creation_source",void 0),r[121].set("message_payload_source",t.i64.cast([0,2])),r[107]!==void 0?(r[123]=r[107].get("stored_procedure"),r[124]=r[107].get("error_code"),r[125]=r[107].get("error_message"),r[126]=".",r[127]=[r[123],r[126],t.i64.to_string(r[124]),r[126],r[125]].join(""),r[6]!==void 0&&r[127]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,637746317]),r[6],"exception_error",r[127]):t.resolve()):t.resolve()},function(e){return r[95]!==void 0?(r[123]=r[95].get("stored_procedure"),r[124]=r[95].get("error_code"),r[125]=r[95].get("error_message"),r[126]=".",r[127]=[r[123],r[126],t.i64.to_string(r[124]),r[126],r[125]].join(""),r[6]!==void 0&&r[127]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,637746317]),r[6],"exception_error",r[127]):t.resolve()):t.resolve()},function(e){return r[6]!==void 0?t.nativeOperation(n("LSQplMarkEnd.nop"),t.i64.cast([0,637746317]),r[6],!1):t.resolve()},function(e){var n;return r[122]=t.createArray(),r[123]=(r[122].push(r[95]),r[122]),n=[void 0,r[107],r[121],r[122]],r[108]=n[0],r[109]=n[1],r[110]=n[2],r[111]=n[3]}])},function(e){var t;return t=[r[108],r[109],r[110],r[111]],r[102]=t[0],r[103]=t[1],r[104]=t[2],r[105]=t[3],t}])},function(e){var t;return t=[r[102],r[103],r[104],r[105]],r[96]=t[0],r[97]=t[1],r[98]=t[2],r[99]=t[3],t}])},function(e){var t;return t=[r[96],r[97],r[98],r[99]],r[89]=t[0],r[90]=t[1],r[91]=t[2],r[92]=t[3],t}]):t.sequence([function(n){return t.db.table(2).fetch([[[e[0]]]]).next().then(function(n,o){var a,i,l=n.done,s=n.value;return l?(r[104]=t.i64.of_float(Date.now()),t.i64.eq(r[67],t.i64.cast([0,0]))||t.i64.eq(r[67],void 0)?r[105]=void 0:r[105]=r[67],a=[e[0],void 0,void 0,void 0,void 0,t.i64.sub(t.i64.mul(r[104],t.i64.cast([0,1e6])),r[19]),r[105]],r[93]=a[0],r[94]=a[1],r[95]=a[2],r[96]=a[3],r[97]=a[4],r[98]=a[5],r[99]=a[6]):(o=s.item,r[104]=t.i64.of_float(Date.now()),t.i64.eq(r[67],t.i64.cast([0,0]))||t.i64.eq(r[67],void 0)?r[105]=void 0:r[105]=r[67],i=[e[0],o.queueName,o.enqueueTimestampMs,void 0,o.firstExecutedTimestampMs,t.i64.sub(t.i64.mul(r[104],t.i64.cast([0,1e6])),r[19]),r[105]],r[93]=i[0],r[94]=i[1],r[95]=i[2],r[96]=i[3],r[97]=i[4],r[98]=i[5],r[99]=i[6])})},function(e){return r[101]=new t.Map,r[101].set("task_id",r[93]),r[101].set("queue_name",r[94]),r[101].set("enqueue_timestamp_ms",r[95]),r[101].set("priority",r[96]),r[101].set("first_executed_timestamp_ms",r[97]),r[101].set("execution_time_ns",r[98]),r[101].set("echo_encoding_execution_time_ns",r[99]),r[102]=new t.Map,r[102].set("task_metadata",r[101]),r[102].set("action_type",r[62]),r[102].set("content_type",r[63]),r[102].set("identifiers",void 0),r[102].set("identifiers_v2",r[55]),r[102].set("task_creation_source",void 0),r[102].set("message_payload_source",t.i64.cast([0,2])),r[88]!==void 0?(r[104]=r[88].get("stored_procedure"),r[105]=r[88].get("error_code"),r[106]=r[88].get("error_message"),r[107]=".",r[108]=[r[104],r[107],t.i64.to_string(r[105]),r[107],r[106]].join(""),r[6]!==void 0&&r[108]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,637746317]),r[6],"exception_error",r[108]):t.resolve()):t.resolve()},function(e){return t.resolve()},function(e){return r[6]!==void 0?t.nativeOperation(n("LSQplMarkEnd.nop"),t.i64.cast([0,637746317]),r[6],!1):t.resolve()},function(e){var n;return r[103]=t.createArray(),r[104]=(r[103].push(void 0),r[103]),n=[void 0,r[88],r[102],r[103]],r[89]=n[0],r[90]=n[1],r[91]=n[2],r[92]=n[3]}])},function(e){var t;return t=[r[89],r[90],r[91],r[92]],r[79]=t[0],r[80]=t[1],r[81]=t[2],r[82]=t[3],t}]):t.sequence([function(n){return t.db.table(2).fetch([[[e[0]]]]).next().then(function(n,o){var a,i,l=n.done,s=n.value;return l?(r[94]=t.i64.of_float(Date.now()),t.i64.eq(r[67],t.i64.cast([0,0]))||t.i64.eq(r[67],void 0)?r[95]=void 0:r[95]=r[67],a=[e[0],void 0,void 0,void 0,void 0,t.i64.sub(t.i64.mul(r[94],t.i64.cast([0,1e6])),r[19]),r[95]],r[83]=a[0],r[84]=a[1],r[85]=a[2],r[86]=a[3],r[87]=a[4],r[88]=a[5],r[89]=a[6]):(o=s.item,r[94]=t.i64.of_float(Date.now()),t.i64.eq(r[67],t.i64.cast([0,0]))||t.i64.eq(r[67],void 0)?r[95]=void 0:r[95]=r[67],i=[e[0],o.queueName,o.enqueueTimestampMs,void 0,o.firstExecutedTimestampMs,t.i64.sub(t.i64.mul(r[94],t.i64.cast([0,1e6])),r[19]),r[95]],r[83]=i[0],r[84]=i[1],r[85]=i[2],r[86]=i[3],r[87]=i[4],r[88]=i[5],r[89]=i[6])})},function(e){return r[91]=new t.Map,r[91].set("task_id",r[83]),r[91].set("queue_name",r[84]),r[91].set("enqueue_timestamp_ms",r[85]),r[91].set("priority",r[86]),r[91].set("first_executed_timestamp_ms",r[87]),r[91].set("execution_time_ns",r[88]),r[91].set("echo_encoding_execution_time_ns",r[89]),r[92]=new t.Map,r[92].set("task_metadata",r[91]),r[92].set("action_type",r[62]),r[92].set("content_type",r[63]),r[92].set("identifiers",void 0),r[92].set("identifiers_v2",r[55]),r[92].set("task_creation_source",void 0),r[92].set("message_payload_source",t.i64.cast([0,2])),r[78]!==void 0?(r[94]=r[78].get("stored_procedure"),r[95]=r[78].get("error_code"),r[96]=r[78].get("error_message"),r[97]=".",r[98]=[r[94],r[97],t.i64.to_string(r[95]),r[97],r[96]].join(""),r[6]!==void 0&&r[98]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,637746317]),r[6],"exception_error",r[98]):t.resolve()):t.resolve()},function(e){return t.resolve()},function(e){return r[6]!==void 0?t.nativeOperation(n("LSQplMarkEnd.nop"),t.i64.cast([0,637746317]),r[6],!1):t.resolve()},function(e){var n;return r[93]=t.createArray(),r[94]=(r[93].push(void 0),r[93]),n=[void 0,r[78],r[92],r[93]],r[79]=n[0],r[80]=n[1],r[81]=n[2],r[82]=n[3]}])},function(e){var t;return t=[r[79],r[80],r[81],r[82]],r[58]=t[0],r[59]=t[1],r[60]=t[2],r[61]=t[3],t}]):t.sequence([function(n){return t.db.table(2).fetch([[[e[0]]]]).next().then(function(n,o){var a,i,l=n.done,s=n.value;return l?(r[85]=t.i64.of_float(Date.now()),t.i64.eq(r[67],t.i64.cast([0,0]))||t.i64.eq(r[67],void 0)?r[86]=void 0:r[86]=r[67],a=[e[0],void 0,void 0,void 0,void 0,t.i64.sub(t.i64.mul(r[85],t.i64.cast([0,1e6])),r[19]),r[86]],r[73]=a[0],r[74]=a[1],r[75]=a[2],r[76]=a[3],r[77]=a[4],r[78]=a[5],r[79]=a[6]):(o=s.item,r[85]=t.i64.of_float(Date.now()),t.i64.eq(r[67],t.i64.cast([0,0]))||t.i64.eq(r[67],void 0)?r[86]=void 0:r[86]=r[67],i=[e[0],o.queueName,o.enqueueTimestampMs,void 0,o.firstExecutedTimestampMs,t.i64.sub(t.i64.mul(r[85],t.i64.cast([0,1e6])),r[19]),r[86]],r[73]=i[0],r[74]=i[1],r[75]=i[2],r[76]=i[3],r[77]=i[4],r[78]=i[5],r[79]=i[6])})},function(e){return r[81]=new t.Map,r[81].set("task_id",r[73]),r[81].set("queue_name",r[74]),r[81].set("enqueue_timestamp_ms",r[75]),r[81].set("priority",r[76]),r[81].set("first_executed_timestamp_ms",r[77]),r[81].set("execution_time_ns",r[78]),r[81].set("echo_encoding_execution_time_ns",r[79]),r[82]=new t.Map,r[82].set("task_metadata",r[81]),r[82].set("action_type",r[62]),r[82].set("content_type",r[63]),r[82].set("identifiers",void 0),r[82].set("identifiers_v2",r[55]),r[82].set("task_creation_source",void 0),r[82].set("message_payload_source",t.i64.cast([0,2])),r[83]=new t.Map,r[83].set("error_code",r[64]),r[83].set("stored_procedure","LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure"),r[83].set("error_message",""),r[83]!==void 0?(r[85]=r[83].get("stored_procedure"),r[86]=r[83].get("error_code"),r[87]=r[83].get("error_message"),r[88]=".",r[89]=[r[85],r[88],t.i64.to_string(r[86]),r[88],r[87]].join(""),r[6]!==void 0&&r[89]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,637746317]),r[6],"exception_error",r[89]):t.resolve()):t.resolve()},function(e){return t.resolve()},function(e){return r[6]!==void 0?t.nativeOperation(n("LSQplMarkEnd.nop"),t.i64.cast([0,637746317]),r[6],!1):t.resolve()},function(e){var n;return r[84]=t.createArray(),n=[void 0,r[83],r[82],r[84]],r[58]=n[0],r[59]=n[1],r[60]=n[2],r[61]=n[3]}])},function(e){var t;return t=[r[58],r[59],r[60],r[61]],r[50]=t[0],r[51]=t[1],r[52]=t[2],r[53]=t[3],t}]))})},function(e){var t;return t=[r[50],r[51],r[52],r[53]],r[42]=t[0],r[43]=t[1],r[44]=t[2],r[45]=t[3],t}]):t.sequence([function(n){return t.db.table(2).fetch([[[e[0]]]]).next().then(function(n,o){var a,i,l=n.done,s=n.value;return l?(r[58]=t.i64.of_float(Date.now()),a=[e[0],void 0,void 0,void 0,void 0,t.i64.sub(t.i64.mul(r[58],t.i64.cast([0,1e6])),r[19]),void 0],r[46]=a[0],r[47]=a[1],r[48]=a[2],r[49]=a[3],r[50]=a[4],r[51]=a[5],r[52]=a[6]):(o=s.item,r[58]=t.i64.of_float(Date.now()),i=[e[0],o.queueName,o.enqueueTimestampMs,void 0,o.firstExecutedTimestampMs,t.i64.sub(t.i64.mul(r[58],t.i64.cast([0,1e6])),r[19]),void 0],r[46]=i[0],r[47]=i[1],r[48]=i[2],r[49]=i[3],r[50]=i[4],r[51]=i[5],r[52]=i[6])})},function(e){return r[54]=new t.Map,r[54].set("task_id",r[46]),r[54].set("queue_name",r[47]),r[54].set("enqueue_timestamp_ms",r[48]),r[54].set("priority",r[49]),r[54].set("first_executed_timestamp_ms",r[50]),r[54].set("execution_time_ns",r[51]),r[54].set("echo_encoding_execution_time_ns",r[52]),r[55]=new t.Map,r[55].set("task_metadata",r[54]),r[55].set("action_type",void 0),r[55].set("content_type",void 0),r[55].set("identifiers",void 0),r[55].set("identifiers_v2",void 0),r[55].set("task_creation_source",void 0),r[55].set("message_payload_source",t.i64.cast([0,2])),r[56]=new t.Map,r[56].set("error_code",t.i64.cast([0,24])),r[56].set("stored_procedure","LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure"),r[56].set("error_message",""),r[56]!==void 0?(r[58]=r[56].get("stored_procedure"),r[59]=r[56].get("error_code"),r[60]=r[56].get("error_message"),r[61]=".",r[62]=[r[58],r[61],t.i64.to_string(r[59]),r[61],r[60]].join(""),r[6]!==void 0&&r[62]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,637746317]),r[6],"exception_error",r[62]):t.resolve()):t.resolve()},function(e){return t.resolve()},function(e){return r[6]!==void 0?t.nativeOperation(n("LSQplMarkEnd.nop"),t.i64.cast([0,637746317]),r[6],!1):t.resolve()},function(e){var n;return r[57]=t.createArray(),n=[void 0,r[56],r[55],r[57]],r[42]=n[0],r[43]=n[1],r[44]=n[2],r[45]=n[3]}])},function(e){var t;return t=[r[42],r[43],r[44],r[45]],r[12]=t[0],r[13]=t[1],r[14]=t[2],r[15]=t[3],t}]):t.sequence([function(n){return r[23]=r[10].get("errors"),r[24]=r[10].get("errors"),t.db.table(2).fetch([[[e[0]]]]).next().then(function(n,o){var a,i,l=n.done,s=n.value;return l?(r[37]=t.i64.of_float(Date.now()),a=[e[0],void 0,void 0,void 0,void 0,t.i64.sub(t.i64.mul(r[37],t.i64.cast([0,1e6])),r[19]),void 0],r[25]=a[0],r[26]=a[1],r[27]=a[2],r[28]=a[3],r[29]=a[4],r[30]=a[5],r[31]=a[6]):(o=s.item,r[37]=t.i64.of_float(Date.now()),i=[e[0],o.queueName,o.enqueueTimestampMs,void 0,o.firstExecutedTimestampMs,t.i64.sub(t.i64.mul(r[37],t.i64.cast([0,1e6])),r[19]),void 0],r[25]=i[0],r[26]=i[1],r[27]=i[2],r[28]=i[3],r[29]=i[4],r[30]=i[5],r[31]=i[6])})},function(e){return r[33]=new t.Map,r[33].set("task_id",r[25]),r[33].set("queue_name",r[26]),r[33].set("enqueue_timestamp_ms",r[27]),r[33].set("priority",r[28]),r[33].set("first_executed_timestamp_ms",r[29]),r[33].set("execution_time_ns",r[30]),r[33].set("echo_encoding_execution_time_ns",r[31]),r[34]=new t.Map,r[34].set("task_metadata",r[33]),r[34].set("action_type",void 0),r[34].set("content_type",void 0),r[34].set("identifiers",void 0),r[34].set("identifiers_v2",void 0),r[34].set("task_creation_source",void 0),r[34].set("message_payload_source",t.i64.cast([0,2])),r[35]=new t.Map,r[35].set("error_code",t.i64.cast([0,1])),r[35].set("stored_procedure","LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure"),r[35].set("error_message",""),r[35]!==void 0?(r[37]=r[35].get("stored_procedure"),r[38]=r[35].get("error_code"),r[39]=r[35].get("error_message"),r[40]=".",r[41]=[r[37],r[40],t.i64.to_string(r[38]),r[40],r[39]].join(""),r[6]!==void 0&&r[41]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,637746317]),r[6],"exception_error",r[41]):t.resolve()):t.resolve()},function(e){return t.resolve()},function(e){return r[6]!==void 0?t.nativeOperation(n("LSQplMarkEnd.nop"),t.i64.cast([0,637746317]),r[6],!1):t.resolve()},function(e){var n;return r[36]=t.createArray(),n=[void 0,r[35],r[34],r[36]],r[12]=n[0],r[13]=n[1],r[14]=n[2],r[15]=n[3]}])},function(e){return r[16]=t.i64.of_float(Date.now()),r[17]=t.i64.random(),r[20]="Finishing execution. Execution time: ",r[21]=t.i64.to_string(t.i64.sub(r[16],r[0])),r[22]=" ms",r[18]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][serializeBackupPayloadV2] ",r[18],r[20],r[18],r[21],r[18],r[22]].join("")),t.i64.eq(t.i64.mod_(r[17],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[23]=",",r[24]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"serializeBackupPayloadV2",[r[20],r[23],r[21],r[23],r[22]].join(""),r[24],t.i64.cast([0,4]))):t.resolve()},function(e){var t;return t=[r[12],r[13],r[14],r[15]],o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],t}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure",e.__tables__=["pending_tasks","secure_encrypted_backups_client_state","pending_backups_context_v2","pending_protobuf_backups_context","secure_encrypted_backups_epochs"],a.exports=e}),null);
__d("LSTaskSerializerEncryptedBackupsUpload",["LSArrayGetObjectAt","LSLogMebClientEvent.nop","LSSerializeBackupPayloadV2"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(n){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][taskSerializerEncryptedBackupsUpload] Beginning execution."),r[1]=t.i64.of_float(Date.now()),t.forEach(t.db.table(177).fetch([[[e[0]]],"fk_pending_tasks"]),function(e){var n=e.update,r=e.item;return n({backupStatus:t.i64.cast([0,2])})})},function(o){return t.storedProcedure(n("LSSerializeBackupPayloadV2"),e[0]).then(function(e){var t;return t=e,r[2]=t[0],r[3]=t[1],r[4]=t[2],r[5]=t[3],t})},function(e){return r[6]=t.createArray(),r[7]=t.i64.of_int32(r[5].length),t.i64.gt(r[7],t.i64.cast([0,0]))?t.loopAsync(r[7],function(e){return r[23]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[5],r[23]).then(function(e){var t;return t=e,r[24]=t[0],r[25]=t[1],t})},function(e){return r[24]!==void 0?r[26]=(r[6].push(r[24]),r[6]):0}])}):t.resolve()},function(e){return r[8]=t.i64.of_int32(r[6].length),t.i64.gt(r[8],t.i64.cast([0,0]))?t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[6],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[23]=t[0],r[24]=t[1],t})},function(e){return r[9]=r[23]}]):t.resolve(r[9]=void 0)},function(e){var o,a,i,l;return r[2]?r[10]=!1:r[10]=!0,r[10]?(r[3]?r[23]=!1:r[23]=!0,r[23]?(i=[void 0,void 0,r[9],r[6],r[4]],r[24]=i[0],r[25]=i[1],r[26]=i[2],r[27]=i[3],r[28]=i[4]):(a=[void 0,r[3],r[9],r[6],r[4]],r[24]=a[0],r[25]=a[1],r[26]=a[2],r[27]=a[3],r[28]=a[4]),l=[r[24],r[25],r[26],r[27],r[28]],r[11]=l[0],r[12]=l[1],r[13]=l[2],r[14]=l[3],r[15]=l[4]):(r[23]=r[2].get("payload"),o=[r[23],r[3],r[9],r[6],r[4]],r[11]=o[0],r[12]=o[1],r[13]=o[2],r[14]=o[3],r[15]=o[4]),r[23]=new t.Map,r[24]=r[23].set("success",r[11]),r[25]=r[23].set("failure",r[12]),r[26]=r[23].set("protobuf_failure",r[13]),r[27]=r[23].set("protobuf_failures",r[14]),r[28]=r[23].set("context",r[15]),r[29]=t.toJSON(r[23]),r[16]=r[29],r[17]=t.i64.of_float(Date.now()),r[18]=t.i64.random(),r[20]="Finishing execution. Execution time: ",r[21]=t.i64.to_string(t.i64.sub(r[17],r[0])),r[22]=" ms",r[19]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][taskSerializerEncryptedBackupsUpload] ",r[19],r[20],r[19],r[21],r[19],r[22]].join("")),t.i64.eq(t.i64.mod_(r[18],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[23]=",",r[24]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"taskSerializerEncryptedBackupsUpload",[r[20],r[23],r[21],r[23],r[22]].join(""),r[24],t.i64.cast([0,4]))):t.resolve()},function(e){var n;return n=[r[16],t.i64.cast([0,50026])],o[0]=n[0],o[1]=n[1],n}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsTaskSerializerEncryptedBackupsUploadStoredProcedure",e.__tables__=["pending_backups_context_v2"],a.exports=e}),null);
__d("LSTaskSerializerEncryptedBackupsUploadProtobufOnly",[],(function(t,n,r,o,a,i){function e(){var e,t=arguments,n=t[t.length-1],r=[],o=[];return r[0]=new n.Map,r[0].set("error_code",n.i64.cast([0,802])),r[0].set("stored_procedure","LSEncryptedBackupsTaskSerializerEncryptedBackupsUploadProtobufOnlyStoredProcedure"),r[0].set("error_message",""),r[2]=new n.Map,r[3]=r[2].set("success",void 0),r[4]=r[2].set("failure",r[0]),r[5]=r[2].set("context",void 0),r[6]=n.toJSON(r[2]),r[1]=r[6],e=[r[1],n.i64.cast([0,50042]),void 0],o[0]=e[0],o[1]=e[1],o[2]=e[2],n.resolve(o)}e.__sproc_name__="LSEncryptedBackupsTaskSerializerEncryptedBackupsUploadProtobufOnlyStoredProcedure",e.__tables__=[],a.exports=e}),null);
__d("LSTaskSerializerEncryptedBackupsUploadSenderBackup",["LSLogMebClientEvent.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(e){return t.sequence([function(e){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][taskSerializerEncryptedBackupsUploadSenderBackup] Beginning execution."),r[1]=t.i64.of_float(Date.now()),(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsTaskSerializerEncryptedBackupsUploadSenderBackupStoredProcedure] LSEncryptedBackupsMinosEncrypt native op not supported"),r[3]="LSEncryptedBackupsMinosEncrypt native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsTaskSerializerEncryptedBackupsUploadSenderBackupStoredProcedure] ","",r[3]].join("")),r[2]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsTaskSerializerEncryptedBackupsUploadSenderBackupStoredProcedure",r[3],r[2],t.i64.cast([0,3]))},function(e){return r[4]=new t.Map,r[4].set("error_code",t.i64.cast([0,3])),r[4].set("stored_procedure","taskSerializerEncryptedBackupsUploadSenderBackup"),r[4].set("error_message",""),r[12]=new t.Map,r[13]=r[12].set("success",void 0),r[14]=r[12].set("failure",r[4]),r[15]=r[12].set("context",void 0),r[16]=t.toJSON(r[12]),r[5]=r[16],r[6]=t.i64.of_float(Date.now()),r[7]=t.i64.random(),r[9]="Finishing execution. Execution time: ",r[10]=t.i64.to_string(t.i64.sub(r[6],r[0])),r[11]=" ms",r[8]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][taskSerializerEncryptedBackupsUploadSenderBackup] ",r[8],r[9],r[8],r[10],r[8],r[11]].join("")),t.i64.eq(t.i64.mod_(r[7],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[12]=",",r[13]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"taskSerializerEncryptedBackupsUploadSenderBackup",[r[9],r[12],r[10],r[12],r[11]].join(""),r[13],t.i64.cast([0,4]))):t.resolve()},function(e){var n;return n=[r[5],t.i64.cast([0,50057]),void 0],o[0]=n[0],o[1]=n[1],o[2]=n[2],n}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsTaskSerializerEncryptedBackupsUploadSenderBackupStoredProcedure",e.__tables__=[],a.exports=e}),null);
__d("LSTaskSerializerMuteThreadV2",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(o){return t.sequence([function(r){return t.db.table(32).fetch([[[e[0]]]]).next().then(function(r,o){var a,i=r.done,l=r.value;return i?(n[4]=t.createArray(),n[5]=(n[4].push("TaskSerializerMuteThreadV2: Task ID not found"),n[4]),n[6]=(n[4].push(e[0]),n[4]),n[7]=t.toJSON(n[4]),(function(e){t.logger(e).mustfix(e)})(n[7]),a=[void 0,void 0,void 0],n[0]=a[0],n[1]=a[1],n[2]=a[2]):(o=l.item,t.sequence([function(e){return n[8]=o.threadKey,t.db.table(9).fetch([[[n[8]]]]).next().then(function(e,r){var o,a=e.done,i=e.value;return a?(n[9]=t.createArray(),n[10]=(n[9].push("TaskSerializerMuteThreadV2: Thread not found"),n[9]),n[11]=(n[9].push(n[8]),n[9]),n[12]=t.toJSON(n[9]),(function(e){t.logger(e).mustfix(e)})(n[12]),o=[void 0,void 0,void 0],n[4]=o[0],n[5]=o[1],n[6]=o[2]):(r=i.item,t.sequence([function(e){return t.db.table(9).fetch([[[n[8]]]]).next().then(function(e,r){var o=e.done,a=e.value;return o?n[9]=t.i64.cast([0,1]):(r=a.item,n[14]=r.syncGroup,t.i64.neq(n[14],void 0)?n[13]=n[14]:n[13]=t.i64.cast([0,1]),n[9]=n[13])})},function(e){var o;return n[11]=new t.Map,n[11].set("thread_key",n[8]),n[11].set("mailbox_type",t.i64.cast([0,0])),n[11].set("mute_expire_time_ms",r.muteExpireTimeMs),n[11].set("sync_group",n[9]),n[12]=t.toJSON(n[11]),o=[n[12],t.i64.cast([0,144]),void 0],n[4]=o[0],n[5]=o[1],n[6]=o[2]}]))})},function(e){var t;return t=[n[4],n[5],n[6]],n[0]=t[0],n[1]=t[1],n[2]=t[2],t}]))})},function(e){var t;return t=[n[0],n[1]],r[0]=t[0],r[1]=t[1],t}])},function(e){return t.resolve(r)}])}e.__sproc_name__="LSMailboxTaskSerializerMuteThreadV2StoredProcedure",e.__tables__=["threads_optimistic_context","threads"],a.exports=e}),null);
__d("LSTaskSerializerRemoveThread",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(o){return t.sequence([function(r){return t.db.table(32).fetch([[[e[0]]]]).next().then(function(r,o){var a,i,l,s,u=r.done,c=r.value;return u?(n[4]=t.createArray(),n[5]=(n[4].push("TaskSerializerRemoveThreadV2: Task ID not found"),n[4]),n[6]=(n[4].push(e[0]),n[4]),n[7]=t.toJSON(n[4]),(function(e){t.logger(e).mustfix(e)})(n[7]),a=[void 0,void 0,void 0],n[0]=a[0],n[1]=a[1],n[2]=a[2]):(o=c.item,n[7]=o.removeType,t.i64.neq(n[7],void 0)?(n[8]=new t.Map,n[8].set("thread_key",o.threadKey),n[8].set("remove_type",n[7]),n[8].set("sync_group",o.syncGroup==null?t.i64.cast([0,1]):o.syncGroup),n[9]=t.toJSON(n[8]),i=[n[9],t.i64.cast([0,146]),void 0],n[4]=i[0],n[5]=i[1],n[6]=i[2]):(l=[void 0,void 0,void 0],n[4]=l[0],n[5]=l[1],n[6]=l[2]),s=[n[4],n[5],n[6]],n[0]=s[0],n[1]=s[1],n[2]=s[2])})},function(e){var t;return t=[n[0],n[1]],r[0]=t[0],r[1]=t[1],t}])},function(e){return t.resolve(r)}])}e.__sproc_name__="LSMailboxTaskSerializerRemoveThreadStoredProcedure",e.__tables__=["threads_optimistic_context"],a.exports=e}),null);
__d("LSTaskSerializerSendMessageV2",["LSArrayGetObjectAt","LSDeserializeFromJsonIntoDictionaryV2.nop","LSSymmetricEncryptionCreateEncryptedString.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(o){return t.db.table(31).fetch([[[e[0]]]]).next().then(function(o,a){var i,l=o.done,s=o.value;return l?(r[4]=t.createArray(),r[5]=(r[4].push("task ID not found"),r[4]),r[6]=(r[4].push(e[0]),r[4]),r[7]=t.toJSON(r[4]),(function(e){t.logger(e).mustfix(e)})(r[7]),i=[void 0,void 0,void 0],r[0]=i[0],r[1]=i[1],r[2]=i[2]):(a=s.item,t.sequence([function(o){return r[12]=a.offlineThreadingId,r[13]=a.messageId,r[11]=a.threadAttributionSource,r[9]=a.platformRef,r[10]=a.platformToken,r[8]=a.replySourceId,r[14]=a.replySourceType,r[23]=a.sendType,r[25]=a.markThreadRead,r[16]=a.initiatingSource,r[17]=a.skipUrlPreviewGen,r[19]=a.textHasLinks,r[20]=a.dataclassParams,r[21]=a.multitabEnv,r[22]=a.metadataDataclass,r[18]=a.richTextFormatType,r[24]=a.subthreadParentMessageId,r[15]=a.isExclusiveToSubthread,t.db.table(12).fetch([[[r[12]]],"optimistic"]).next().then(function(o,a){var i,l=o.done,s=o.value;return l?(r[26]=t.createArray(),r[27]=(r[26].push("OTID not found"),r[26]),r[28]=(r[26].push(r[12]),r[26]),r[29]=t.toJSON(r[26]),(function(e){t.logger(e).mustfix(e)})(r[29]),i=[void 0,void 0,void 0],r[4]=i[0],r[5]=i[1],r[6]=i[2]):(a=s.item,t.sequence([function(o){return r[34]=a.text,r[30]=a.threadKey,r[35]=a.messageId,r[43]=a.senderId,r[32]=a.stickerId,r[37]=a.mentionOffsets,r[38]=a.mentionLengths,r[31]=a.mentionIds,r[39]=a.mentionTypes,r[42]=a.replyType,r[40]=a.isForwarded,r[36]=a.forwardScore,r[41]=a.hotEmojiSize,r[33]=a.metadataDataclass,t.db.table(9).fetch([[[r[30]]]]).next().then(function(o,i){var l,s=o.done,u=o.value;return s?(r[44]=t.createArray(),r[45]=(r[44].push("thread not found"),r[44]),r[46]=(r[44].push(r[30]),r[44]),r[47]=t.toJSON(r[44]),(function(e){t.logger(e).mustfix(e)})(r[47]),l=[void 0,void 0,void 0],r[26]=l[0],r[27]=l[1],r[28]=l[2]):(i=u.item,t.sequence([function(n){return r[51]=i.threadName,r[49]=i.threadKey,r[52]=i.mailboxType,r[50]=i.threadType,r[53]=i.capabilities,r[54]=i.capabilities2,r[55]=i.capabilities3,r[56]=i.capabilities4,r[57]=i.capabilities5,t.db.table(2).fetch([[[e[0]]]]).next().then(function(n,o){var a=n.done,i=n.value;return a?r[44]=!1:(o=i.item,t.sequence([function(n){return t.islc(t.db.table(2).fetch([[[o.queueName]],"queueNameTaskId"]),0,t.i64.to_float(t.i64.cast([0,1]))).next().then(function(n,o){var a=n.done,i=n.value;return a?r[58]=!1:(o=i.item,r[58]=t.i64.eq(o.taskId,e[0]))})},function(e){return r[44]=r[58]}]))})},function(e){return t.i64.eq(i.authorityLevel,t.i64.cast([0,20]))&&[t.i64.cast([0,2]),t.i64.cast([0,5]),t.i64.cast([0,205]),t.i64.cast([0,206]),t.i64.cast([0,26])].some(function(e){return t.i64.eq(r[50],e)})&&r[44]?t.sequence([function(e){return r[61]=r[23]==null?t.i64.cast([0,1]):r[23],t.db.table(9).fetch([[[r[30]]]]).next().then(function(e,n){var o=e.done,a=e.value;return o?r[58]=t.i64.cast([0,1]):(n=a.item,r[79]=n.syncGroup,t.i64.neq(r[79],void 0)?r[78]=r[79]:r[78]=t.i64.cast([0,1]),r[58]=r[78])})},function(e){return r[60]=new t.Map,r[60].set("thread_id",r[30]),r[60].set("otid",r[12]),r[60].set("source",r[11]==null?t.i64.cast([0,0]):r[11]),r[60].set("send_type",t.i64.cast([0,1])),r[60].set("sync_group",r[58]),r[60].set("mark_thread_read",r[25]),t.i64.eq(r[61],t.i64.cast([0,1]))?t.resolve(r[60].set("text",r[34])):t.i64.eq(r[61],t.i64.cast([0,2]))?(t.i64.neq(r[32],void 0)&&(r[60].set("sticker_id",r[32]),r[60].set("send_type",r[61])),r[33]!==void 0?t.sequence([function(e){return t.nativeOperation(n("LSDeserializeFromJsonIntoDictionaryV2.nop"),r[33]).then(function(e){var t;return t=e,r[78]=t[0],t})},function(e){return r[79]=new t.Map,r[80]=r[78].keys(),r[81]=t.i64.of_int32(r[80].length),t.i64.gt(r[81],t.i64.cast([0,0]))?t.loopAsync(r[81],function(e){return r[85]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[80],r[85]).then(function(e){var t;return t=e,r[86]=t[0],r[87]=t[1],t})},function(e){return r[88]=r[78].get(r[86]),r[79].set(r[86],r[88])}])}):t.resolve()},function(e){return r[82]=r[79].get("xma_music_sticker_message_metadata"),r[82]?r[83]=!1:r[83]=!0,r[83]?t.resolve(r[84]=void 0):t.sequence([function(e){return r[85]=new t.Map,r[86]=r[82].keys(),r[87]=t.i64.of_int32(r[86].length),t.i64.gt(r[87],t.i64.cast([0,0]))?t.loopAsync(r[87],function(e){return r[88]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[86],r[88]).then(function(e){var t;return t=e,r[89]=t[0],r[90]=t[1],t})},function(e){return r[91]=r[82].get(r[89]),r[85].set(r[89],r[91])}])}):t.resolve()},function(e){return r[84]=r[85]}])},function(e){return r[84]!==void 0?r[60].set("send_type",r[61]):0}]):t.resolve()):t.i64.eq(r[61],t.i64.cast([0,7]))?t.sequence([function(e){return t.db.table(16).fetch([[[r[30],r[35]]]]).next().then(function(e,t){var n,o,a=e.done,i=e.value;return a?(n=[void 0,void 0],r[78]=n[0],r[79]=n[1],n):(t=i.item,o=[t.filename,t.attributionAppId],r[78]=o[0],r[79]=o[1])})},function(e){return r[78]!==void 0&&t.i64.neq(r[79],void 0)?(r[60].set("url",r[78]),r[60].set("attribution_app_id",r[79]),r[60].set("send_type",r[61]),r[33]!==void 0?r[60].set("metadata_dataclass",r[33]):0):0}]):t.i64.eq(r[61],t.i64.cast([0,3]))?t.sequence([function(e){return r[60].set("text",r[34]),r[78]=t.createArray(),r[79]=t.createArray(),t.forEach(t.sortBy(t.db.table(16).fetch([[[r[30],r[35]]]]),[["attachmentIndex","ASC"]]),function(e){var n=e.item;return r[80]=n.offlineAttachmentId,r[81]=(r[78].push(t.i64.from_string(n.attachmentFbid)),r[78]),r[80]!==void 0?r[81]=(r[79].push(r[80]),r[79]):0})},function(e){return r[60].set("attachment_fbids",r[78]),t.i64.eq(r[61],t.i64.cast([0,9]))&&r[60].set("offline_attachment_ids",r[79]),r[60].set("send_type",r[61])}]):t.i64.eq(r[61],t.i64.cast([0,9]))?t.sequence([function(e){return r[60].set("text",r[34]),r[78]=t.createArray(),r[79]=t.createArray(),t.forEach(t.sortBy(t.db.table(16).fetch([[[r[30],r[35]]]]),[["attachmentIndex","ASC"]]),function(e){var n=e.item;return r[80]=n.offlineAttachmentId,r[81]=(r[78].push(t.i64.from_string(n.attachmentFbid)),r[78]),r[80]!==void 0?r[81]=(r[79].push(r[80]),r[79]):0})},function(e){return r[60].set("attachment_fbids",r[78]),t.i64.eq(r[61],t.i64.cast([0,9]))&&r[60].set("offline_attachment_ids",r[79]),r[60].set("send_type",r[61])}]):t.i64.eq(r[61],t.i64.cast([0,4]))?t.sequence([function(e){return t.db.table(16).fetch([[[r[30],r[35]]]]).next().then(function(e,t){var n=e.done,o=e.value;return n?r[78]=void 0:(t=o.item,r[78]=t.attachmentFbid)})},function(e){return t.db.table(16).fetch([[[r[30],r[35]]]]).next().then(function(e,t){var n=e.done,o=e.value;return n?r[80]=void 0:(t=o.item,r[80]=t.actionUrl)})},function(e){return r[78]!==void 0?(r[60].set("text",r[34]),r[80]!==void 0&&r[60].set("url",r[80]),r[60].set("forwarded_share_id",r[78]),r[60].set("send_type",r[61])):0}]):t.i64.eq(r[61],t.i64.cast([0,5]))?t.resolve(r[13]!==void 0?(r[60].set("forwarded_msg_id",r[13]),r[60].set("send_type",r[61]),t.i64.neq(r[36],void 0)&&r[60].set("forward_score",r[36]),r[60].set("strip_forwarded_msg_caption",!1)):0):t.i64.eq(r[61],t.i64.cast([0,6]))?t.sequence([function(e){return t.db.table(16).fetch([[[r[30],r[35]]]]).next().then(function(e,t){var n,o,a=e.done,i=e.value;return a?(n=[void 0,void 0],r[78]=n[0],r[79]=n[1],n):(t=i.item,o=[t.filename,t.attributionAppId],r[78]=o[0],r[79]=o[1])})},function(e){return r[78]!==void 0?(r[60].set("url",r[78]),r[60].set("text",r[34]),r[60].set("send_type",r[61])):0}]):t.i64.eq(r[61],t.i64.cast([0,11]))?t.sequence([function(e){return t.db.table(16).fetch([[[r[30],r[35]]]]).next().then(function(e,t){var n,o,a=e.done,i=e.value;return a?(n=[void 0,void 0],r[78]=n[0],r[79]=n[1],n):(t=i.item,o=[t.actionUrl,t.attributionAppId],r[78]=o[0],r[79]=o[1])})},function(e){return r[78]!==void 0?(r[60].set("url",r[78]),r[60].set("text",r[34]),r[60].set("send_type",r[61])):0}]):t.resolve(t.i64.eq(r[61],t.i64.cast([0,12]))?r[60].set("send_type",r[61]):0)},function(e){return r[73]=r[24]==null?void 0:r[24],r[72]=r[8]===""?void 0:r[8],r[72]!==void 0&&t.i64.neq(r[14],void 0)&&(r[78]=new t.Map,r[78].set("reply_source_id",r[72]),r[78].set("reply_source_type",r[14]),r[78].set("reply_type",r[42]==null?t.i64.cast([0,0]):r[42]),r[78].set("reply_source_attachment_id",void 0),r[60].set("reply_metadata",r[78])),r[73]!==void 0&&r[15]!==void 0&&(r[78]=new t.Map,r[78].set("subthread_parent_message_id",r[73]),r[78].set("is_exclusive_to_subthread",r[15]),r[60].set("subthread_data",r[78])),r[74]=r[31]===""?void 0:r[31],r[74]!==void 0&&(r[78]=r[37]===""?void 0:r[37],r[78]!==void 0&&(r[79]=r[38]===""?void 0:r[38],r[79]!==void 0&&(r[80]=new t.Map,r[80].set("mention_ids",r[74]),r[80].set("mention_offsets",r[78]),r[80].set("mention_lengths",r[79]),r[80].set("mention_types",r[39]===""?void 0:r[39]),r[60].set("mention_data",r[80])))),r[40]!==void 0&&r[60].set("is_forwarded",r[40]),r[75]=r[9]===""?void 0:r[9],r[75]!==void 0&&r[60].set("platform_ref",r[75]),r[76]=r[10]===""?void 0:r[10],r[76]!==void 0&&r[60].set("platform_token",r[76]),[t.i64.cast([0,1]),t.i64.cast([0,2])].some(function(e){return t.i64.eq(r[61],e)})&&t.i64.neq(r[41],void 0)&&r[60].set("hot_emoji_size",r[41]),t.i64.neq(r[16],void 0)&&r[60].set("initiating_source",r[16]),r[17]!==void 0&&r[60].set("skip_url_preview_gen",r[17]),t.i64.neq(r[18],void 0)&&r[60].set("rich_text_format_type",r[18]),t.resolve()},function(e){return r[19]!==void 0&&r[60].set("text_has_links",r[19]),r[20]!==void 0&&r[60].set("dataclass_params",r[20]),r[21]!==void 0&&r[60].set("multitab_env",r[21]),r[22]!==void 0&&r[60].set("metadata_dataclass",r[22]),t.filter(t.db.table(14).fetch([[[r[49],r[43]]]]),function(e){return t.i64.eq(e.threadKey,r[49])&&t.i64.eq(t.i64.cast([0,0]),r[52])&&t.i64.eq(e.contactId,r[43])}).next().then(function(e,n){var o=e.done,a=e.value;return o?r[62]=!1:(n=a.item,t.i64.eq(r[50],t.i64.cast([0,152]))?(r[79]=n.threadRoles,t.i64.lt(t.i64.cast([0,7]),t.i64.cast([0,0]))||t.i64.gt(t.i64.cast([0,7]),t.i64.cast([0,13]))?r[80]=!1:r[80]=!t.i64.eq(t.i64.and_(t.i64.lsl_(t.i64.cast([0,1]),t.i64.to_int32(t.i64.cast([0,7]))),r[79]),t.i64.cast([0,0])),r[81]=r[53],r[82]=r[54],r[83]=r[55],r[84]=r[56],r[85]=r[57],r[87]=t.i64.div(t.i64.cast([0,223]),t.i64.cast([0,64])),r[88]=t.i64.lsl_(t.i64.cast([0,1]),t.i64.to_int32(t.i64.sub(t.i64.cast([0,223]),t.i64.mul(r[87],t.i64.cast([0,64]))))),t.i64.lt(t.i64.cast([0,223]),t.i64.cast([0,0]))||t.i64.gt(t.i64.cast([0,223]),t.i64.cast([0,310]))?r[86]=!1:(t.i64.eq(r[87],t.i64.cast([0,0]))?r[89]=!t.i64.eq(t.i64.and_(r[88],r[81]),t.i64.cast([0,0])):(t.i64.eq(r[87],t.i64.cast([0,1]))?r[90]=!t.i64.eq(t.i64.and_(r[88],r[82]),t.i64.cast([0,0])):(t.i64.eq(r[87],t.i64.cast([0,2]))?r[91]=!t.i64.eq(t.i64.and_(r[88],r[83]),t.i64.cast([0,0])):(t.i64.eq(r[87],t.i64.cast([0,3]))?r[92]=!t.i64.eq(t.i64.and_(r[88],r[84]),t.i64.cast([0,0])):(t.i64.eq(r[87],t.i64.cast([0,4]))?r[93]=!t.i64.eq(t.i64.and_(r[88],r[85]),t.i64.cast([0,0])):r[93]=!1,r[92]=r[93]),r[91]=r[92]),r[90]=r[91]),r[89]=r[90]),r[86]=r[89]),r[80]!==r[86]&&((function(e){t.logger(e).mustfix(e)})("LS::assert is failed. Thread role and thread capability don't agree for Broadcast Channels message-as-page functionality; aborting"),t.throw("LS::assert is failed. Thread role and thread capability don't agree for Broadcast Channels message-as-page functionality; aborting")),r[78]=r[80]):r[78]=!1,r[62]=r[78])})},function(e){return r[62]&&r[60].set("perform_action_as_page",!0),r[64]=t.createArray(),t.forEach(t.db.table(14).fetch([[[r[30]]]]),function(e){var t=e.item;return r[78]=(r[64].push(t.contactId),r[64])})},function(e){return r[65]=new t.Map,r[65].set("participants",r[64]),r[65].set("send_payload",r[60]),r[51]!==void 0&&r[65].set("thread_name",r[51]),t.db.table(312).fetch([[[r[30]]]]).next().then(function(e,t){var n=e.done,o=e.value;return n?r[66]=void 0:(t=o.item,r[66]=t.metadata)})},function(e){return r[65].set("thread_metadata",r[66]),r[77]=r[11]==null?t.i64.cast([0,0]):r[11],t.i64.eq(r[77],t.i64.cast([0,393217]))?r[68]="broadcast_flow":(t.i64.eq(r[77],t.i64.cast([0,393216]))?r[78]="broadcast_flow":(t.i64.eq(r[77],t.i64.cast([0,393219]))?r[79]="broadcast_flow":(t.i64.eq(r[77],t.i64.cast([0,393224]))?r[80]="broadcast_flow":(t.i64.eq(r[77],t.i64.cast([0,458752]))?r[81]="inbox_new_message":(t.i64.eq(r[77],t.i64.cast([0,65537]))?r[82]="inbox_new_message":(t.i64.eq(r[77],t.i64.cast([0,2097155]))?r[83]="inbox_new_message":(t.i64.eq(r[77],t.i64.cast([0,2228226]))?r[84]="fbm_sidebar_contacts_search":(t.i64.eq(r[77],t.i64.cast([0,2228227]))?r[85]="fbm_sidebar_contacts_groups":r[85]=void 0,r[84]=r[85]),r[83]=r[84]),r[82]=r[83]),r[81]=r[82]),r[80]=r[81]),r[79]=r[80]),r[78]=r[79]),r[68]=r[78]),r[65].set("group_thread_creation_entry_point",r[68]),t.forEach(t.db.table(9).fetch([[[r[49]]]]),function(e){var t=e.update,n=e.item;return t({otidOfFirstMessage:a.offlineThreadingId})})},function(e){var n,o,a,i,l,s,u,c,d;return r[66]===void 0?(t.i64.eq(r[50],t.i64.cast([0,5]))||t.i64.eq(r[50],t.i64.cast([0,26]))?((function(e){t.logger(e).mustfix(e)})("For Marketplace & community chat subthreads, thread metadata cannot be null"),n=[void 0,void 0,void 0],r[78]=n[0],r[79]=n[1],r[80]=n[2]):(r[81]=t.toJSON(r[65]),o=[r[81],t.i64.cast([0,130]),void 0],r[78]=o[0],r[79]=o[1],r[80]=o[2]),a=[r[78],r[79],r[80]],r[69]=a[0],r[70]=a[1],r[71]=a[2]):(t.i64.eq(r[50],t.i64.cast([0,5]))?(r[81]=t.toJSON(r[65]),i=[r[81],t.i64.cast([0,645]),void 0],r[78]=i[0],r[79]=i[1],r[80]=i[2]):(t.i64.eq(r[50],t.i64.cast([0,2]))?(r[84]=t.toJSON(r[65]),l=[r[84],t.i64.cast([0,787]),void 0],r[81]=l[0],r[82]=l[1],r[83]=l[2]):(r[84]=t.toJSON(r[65]),s=[r[84],t.i64.cast([0,645]),void 0],r[81]=s[0],r[82]=s[1],r[83]=s[2]),u=[r[81],r[82],r[83]],r[78]=u[0],r[79]=u[1],r[80]=u[2]),c=[r[78],r[79],r[80]],r[69]=c[0],r[70]=c[1],r[71]=c[2]),d=[r[69],r[70],r[71]],r[46]=d[0],r[47]=d[1],r[48]=d[2]}]):t.sequence([function(e){return r[61]=r[23]==null?t.i64.cast([0,1]):r[23],t.db.table(9).fetch([[[r[30]]]]).next().then(function(e,n){var o=e.done,a=e.value;return o?r[58]=t.i64.cast([0,1]):(n=a.item,r[71]=n.syncGroup,t.i64.neq(r[71],void 0)?r[70]=r[71]:r[70]=t.i64.cast([0,1]),r[58]=r[70])})},function(e){return r[60]=new t.Map,r[60].set("thread_id",r[30]),r[60].set("otid",r[12]),r[60].set("source",r[11]==null?t.i64.cast([0,0]):r[11]),r[60].set("send_type",t.i64.cast([0,1])),r[60].set("sync_group",r[58]),r[60].set("mark_thread_read",r[25]),t.i64.eq(r[61],t.i64.cast([0,1]))?t.resolve(r[60].set("text",r[34])):t.i64.eq(r[61],t.i64.cast([0,2]))?(t.i64.neq(r[32],void 0)&&(r[60].set("sticker_id",r[32]),r[60].set("send_type",r[61])),r[33]!==void 0?t.sequence([function(e){return t.nativeOperation(n("LSDeserializeFromJsonIntoDictionaryV2.nop"),r[33]).then(function(e){var t;return t=e,r[70]=t[0],t})},function(e){return r[71]=new t.Map,r[72]=r[70].keys(),r[73]=t.i64.of_int32(r[72].length),t.i64.gt(r[73],t.i64.cast([0,0]))?t.loopAsync(r[73],function(e){return r[77]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[72],r[77]).then(function(e){var t;return t=e,r[78]=t[0],r[79]=t[1],t})},function(e){return r[80]=r[70].get(r[78]),r[71].set(r[78],r[80])}])}):t.resolve()},function(e){return r[74]=r[71].get("xma_music_sticker_message_metadata"),r[74]?r[75]=!1:r[75]=!0,r[75]?t.resolve(r[76]=void 0):t.sequence([function(e){return r[77]=new t.Map,r[78]=r[74].keys(),r[79]=t.i64.of_int32(r[78].length),t.i64.gt(r[79],t.i64.cast([0,0]))?t.loopAsync(r[79],function(e){return r[80]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[78],r[80]).then(function(e){var t;return t=e,r[81]=t[0],r[82]=t[1],t})},function(e){return r[83]=r[74].get(r[81]),r[77].set(r[81],r[83])}])}):t.resolve()},function(e){return r[76]=r[77]}])},function(e){return r[76]!==void 0?r[60].set("send_type",r[61]):0}]):t.resolve()):t.i64.eq(r[61],t.i64.cast([0,7]))?t.sequence([function(e){return t.db.table(16).fetch([[[r[30],r[35]]]]).next().then(function(e,t){var n,o,a=e.done,i=e.value;return a?(n=[void 0,void 0],r[70]=n[0],r[71]=n[1],n):(t=i.item,o=[t.filename,t.attributionAppId],r[70]=o[0],r[71]=o[1])})},function(e){return r[70]!==void 0&&t.i64.neq(r[71],void 0)?(r[60].set("url",r[70]),r[60].set("attribution_app_id",r[71]),r[60].set("send_type",r[61]),r[33]!==void 0?r[60].set("metadata_dataclass",r[33]):0):0}]):t.i64.eq(r[61],t.i64.cast([0,3]))?t.sequence([function(e){return r[60].set("text",r[34]),r[70]=t.createArray(),r[71]=t.createArray(),t.forEach(t.sortBy(t.db.table(16).fetch([[[r[30],r[35]]]]),[["attachmentIndex","ASC"]]),function(e){var n=e.item;return r[72]=n.offlineAttachmentId,r[73]=(r[70].push(t.i64.from_string(n.attachmentFbid)),r[70]),r[72]!==void 0?r[73]=(r[71].push(r[72]),r[71]):0})},function(e){return r[60].set("attachment_fbids",r[70]),t.i64.eq(r[61],t.i64.cast([0,9]))&&r[60].set("offline_attachment_ids",r[71]),r[60].set("send_type",r[61])}]):t.i64.eq(r[61],t.i64.cast([0,9]))?t.sequence([function(e){return r[60].set("text",r[34]),r[70]=t.createArray(),r[71]=t.createArray(),t.forEach(t.sortBy(t.db.table(16).fetch([[[r[30],r[35]]]]),[["attachmentIndex","ASC"]]),function(e){var n=e.item;return r[72]=n.offlineAttachmentId,r[73]=(r[70].push(t.i64.from_string(n.attachmentFbid)),r[70]),r[72]!==void 0?r[73]=(r[71].push(r[72]),r[71]):0})},function(e){return r[60].set("attachment_fbids",r[70]),t.i64.eq(r[61],t.i64.cast([0,9]))&&r[60].set("offline_attachment_ids",r[71]),r[60].set("send_type",r[61])}]):t.i64.eq(r[61],t.i64.cast([0,4]))?t.sequence([function(e){return t.db.table(16).fetch([[[r[30],r[35]]]]).next().then(function(e,t){var n=e.done,o=e.value;return n?r[70]=void 0:(t=o.item,r[70]=t.attachmentFbid)})},function(e){return t.db.table(16).fetch([[[r[30],r[35]]]]).next().then(function(e,t){var n=e.done,o=e.value;return n?r[72]=void 0:(t=o.item,r[72]=t.actionUrl)})},function(e){return r[70]!==void 0?(r[60].set("text",r[34]),r[72]!==void 0&&r[60].set("url",r[72]),r[60].set("forwarded_share_id",r[70]),r[60].set("send_type",r[61])):0}]):t.i64.eq(r[61],t.i64.cast([0,5]))?t.resolve(r[13]!==void 0?(r[60].set("forwarded_msg_id",r[13]),r[60].set("send_type",r[61]),t.i64.neq(r[36],void 0)&&r[60].set("forward_score",r[36]),r[60].set("strip_forwarded_msg_caption",!1)):0):t.i64.eq(r[61],t.i64.cast([0,6]))?t.sequence([function(e){return t.db.table(16).fetch([[[r[30],r[35]]]]).next().then(function(e,t){var n,o,a=e.done,i=e.value;return a?(n=[void 0,void 0],r[70]=n[0],r[71]=n[1],n):(t=i.item,o=[t.filename,t.attributionAppId],r[70]=o[0],r[71]=o[1])})},function(e){return r[70]!==void 0?(r[60].set("url",r[70]),r[60].set("text",r[34]),r[60].set("send_type",r[61])):0}]):t.i64.eq(r[61],t.i64.cast([0,11]))?t.sequence([function(e){return t.db.table(16).fetch([[[r[30],r[35]]]]).next().then(function(e,t){var n,o,a=e.done,i=e.value;return a?(n=[void 0,void 0],r[70]=n[0],r[71]=n[1],n):(t=i.item,o=[t.actionUrl,t.attributionAppId],r[70]=o[0],r[71]=o[1])})},function(e){return r[70]!==void 0?(r[60].set("url",r[70]),r[60].set("text",r[34]),r[60].set("send_type",r[61])):0}]):t.resolve(t.i64.eq(r[61],t.i64.cast([0,12]))?r[60].set("send_type",r[61]):0)},function(e){return r[66]=r[24]==null?void 0:r[24],r[65]=r[8]===""?void 0:r[8],r[65]!==void 0&&t.i64.neq(r[14],void 0)&&(r[70]=new t.Map,r[70].set("reply_source_id",r[65]),r[70].set("reply_source_type",r[14]),r[70].set("reply_type",r[42]==null?t.i64.cast([0,0]):r[42]),r[70].set("reply_source_attachment_id",void 0),r[60].set("reply_metadata",r[70])),r[66]!==void 0&&r[15]!==void 0&&(r[70]=new t.Map,r[70].set("subthread_parent_message_id",r[66]),r[70].set("is_exclusive_to_subthread",r[15]),r[60].set("subthread_data",r[70])),r[67]=r[31]===""?void 0:r[31],r[67]!==void 0&&(r[70]=r[37]===""?void 0:r[37],r[70]!==void 0&&(r[71]=r[38]===""?void 0:r[38],r[71]!==void 0&&(r[72]=new t.Map,r[72].set("mention_ids",r[67]),r[72].set("mention_offsets",r[70]),r[72].set("mention_lengths",r[71]),r[72].set("mention_types",r[39]===""?void 0:r[39]),r[60].set("mention_data",r[72])))),r[40]!==void 0&&r[60].set("is_forwarded",r[40]),r[68]=r[9]===""?void 0:r[9],r[68]!==void 0&&r[60].set("platform_ref",r[68]),r[69]=r[10]===""?void 0:r[10],r[69]!==void 0&&r[60].set("platform_token",r[69]),[t.i64.cast([0,1]),t.i64.cast([0,2])].some(function(e){return t.i64.eq(r[61],e)})&&t.i64.neq(r[41],void 0)&&r[60].set("hot_emoji_size",r[41]),t.i64.neq(r[16],void 0)&&r[60].set("initiating_source",r[16]),r[17]!==void 0&&r[60].set("skip_url_preview_gen",r[17]),t.i64.neq(r[18],void 0)&&r[60].set("rich_text_format_type",r[18]),t.resolve()},function(e){return r[19]!==void 0&&r[60].set("text_has_links",r[19]),r[20]!==void 0&&r[60].set("dataclass_params",r[20]),r[21]!==void 0&&r[60].set("multitab_env",r[21]),r[22]!==void 0&&r[60].set("metadata_dataclass",r[22]),t.filter(t.db.table(14).fetch([[[r[49],r[43]]]]),function(e){return t.i64.eq(e.threadKey,r[49])&&t.i64.eq(t.i64.cast([0,0]),r[52])&&t.i64.eq(e.contactId,r[43])}).next().then(function(e,n){var o=e.done,a=e.value;return o?r[62]=!1:(n=a.item,t.i64.eq(r[50],t.i64.cast([0,152]))?(r[71]=n.threadRoles,t.i64.lt(t.i64.cast([0,7]),t.i64.cast([0,0]))||t.i64.gt(t.i64.cast([0,7]),t.i64.cast([0,13]))?r[72]=!1:r[72]=!t.i64.eq(t.i64.and_(t.i64.lsl_(t.i64.cast([0,1]),t.i64.to_int32(t.i64.cast([0,7]))),r[71]),t.i64.cast([0,0])),r[73]=r[53],r[74]=r[54],r[75]=r[55],r[76]=r[56],r[77]=r[57],r[79]=t.i64.div(t.i64.cast([0,223]),t.i64.cast([0,64])),r[80]=t.i64.lsl_(t.i64.cast([0,1]),t.i64.to_int32(t.i64.sub(t.i64.cast([0,223]),t.i64.mul(r[79],t.i64.cast([0,64]))))),t.i64.lt(t.i64.cast([0,223]),t.i64.cast([0,0]))||t.i64.gt(t.i64.cast([0,223]),t.i64.cast([0,310]))?r[78]=!1:(t.i64.eq(r[79],t.i64.cast([0,0]))?r[81]=!t.i64.eq(t.i64.and_(r[80],r[73]),t.i64.cast([0,0])):(t.i64.eq(r[79],t.i64.cast([0,1]))?r[82]=!t.i64.eq(t.i64.and_(r[80],r[74]),t.i64.cast([0,0])):(t.i64.eq(r[79],t.i64.cast([0,2]))?r[83]=!t.i64.eq(t.i64.and_(r[80],r[75]),t.i64.cast([0,0])):(t.i64.eq(r[79],t.i64.cast([0,3]))?r[84]=!t.i64.eq(t.i64.and_(r[80],r[76]),t.i64.cast([0,0])):(t.i64.eq(r[79],t.i64.cast([0,4]))?r[85]=!t.i64.eq(t.i64.and_(r[80],r[77]),t.i64.cast([0,0])):r[85]=!1,r[84]=r[85]),r[83]=r[84]),r[82]=r[83]),r[81]=r[82]),r[78]=r[81]),r[72]!==r[78]&&((function(e){t.logger(e).mustfix(e)})("LS::assert is failed. Thread role and thread capability don't agree for Broadcast Channels message-as-page functionality; aborting"),t.throw("LS::assert is failed. Thread role and thread capability don't agree for Broadcast Channels message-as-page functionality; aborting")),r[70]=r[72]):r[70]=!1,r[62]=r[70])})},function(e){var n;return r[62]&&r[60].set("perform_action_as_page",!0),r[64]=t.toJSON(r[60]),n=[r[64],t.i64.cast([0,46]),void 0],r[46]=n[0],r[47]=n[1],r[48]=n[2]}])},function(e){var t;return t=[r[46],r[47],r[48]],r[26]=t[0],r[27]=t[1],r[28]=t[2],t}]))})},function(e){var t;return t=[r[26],r[27],r[28]],r[4]=t[0],r[5]=t[1],r[6]=t[2],t}]))})},function(e){var t;return t=[r[4],r[5],r[6]],r[0]=t[0],r[1]=t[1],r[2]=t[2],t}]))})},function(e){var t;return t=[r[0],r[1]],o[0]=t[0],o[1]=t[1],t}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSMailboxTaskSerializerSendMessageV2StoredProcedure",e.__tables__=["messages_optimistic_context","messages","threads","pending_tasks","attachments","participants","threads_optimistic_metadata"],a.exports=e}),null);
__d("LSTaskSerializerSyncThreadCapabilities",[],(function(t,n,r,o,a,i){function e(){var e,t=arguments,n=t[t.length-1],r=[],o=[];return e=[void 0,void 0,void 0],o[0]=e[0],o[1]=e[1],o[2]=e[2],n.resolve(o)}e.__sproc_name__="LSMailboxTaskSerializerSyncThreadCapabilitiesStoredProcedure",e.__tables__=[],a.exports=e}),null);
__d("LSIsExperimentCapabilityEnabled.nop",["LSACSExperimentCapability","LSIntEnum","MetaConfig","Promise"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=r("MetaConfig")._("87"),c=r("MetaConfig")._("156"),d=function(a,i,l,d){switch((s||(s=o("LSIntEnum"))).toNumber(l)){case r("LSACSExperimentCapability").BUMP_TOKEN_SYNC_TASK_AT_TASK_SERIALIZATION:return(e||(e=n("Promise"))).resolve([c]);case r("LSACSExperimentCapability").INSERT_PENDING_TASK_PARENT_ROW_WHEN_NO_ACS_TOKENS_AT_TASK_INSERTION:return(e||(e=n("Promise"))).resolve([!1]);case r("LSACSExperimentCapability").RETRY_AFTER_TASK_SERIALIZATION_FAILURE_EXPONENTIAL_BACKOFF:return(e||(e=n("Promise"))).resolve([u])}return(e||(e=n("Promise"))).resolve([!1])};d.__nop_name__="LSIsExperimentCapabilityEnabled",l.default=d}),98);
__d("LSVoprfHmac.nop",["ACSCipherSuiteModule","ACSTokenHmacUtil","Promise","XPlatReactTextEncoder","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r,a,i){var l=o("ACSCipherSuiteModule").getACSCipherSuiteByValue(o("ACSCipherSuiteModule").VOPRF_RISTRETTO_HMACSHA512.value);if(!l)return(e||(e=n("Promise"))).resolve([void 0]);var s=yield o("ACSTokenHmacUtil").hmac(l.macAlgorithm,new Uint8Array(i).slice(),new(o("XPlatReactTextEncoder")).TextEncoder().encode(a));return(e||(e=n("Promise"))).resolve([s.buffer])});function r(e,n,r,o){return t.apply(this,arguments)}return r})();s.__nop_name__="LSVoprfHmac",l.default=s}),98);
__d("LSTaskSerializerUnauthenticatedTask",["LSArrayGetObjectAt","LSBase64Encode.nop","LSIsExperimentCapabilityEnabled.nop","LSMailboxTaskCompletionApiOnTaskCompletion","LSRemoveUsedTokens","LSVoprfHmac.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(n){return t.db.table(311).fetch([[[e[0]]]]).next().then(function(e,t){var n=e.done,o=e.value;return n?r[0]=void 0:(t=o.item,r[0]=t.projectName)})},function(o){return r[0]!==void 0?t.sequence([function(o){return e[1]!==void 0?t.sequence([function(e){return r[9]=t.createArray(),r[10]=t.i64.of_float(Date.now()),t.forEach(t.filter(t.db.table(307).fetch(),function(e){return r[0]===e.projectName&&t.i64.gt(e.expirationTimestampMs,r[10])}),function(e){var t=e.item;return r[16]=(r[9].push(t.configId),r[9])})},function(e){return t.sequence([function(e){return r[16]=t.createArray(),r[17]=t.i64.of_int32(r[9].length),t.i64.gt(r[17],t.i64.cast([0,0]))?t.loopAsync(r[17],function(e){return r[19]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[9],r[19]).then(function(e){var t;return t=e,r[20]=t[0],r[21]=t[1],t})},function(e){return r[22]=(r[16].push(r[20]),r[16])}])}):t.resolve()},function(e){return r[18]=r[16].join(","),r[11]=r[18]}])},function(o){return t.filter(t.db.table(309).fetch(),function(e){return r[9].includes(e.configId)&&t.i64.gt(e.redeemLimit,t.i64.cast([0,0]))}).next().then(function(o,a){var i=o.done,l=o.value;return i?t.sequence([function(e){return t.nativeOperation(n("LSIsExperimentCapabilityEnabled.nop"),t.i64.cast([0,0]),r[0]).then(function(e){var t;return t=e,r[16]=t[0],t})},function(o){return r[16]?t.sequence([function(n){return t.db.table(311).fetch([[[e[0]]]]).next().then(function(e,n){var o=e.done,a=e.value;return o?r[20]=t.i64.cast([0,0]):(n=a.item,r[20]=n.failureCount)})},function(n){return t.forEach(t.db.table(311).fetch([[[e[0]]]]),function(e){var n=e.item;return t.forEach(t.db.table(311).fetch([[[n.taskId]]]),function(e){var n=e.update,o=e.item;return n({failureCount:t.i64.add(r[20],t.i64.cast([0,1]))})})})},function(e){var n;return n=[void 0,void 0,t.i64.mul(t.i64.lsl_(t.i64.cast([0,1]),t.i64.to_int32(t.i64.mod_(r[20],t.i64.cast([0,7])))),t.i64.cast([0,500]))],r[17]=n[0],r[18]=n[1],r[19]=n[2],n}]):t.sequence([function(r){return t.storedProcedure(n("LSMailboxTaskCompletionApiOnTaskCompletion"),e[0],!1)},function(n){var o;return r[20]=t.createArray(),r[21]=(r[20].push("Unauthenticated Task Serializer: no valid tokens"),r[20]),r[22]=(r[20].push(e[0]),r[20]),r[23]=(r[20].push(r[0]),r[20]),r[24]=t.toJSON(r[20]),(function(e){t.logger(e).mustfix(e)})(r[24]),o=[void 0,void 0,void 0],r[17]=o[0],r[18]=o[1],r[19]=o[2]}])},function(e){var t;return t=[r[17],r[18],r[19]],r[12]=t[0],r[13]=t[1],r[14]=t[2],t}]):(a=l.item,t.sequence([function(o){return r[20]=a.tokenId,t.nativeOperation(n("LSVoprfHmac.nop"),e[2]==null?"":e[2],a.sharedSecret).then(function(e){var t;return t=e,r[16]=t[0],t})},function(o){return t.blobs.neq(r[16],void 0)?t.sequence([function(e){return t.forEach(t.db.table(309).fetch([[[r[20]]]]),function(e){var n=e.update,r=e.item;return n({redeemLimit:t.i64.sub(r.redeemLimit,t.i64.cast([0,1]))})})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[16]).then(function(e){var t;return t=e,r[21]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),a.nonce).then(function(e){var t;return t=e,r[22]=t[0],t})},function(n){var o;return r[23]=new t.Map,r[23].set("config_id",a.configId),r[23].set("tag",r[21]==null?"":r[21]),r[23].set("aux",r[22]==null?"":r[22]),r[23].set("project_name",r[0]),r[24]=t.toJSON(r[23]),r[25]=new t.Map,r[25].set("payload",e[2]==null?"":e[2]),r[25].set("token",r[24]),r[26]=t.toJSON(r[25]),o=[r[26],t.i64.from_string(e[1]),void 0],r[17]=o[0],r[18]=o[1],r[19]=o[2]}]):t.sequence([function(e){return t.forEach(t.db.table(309).fetch([[[r[20]]]]),function(e){return e.delete()})},function(r){return t.storedProcedure(n("LSMailboxTaskCompletionApiOnTaskCompletion"),e[0],!1)},function(n){var o;return r[21]=t.createArray(),r[22]=(r[21].push("Unauthenticated Task Serializer: hmac failed"),r[21]),r[23]=(r[21].push(e[0]),r[21]),r[24]=t.toJSON(r[21]),(function(e){t.logger(e).mustfix(e)})(r[24]),o=[void 0,void 0,void 0],r[17]=o[0],r[18]=o[1],r[19]=o[2]}])},function(e){var t;return t=[r[17],r[18],r[19]],r[12]=t[0],r[13]=t[1],r[14]=t[2],t}]))})},function(e){var t;return t=[r[12],r[13],r[14]],r[6]=t[0],r[7]=t[1],r[8]=t[2],t}]):t.sequence([function(r){return t.storedProcedure(n("LSMailboxTaskCompletionApiOnTaskCompletion"),e[0],!1)},function(n){var o;return r[9]=t.createArray(),r[10]=(r[9].push("Unauthenticated Task Serializer: task has no write label"),r[9]),r[11]=(r[9].push(e[0]),r[9]),r[12]=t.toJSON(r[9]),(function(e){t.logger(e).mustfix(e)})(r[12]),o=[void 0,void 0,void 0],r[6]=o[0],r[7]=o[1],r[8]=o[2]}])},function(e){var t;return t=[r[6],r[7],r[8]],r[2]=t[0],r[3]=t[1],r[4]=t[2],t}]):t.sequence([function(r){return t.storedProcedure(n("LSMailboxTaskCompletionApiOnTaskCompletion"),e[0],!1)},function(n){var o;return r[6]=t.createArray(),r[7]=(r[6].push("Unauthenticated Task Serializer: anonymous_task_context row not found"),r[6]),r[8]=(r[6].push(e[0]),r[6]),r[9]=t.toJSON(r[6]),(function(e){t.logger(e).mustfix(e)})(r[9]),o=[void 0,void 0,void 0],r[2]=o[0],r[3]=o[1],r[4]=o[2]}])},function(e){return t.storedProcedure(n("LSRemoveUsedTokens"))},function(e){return r[0]!==void 0?t.sequence([function(e){return t.nativeOperation(n("LSIsExperimentCapabilityEnabled.nop"),t.i64.cast([0,1]),r[0]).then(function(e){var t;return t=e,r[6]=t[0],t})},function(e){return r[6]?t.sequence([function(e){return t.i64.neq(r[4],void 0)?t.resolve(r[8]=!0):t.sequence([function(e){return r[10]=t.createArray(),r[11]=t.i64.of_float(Date.now()),t.forEach(t.filter(t.db.table(307).fetch(),function(e){return r[0]===e.projectName&&t.i64.gt(e.expirationTimestampMs,r[11])}),function(e){var t=e.item;return r[15]=(r[10].push(t.configId),r[10])})},function(e){return t.sequence([function(e){return r[15]=t.createArray(),r[16]=t.i64.of_int32(r[10].length),t.i64.gt(r[16],t.i64.cast([0,0]))?t.loopAsync(r[16],function(e){return r[18]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[10],r[18]).then(function(e){var t;return t=e,r[19]=t[0],r[20]=t[1],t})},function(e){return r[21]=(r[15].push(r[19]),r[15])}])}):t.resolve()},function(e){return r[17]=r[15].join(","),r[12]=r[17]}])},function(e){return t.filter(t.db.table(309).fetch(),function(e){return r[10].includes(e.configId)&&t.i64.gt(e.redeemLimit,t.i64.cast([0,0]))}).next().then(function(e,t){var n=e.done,o=e.value;return n?r[13]=!0:(t=o.item,r[13]=!1)})},function(e){return r[8]=r[13]}])},function(e){return r[8]?t.sequence([function(e){return t.filter(t.db.table(310).fetch(),function(e){return e.projectName===r[0]}).next().then(function(e,t){var n=e.done,o=e.value;return n?r[10]=void 0:(t=o.item,r[10]=t.taskId)})},function(e){return r[9]=r[10]}]):t.resolve(r[9]=void 0)},function(e){return r[7]=r[9]}]):t.resolve(r[7]=void 0)},function(e){return r[5]=r[7]}]):t.resolve(r[5]=void 0)},function(e){var t;return t=[r[2],r[3],r[4],r[5]],o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],t}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSAnonymousCredentialsTaskSerializerUnauthenticatedTaskStoredProcedure",e.__tables__=["anonymous_task_context","secure_acs_configurations","secure_acs_tokens","acs_request_context"],a.exports=e}),null);
__d("LSTaskSerializerUpdateThreadName",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(o){return t.sequence([function(r){return t.db.table(32).fetch([[[e[0]]]]).next().then(function(r,o){var a,i=r.done,l=r.value;return i?(n[4]=t.createArray(),n[5]=(n[4].push("taskSerializerUpdateThreadName: Task ID not found"),n[4]),n[6]=(n[4].push(e[0]),n[4]),n[7]=t.toJSON(n[4]),(function(e){t.logger(e).mustfix(e)})(n[7]),a=[void 0,void 0,void 0],n[0]=a[0],n[1]=a[1],n[2]=a[2]):(o=l.item,t.sequence([function(e){return n[8]=o.threadKey,t.db.table(9).fetch([[[n[8]]]]).next().then(function(e,r){var o,a=e.done,i=e.value;return a?(n[9]=t.createArray(),n[10]=(n[9].push("taskSerializerUpdateThreadName: Thread not found"),n[9]),n[11]=(n[9].push(n[8]),n[9]),n[12]=t.toJSON(n[9]),(function(e){t.logger(e).mustfix(e)})(n[12]),o=[void 0,void 0,void 0],n[4]=o[0],n[5]=o[1],n[6]=o[2]):(r=i.item,t.sequence([function(e){return t.db.table(9).fetch([[[n[8]]]]).next().then(function(e,r){var o=e.done,a=e.value;return o?n[9]=t.i64.cast([0,1]):(r=a.item,n[14]=r.syncGroup,t.i64.neq(n[14],void 0)?n[13]=n[14]:n[13]=t.i64.cast([0,1]),n[9]=n[13])})},function(e){var o;return n[11]=new t.Map,n[11].set("thread_key",n[8]),n[11].set("thread_name",r.threadName==null?"":r.threadName),n[11].set("sync_group",n[9]),n[12]=t.toJSON(n[11]),o=[n[12],t.i64.cast([0,32]),void 0],n[4]=o[0],n[5]=o[1],n[6]=o[2]}]))})},function(e){var t;return t=[n[4],n[5],n[6]],n[0]=t[0],n[1]=t[1],n[2]=t[2],t}]))})},function(e){var t;return t=[n[0],n[1],n[2]],r[0]=t[0],r[1]=t[1],r[2]=t[2],t}])},function(e){return t.resolve(r)}])}e.__sproc_name__="LSMailboxTaskSerializerUpdateThreadNameStoredProcedure",e.__tables__=["threads_optimistic_context","threads"],a.exports=e}),null);
__d("LSSerializeTask",["LSForceTaskExecutionImmediately","LSLogMebClientEvent.nop","LSTaskSerializerAcsIssueNextSync","LSTaskSerializerDeleteChatHistory","LSTaskSerializerE2eeMessageIntegrityCheckV2","LSTaskSerializerE2eeMetadataThreadIntegrityCheck","LSTaskSerializerEncryptedBackupAction","LSTaskSerializerEncryptedBackupsLoopingUpload","LSTaskSerializerEncryptedBackupsOpenUpload","LSTaskSerializerEncryptedBackupsRestoreWithSerializer","LSTaskSerializerEncryptedBackupsUpload","LSTaskSerializerEncryptedBackupsUploadProtobufOnly","LSTaskSerializerEncryptedBackupsUploadSenderBackup","LSTaskSerializerMuteThreadV2","LSTaskSerializerRemoveThread","LSTaskSerializerSendMessageV2","LSTaskSerializerSyncThreadCapabilities","LSTaskSerializerUnauthenticatedTask","LSTaskSerializerUpdateThreadName"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(o){return e[1]==="46"?t.sequence([function(o){return t.storedProcedure(n("LSTaskSerializerSendMessageV2"),e[0]).then(function(e){var t;return t=e,r[8]=t[0],r[9]=t[1],t})},function(e){var n;return n=[r[8],t.i64.to_string(r[9]),void 0,void 0],r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],n}]):t.sequence([function(o){return e[1]==="144"?t.sequence([function(o){return t.storedProcedure(n("LSTaskSerializerMuteThreadV2"),e[0]).then(function(e){var t;return t=e,r[12]=t[0],r[13]=t[1],t})},function(e){var n;return n=[r[12],t.i64.to_string(r[13]),void 0,void 0],r[8]=n[0],r[9]=n[1],r[10]=n[2],r[11]=n[3],n}]):t.sequence([function(o){return e[1]==="146"?t.sequence([function(o){return t.storedProcedure(n("LSTaskSerializerRemoveThread"),e[0]).then(function(e){var t;return t=e,r[16]=t[0],r[17]=t[1],t})},function(e){var n;return n=[r[16],t.i64.to_string(r[17]),void 0,void 0],r[12]=n[0],r[13]=n[1],r[14]=n[2],r[15]=n[3],n}]):t.sequence([function(o){return e[1]==="32"?t.sequence([function(o){return t.storedProcedure(n("LSTaskSerializerUpdateThreadName"),e[0]).then(function(e){var t;return t=e,r[20]=t[0],r[21]=t[1],r[22]=t[2],t})},function(e){var n;return n=[r[20],t.i64.to_string(r[21]),void 0,r[22]],r[16]=n[0],r[17]=n[1],r[18]=n[2],r[19]=n[3],n}]):t.sequence([function(o){return e[1]==="362"?t.sequence([function(o){return t.storedProcedure(n("LSTaskSerializerAcsIssueNextSync"),e[0]).then(function(e){var t;return t=e,r[24]=t[0],r[25]=t[1],r[26]=t[2],t})},function(e){var n;return n=[r[24],t.i64.to_string(r[25]),void 0,r[26]],r[20]=n[0],r[21]=n[1],r[22]=n[2],r[23]=n[3],n}]):t.sequence([function(o){return e[1]==="50015"?t.sequence([function(o){return t.storedProcedure(n("LSTaskSerializerEncryptedBackupsRestoreWithSerializer"),e[0]).then(function(e){var t;return t=e,r[28]=t[0],r[29]=t[1],r[30]=t[2],t})},function(e){var n;return n=[r[28],t.i64.to_string(r[29]),void 0,r[30]],r[24]=n[0],r[25]=n[1],r[26]=n[2],r[27]=n[3],n}]):t.sequence([function(o){return e[1]==="319"?t.sequence([function(o){return t.storedProcedure(n("LSTaskSerializerEncryptedBackupAction"),e[0]).then(function(e){var t;return t=e,r[32]=t[0],r[33]=t[1],r[34]=t[2],t})},function(e){var n;return n=[r[32],t.i64.to_string(r[33]),void 0,r[34]],r[28]=n[0],r[29]=n[1],r[30]=n[2],r[31]=n[3],n}]):t.sequence([function(o){return e[1]==="50026"?t.sequence([function(o){return t.storedProcedure(n("LSTaskSerializerEncryptedBackupsUpload"),e[0]).then(function(e){var t;return t=e,r[36]=t[0],r[37]=t[1],t})},function(e){var n;return n=[r[36],t.i64.to_string(r[37]),void 0,void 0],r[32]=n[0],r[33]=n[1],r[34]=n[2],r[35]=n[3],n}]):t.sequence([function(o){return e[1]==="50042"?t.sequence([function(o){return t.storedProcedure(n("LSTaskSerializerEncryptedBackupsUploadProtobufOnly"),e[0]).then(function(e){var t;return t=e,r[40]=t[0],r[41]=t[1],r[42]=t[2],t})},function(e){var n;return n=[r[40],t.i64.to_string(r[41]),void 0,r[42]],r[36]=n[0],r[37]=n[1],r[38]=n[2],r[39]=n[3],n}]):t.sequence([function(o){return e[1]==="700"?t.sequence([function(o){return t.storedProcedure(n("LSTaskSerializerE2eeMetadataThreadIntegrityCheck"),e[0]).then(function(e){var t;return t=e,r[44]=t[0],r[45]=t[1],r[46]=t[2],t})},function(e){var n;return n=[r[44],t.i64.to_string(r[45]),void 0,r[46]],r[40]=n[0],r[41]=n[1],r[42]=n[2],r[43]=n[3],n}]):t.sequence([function(o){return e[1]==="705"?t.sequence([function(o){return t.storedProcedure(n("LSTaskSerializerE2eeMessageIntegrityCheckV2"),e[0]).then(function(e){var t;return t=e,r[48]=t[0],r[49]=t[1],r[50]=t[2],t})},function(e){var n;return n=[r[48],t.i64.to_string(r[49]),void 0,r[50]],r[44]=n[0],r[45]=n[1],r[46]=n[2],r[47]=n[3],n}]):t.sequence([function(o){return e[1]==="50043"?t.sequence([function(o){return t.storedProcedure(n("LSTaskSerializerEncryptedBackupsLoopingUpload"),e[0]).then(function(e){var t;return t=e,r[52]=t[0],r[53]=t[1],r[54]=t[2],t})},function(e){var n;return n=[r[52],t.i64.to_string(r[53]),void 0,r[54]],r[48]=n[0],r[49]=n[1],r[50]=n[2],r[51]=n[3],n}]):t.sequence([function(o){return e[1]==="50048"?t.sequence([function(o){return t.storedProcedure(n("LSTaskSerializerEncryptedBackupsOpenUpload"),e[0]).then(function(e){var t;return t=e,r[56]=t[0],r[57]=t[1],t})},function(e){var n;return n=[r[56],t.i64.to_string(r[57]),void 0,void 0],r[52]=n[0],r[53]=n[1],r[54]=n[2],r[55]=n[3],n}]):t.sequence([function(o){return e[1]==="160013"?t.sequence([function(o){return t.storedProcedure(n("LSTaskSerializerSyncThreadCapabilities"),e[0]).then(function(e){var t;return t=e,r[60]=t[0],r[61]=t[1],r[62]=t[2],t})},function(e){var n;return n=[r[60],t.i64.to_string(r[61]),void 0,r[62]],r[56]=n[0],r[57]=n[1],r[58]=n[2],r[59]=n[3],n}]):t.sequence([function(o){return e[1]==="903"?t.sequence([function(o){return t.storedProcedure(n("LSTaskSerializerDeleteChatHistory"),e[0]).then(function(e){var t;return t=e,r[64]=t[0],r[65]=t[1],r[66]=t[2],t})},function(e){var n;return n=[r[64],t.i64.to_string(r[65]),void 0,r[66]],r[60]=n[0],r[61]=n[1],r[62]=n[2],r[63]=n[3],n}]):t.sequence([function(o){var a;return e[1]==="50057"?t.sequence([function(o){return t.storedProcedure(n("LSTaskSerializerEncryptedBackupsUploadSenderBackup"),e[0]).then(function(e){var t;return t=e,r[68]=t[0],r[69]=t[1],r[70]=t[2],t})},function(e){var n;return n=[r[68],t.i64.to_string(r[69]),void 0,r[70]],r[64]=n[0],r[65]=n[1],r[66]=n[2],r[67]=n[3],n}]):t.resolve((a=[e[2],e[1],void 0,void 0],r[64]=a[0],r[65]=a[1],r[66]=a[2],r[67]=a[3],a))},function(e){var t;return t=[r[64],r[65],r[66],r[67]],r[60]=t[0],r[61]=t[1],r[62]=t[2],r[63]=t[3],t}])},function(e){var t;return t=[r[60],r[61],r[62],r[63]],r[56]=t[0],r[57]=t[1],r[58]=t[2],r[59]=t[3],t}])},function(e){var t;return t=[r[56],r[57],r[58],r[59]],r[52]=t[0],r[53]=t[1],r[54]=t[2],r[55]=t[3],t}])},function(e){var t;return t=[r[52],r[53],r[54],r[55]],r[48]=t[0],r[49]=t[1],r[50]=t[2],r[51]=t[3],t}])},function(e){var t;return t=[r[48],r[49],r[50],r[51]],r[44]=t[0],r[45]=t[1],r[46]=t[2],r[47]=t[3],t}])},function(e){var t;return t=[r[44],r[45],r[46],r[47]],r[40]=t[0],r[41]=t[1],r[42]=t[2],r[43]=t[3],t}])},function(e){var t;return t=[r[40],r[41],r[42],r[43]],r[36]=t[0],r[37]=t[1],r[38]=t[2],r[39]=t[3],t}])},function(e){var t;return t=[r[36],r[37],r[38],r[39]],r[32]=t[0],r[33]=t[1],r[34]=t[2],r[35]=t[3],t}])},function(e){var t;return t=[r[32],r[33],r[34],r[35]],r[28]=t[0],r[29]=t[1],r[30]=t[2],r[31]=t[3],t}])},function(e){var t;return t=[r[28],r[29],r[30],r[31]],r[24]=t[0],r[25]=t[1],r[26]=t[2],r[27]=t[3],t}])},function(e){var t;return t=[r[24],r[25],r[26],r[27]],r[20]=t[0],r[21]=t[1],r[22]=t[2],r[23]=t[3],t}])},function(e){var t;return t=[r[20],r[21],r[22],r[23]],r[16]=t[0],r[17]=t[1],r[18]=t[2],r[19]=t[3],t}])},function(e){var t;return t=[r[16],r[17],r[18],r[19]],r[12]=t[0],r[13]=t[1],r[14]=t[2],r[15]=t[3],t}])},function(e){var t;return t=[r[12],r[13],r[14],r[15]],r[8]=t[0],r[9]=t[1],r[10]=t[2],r[11]=t[3],t}])},function(e){var t;return t=[r[8],r[9],r[10],r[11]],r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],t}])},function(o){return e[3]?t.sequence([function(e){return r[9]=r[1]==="60009"||r[1]==="60006"||r[1]==="60008"||r[1]==="60011"||r[1]==="765"||r[1]==="1006"||r[1]==="160009"||r[1]==="761"||r[1]==="1018"||r[1]==="632"||r[1]==="384"||r[1]==="384",r[9]&&r[1]!==void 0?(r[15]=["Deidentified task is being executed through the 'identified' path. Canceling task with label: ",r[1]].join(""),(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSCoreSerializeTaskStoredProcedure] ","",r[15]].join("")),r[14]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSCoreSerializeTaskStoredProcedure",r[15],r[14],t.i64.cast([0,3]))):t.resolve()},function(e){return t.resolve(r[8]=!1)},function(e){var t,n,o;return r[9]||r[8]?(t=[void 0,void 0,void 0,void 0],r[10]=t[0],r[11]=t[1],r[12]=t[2],r[13]=t[3]):(n=[r[0],r[1],r[2],r[3]],r[10]=n[0],r[11]=n[1],r[12]=n[2],r[13]=n[3]),o=[r[10],r[11],r[12],r[13]],r[4]=o[0],r[5]=o[1],r[6]=o[2],r[7]=o[3]}]):t.sequence([function(o){return t.storedProcedure(n("LSTaskSerializerUnauthenticatedTask"),e[0],r[1],r[0]).then(function(e){var t;return t=e,r[8]=t[0],r[9]=t[1],r[10]=t[2],r[11]=t[3],t})},function(e){return t.i64.neq(r[11],void 0)?t.storedProcedure(n("LSForceTaskExecutionImmediately"),r[11]):t.resolve()},function(e){var n;return n=[r[8],t.i64.to_string(r[9]),void 0,r[10]],r[4]=n[0],r[5]=n[1],r[6]=n[2],r[7]=n[3],n}])},function(e){var t;return t=[r[4],r[5],r[6],r[7]],o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],t}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSCoreSerializeTaskStoredProcedure",e.__tables__=[],a.exports=e}),null);
__d("LSSerializeTaskStoredProcedure",["LSSerializeTask","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSSerializeTask"),a.taskId,a.taskLabel,a.taskValue,a.requiresAuthentication);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("LSBeginHandlingPendingTasksForQueue2",["I64","LSFactory","LSIntEnum","LSPendingTasksPluginType","LSSerializeTaskStoredProcedure","LSShape","LSVec","Promise","ReQL","XPlatReactCrypto","asyncToGeneratorRuntime","gkx","isNativeTask"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=500,d=3e4,m=5,p=100,_=7;function f(e,t){return g.apply(this,arguments)}function g(){return g=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=yield e.lightspeed_task_context.get(t);return n==null||n.requiresAuthentication}),g.apply(this,arguments)}function h(e,t){return y.apply(this,arguments)}function y(){return y=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=yield o("ReQL").firstAsync(o("ReQL").fromTableAscending(e.pending_tasks.index("queueNameTaskId")).getKeyRange(t));return n==null?{context:void 0,failureCount:(s||(s=o("I64"))).neg_one,httpUrlOverride:void 0,minTimeToSyncTimestampMs:s.neg_one,pluginType:(u||(u=o("LSIntEnum"))).ofNumber(r("LSPendingTasksPluginType").LS_BROKER),queueName:""}:n}),y.apply(this,arguments)}function C(e,t){return b.apply(this,arguments)}function b(){return b=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=yield o("ReQL").firstAsync(o("ReQL").fromTableAscending(e.network_requests).getKeyRange(t));return n==null?0:(s||(s=o("I64"))).to_float(n.lastSyncRequestTimestampMs)}),b.apply(this,arguments)}function v(e,t,n){var r=(s||(s=o("I64"))).equal(e.failureCount,(s||(s=o("I64"))).zero)||t;if(r)return 0;var a=(s||(s=o("I64"))).to_float(e.failureCount)>_?(s||(s=o("I64"))).to_float(e.failureCount)-_:(s||(s=o("I64"))).to_float(e.failureCount),i=Math.min((1<<Math.min(a-1,_))*c,d),l=n+i;return Math.max(l-Date.now(),0)}function S(){var e=Array.from(o("XPlatReactCrypto").getRandomValues(new Uint32Array(2)));return e[0]>>>=1,(s||(s=o("I64"))).add(s.lsl_(s.of_float(e[0]),32),s.of_float(e[1]))}function R(){var e=(s||(s=o("I64"))).of_float(Date.now());return s.and_(s.or_(s.lsl_(e,22),s.and_(S(),s.castExn([0,4194303]))),s.castExn([2147483647,4294967295]))}function L(e,t){return E.apply(this,arguments)}function E(){return E=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=R(),r=yield e.network_requests.get(t,(s||(s=o("I64"))).neg_one);return r==null?yield e.network_requests.add({epochId:n,failureCount:(s||(s=o("I64"))).zero,lastSentTimestampMs:s.zero,lastSyncRequestTimestampMs:s.of_float(Date.now()),syncDatabaseId:s.neg_one,taskQueueName:t}):yield e.network_requests.put(babelHelpers.extends({},r,{epochId:n,lastSyncRequestTimestampMs:(s||(s=o("I64"))).of_float(Date.now())})),n}),E.apply(this,arguments)}function k(e,t){return I.apply(this,arguments)}function I(){return I=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){return(yield o("ReQL").firstAsync(o("ReQL").fromTableAscending(e.network_requests).getKeyRange(t).filter(function(e){return e.epochId!=null})))!=null}),I.apply(this,arguments)}function T(e,t,n){var r=(s||(s=o("I64"))).to_float(e.minTimeToSyncTimestampMs),a=Date.now(),i=r-a,l=i<=0;return l?v(e,t,n):i}function D(e){return e.httpUrlOverride!=null||(s||(s=o("I64"))).to_float(e.failureCount)>_}function x(e){return e.timeoutTimestampMs!=null?(s||(s=o("I64"))).to_float(e.timeoutTimestampMs)<=Date.now():!1}function $(e){return e==="90"||e==="130"||e==="153"}function P(e,t,n,r,o){var a=o===0?void 0:o;return{failureCount:a,label:e,payload:t,queueName:n,taskId:r}}function N(e,t,n){return M.apply(this,arguments)}function M(){return M=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var a=yield r("LSSerializeTaskStoredProcedure")(r("LSFactory")(e),{requiresAuthentication:n,taskId:t.taskId,taskLabel:t.context,taskValue:t.taskValue}),i=a[0],l=a[1],u=a[2],c=a[3];return i==null?c!=null?{minRetryDelayMs:c}:void 0:P(l,i,t.queueName,t.taskId,(s||(s=o("I64"))).to_float(t.failureCount))}),M.apply(this,arguments)}function w(e,t,n){return A.apply(this,arguments)}function A(){return A=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){if(t.context==null){yield e.pending_tasks.delete(t.taskId);return}var r=x(t);if(r){yield e.pending_tasks.delete(t.taskId);return}return N(e,t,n)}),A.apply(this,arguments)}function F(e,t){var n=t>=(r("gkx")("26373")&&e===String(207)?p:m)||$(e);return!n}function O(e,t){return B.apply(this,arguments)}function B(){return B=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=yield e.pending_tasks.get(t.taskId);n!=null&&(s||(s=o("I64"))).equal(t.firstExecutedTimestampMs,(s||(s=o("I64"))).zero)&&(yield e.pending_tasks.put(babelHelpers.extends({},n,{firstExecutedTimestampMs:(s||(s=o("I64"))).of_float(Date.now())})))}),B.apply(this,arguments)}function W(e,t){return q.apply(this,arguments)}function q(){return q=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r){if(r.length===0)return{epochId:void 0,tasks:[]};var a=[],i=r[0].httpUrlOverride,l=(yield(e||(e=n("Promise"))).all(r.map(function(e){return f(t,e.taskId)}))).some(Boolean);for(var u of r){var c=u.httpUrlOverride===i,d=(yield f(t,u.taskId))===l;if(yield O(t,u),!c||!d)break;var m=yield w(t,u,l);if(m!=null&&m.payload!=null)a.push(m);else if((m==null?void 0:m.minRetryDelayMs)!=null){var p=yield t.pending_tasks.get(u.taskId);if(p!=null){var _;yield t.pending_tasks.put(babelHelpers.extends({},p,{failureCount:(s||(s=o("I64"))).add((_=p.failureCount)!=null?_:(s||(s=o("I64"))).zero,s.one),minTimeToSyncTimestampMs:s.add(m.minRetryDelayMs,s.of_float(Date.now()))}))}}else yield t.pending_tasks.delete(u.taskId);if(!F(u.context,a.length))break}return{epochId:void 0,tasks:a}}),q.apply(this,arguments)}function U(e,t,n,r,o){return V.apply(this,arguments)}function V(){return V=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,r,o){o===void 0&&(o=!0);var a=yield W(e,t),i=a.tasks;if(i.length===0)return{httpUrlOverride:void 0,networkPayload:void 0,nextSyncMs:void 0,queueName:n,skipRealtimeGateway:!1,workItemType:4};if(o===!0){var l=yield L(e,n);a.epochId=l}var s=yield h(e,n);return{httpUrlOverride:s.httpUrlOverride,networkPayload:a,nextSyncMs:void 0,queueName:n,skipRealtimeGateway:D(s),workItemType:r}}),V.apply(this,arguments)}function H(e,t,n){return G.apply(this,arguments)}function G(){return G=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var a=yield h(e,t),i=yield C(e,t),l=T(a,n,i),s=l!==0;if(s)return[{httpUrlOverride:void 0,networkPayload:void 0,nextSyncMs:l,queueName:t,skipRealtimeGateway:!1,workItemType:3}];var u=[],c=yield o("ReQL").toArrayAsync(o("ReQL").fromTableAscending(e.pending_tasks.index("queueNameTaskId")).getKeyRange(t)),d=c.filter(r("isNativeTask"));if(d.length>0){var m=yield U(e,d,t,2,r("gkx")("4778")===!0);u.push(m)}var p=c.filter(function(e){return!r("isNativeTask")(e)});if(p.length>0){var _=yield U(e,p,t,1);u.push(_)}return u}),G.apply(this,arguments)}function z(e,t,n){return j.apply(this,arguments)}function j(){return j=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var r=!(yield k(e,t));return r?H(e,t,n):[{httpUrlOverride:void 0,networkPayload:void 0,nextSyncMs:void 0,queueName:t,skipRealtimeGateway:!1,workItemType:4}]}),j.apply(this,arguments)}function K(e,t){return Q.apply(this,arguments)}function Q(){return Q=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=t.ignoreSoftDelay,a=t.queueName,i=yield z(e,a,n);return i.map(function(e){var t,n,a;return o("LSShape").ofRecord({network_payload:o("LSShape").ofRecord({epoch_id:(t=e.networkPayload)==null?void 0:t.epochId,tasks:r("LSVec").ofArray(((n=(a=e.networkPayload)==null?void 0:a.tasks)!=null?n:[]).map(function(e){var t;return o("LSShape").ofRecord({failure_count:e.failureCount!=null?(s||(s=o("I64"))).of_float(e.failureCount):void 0,label:(t=e.label)!=null?t:void 0,payload:e.payload,queue_name:e.queueName,task_id:e.taskId})}))}),next_sync_ms:e.nextSyncMs!=null?(s||(s=o("I64"))).of_float(e.nextSyncMs):void 0,queue_name:e.queueName,skip_realtime_gateway:e.skipRealtimeGateway,work_item_type:(u||(u=o("LSIntEnum"))).ofNumber(e.workItemType)})})}),Q.apply(this,arguments)}K._updateTaskIfNeeded=O,K._getHeadOfNormalQueue=h,K._lastSyncRequestTimestampForQueue=C,K._exponentialBackoffForNormalQueue=v,K._generateNewEpoch=R,K._openNewEpochForQueue=L,K._isEpochOpenForQueue=k,K._calculateDelayForNormalQueue=T,K._queueShouldSkipRealtimeGateway=D,K._isNativeTask=r("isNativeTask"),K._taskIsTimedOut=x,K._taskShouldStopBatching=$,K._buildTaskPayloadExpressionForNormalTaskWithParameters=P,K._buildTaskPayloadExpressionForValidatedNormalTask=N,K._buildTaskPayloadExpressionForUnvalidatedNormalTask=w,K._workForNormalQueueWithoutDelay=U,K._workForNormalQueueWithClosedEpoch=H,K._buildWorkForNormalQueue=z,K._buildNetworkPayloadShapeForTasks=W,K._canContinueBatchingForQueue=F,l.default=K}),98);
__d("LSContactGender",[],(function(t,n,r,o,a,i){var e=Object.freeze({UNKNOWN:0,FEMALE:1,MALE:2,NEUTER:3});i.default=e}),66);
__d("LSContactIdType",[],(function(t,n,r,o,a,i){var e=Object.freeze({UNKNOWN:0,FBID:1,SMS_LOCAL_ID:2});i.default=e}),66);
__d("LSContactWorkForeignEntityType",[],(function(t,n,r,o,a,i){var e=Object.freeze({UNKNOWN:0,FOREIGN:1,NOT_FOREIGN:2,NOT_FOREIGN_LIMITED:3});i.default=e}),66);
__d("LSCookie",["$InternalEnum","Cookie","CookieCore","CurrentEnvironment","CurrentMessengerUser","FBLogger","I64","LSE2EEMetadataSyncGroupUtils","LSIntEnum","MessengerLogHistory","MqttWebDeviceID","ReQL","SortedAsyncIterable","getErrorSafe","isPromise","isStringNullOrEmpty","pageID","promiseDone"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=n("$InternalEnum")({SYNCING:"1",NOT_SYNCING:"0"}),d=o("MessengerLogHistory").getInstance("client_init"),m=r("CurrentEnvironment").instagramdotcom?"igd_ls":"m_ls",p={c:{},d:r("MqttWebDeviceID").clientID,s:c.NOT_SYNCING,u:r("pageID")};function _(e){function t(e){o("CookieCore").setWithDomain_FOR_MESSENGER_LS_ONLY(m,JSON.stringify(e),window.location.hostname)}var n=r("Cookie").get(m);if(n==null){var a;t((a={},a[o("CurrentMessengerUser").getIDorEIMU()]=e,a));return}var i=JSON.parse(n);if(i.u==null){var l;t(babelHelpers.extends({},i,(l={},l[o("CurrentMessengerUser").getIDorEIMU()]=e,l)))}else{var s;t((s={},s[o("CurrentMessengerUser").getIDorEIMU()]=e,s))}}function f(){r("Cookie").clear(m)}function g(e){if(typeof e!="object"||e==null)return null;var t=e.c,n=e.d,r=e.s,o=e.u,a=typeof r=="string"?c.cast(r):null,i=typeof t=="object"&&t!=null?Object.entries(t).reduce(function(e,t){var n=t[0],r=t[1];return e==null||typeof r!="string"?null:(e[n]=r,e)},{}):null;return typeof n!="string"||a==null||i==null||typeof o!="string"?null:{c:i,d:n,s:a,u:o}}function h(){var e,t=r("Cookie").get(m);if(r("isStringNullOrEmpty")(t))return p;var n=JSON.parse(t),a=o("CurrentMessengerUser").getIDorEIMU(),i=g(n),l=typeof n=="object"&&n!=null?g(n[a]):null;return(e=l!=null?l:i)!=null?e:p}function y(e){var t=h();if(t.u===r("pageID")){var n={};e.forEach(function(e){var t=e[0],r=e[1],a=r.currentCursor,i=r.groupId;a!=null&&(n[(s||(s=o("I64"))).to_string(i)]=a)}),d.debug("Updated sync cookie to set syncing=false, saving latest cursors"),_(babelHelpers.extends({},t,{c:n,s:c.NOT_SYNCING}))}}var C=[1,2,o("LSE2EEMetadataSyncGroupUtils").shouldAlwaysResetE2EEMetadata()?null:95];function b(t){var n=o("SortedAsyncIterable").toArray(o("ReQL").union.apply(void 0,C.map(function(e){return e==null?o("ReQL").empty():o("ReQL").fromTableAscending(t.tables.sync_groups).getKeyRange((u||(u=o("LSIntEnum"))).ofNumber(e))})));if((e||(e=r("isPromise")))(n)){r("promiseDone")(n.then(function(e){y(e)}));return}y(n)}function v(){try{var e=h();d.debug("Updated sync cookie to set syncing=true"),_(babelHelpers.extends({},e,{s:c.SYNCING,u:r("pageID")}))}catch(e){r("FBLogger")("messenger_web").catching(r("getErrorSafe")(e)).warn("[LS] Failed to sync cookie")}}l.Status=c,l.DEFAULT_COOKIE=p,l.clear=f,l.get=h,l.syncBeforeUnload=b,l.setSyncing=v}),98);
__d("LSDataTraceFlushDeferred",["MetaConfig","Promise","requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e,s=r("requireDeferred")("LSDataTraceFlush").__setRef("LSDataTraceFlushDeferred");function u(t){return r("MetaConfig")._("62")?s.load().then(function(e){return e.flushExpiredDataTraces(t)}):(e||(e=n("Promise"))).resolve(function(){})}l.watchForExpiredTraces=u}),98);
__d("LSDatascriptEvaluatorMaybeDeferred",["cr:6542"],(function(t,n,r,o,a,i,l){"use strict";l.default=n("cr:6542")}),98);
__d("LSTruncateTableAndSetShowError",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(r){return t.sequence([function(e){return t.forEach(t.db.table(115).fetch(),function(e){return e.delete()})},function(r){return n[0]=t.i64.of_float(Date.now()),t.db.table(115).add({statusId:t.i64.cast([0,0]),timestampMs:n[0],errorShouldBeShown:e[0]})}])},function(e){return t.resolve(r)}])}e.__sproc_name__="LSConnectivityTruncateTableAndSetShowErrorStoredProcedure",e.__tables__=["user_visible_network_connectivity_error"],a.exports=e}),null);
__d("LSDeleteAllAndInsertConnectivityStatus",["LSTruncateTableAndSetShowError"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return t.sequence([function(e){return t.forEach(t.db.table(114).fetch(),function(e){return e.delete()})},function(n){return r[0]=t.i64.of_float(Date.now()),t.db.table(114).add({statusId:void 0,timestampMs:r[0],internetConnectionState:e[0]})},function(r){return t.storedProcedure(n("LSTruncateTableAndSetShowError"),t.i64.neq(e[0],t.i64.cast([0,1])))}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSConnectivityDeleteAllAndInsertConnectivityStatusStoredProcedure",e.__tables__=["connectivity_status"],a.exports=e}),null);
__d("LSDeleteAllAndInsertConnectivityStatusStoredProcedure",["LSDeleteAllAndInsertConnectivityStatus","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSDeleteAllAndInsertConnectivityStatus"),a.internetConnectionState);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("LSSyncStoredProcedureUtils",["I64","ReQL","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e,t,n){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n,r){var a=r!=null?(e||(e=o("I64"))).of_float(Date.now()+r):n.minTimeToSyncTimestampMs;yield t.pending_tasks.put(babelHelpers.extends({},n,{failureCount:(e||(e=o("I64"))).add(n.failureCount,e.one),minTimeToSyncTimestampMs:a}))}),u.apply(this,arguments)}function c(e,t,n){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var r=yield o("ReQL").firstAsync(o("ReQL").fromTableAscending(e.pending_tasks.index("queueNameTaskId")).getKeyRange(t));if(r!=null)return s(e,r,n)}),d.apply(this,arguments)}function m(e,t,n){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n,r){var a=yield t.network_requests.get(n,r);a!=null&&(yield t.network_requests.put(babelHelpers.extends({},a,{failureCount:(e||(e=o("I64"))).add(a==null?void 0:a.failureCount,e.one)})))}),p.apply(this,arguments)}function _(e,t,n){return f.apply(this,arguments)}function f(){return f=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var r=yield e.network_requests.get(t,n);r!=null&&(yield e.network_requests.put(babelHelpers.extends({},r,{epochId:void 0,networkTaskIdentifier:void 0})))}),f.apply(this,arguments)}l.incrementPendingTaskFailureCount=s,l.incrementPendingTasksTaskFailureCount=c,l.incrementNetworkRequestsTaskFailureCount=m,l.closeEpoch=_}),98);
__d("LSHandleTaskSendFailureForQueue2",["I64","LSSyncStoredProcedureUtils","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e,t,n){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n,r){yield o("LSSyncStoredProcedureUtils").incrementPendingTasksTaskFailureCount(t,n,r),yield o("LSSyncStoredProcedureUtils").incrementNetworkRequestsTaskFailureCount(t,n,(e||(e=o("I64"))).neg_one),yield o("LSSyncStoredProcedureUtils").closeEpoch(t,n,e.neg_one)}),u.apply(this,arguments)}l.default=s}),98);
__d("LSHandleTaskSendSuccessForQueue2",["I64","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e,t){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n){var r=yield t.network_requests.get(n,(e||(e=o("I64"))).neg_one);r==null||r.epochId==null||(yield t.network_requests.delete(n,e.neg_one))}),u.apply(this,arguments)}l.default=s}),98);
__d("LSHandleTaskSuccessOpsDownloadFailureForQueue",["I64","ReQL","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e,t){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n){var r=yield t.network_requests.get(n,(e||(e=o("I64"))).neg_one);r!=null&&r.epochId!=null&&(yield t.network_requests.delete(n,(e||(e=o("I64"))).neg_one));var a=yield o("ReQL").firstAsync(o("ReQL").fromTableAscending(t.pending_tasks.index("queueNameTaskId")).getKeyRange(n));a!=null&&(yield t.pending_tasks.delete(a.taskId))}),u.apply(this,arguments)}l.default=s}),98);
__d("LSInternetConnectionState",[],(function(t,n,r,o,a,i){var e=Object.freeze({NOT_CONNECTED:0,CONNECTED:1});i.default=e}),66);
__d("LSPlatformDefaultUnderlyingApi",["Promise","emptyFunction"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(){return r("emptyFunction")}function u(){return(e||(e=n("Promise"))).resolve()}var c={cleanup:r("emptyFunction"),logEvent:function(t){},onConnectionStatusChange:s,onReconnect:s,publish:u,subscribe:s};l.default=c}),98);
__d("LSPlatformDeviceId",["ChannelClientID","FBLogger","LSCookie","MqttWebDeviceID","gkx"],(function(t,n,r,o,a,i,l){"use strict";function e(){return r("gkx")("21118")?r("MqttWebDeviceID").clientID:r("ChannelClientID").getID()}var s=e();function u(t){return t==null&&r("FBLogger")("messenger_web").info("Missed provider type for deviceId"),t==="persisted"?o("LSCookie").get().d:e()}l.deviceId=s,l.getDeviceIdForProviderType=u}),98);
__d("shouldStubUnderlyingTransport",["ExecutionEnvironment"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(){return!(e||(e=r("ExecutionEnvironment"))).canUseDOM&&!(e||(e=r("ExecutionEnvironment"))).isInWorker}l.default=s}),98);
__d("LSPlatformMqttRealtimeTransport",["I64","LSIntEnum","LSPlatformDefaultUnderlyingApi","LSPlatformRealtimeTransport","Promise","promiseDone","shouldStubUnderlyingTransport"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;function c(e){return[{payload:JSON.stringify({ls_fdid:"",ls_sv:e}),qos:1,topic:"/ls_app_settings"}]}function d(t){var a={contents:t.getConnectionState()},i={contents:function(){}},l={contents:new(u||(u=n("Promise")))(function(e,t){i.contents=e})},c={onMQTTStateChanged:function(t){t==="Connected"?i.contents():t==="Disconnected"&&a.contents==="Connected"&&(l.contents=new(u||(u=n("Promise")))(function(e,t){i.contents=e})),a.contents=t}};return a.contents==="Connected"&&i.contents(),t.subscribeChannelEvents(c),[function(){t.unsubscribeChannelEvents(c)},function(a,i,c){return l.contents.then(function(){return new(u||(u=n("Promise")))(function(n,l){r("promiseDone")(t.publish("/ls_req",a,{listener:{onEvent:function(t){if(t==="NOT_CONNECTED")return l({RE_EXN_ID:o("LSPlatformRealtimeTransport").NotConnected})}},qos:(e||(e=o("I64"))).equal(i,(s||(s=o("LSIntEnum"))).ofNumber(4))?0:1,skipBuffer:!1}),function(){return n()},function(e){return e.message==="Publish Timed Out"?l({RE_EXN_ID:o("LSPlatformRealtimeTransport").Timeout}):l(e)})})})}]}var m={contents:void 0};function p(e,t,n){if(r("shouldStubUnderlyingTransport")())return r("LSPlatformDefaultUnderlyingApi");var o=n.getInstance(t),a={getPublishMessages:function(){return c(e)}};o.registerExtraConnectPayloadProvider(a);var i={onMQTTStateChanged:function(t){var e=m.contents;if(e!=null)return e(t)}};o.subscribeChannelEvents(i);var l=o.subscribe("/ls_foreground_state",function(){}),s=d(o),u=s[0],p=s[1];return{cleanup:function(){o.unregisterExtraConnectPayloadProvider(a),n.shutdownAndClear(),o.unsubscribeChannelEvents(i),l(),u()},logEvent:function(t){},onConnectionStatusChange:function(t){return m.contents=t,function(){m.contents=void 0}},onReconnect:function(t){var e={contents:o.getConnectionState()},n={contents:e.contents==="Connected"},r={onMQTTStateChanged:function(o){o==="Connected"&&(n.contents&&e.contents!=="Connected"&&t(1),n.contents=!0),e.contents=o}};return o.subscribeChannelEvents(r),function(){o.unsubscribeChannelEvents(r)}},publish:p,subscribe:function(t){return o.subscribe("/ls_resp",function(e){return t(e)})}}}l.default=p}),98);
__d("LSPlatformTaskSyncGroupId",[],(function(t,n,r,o,a,i){"use strict";var e=-1,l=e;i.default=l}),66);
__d("MWPBeginHandlingPendingTasksForQueue",["LSBeginHandlingFireForgetTasksForQueueStoredProcedure","LSBeginHandlingPendingTasksForQueue2","LSFactory","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var o=t.fireAndForgetTask,a=t.ignoreSoftDelay,l=t.queueName,s=yield e.runInTransaction((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){if(o===!0){var t=yield r("LSBeginHandlingFireForgetTasksForQueueStoredProcedure")(r("LSFactory")(e),{queueName:l}),n=t[0];return[n]}return r("LSBeginHandlingPendingTasksForQueue2")(e,{ignoreSoftDelay:a,queueName:l})});return function(t){return e.apply(this,arguments)}})(),"readwrite",void 0,void 0,i.id+":37");return s}),s.apply(this,arguments)}l.default=e}),98);
__d("MWPlatformTaskUtils",["FBLogger","I64","JSScheduler","MetaConfig","Promise","ReQL","asyncToGeneratorRuntime","getErrorSafe","promiseDone"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;function c(e,t){function a(){return i.apply(this,arguments)}function i(){return i=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{yield e(t)}catch(e){var n=r("getErrorSafe")(e);r("FBLogger")("messenger_web").catching(n).warn("Failed to calculate work for task queue %s",t.queueName)}}),i.apply(this,arguments)}if((u||(u=o("I64"))).gt(t.priority,(u||(u=o("I64"))).zero)&&r("MetaConfig")._("78")){var l=function(){var e=a()};(s||(s=r("JSScheduler"))).scheduleLoggingPriCallback(l)}else r("promiseDone")(a())}function d(e,t){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){try{yield e(t)}catch(e){var n=r("getErrorSafe")(e);r("FBLogger")("messenger_web").catching(n).warn("Failed to calculate work for fire forget queue %s",t.queueName)}}),m.apply(this,arguments)}function p(e,t){var r=new Set,a=[],i=[];return i.push(e.tables.pending_tasks.index("queueNameTaskId").subscribe(function(e,t){var n,i;if(t.operation==="delete"){r.add(e[0]);return}var l=t.operation==="put"&&t.prevValue==null||t.operation==="add",s=t.operation==="put"&&(u||(u=o("I64"))).compare(t.value.failureCount,(n=(i=t.prevValue)==null?void 0:i.failureCount)!=null?n:(u||(u=o("I64"))).zero)>0;(l||s)&&r.add(t.value.queueName),(t.operation==="add"&&t.value.dataTraceId==null||t.value.dataTraceId==="")&&a.push(t.value)})),i.push(e.tables.network_requests.subscribe(function(e,t){var n=e[0];n!==""&&(t.operation==="delete"||t.value.epochId==null)&&r.add(n)})),i.push(e.subscribeToCommit(function(){var i=Array.from(r);r.clear(),a=[],i.forEach((function(){var r=n("asyncToGeneratorRuntime").asyncToGenerator(function*(n){var r=yield o("ReQL").firstAsync(o("ReQL").fromTableAscending(e.tables.pending_tasks.index("queueNameTaskId")).bounds({gte:[n]}));r!=null&&c(t,r)});return function(e){return r.apply(this,arguments)}})())})),i}function _(e,t){r("promiseDone")(n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var n=yield o("ReQL").toArrayAsync(o("ReQL").fromTableAscending(e.tables.pending_tasks)),r=new Set;for(var a of n)r.has(a.queueName)||(r.add(a.queueName),c(t,a))})())}function f(t,a){r("promiseDone")(n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var l=yield o("ReQL").toArrayAsync(o("ReQL").fromTableAscending(t.tables.pending_fire_and_forget_tasks));yield(e||(e=n("Promise"))).all(l.map(function(e){return d(a,e)})),r("promiseDone")(t.runInTransaction(function(t){return(e||(e=n("Promise"))).all(l.map(function(e){return t.pending_fire_and_forget_tasks.delete(e.taskId)}))},"readwrite","background",void 0,i.id+":199"))})())}function g(e,t){var n=!1,r=[];return r.push(e.tables.pending_fire_and_forget_tasks.subscribe(function(e,t){if(t.operation!=="delete"){var r=t.operation==="put"&&t.prevValue==null||t.operation==="add";r&&(n=!0)}})),r.push(e.subscribeToCommit(function(){n&&f(e,t),n=!1})),r}l.checkQueuesWhenPendingTaskTableUpdates=p,l.checkAllPendingTasksForWork=_,l.checkAllFireForgetTasksForWork=f,l.checkQueuesWhenPendingFireForgetTaskTableUpdates=g}),98);
__d("LSPlatformTaskSystemTransport",["CurrentMessengerUser","FBLogger","I64","JSResourceForInteraction","JSScheduler","LSDatabaseProviderType","LSHandleTaskSendFailureForQueue2","LSHandleTaskSendSuccessForQueue2","LSHandleTaskSuccessOpsDownloadFailureForQueue","LSJson","LSMailboxInitialSyncCursor","LSPlatformRealtimeTransport","LSPlatformRequestId","LSPlatformRequestScheduler","LSPlatformServerResponseHandler","LSPlatformTaskSyncGroupId","LSShape","LSVec","MWPBeginHandlingPendingTasksForQueue","MWPBumpEntityKey","MWPlatformTaskUtils","Promise","ReQL","asyncToGeneratorRuntime","cr:4031","cr:6668","gkx","promiseDone","qex"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=500,d=r("JSResourceForInteraction")("publishLSPlatformDeidentifiedPayload").__setRef("LSPlatformTaskSystemTransport"),m=new Set([632,765,60011,1006,1018].map(function(e){return e.toString()})),p=(function(){function t(e,t,a,i){var l=this;this.key="ls",this.$8=!1,this.$19=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=yield r("MWPBeginHandlingPendingTasksForQueue")(l.$1,{ignoreSoftDelay:t,queueName:e});for(var a of n)yield l.$18(o("LSShape").toRecord(a))});return function(t,n){return e.apply(this,arguments)}})(),this.$1=e,this.$2=t,this.$3=a,this.$4=i,this.$8=o("LSDatabaseProviderType").isProviderPersisted(e),this.$5=new(r("LSPlatformRequestScheduler")),this.$6=new(r("LSPlatformServerResponseHandler"))(a),this.$7=this.$9(),this.$10()}var a=t.prototype;return a.$11=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=e.filter(function(e){return e.label!=null&&m.has(e.label)});if(n.length<e.length){n.length>0&&r("FBLogger")("maw_ohai").mustfix("Deidentifed tasks label %s sent together with normal tasks",n[0].label);var o=yield this.$2.publish(t);return o}var a=n[0],i=yield d.load(),l=yield i(babelHelpers.extends({},t,{taskLabel:a.label}));return l});function t(t,n){return e.apply(this,arguments)}return t})(),a.$12=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){yield this.$1.runInTransaction(function(t){return r("LSHandleTaskSendFailureForQueue2")(t,e)},"readwrite",void 0,void 0,i.id+":150")});function t(t){return e.apply(this,arguments)}return t})(),a.$13=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){yield this.$1.runInTransaction(function(t){return r("LSHandleTaskSendSuccessForQueue2")(t,e)},"readwrite","background",void 0,i.id+":159")});function t(t){return e.apply(this,arguments)}return t})(),a.$14=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){yield this.$1.runInTransaction(function(t){return r("LSHandleTaskSuccessOpsDownloadFailureForQueue")(t,e)},"readwrite",void 0,void 0,i.id+":167")});function t(t){return e.apply(this,arguments)}return t})(),a.$15=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=r("LSVec").toArray(e.tasks).slice(0).map(function(e){return o("LSShape").toRecord(e)}),n=t[0];if(n!=null){var a=yield o("ReQL").firstAsync(o("ReQL").fromTableAscending(this.$1.tables.pending_tasks).getKeyRange(n.task_id));return a==null?void 0:a.dataTraceId}});function t(t){return e.apply(this,arguments)}return t})(),a.$16=(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,a){var i=this;if(t.network_payload!=null){var l=o("LSShape").toRecord(t.network_payload);(u||(u=r("JSScheduler"))).scheduleLoggingPriCallback(function(){return l&&(n("cr:6668")==null?void 0:n("cr:6668").recordTaskSending(l.tasks))});var c=this.$4;try{yield(s||(s=n("Promise"))).all(r("LSVec").toArray(l.tasks).map(function(e){return o("LSShape").toRecord(e)}).map(function(n){var l=r("LSPlatformRequestId").generate();return i.$11([n],{databaseType:r("LSPlatformTaskSyncGroupId"),payload:o("LSJson").stringify(o("LSShape").ofRecord({label:n.label,payload:n.payload,version:c})),queueName:t.queue_name,requestId:l,syncChannel:o("LSMailboxInitialSyncCursor").taskChannel,type_:(e||(e=o("I64"))).of_int32(a)})}))}catch(e){}}});function a(e,n){return t.apply(this,arguments)}return a})(),a.$17=(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,a){if(t.network_payload!=null){var i=o("LSShape").toRecord(t.network_payload),l=r("LSVec").toArray(i.tasks).map(function(e){return o("LSShape").toRecord(e)}),s=yield this.$15(i);(u||(u=r("JSScheduler"))).scheduleLoggingPriCallback(function(){return i&&(n("cr:6668")==null?void 0:n("cr:6668").recordTaskSending(i.tasks))});var c=r("LSPlatformRequestId").generate(),d;try{d=yield this.$11(l,{databaseType:r("LSPlatformTaskSyncGroupId"),payload:o("LSJson").stringify(o("LSShape").ofRecord(babelHelpers.extends({},i,{version_id:this.$4},s==null?{}:{data_trace_id:s}))),queueName:t.queue_name,requestId:c,syncChannel:o("LSMailboxInitialSyncCursor").taskChannel,type_:(e||(e=o("I64"))).of_int32(a)})}catch(e){e.RE_EXN_ID===o("LSPlatformRealtimeTransport").Timeout?o("MWPBumpEntityKey").bumpEntityKeyWithAppId("lsplatform_tasks","send_fail_timeout"):e.RE_EXN_ID===o("LSPlatformRealtimeTransport").NotConnected?(o("MWPBumpEntityKey").bumpEntityKeyWithAppId("lsplatform_tasks","send_fail_notconnected"),r("FBLogger")("messenger_web").warn("Publishing a task to the server not connected")):(o("MWPBumpEntityKey").bumpEntityKeyWithAppId("lsplatform_tasks","send_fail_generic"),r("FBLogger")("messenger_web").warn("Error while publishing a task for request: %s, error %s",a,JSON.stringify(e))),yield this.$12(t.queue_name)}if(d!=null&&d.type==="taskresponse")try{var m=d.downloadTask,p=d.payload,_={experiments:p.ex,sp:p.sp,syncScript:p.payload,target:p.target,taskNames:l.map(function(e){return e.label}).filter(Boolean)};yield this.$6.evalWhenReady(m,_),yield this.$13(t.queue_name),(u||(u=r("JSScheduler"))).scheduleLoggingPriCallback(function(){return i&&(n("cr:6668")==null?void 0:n("cr:6668").recordTaskSent(i.tasks,p.payload))})}catch(e){o("MWPBumpEntityKey").bumpEntityKeyWithAppId("lsplatform_tasks","handle_task_failure"),r("FBLogger")("messenger_web").catching(e).mustfix("Encountered an error while processing a task response via realtime transport"),(e==null?void 0:e.name)==="dynamic_sproc_loading_timeout"&&r("gkx")("14417")?yield this.$14(t.queue_name):yield this.$12(t.queue_name)}}});function a(e,n){return t.apply(this,arguments)}return a})(),a.decideWhatToDoWithTask=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,a,i){var l=this,s=yield r("MWPBeginHandlingPendingTasksForQueue")(e,{fireAndForgetTask:i,ignoreSoftDelay:!1,queueName:t,transportKey:a});r("promiseDone")(n("asyncToGeneratorRuntime").asyncToGenerator(function*(){for(var e of s)yield l.$18(o("LSShape").toRecord(e))})())});function t(t,n,r,o){return e.apply(this,arguments)}return t})(),a.$18=(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var a=this.$5,i=this.$19;function l(t,n){a.schedule(function(){r("promiseDone")(i(t,!1))},t,n!=null?(e||(e=o("I64"))).to_float(n):c)}var s=(e||(e=o("I64"))).to_int32(t.work_item_type);switch(s){case 1:yield this.$17(t,3);break;case 5:yield this.$16(t,4);break;case 3:l(t.queue_name,t.next_sync_ms);break;case 2:yield n("cr:4031").handleLSWork(this.$1,t,o("CurrentMessengerUser").getAccountID());break;case 4:break;default:r("FBLogger")("messenger_web").warn("Unknown Task type of %s",s)}});function a(e){return t.apply(this,arguments)}return a})(),a.$9=function(){var e=this,t=this.$1;return this.$2.onReconnect(function(a){o("LSMailboxInitialSyncCursor").isWebApp&&a===3&&r("qex")._("2082")===!0||(r("promiseDone")(t.runInTransaction((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield o("ReQL").toArrayAsync(o("ReQL").fromTableAscending(e.network_requests).bounds({gte:o("ReQL").key("")}));yield(s||(s=n("Promise"))).all(t.map(function(t){var n=t.taskQueueName;return r("LSHandleTaskSendFailureForQueue2")(e,n)}))});return function(t){return e.apply(this,arguments)}})(),"readwrite",void 0,void 0,i.id+":446")),e.$10())})},a.$10=function(){var e=this;o("MWPlatformTaskUtils").checkAllPendingTasksForWork(this.$1,function(t){var n=t.queueName;return e.decideWhatToDoWithTask(e.$1,n)})},a.cleanup=function(){this.$7()},t})();l.default=p}),98);
__d("LSRequestId",["uuidv4"],(function(t,n,r,o,a,i,l){"use strict";var e="0123456789abcdef",s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function u(){for(var t=r("uuidv4")().replace(/[^0-9a-f]/gi,""),n=0,o=["#"];n<33;){var a=e.indexOf(t.charAt(n))<<8,i=e.indexOf(t.charAt(n+1))<<4,l=e.indexOf(t.charAt(n+2)),u=l|(i|a),c=u>>6;o.push(s.charAt(c)),o.push(s.charAt(u&63)),n+=3}return o.join("")}var c={generate:u};l.default=c}),98);
__d("LSVerifyContactRowExistsStoredProcedure",["LSSynchronousPromise","LSVerifyContactRowExists","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSVerifyContactRowExists"),a.id,a.contactIdType,a.profilePictureUrl,a.name,a.contactType,a.profilePictureFallbackUrl,a.profilePictureUrlExpirationTimestampMs,a.urlExpirationTimestampMs,a.normalizedNameForSearch,a.isMemorialized,a.isBlocked,a.blockedByViewerStatus,a.canViewerMessage,a.isSelf,a.authorityLevel,a.capabilities,a.capabilities2,a.workForeignEntityType,a.gender,a.contactViewerRelationship,a.secondaryName,a.firstName,a.friendshipStatus);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("LSVersion",[],(function(t,n,r,o,a,i){a.exports="26318032341218299"}),null);
__d("MAWAppVersion",["SiteData"],(function(t,n,r,o,a,i,l){"use strict";function e(){return"302.0."+r("SiteData").client_revision}function s(){return{primary:302,secondary:0,tertiary:r("SiteData").client_revision}}l.getVersionNumber=e,l.getAppVersionParts=s}),98);
__d("MAWCacheServiceDB",["FBLogger","MAWCurrentUser","MAWIndexedDbMetadata","MAWWormOdsLogger","MessengerWebInitData","Promise","WAHex","Worm","WormDump","WormEAR","WormIDbDriver","asyncToGeneratorRuntime","getErrorSafe","promiseDone","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e,s={autoIncrement:!0,indexes:{key:{fields:["key"],unique:!0}},primaryKey:"id",secure:!0},u={snippets:s},c=null,d=function(t,n,a){var e="maw_cache_service",i=new(o("WormEAR")).WormEAR(a,e,n),l=new(o("WormIDbDriver")).WormIDbDriver(t,e,a,i,o("MAWWormOdsLogger").wormOdsWorkerLogger,{onTransactionError:p});return new(o("Worm")).WormDatabase(l,r("qpl")._(1056840657,"2716"))};function m(){return c!==null||(c=new(e||(e=n("Promise")))((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){try{var n=d(o("MAWIndexedDbMetadata").MAWcacheServiceDbName(o("MAWCurrentUser").getID()),o("WAHex").parseHex(r("MessengerWebInitData").accountKeyV2),u);yield n.init(),e(n)}catch(e){var a=r("getErrorSafe")(e);r("FBLogger")("messenger_web").catching(a).mustfix("Failed to create cache service DB"),c=null,t(a)}});return function(t,n){return e.apply(this,arguments)}})())),c}function p(e){if(e instanceof o("WormEAR").DecryptionError){var t=e;r("FBLogger")("MAWCacheService").mustfix("EAR decryption error in store: %s. Attempting to delete the store:",t.store),r("promiseDone")(m().then(function(e){return e.runInTransaction([t.store],"readwrite",function(e){return e.stores[t.store].clear()},"delete-corrupted-entity")}).then(function(){r("FBLogger")("MAWCacheService").info("Successfully deleted corrupted store %s",t.store)}).catch(function(e){var n=r("getErrorSafe")(e);r("FBLogger")("MAWCacheService").catching(n).mustfix("Failed to delete corrupted store %s, err: %s",t.store,n.message)}))}}function _(e){return e.map(function(e){var t=e[0],n=e[1];return n})}function f(){return g.apply(this,arguments)}function g(){return g=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=yield m();return e.dump({snippets:{customFields:{id:o("WormDump").wormNonSensitiveField,key:o("WormDump").wormNonSensitiveField,timestamp:o("WormDump").wormNonSensitiveField,value:function(t){var e;return{snippet:(e=o("WormDump")).wormRedact(t.snippet),snippetMsgAckLevel:e.wormNonSensitiveField(t.snippetMsgAckLevel),snippetMsgId:e.wormNonSensitiveField(t.snippetMsgId),snippetNewestIncomingMsgs:e.wormNonSensitiveField(t.snippetNewestIncomingMsgs),snippetReactionId:e.wormRedact(t.snippetReactionId)}}}}})}),g.apply(this,arguments)}l.getOrSetupMAWCacheDB=m,l.convertCacheValueToDBRawValue=_,l.getDbDump=f}),98);
__d("MAWConsoleLogger",["gkx"],(function(t,n,r,o,a,i,l){"use strict";var e=r("gkx")("2656");function s(t,n,r){if(e){var o=r.map(function(e){return"["+e+"]"}).join("");if(t==="count"){console.count(o+" "+String(n));return}for(var a=arguments.length,i=new Array(a>3?a-3:0),l=3;l<a;l++)i[l-3]=arguments[l];if(o){var s;(s=console)[t].apply(s,[o,n].concat(i))}else{var u;(u=console)[t].apply(u,[n].concat(i))}}}l.logToConsole=s}),98);
__d("MAWDbChatId__UNSAFE_DO_NOT_USE",["I64"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t){return(e||(e=o("I64"))).of_float(t)}function u(e,t){return e+"_"+t}l.convertToChatId64__DEPRECATED=s,l.craftAltIndex__DEPRECATED=u}),98);
__d("MAWHexUtils",["FBLogger"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.toString(16);return(t.length-1).toString(16)+t}function s(e){for(var t=1;t<e.length;t++){var n=e.substring(0,t),o=e.substring(t);if(o.length-1===parseInt(n,16))return parseInt(o,16)}throw r("FBLogger")("messenger_web").mustfixThrow("Cannot convert the order-preserving-hex back to number")}l.orderPreservingHex=e,l.reverseOrderPreservingHex=s}),98);
__d("WAMsg",["WAAssertUnreachable","WAJids","WAMsgType","err"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.author,n=e.chat,r=e.externalId;return n+"_"+r+"_"+t}function s(e){switch(e.type){case o("WAMsgType").MSG_TYPE.TEXT:case o("WAMsgType").MSG_TYPE.IMAGE:case o("WAMsgType").MSG_TYPE.VIDEO:case o("WAMsgType").MSG_TYPE.PTT:case o("WAMsgType").MSG_TYPE.GIF:case o("WAMsgType").MSG_TYPE.STICKER:case o("WAMsgType").MSG_TYPE.RECEIVER_FETCH:return{author:e.id.author,deleteTs:e.deleteTs,ephemeralSetting:e.ephemeralSetting,expirationTs:e.expirationTs,externalId:e.id.externalId,sentTs:e.sentTs,serverTs:e.serverTs,ts:e.ts};case o("WAMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:case o("WAMsgType").MSG_TYPE.UNAVAILABLE:return{author:e.id.author,externalId:e.id.externalId,sentTs:e.sentTs,ts:e.ts};default:return e.type,null}}function u(e){var t=s(e);if(t==null)return null;switch(e.type){case o("WAMsgType").MSG_TYPE.TEXT:return babelHelpers.extends({},t,{msgContent:e.msgContent,type:o("WAMsgType").MSG_TYPE.TEXT});case o("WAMsgType").MSG_TYPE.IMAGE:return babelHelpers.extends({},t,{mediaId:e.mediaId,type:o("WAMsgType").MSG_TYPE.IMAGE});case o("WAMsgType").MSG_TYPE.VIDEO:return babelHelpers.extends({},t,{mediaId:e.mediaId,type:o("WAMsgType").MSG_TYPE.VIDEO});case o("WAMsgType").MSG_TYPE.PTT:return babelHelpers.extends({},t,{mediaId:e.mediaId,type:o("WAMsgType").MSG_TYPE.PTT});case o("WAMsgType").MSG_TYPE.STICKER:return babelHelpers.extends({},t,{mediaId:e.mediaId,type:o("WAMsgType").MSG_TYPE.STICKER});case o("WAMsgType").MSG_TYPE.RECEIVER_FETCH:return babelHelpers.extends({},t,{type:o("WAMsgType").MSG_TYPE.RECEIVER_FETCH});case o("WAMsgType").MSG_TYPE.GIF:return babelHelpers.extends({},t,{mediaId:e.mediaId,type:o("WAMsgType").MSG_TYPE.PTT});case o("WAMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:return babelHelpers.extends({},t,{type:o("WAMsgType").MSG_TYPE.EXPIRED_EPHEMERAL});case o("WAMsgType").MSG_TYPE.UNAVAILABLE:return babelHelpers.extends({},t,{type:o("WAMsgType").MSG_TYPE.UNAVAILABLE});case o("WAMsgType").MSG_TYPE.REVOKED:case o("WAMsgType").MSG_TYPE.REACTION:case o("WAMsgType").MSG_TYPE.ICDC_ALERT:case o("WAMsgType").MSG_TYPE.ADMIN:case o("WAMsgType").MSG_TYPE.FUTUREPROOF:case o("WAMsgType").MSG_TYPE.CIPHERTEXT:case o("WAMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:case o("WAMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE:case o("WAMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE:case o("WAMsgType").MSG_TYPE.GROUP_INVITE:case o("WAMsgType").MSG_TYPE.DELETE_FOR_ME:case o("WAMsgType").MSG_TYPE.DOCUMENT_FILE:case o("WAMsgType").MSG_TYPE.EDIT_ACTION:return null;default:return r("WAAssertUnreachable")(e.type)}}function c(e){if(o("WAJids").isAuthorSystem(e.author))throw r("err")("Cannot send @system messages");return{author:e.author,chat:e.chat,externalId:e.externalId}}l.craftWAMsgIdString=e,l.asQuotedMsg=u,l.asProtocolMsgId=c}),98);
__d("MAWDbMsg",["FBLogger","I64","MAWDbChatId__UNSAFE_DO_NOT_USE","MAWHexUtils","MAWMsgType","WAMsg"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=[(s=o("MAWMsgType")).MSG_TYPE.REVOKED,s.MSG_TYPE.EPHEMERAL_SYNC_RESPONSE,s.MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE,s.MSG_TYPE.GROUP_INVITE,s.MSG_TYPE.SK_DISTRIBUTION,s.MSG_TYPE.RAVEN_ACTION],c=0,d=Number.MAX_SAFE_INTEGER;function m(e){return e}function p(e){return e}function _(e){return D(e)?e:null}function f(e){return e}function g(e){return e}var h="futureproof",y="futureproof_spam",C="spam",b="toBeRead",v="e2ee_admin_msg",S="cutover_admin_msg";function R(e,t){return o("MAWHexUtils").orderPreservingHex(e)+"_"+o("MAWHexUtils").orderPreservingHex(t)+"_m"}function L(e,t,n){var r=o("MAWHexUtils").orderPreservingHex(e)+"_"+o("MAWHexUtils").orderPreservingHex(t)+"_m";return r+"_"+n.externalId}function E(e,t){return o("MAWHexUtils").orderPreservingHex(e)+"_"+o("MAWHexUtils").orderPreservingHex(t)+"_um"}function k(e,t){return o("MAWHexUtils").orderPreservingHex(e)+"_"+o("MAWHexUtils").orderPreservingHex(t)+"_r"}function I(e,t,n){var r=n!=null?n:o("MAWHexUtils").orderPreservingHex(Math.floor(Math.random()*1e4));return o("MAWHexUtils").orderPreservingHex(e)+"_"+o("MAWHexUtils").orderPreservingHex(t)+"_DEBUG_"+r+")}"}function T(e){var t=e.split("_");return t.length>=3&&t[0]!==""&&t[1]!==""&&t[2]==="m"}function D(e){var t=/^(.*)\..*?$/,n=t.test(e);return T(e)||n}function x(e){return o("MAWDbChatId__UNSAFE_DO_NOT_USE").craftAltIndex__DEPRECATED(e,b)}function $(e){return o("MAWDbChatId__UNSAFE_DO_NOT_USE").craftAltIndex__DEPRECATED(e,v)}function P(e){return o("MAWDbChatId__UNSAFE_DO_NOT_USE").craftAltIndex__DEPRECATED(e,S)}function N(e){if(!T(e))return 0;var t=e.split("_"),n=t[0],r=t[1];return o("MAWHexUtils").reverseOrderPreservingHex(r)}function M(e){return o("MAWHexUtils").orderPreservingHex(e)+"_"}function w(e){return o("MAWHexUtils").orderPreservingHex(e)+"_z"}function A(e){switch(e.type){case o("MAWMsgType").MSG_TYPE.XMA:return!0;case o("MAWMsgType").MSG_TYPE.IMAGE:case o("MAWMsgType").MSG_TYPE.VIDEO:case o("MAWMsgType").MSG_TYPE.PTT:case o("MAWMsgType").MSG_TYPE.GIF:case o("MAWMsgType").MSG_TYPE.STICKER:case o("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:case o("MAWMsgType").MSG_TYPE.TEXT:case o("MAWMsgType").MSG_TYPE.FUTUREPROOF:case o("MAWMsgType").MSG_TYPE.CIPHERTEXT:case o("MAWMsgType").MSG_TYPE.UNAVAILABLE:case o("MAWMsgType").MSG_TYPE.ADMIN:case o("MAWMsgType").MSG_TYPE.REVOKED:case o("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:case o("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:case o("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE:case o("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:case o("MAWMsgType").MSG_TYPE.ICDC_ALERT:case o("MAWMsgType").MSG_TYPE.GROUP_INVITE:case o("MAWMsgType").MSG_TYPE.RAVEN:case o("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:case o("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:case o("MAWMsgType").MSG_TYPE.GROUP_POLL_CREATE:case o("MAWMsgType").MSG_TYPE.GROUP_POLL_UPDATE:return!1}throw r("FBLogger")("messenger_web").mustfixThrow('Invalid msg type for isXMAMsg check: "%s"',e.type)}function F(e){switch(e.type){case o("MAWMsgType").MSG_TYPE.IMAGE:case o("MAWMsgType").MSG_TYPE.VIDEO:case o("MAWMsgType").MSG_TYPE.PTT:case o("MAWMsgType").MSG_TYPE.GIF:case o("MAWMsgType").MSG_TYPE.STICKER:case o("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:case o("MAWMsgType").MSG_TYPE.RAVEN:return!0;case o("MAWMsgType").MSG_TYPE.TEXT:case o("MAWMsgType").MSG_TYPE.FUTUREPROOF:case o("MAWMsgType").MSG_TYPE.CIPHERTEXT:case o("MAWMsgType").MSG_TYPE.UNAVAILABLE:case o("MAWMsgType").MSG_TYPE.ADMIN:case o("MAWMsgType").MSG_TYPE.REVOKED:case o("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:case o("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:case o("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE:case o("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:case o("MAWMsgType").MSG_TYPE.ICDC_ALERT:case o("MAWMsgType").MSG_TYPE.GROUP_INVITE:case o("MAWMsgType").MSG_TYPE.XMA:case o("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:case o("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:case o("MAWMsgType").MSG_TYPE.GROUP_POLL_CREATE:case o("MAWMsgType").MSG_TYPE.GROUP_POLL_UPDATE:return!1}throw r("FBLogger")("messenger_web").mustfixThrow('Invalid msg type for isMediaMsg check: "%s"',e.type)}function O(e){return e.type===o("MAWMsgType").MSG_TYPE.RECEIVER_FETCH}function B(e){switch(e.type){case o("MAWMsgType").MSG_TYPE.IMAGE:case o("MAWMsgType").MSG_TYPE.VIDEO:return!0;case o("MAWMsgType").MSG_TYPE.PTT:case o("MAWMsgType").MSG_TYPE.GIF:case o("MAWMsgType").MSG_TYPE.STICKER:case o("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:case o("MAWMsgType").MSG_TYPE.RAVEN:case o("MAWMsgType").MSG_TYPE.TEXT:case o("MAWMsgType").MSG_TYPE.FUTUREPROOF:case o("MAWMsgType").MSG_TYPE.CIPHERTEXT:case o("MAWMsgType").MSG_TYPE.UNAVAILABLE:case o("MAWMsgType").MSG_TYPE.ADMIN:case o("MAWMsgType").MSG_TYPE.REVOKED:case o("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:case o("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:case o("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE:case o("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:case o("MAWMsgType").MSG_TYPE.ICDC_ALERT:case o("MAWMsgType").MSG_TYPE.GROUP_INVITE:case o("MAWMsgType").MSG_TYPE.XMA:case o("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:case o("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:case o("MAWMsgType").MSG_TYPE.GROUP_POLL_CREATE:return!1;default:return r("FBLogger")("messenger_web").mustfix('Invalid msg type for isPhotoOrVideoMediaMsg check: "%s"',e.type),!1}}function W(e){switch(e.type){case o("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:return!0;case o("MAWMsgType").MSG_TYPE.IMAGE:case o("MAWMsgType").MSG_TYPE.VIDEO:case o("MAWMsgType").MSG_TYPE.PTT:case o("MAWMsgType").MSG_TYPE.GIF:case o("MAWMsgType").MSG_TYPE.STICKER:case o("MAWMsgType").MSG_TYPE.RAVEN:case o("MAWMsgType").MSG_TYPE.TEXT:case o("MAWMsgType").MSG_TYPE.FUTUREPROOF:case o("MAWMsgType").MSG_TYPE.CIPHERTEXT:case o("MAWMsgType").MSG_TYPE.UNAVAILABLE:case o("MAWMsgType").MSG_TYPE.ADMIN:case o("MAWMsgType").MSG_TYPE.REVOKED:case o("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:case o("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:case o("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE:case o("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:case o("MAWMsgType").MSG_TYPE.ICDC_ALERT:case o("MAWMsgType").MSG_TYPE.GROUP_INVITE:case o("MAWMsgType").MSG_TYPE.XMA:case o("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:case o("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:case o("MAWMsgType").MSG_TYPE.GROUP_POLL_CREATE:return!1;default:return r("FBLogger")("messenger_web").mustfix('Invalid msg type for isDocumentFileMediaMsg check: "%s"',e.type),!1}}function q(e){switch(e.type){case o("MAWMsgType").MSG_TYPE.TEXT:case o("MAWMsgType").MSG_TYPE.IMAGE:case o("MAWMsgType").MSG_TYPE.VIDEO:case o("MAWMsgType").MSG_TYPE.PTT:case o("MAWMsgType").MSG_TYPE.GIF:case o("MAWMsgType").MSG_TYPE.STICKER:case o("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:case o("MAWMsgType").MSG_TYPE.REVOKED:case o("MAWMsgType").MSG_TYPE.DELETE_FOR_ME:case o("MAWMsgType").MSG_TYPE.XMA:case o("MAWMsgType").MSG_TYPE.RAVEN:case o("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:case o("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:case o("MAWMsgType").MSG_TYPE.GROUP_POLL_CREATE:return!0;case o("MAWMsgType").MSG_TYPE.FUTUREPROOF:case o("MAWMsgType").MSG_TYPE.CIPHERTEXT:case o("MAWMsgType").MSG_TYPE.UNAVAILABLE:case o("MAWMsgType").MSG_TYPE.ADMIN:case o("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:case o("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:case o("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE:case o("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:case o("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE:case o("MAWMsgType").MSG_TYPE.ICDC_ALERT:case o("MAWMsgType").MSG_TYPE.GROUP_INVITE:case o("MAWMsgType").MSG_TYPE.SK_DISTRIBUTION:case o("MAWMsgType").MSG_TYPE.RAVEN_ACTION:case o("MAWMsgType").MSG_TYPE.EDIT_ACTION:return!1}throw r("FBLogger")("messenger_web").mustfixThrow('Invalid msg type for isContentMsg check: "%s"',e.type)}function U(e){switch(e.type){case o("MAWMsgType").MSG_TYPE.TEXT:case o("MAWMsgType").MSG_TYPE.IMAGE:case o("MAWMsgType").MSG_TYPE.VIDEO:case o("MAWMsgType").MSG_TYPE.PTT:case o("MAWMsgType").MSG_TYPE.GIF:case o("MAWMsgType").MSG_TYPE.STICKER:case o("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:case o("MAWMsgType").MSG_TYPE.XMA:case o("MAWMsgType").MSG_TYPE.RAVEN:case o("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:case o("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:return!0;case o("MAWMsgType").MSG_TYPE.FUTUREPROOF:case o("MAWMsgType").MSG_TYPE.CIPHERTEXT:case o("MAWMsgType").MSG_TYPE.UNAVAILABLE:case o("MAWMsgType").MSG_TYPE.ADMIN:case o("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:case o("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:case o("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE:case o("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:case o("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE:case o("MAWMsgType").MSG_TYPE.ICDC_ALERT:case o("MAWMsgType").MSG_TYPE.GROUP_INVITE:case o("MAWMsgType").MSG_TYPE.REVOKED:case o("MAWMsgType").MSG_TYPE.DELETE_FOR_ME:case o("MAWMsgType").MSG_TYPE.SK_DISTRIBUTION:case o("MAWMsgType").MSG_TYPE.EDIT_ACTION:case o("MAWMsgType").MSG_TYPE.GROUP_POLL_CREATE:return!1}throw r("FBLogger")("messenger_web").mustfixThrow('Invalid msg type for isMsgEligibleForTriggeringEphemeralSyncResponse check: "%s"',e.type)}function V(e){return G(e.type)}function H(e){return e.type===o("MAWMsgType").MSG_TYPE.ADMIN}function G(e){return e==="EphemeralSyncResponse"||e==="EphemeralSettingChangeFromCurrentDevice"||e==="GroupInvite"||e==="SenderKeyDistribution"||e==="RavenAction"||e==="EditAction"}function z(e){return e==="RavenAction"}function j(e){return e.originalTs!=null?e.originalTs:K(e)}function K(e){return e.serverTs!=null?e.serverTs:e.ts}function Q(e){return e.sortOrderMs!=null?e.sortOrderMs:K(e)*1e3}function X(e,t){return e.serverTs!=null?Math.max(t+1,e.serverTs*1e3):t+1}function Y(e){switch(e.type){case o("MAWMsgType").MSG_TYPE.TEXT:return e.msgContent;case o("MAWMsgType").MSG_TYPE.EDIT_ACTION:return e.editMsgContent;case o("MAWMsgType").MSG_TYPE.IMAGE:case o("MAWMsgType").MSG_TYPE.VIDEO:case o("MAWMsgType").MSG_TYPE.PTT:case o("MAWMsgType").MSG_TYPE.GIF:case o("MAWMsgType").MSG_TYPE.STICKER:case o("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:case o("MAWMsgType").MSG_TYPE.REVOKED:case o("MAWMsgType").MSG_TYPE.DELETE_FOR_ME:case o("MAWMsgType").MSG_TYPE.FUTUREPROOF:case o("MAWMsgType").MSG_TYPE.CIPHERTEXT:case o("MAWMsgType").MSG_TYPE.UNAVAILABLE:case o("MAWMsgType").MSG_TYPE.ADMIN:case o("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:case o("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:case o("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE:case o("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:case o("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE:case o("MAWMsgType").MSG_TYPE.ICDC_ALERT:case o("MAWMsgType").MSG_TYPE.GROUP_INVITE:case o("MAWMsgType").MSG_TYPE.XMA:case o("MAWMsgType").MSG_TYPE.RAVEN:case o("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:case o("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:case o("MAWMsgType").MSG_TYPE.GROUP_POLL_CREATE:return}throw r("FBLogger")("messenger_web").mustfixThrow('Invalid msg type for getMsgContent check: "%s"',e.type)}function J(e){return o("WAMsg").craftWAMsgIdString({author:e.author,chat:e.threadJid,externalId:e.externalId})}function Z(t){return(e||(e=o("I64"))).to_float(t)}l.NO_CONTENT_MESSAGE_TYPES_ALLOWLIST=u,l.MIN_MSG_SORT_ORDER=c,l.MAX_MSG_SORT_ORDER=d,l.toCachedMsgId__UNSAFE_DO_NOT_USE=m,l.toMsgId__UNSAFE_DO_NOT_USE=p,l.toMsgId=_,l.stanzaIdToMsgId=f,l.instamadilloMsgIdToMsgId=g,l.FUTUREPROOF_ALT_INDEX=h,l.FUTUREPROOF_SPAM_ALT_INDEX=y,l.SPAM_ALT_INDEX=C,l.craftMsgId__DEPRECATED=R,l.craftMsgIdV2=L,l.craftUnrenderedMsgId=E,l.craftReactionId=k,l.craftDebugMsgId=I,l.isValidMsgId=D,l.craftToBeReadAltIndex=x,l.craftE2eeAdminMsgAltIndex=$,l.craftCutoverAdminMsgAltIndex=P,l.getInChatMsgIdFromMsgId=N,l.msgIdsInChatLowerBound=M,l.msgIdsInChatUpperBound=w,l.isXMAMsg=A,l.isMediaMsg=F,l.isReceiverFetchStickerMsg=O,l.isPhotoOrVideoMediaMsg=B,l.isDocumentFileMediaMsg=W,l.isContentMsg=q,l.isMsgEligibleForTriggeringEphemeralSyncResponse=U,l.isUnrenderedMsg=V,l.isAdminMsg=H,l.isUnrenderedMsgType=G,l.isRavenActionMsgType=z,l.getOriginalTsFromMsg=j,l.getCanonicalTsFromMsg=K,l.getSortOrderWithFallback=Q,l.getSortOrderFromPrevious=X,l.getMsgContent=Y,l.getWAMsgId=J,l.convertMsgRowId64=Z}),98);
__d("MAWDeleteOldLogsFromDisk",["Deferred","MAWLogIndexedDb","MAWSaveLogToDisk","MAWTransactionMode","WALogger","asyncToGeneratorRuntime","justknobx"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d=r("justknobx")._("1400"),m=r("justknobx")._("1401"),p=r("justknobx")._("1402"),_=(u=o("MAWLogIndexedDb")).makeLogMsgrTransactor("logs",(c=o("MAWTransactionMode")).READONLY)(function(e){var t=new(r("Deferred")),n=e(),o=n.count();return o.onsuccess=function(e){var n=e.target.result;t.resolve(n)},o.onerror=function(e){t.reject(e)},t.getPromise()}),f=u.makeLogMsgrTransactor("logs",c.READONLY)(function(e,t){var n=new(r("Deferred")),o=e(),a=[],i=o.index("date"),l=i.openCursor();return l.onsuccess=function(e){var r=e.target.result;if(r==null||!t(r.value,a)){n.resolve(a);return}a.push(r.value.id),r.continue()},l.onerror=function(e){n.reject(e)},n.getPromise()}),g=u.makeLogMsgrTransactor("logs",c.READWRITE)(function(e){var t=new(r("Deferred")),n=e(),a=n.clear();return a.onsuccess=function(){return t.resolve()},a.onerror=function(e){return t.reject(e)},o("MAWSaveLogToDisk").clearLogEntryCache(),t.getPromise()}),h=u.makeLogMsgrTransactor("logs",c.READWRITE)(function(e,t){var n=new(r("Deferred")),o=e();return t.forEach(function(e){return o.delete(e)}),o.transaction.oncomplete=function(){return n.resolve()},o.transaction.onerror=function(e){return n.reject(e)},n.getPromise()});function y(e,t){var n=Date.now()-p;return e!=null&&e.date<=n}function C(e){return function(t,n){return n.length<e}}function b(){return v.apply(this,arguments)}function v(){return v=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{var t=yield _();if(t===0)return;var n=t-m;if(n>0){var r=yield f(C(n));yield h(r);return}var a=yield f(y);a.length>0&&(yield h(a))}catch(t){o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Failed to delete old logs: ",""])),t)}}),v.apply(this,arguments)}function S(){return R.apply(this,arguments)}function R(){return R=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{var e=yield _();if(e===0)return;if(e>=d){yield g();return}}catch(e){o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Failed to delete old logs: ",""])),e)}}),R.apply(this,arguments)}l.clearLogs=g,l.deleteOldLogs=b,l.deleteOldLogsOnStartup=S}),98);
__d("MAWRotateDTSG",["CSRFGuard","DTSG","MWFBLogger","asyncToGeneratorRuntime","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=o("MWFBLogger").MWLogger().tags(["RotateDTSG"]),c=(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var t,n;u.DEBUG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Getting new DTSG token"])));var r=new Request("/ajax/dtsg/?__a=true",{credentials:"include",method:"GET"}),a=yield self.fetch(r);if(a.status!==200)throw u.mustfixThrow("Unable to get new DTSG token: "+a.status);var i=yield a.text(),l=o("CSRFGuard").clean(i),s=JSON.parse(l),c=s==null||(t=s.payload)==null?void 0:t.token,d=s==null||(n=s.payload)==null?void 0:n.valid_for;if(c==null||d==null)throw u.mustfixThrow("DTSG response is not valid: "+l+"'");return{token:c,validFor:d}});return function(){return t.apply(this,arguments)}})(),d=null;function m(){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){self.clearTimeout(d);try{var e=yield c(),t=e.token,n=e.validFor;return d=self.setTimeout(m,n/2*1e3),o("DTSG").setToken(t),!0}catch(e){return u.catching(r("getErrorSafe")(e)).MUSTFIX(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Error rotating DTSG"]))),d=self.setTimeout(m,600*1e3),!1}}),p.apply(this,arguments)}l.getNewDTSG=c,l.tryRotateDTSG=m}),98);
__d("MAWUnrecoverableDbErrors",["FBLogger"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(function(e){function t(){return e.apply(this,arguments)||this}return babelHelpers.inheritsLoose(t,e),t})(babelHelpers.wrapNativeSuper(Error)),u=(function(e){function t(){for(var t,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t=e.call.apply(e,[this].concat(r))||this,t.name="indexed_db_access_error",babelHelpers.assertThisInitialized(t)||babelHelpers.assertThisInitialized(t)}return babelHelpers.inheritsLoose(t,e),t})(s),c=(function(e){function t(){for(var t,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t=e.call.apply(e,[this].concat(r))||this,t.name="ear_init_error",babelHelpers.assertThisInitialized(t)||babelHelpers.assertThisInitialized(t)}return babelHelpers.inheritsLoose(t,e),t})(s),d=(function(e){function t(){for(var t,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t=e.call.apply(e,[this].concat(r))||this,t.name="ear_runtime_error",babelHelpers.assertThisInitialized(t)||babelHelpers.assertThisInitialized(t)}return babelHelpers.inheritsLoose(t,e),t})(s),m=(function(e){function t(t,n,r,o){var a;return a=e.call(this,t)||this,a.name="ebsm_hydration_error",a.fullDeletion=n,a.qplInstanceKey=r,a.tableName=o,a}return babelHelpers.inheritsLoose(t,e),t})(s),p=(function(e){function t(){for(var t,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t=e.call.apply(e,[this].concat(r))||this,t.name="wa_exceeded_storage_quota_error",babelHelpers.assertThisInitialized(t)||babelHelpers.assertThisInitialized(t)}return babelHelpers.inheritsLoose(t,e),t})(s);function _(e){return e==null?!1:e instanceof s||f(e.name)}function f(e){return e==="indexed_db_access_error"||e==="ear_init_error"||e==="ear_runtime_error"||e==="ebsm_hydration_error"||e==="wa_exceeded_storage_quota_error"}var g=null,h=new Set;function y(){return g}function C(t,n){r("FBLogger")("messenger_web").MUSTFIX(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Setting unrecoverable db error: ",""])),t.name),g=t,n==null||n(),h.forEach(function(e){return e(t)})}function b(e){return h.add(e),function(){return h.delete(e)}}l.UnrecoverableDbError=s,l.IndexedDbAccessError=u,l.EarInitError=c,l.EarRuntimeError=d,l.EbsmHydrationError=m,l.WAExceededStorageQuotaError=p,l.isUnrecoverableDbError=_,l.isUnrecoverableDbErrorByName=f,l.getError=y,l.setError=C,l.subscribe=b}),98);
__d("MWPlatformTaskSystem",["LSPlatformRequestScheduler","MWPlatformTaskUtils","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e,t){var n=this;this.$1=e,this.$2=t,this.$3=new(r("LSPlatformRequestScheduler")),this.$4=o("MWPlatformTaskUtils").checkQueuesWhenPendingTaskTableUpdates(e,function(t){var r=t.queueName,o=t.transportKey;return n.$6(e,r,o,!1)}),this.$5=o("MWPlatformTaskUtils").checkQueuesWhenPendingFireForgetTaskTableUpdates(e,function(t){var r=t.queueName,o=t.transportKey;return n.$6(e,r,o,!0)}),this.$7()}var t=e.prototype;return t.$6=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,r){yield this.$2.decideWhatToDoWithTask(e,t,n,r)});function t(t,n,r,o){return e.apply(this,arguments)}return t})(),t.$7=function(){var e=this;o("MWPlatformTaskUtils").checkAllPendingTasksForWork(this.$1,function(t){var n=t.queueName;return e.$6(e.$1,n)})},t.cleanup=function(){this.$4.forEach(function(e){return e()}),this.$5.forEach(function(e){return e()}),this.$2.cleanup()},e})();l.default=e}),98);
__d("MainPageUrl",["ExecutionEnvironment","FBLogger","SimpleHook","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=new URL((function(){var e=(self!==void 0?self:typeof window!="undefined"?window:{location:{href:"http://undefined"}}).location.href;return(u||(u=r("ExecutionEnvironment"))).isInWorker&&e&&e.startsWith("blob:")&&(e=e.substring(5,e.length)),e})()),d=new URL(c.href),m=new(o("SimpleHook")).SimpleHook;function p(){var e;return(u||(u=r("ExecutionEnvironment"))).isInBrowser&&(d==null||(e=d.searchParams)==null?void 0:e.get("workerlog"))==="debug"}function _(t){try{p()&&r("FBLogger")("worker").DEBUG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["received url ",""])),t);var n=new URL(t,d.href||c.href);d.href!==n.href?(d.href=n.href,m.call(d)):p()&&r("FBLogger")("worker").DEBUG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["ignoring url: path didn't change in ",""])),t)}catch(e){r("FBLogger")("worker").catching(r("getErrorSafe")(e)).warn("invalid url")}}typeof window=="object"&&typeof window.location=="object"&&typeof window.location.href=="string"&&_(window.location.href),l.mainPageUrl=d,l.onMainPageUrlChange=m,l.isWorkerLogEnabled=p,l.updateMainPageUrl=_}),98);
__d("NestedTimeRange",["SimpleHook","performance","performanceAbsoluteNow"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=new(o("SimpleHook")).SimpleHook,c=new(o("SimpleHook")).SimpleHook,d="/";function m(e,t){return""+e+d+t}var p=(function(){function t(e,t){t===void 0&&(t=null),this.$3=0,this.$1=e,this.$2=t}var n=t.prototype;return n.isRunning=function(){return this.$3>0},n.fullname=function(){return this.$2!==null?m(this.$2.fullname(),this.$1):this.$1},n.start=function(n){if(n===void 0&&(n=(e||(e=r("performanceAbsoluteNow")))()),this.$3===0){var t;(t=this.$2)==null||t.start(n),this.__onStart(n)}return++this.$3,n},n.__onStart=function(t){u.call(this,t)},n.stop=function(n){if(n===void 0&&(n=(e||(e=r("performanceAbsoluteNow")))()),--this.$3,this.$3===0){var t;this.__onStop(n),(t=this.$2)==null||t.stop(n)}return n},n.__onStop=function(t){c.call(this,t)},t})();function _(){(s||(s=r("performance"))).mark&&(s||(s=r("performance"))).measure&&(u.add(function(e,t){(s||(s=r("performance"))).mark(e.fullname()+"_start")}),c.add(function(e,t){(s||(s=r("performance"))).measure(e.fullname(),e.fullname()+"_start")}))}l.OnRangeStart=u,l.OnRangeStop=c,l.TIME_RANGE_LEVEL_SEPARATOR=d,l.rangeFullName=m,l.NestedTimeRange=p,l.enableDevConsoleTimeline=_}),98);
__d("QLogEvent",["DoubleKeyMap","FBLogger","NestedTimeRange","QPLEvent","SimpleHook","performanceNavigationStart"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=new(o("DoubleKeyMap")).DoubleKeyMap,c=(function(e){function t(t,n,r){var o;return o=e.call(this,t,r)||this,o.$QPLRange$p_1=n,u.set(n,o.fullname(),o),o}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.__onStart=function(n){e.prototype.__onStart.call(this,n),this.$QPLRange$p_1.point(this.fullname()+"_START",{timestamp:n})},n.__onStop=function(n){e.prototype.__onStop.call(this,n),this.$QPLRange$p_1.point(this.fullname()+"_END",{timestamp:n}),u.delete(this.$QPLRange$p_1,this.fullname())},n.range=function(n){var e;this.fullname().startsWith(o("NestedTimeRange").TIME_RANGE_LEVEL_SEPARATOR)||r("FBLogger")("qpl").warn("Range %s cannot have subrange since root name does not start with /",this.fullname());var a=o("NestedTimeRange").rangeFullName(this.fullname(),n);return(e=u.get(this.$QPLRange$p_1,a))!=null?e:new t(n,this.$QPLRange$p_1,this)},t})(o("NestedTimeRange").NestedTimeRange),d=new(o("DoubleKeyMap")).DoubleKeyMap,m=new(s=o("SimpleHook")).SimpleHook,p=new s.SimpleHook,_=new s.SimpleHook,f=new s.SimpleHook,g=(function(t){function n(n,r,a,i,l){var s;r===void 0&&(r=0),a===void 0&&(a=2),i===void 0&&(i=!1);var u=(e||(e=o("QPLEvent"))).getMarkerId(n);return s=t.call(this,"event_"+u)||this,s.event=n,s.instanceKey=r,s.$QPLEvent$p_1=a,s.isUserFlow=i,s.$QPLEvent$p_2=l,d.set(u,r,s),s}babelHelpers.inheritsLoose(n,t);var a=n.prototype;return a.action=function(t){return this.$QPLEvent$p_1=t,this},a.getAction=function(){return this.$QPLEvent$p_1},a.setIsUserFlow=function(t){return this.isUserFlow=t,this},a.startFromNavStart=function(){return this.start(r("performanceNavigationStart")()),this},a.startFromTime=function(t){return this.start(t),this},a.__onStart=function(t){var e;(e=this.$QPLEvent$p_2)==null||e.onStart(this,t),m.call(this,t)},a.__onStop=function(n){var t;(t=this.$QPLEvent$p_2)==null||t.onStop(this,n),p.call(this,n),u.deleteAll(this),d.delete((e||(e=o("QPLEvent"))).getMarkerId(this.event),this.instanceKey)},a.range=function(t){var e;return(e=u.get(this,t))!=null?e:new c(t,this)},a.point=function(t,n){var e;return n===void 0&&(n={}),(e=this.$QPLEvent$p_2)==null||e.onPoint(this,t,n),_.call(this,t,n),this},a.annotate=function(t){var e;return(e=this.$QPLEvent$p_2)==null||e.onAnnotate(this,t),f.call(this,t),this},n})(o("NestedTimeRange").NestedTimeRange);function h(t,n,r){var a;return n===void 0&&(n=0),(a=d.get((e||(e=o("QPLEvent"))).getMarkerId(t),n))!=null?a:new g(t,n,2,!1,r)}l.OnEventStart=m,l.OnEventStop=p,l.OnEventPoint=_,l.OnEventAnnotate=f,l.QPLEvent=g,l.event=h}),98);
__d("TimedOnceFunc",["ExecutionEnvironment"],(function(t,n,r,o,a,i,l){var e,s=(function(){function t(t,n){this.$2=!1,this.$4=t,this.$3=n,(e||(e=r("ExecutionEnvironment"))).isInBrowser&&this.$5()}var n=t.prototype;return n.$6=function(){this.$1!=null&&clearTimeout(this.$1),this.$1=null},n.$5=function(){var e=this;this.isDone()||(this.$6(),this.$1=setTimeout(function(){e.$2=!0,e.run()},this.$3))},n.isDone=function(){return this.$4===null},n.isCancelled=function(){return this.$1===null&&this.$4!==null},n.run=function(){if(this.$6(),this.$4!=null){var e=this.$4;this.$4=null,e(this.$2)}},n.getDelay=function(){return this.$3},n.delay=function(t){this.$3=t!=null?t:this.$3,this.$5()},n.cancel=function(){this.$6()},t})();l.TimedOnceFunc=s}),98);
__d("UFICommentFileInputAcceptValues.experimental",["cr:27633"],(function(t,n,r,o,a,i,l){"use strict";l.default=n("cr:27633")}),98);
__d("VirtualMessageChannel",["invariant","Promise","SimpleHook","nullthrows","promiseDone"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u=(function(){function t(e){e===void 0&&(e=!1),this.$2=new(o("SimpleHook")).SimpleHook,this.onmessage=null,this.onmessageerror=null,this.$3=e}var a=t.prototype;return a.setRemotePort=function(t){this.$1=t},a.addEventListener=function(t,n,r){if((t==="message"||t==="error")&&r==null||s(0,55320,t),t==="message")if(typeof n=="function")this.$2.add(n);else{var e=n.handleEvent.bind(n);this.$2.add(e),n.__handler=e}},a.removeEventListener=function(t,n,r){if(typeof n=="function")this.$2.remove(n);else{var e=n.__handler;this.$2.remove(e)}},a.postMessage=function(o,a){var t=this,i=function(){var e=r("nullthrows")(t.$1,"By now remote port must have value!");e.$2.call({data:o,ports:a})};this.$3?i():r("promiseDone")((e||(e=n("Promise"))).resolve(),i)},a.start=function(){},a.close=function(){},t})(),c=function(t,n){this.port1=new u(t),this.port2=new u(n),this.port1.setRemotePort(this.port2),this.port2.setRemotePort(this.port1)};l.VirtualMessagePort=u,l.VirtualMessageChannel=c}),98);
__d("WABlobToArrayBuffer",["Promise","err"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t){return"arrayBuffer"in t?t.arrayBuffer():new(e||(e=n("Promise")))(function(e,n){var o=new FileReader;o.onload=function(){var t=o.result;t instanceof ArrayBuffer?e(t):n(r("err")("blobToArrayBuffer got error because result is not ArrayBuffer: "+typeof t))},o.onerror=function(){var e;n((e=o.error)!=null?e:r("err")("blobToArrayBuffer got unknown error"))},o.readAsArrayBuffer(t)})}l.blobToArrayBuffer=s}),98);
__d("WADbContact",[],(function(t,n,r,o,a,i){"use strict";var e=0,l=1,s=2,u=3;i.NON_CONTACT=e,i.ONE_WAY_CONTACT=l,i.REVERSED_ONE_WAY_CONTACT=s,i.TWO_WAY_CONTACT=u}),66);
__d("WAIsOgg",[],(function(t,n,r,o,a,i){"use strict";function e(e){return!(e.length<4||e[0]!==79||e[1]!==103||e[2]!==103||e[3]!==83)}i.isOgg=e}),66);
__d("XCometFBMultiSiteWebWorkerInitScriptControllerRouteBuilder",["jsRouteBuilder"],(function(t,n,r,o,a,i,l){var e=r("jsRouteBuilder")("/static_resources/webworker_v1/init_script/",Object.freeze({}),void 0),s=e;l.default=s}),98);
__d("WorkerBundleResource",["TrustedTypesWebWorkerScriptURLPolicy","XCometFBMultiSiteWebWorkerInitScriptControllerRouteBuilder","getWorkerInitScriptSPINParams","nullthrows"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){var n,o,a,i=(n=t==null?void 0:t.logImportScriptsErrors)!=null?n:!1,l=(o=t==null?void 0:t.name)!=null?o:e.name,u=new window.URL(e.url,window.location.href).href;if(u==null){var c=new Error("Can't start up worker without a resource url.");throw c.stack,c}for(var d=r("nullthrows")((a=r("XCometFBMultiSiteWebWorkerInitScriptControllerRouteBuilder").buildUri({}).addQueryParams(r("getWorkerInitScriptSPINParams")()))==null||(a=a.addQueryParams(s()))==null?void 0:a.toString()),m=new Worker(r("TrustedTypesWebWorkerScriptURLPolicy").createScriptURL(d),{name:l}),p=arguments.length,_=new Array(p>2?p-2:0),f=2;f<p;f++)_[f-2]=arguments[f];return m.postMessage({bundleUrl:u,initArgs:_,isDev:!1,resource:e,logImportScriptsErrors:i,type:"sr-init"}),m}function s(){var e=new URLSearchParams(window.location.search),t=new Map;return e.forEach(function(e,n){["gk_enable","gk_enable[]","gk_disable","gk_disable[]"].includes(n)&&t.set(n,e)}),t}l.createDedicatedWebWorker=e}),98);
__d("WAOpusRecorderWorkerClient",["WAWebOpusRecorderWorkerResource","WorkerBundleResource"],(function(t,n,r,o,a,i,l){var e=(function(){function e(e){this.$1=o("WorkerBundleResource").createDedicatedWebWorker(r("WAWebOpusRecorderWorkerResource")),this.$1.onmessage=e!=null?e:null}var t=e.prototype;return t.getWorker=function(){return this.$1},t.postMessage=function(t,n){var e={type:"message",message:t};this.$1.postMessage(e,n)},t.addEventListener=function(t,n){this.$1.addEventListener(t,n)},t.removeEventListener=function(t,n){this.$1.addEventListener(t,n)},e})();function s(){return new e}function u(t){return new e(t)}l.WAOpusRecorderWorkerClient=e,l.getOpusEncoderWorker=s,l.getOpusDecoderWorker=u}),98);
__d("WAOpusRecorderPlayer",["Promise","WABinary","WABlobToArrayBuffer","WALogger","WAOpusRecorderWorkerClient"],(function(t,n,r,o,a,i,l){var e,s,u,c,d="audio/wav",m,p=0;function _(){return p++,m||(m=new window.AudioContext),m}function f(){if(p--,p===0&&m){try{m.close().catch(function(t){o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["releaseAudioContext close async error: ",""])),t)})}catch(e){o("WALogger").WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["releaseAudioContext close sync error: ",""])),e)}m=void 0}}var g=(function(){function e(e){this.oggBlob=e}var t=e.prototype;return t.generateBlob=function(){return this.oggBlobToWAVBlob(this.oggBlob,1)},t.oggBlobToWAVBlob=function(t,r){var e=this;r===void 0&&(r=2);var a=r;return new(c||(c=n("Promise")))(function(n){var r=function(r){if(r.data==null){for(var t=function(t){l.forEach(function(e){for(var n=e[t]||e[0],r=0;r<n.length;r++)s.push(n[r])})},o=0;o<a;o++)t(o);var i=e.encodeWAV(s,c,a),u=new Blob([i.readByteArrayView()],{type:d});f(),n(u)}else l.push(r.data),a=l[0].length},i=o("WAOpusRecorderWorkerClient").getOpusDecoderWorker(r),l=[],s=[],c=_(),m={outputBufferSampleRate:c.sampleRate,bufferLength:4096};i.postMessage({command:"decode-init",config:m}),o("WABlobToArrayBuffer").blobToArrayBuffer(t).then(function(e){i.postMessage({command:"decode",pages:new Uint8Array(e)}),i.postMessage({command:"decode-done"})}).catch(function(e){o("WALogger").WARN(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Player::oggBlobToWAVBlob error: ",""])),e)})})},t.encodeWAV=function(t,n,r){var e=new(o("WABinary")).Binary(void 0,!0);e.ensureCapacity(44+t.length*2),e.writeString("RIFF"),e.writeUint32(36+t.length*2),e.writeString("WAVE"),e.writeString("fmt "),e.writeUint32(16),e.writeUint16(1),e.writeUint16(r),e.writeUint32(n.sampleRate),e.writeUint32(n.sampleRate*r*2),e.writeUint16(r*2),e.writeUint16(16),e.writeString("data"),e.writeUint32(t.length*2);for(var a=0;a<t.length;a++){var i=Math.max(-1,Math.min(t[a],1));i*=i>0?32767:32768,e.writeInt16(Math.floor(i))}return e},e})();l.default=g}),98);
__d("WAMaybeTranscodeOggOpusToWavForPlayback",["FBLogger","WABlobToArrayBuffer","WAIsOgg","WAOpusRecorderPlayer","asyncToGeneratorRuntime","justknobx"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d=function(){return r("FBLogger")("wmi").tags(["audio"])},m=r("justknobx")._("4988"),p=new Audio().canPlayType("audio/ogg"),_=p==="probably"||p==="maybe";function f(e){return g.apply(this,arguments)}function g(){return g=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){if(_)return d().DEBUG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Ogg playback supported no need to transcode"]))),t;if(d().DEBUG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Ogg playback is not supported. Start transcoding"]))),t.size>m)return d().MUSTFIX(u||(u=babelHelpers.taggedTemplateLiteralLoose(["blob size too large"]))),t;var n=yield o("WABlobToArrayBuffer").blobToArrayBuffer(t);if(!o("WAIsOgg").isOgg(new Uint8Array(n)))return d().DEBUG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["blob is not Ogg, skip transcode"]))),t;var a=new(r("WAOpusRecorderPlayer"))(t);return a.generateBlob()}),g.apply(this,arguments)}l.isOggPlaybackSupported=_,l.maybeTranscodeOggOpusToWavForPlayback=f}),98);
__d("WorkerMessagePortLogging",["MainPageUrl","QLogEvent","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e=Math.random()<.1,s=20,u=100,c=50;function d(){return o("MainPageUrl").isWorkerLogEnabled()||o("MainPageUrl").mainPageUrl.searchParams.get("worker_log")===1}var m=0;function p(){return o("QLogEvent").event(r("qpl")._(41497718,"106"),m++)}function _(t,n,r){if(r===void 0&&(r=!1),!(n==null||!e)){var o=n.receiveDateTime,a=n.receiveTimestamp,i=n.sendDateTime,l=n.sendDelayHighPrecision,d=n.sendTimestamp,m=p();m.startFromTime();var _=m.range("SEND_DELAY");_.start(d),_.stop(a);var f=m.range("SEND_DELAY_LOW_PRECISION");f.start(i),f.stop(o);var g=Math.abs(d-i),h=Math.abs(a-o);if(m.annotate({string:{port_name:t},int:{send_delay:l,send_drift:g,receive_drift:h},bool:{send_delay_above_max:l!=null&&l>s,send_drift_above_max:g>u,receive_drift_above_max:h>u}}),r){var y=m.range("ROUND_TRIP");y.start(n.sendTimestamp),y.stop(n.receiveTimestamp);var C=n.receiveTimestamp-n.sendTimestamp;m.annotate({int:{round_trip:C},bool:{round_trip_above_max:C>c}})}m.stop()}}l.isWorkerLogEnabled=d,l.logMessageTiming=_}),98);
__d("WorkerMessagePort",["Deferred","FBLogger","MainPageUrl","Promise","PromiseAnnotate","SimpleHook","VirtualMessageChannel","WorkerMessagePortLogging","performanceAbsoluteNow","promiseDone"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;function c(e){return e}var d=(function(e){function t(){return e.apply(this,arguments)||this}return babelHelpers.inheritsLoose(t,e),t})(o("SimpleHook").SimpleHook);function m(e,t){var n=e;n.__timing=t}function p(e){return e.__timing}var _=(function(){function e(e,t){var n=this;this.$1={},this.onUnhandledMessage=new d,this.onMessage=new d,this.onPostMessage=new d,this.onError=new d,this.$2=e,this.name=t,this.$2.addEventListener("message",function(e){return n.onMessageHandler(e.data)}),this.$2.addEventListener("error",function(e){return n.onError.call(e)}),this.onPostMessage.add(function(e){m(e,{receiveDateTime:-1,receiveTimestamp:-1,sendDateTime:Date.now(),sendDelayHighPrecision:0,sendDelayLowPrecision:0,sendTimestamp:(u||(u=r("performanceAbsoluteNow")))()})}),this.onMessage.add(function(e){var t=p(e);if(t!=null){var a=t.sendDateTime,i=t.sendTimestamp,l=(u||(u=r("performanceAbsoluteNow")))(),s=Date.now();t.receiveTimestamp=l,t.receiveDateTime=s,t.sendDelayHighPrecision=l-i,t.sendDelayLowPrecision=s-a,o("WorkerMessagePortLogging").logMessageTiming(n.name,t)}})}var t=e.prototype;return t.onMessageHandler=function(t){try{this.onMessage.call(t);var e=this.$1[t.type];e?e.call(t):this.onUnhandledMessage.call(t)}catch(e){this.onError.call(e)}},t.postMessage=function(t,n){this.onPostMessage.call(t),n?this.$2.postMessage(t,n):this.$2.postMessage(t)},t.addMessageListener=function(t,n){var e=this.$1[t];return e||(e=new d,this.$1[t]=e),e.add(n)},t.removeMessageListener=function(t,n){var e=this.$1[t];return!!e&&e.remove(n)},t.removeAllMessageListeners=function(t){var e=this.$1[t];e&&e.clear()},t.onMessageOnce=function(t,r){var e=this;return new(s||(s=n("Promise")))(function(n){var o=e.addMessageListener(t,function(a){r(a)&&(e.removeMessageListener(t,o),n(a))})})},t.close=function(){var e=this.$2;e.close==null||e.close(),e.terminate==null||e.terminate()},t.isWrappingVirtualMessagePort=function(){return this.$2 instanceof o("VirtualMessageChannel").VirtualMessagePort},e})();function f(e){return e}var g=(function(t){function a(a,i){var l;l=t.call(this,a,i)||this;var u=l,d=new(r("Deferred")),m=d.getPromise();u.addMessageListener("endpoint_started",function(e){d.resolve(e);var t=p(e);u.postMessage({endpoint:e.endpoint,startSendTimestamp:t==null?void 0:t.sendTimestamp,targetEndpoint:l.name,type:"endpoint_started_received"})});var _=u.onMessageOnce("endpoint_started_received",function(){return!0});return(e||(e=o("PromiseAnnotate"))).setDisplayName(m,"endpoint_started"),e.setDisplayName(_,"endpoint_started_received"),u.postMessage({endpoint:l.name,type:"endpoint_started"}),r("promiseDone")(m,function(e){var t=p(e);o("WorkerMessagePortLogging").logMessageTiming(l.name,t)}),r("promiseDone")(_,function(e){var t=p(e);t!=null&&o("WorkerMessagePortLogging").logMessageTiming(l.name,t,!0)}),l.fullyConnected=(s||(s=n("Promise"))).race([m,_]).then(function(){return l}),l}return babelHelpers.inheritsLoose(a,t),a})(_);l.getMessageTiming=p,l.WorkerMessagePort=_,l.CastWorkerMessagePort=f,l.WorkerSyncedMessagePort=g}),98);
__d("WorkerFuncChannel",["invariant","DateConsts","ExecutionEnvironment","FBLogger","FuncChannel","MainPageUrl","Promise","TimedOnceFunc","VirtualMessageChannel","WorkerMessagePort","err","promiseDone"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u,c={serialize:function(t,n){return n.push(t),t},deserialize:function(t){return t}},d=1e4,m=0,p=5,_=p+1,f=(function(){function e(e){var t=self.WeakRef;t&&(this.$1=new t(e))}var t=e.prototype;return t.isDead=function(){return this.$1!=null&&this.$1.deref()==null},e})(),g=(function(t){function a(e,n,a,i){var l;a===void 0&&(a=null),i===void 0&&(i={}),l=t.call(this,e)||this,l.$WorkerFuncChannel$p_1=new Map,l.$WorkerFuncChannel$p_2=new Map,l.$WorkerFuncChannel$p_5={function:{serialize:function(t,n){var e=_++;l.$WorkerFuncChannel$p_1.set(e,t);var r={type:"function",value:e};return r},deserialize:function(t){var e=l,n=t.value,r=function(){var t={type:"call",id:n,method:"__anonymous",thisArg:null,argList:Array.from(arguments)};return e.callMessageHandler(t)};return l.$WorkerFuncChannel$p_2.set(n,new f(r)),r}},custom:{serialize:function(t,n){var e=t.constructor.name,r=l.$WorkerFuncChannel$p_4[e];r!=null||s(0,63779,e);var o=r.serialize(t,n);return{type:"custom",custom:e,value:o}},deserialize:function(t){var e=t.custom,n=l.$WorkerFuncChannel$p_4[e];return n!=null||s(0,63779,e),n.deserialize(t.value)}},error:{serialize:function(t,n){var e={name:t.name,message:t.message,stack:t.stack};return{type:"error",value:e}},deserialize:function(t){var e=r("err")(t.value.message);return e.name=t.value.name,e.stack=t.value.stack,e}},object:{serialize:function(t,n){var e=t.constructor;if(e!==Object)throw new Error("Cannot clone class object");return{type:"object",value:t}},deserialize:function(t){return t.value}},raw:{serialize:function(t,n){return{type:"raw",value:t}},deserialize:function(t){return t.value}}},l.name=n,l.$WorkerFuncChannel$p_3=a,l.$WorkerFuncChannel$p_4=i;var c=function(t){o("MainPageUrl").isWorkerLogEnabled()&&r("FBLogger")("adsworker").debug("[Channel] removing callback ids: %s",t.join()),t.forEach(function(e){return l.$WorkerFuncChannel$p_1.delete(e)})},p=l.__remoteInternalFunc(m,c);return typeof jest=="undefined"&&(u||(u=r("ExecutionEnvironment"))).isInBrowser&&setInterval(function(){var e=[];l.$WorkerFuncChannel$p_2.forEach(function(t,n){t.isDead()&&(e.push(n),l.$WorkerFuncChannel$p_2.delete(n))}),e.length>0?p(e):l.$WorkerFuncChannel$p_2.size>5e3&&l.$WorkerFuncChannel$p_2.size%10===0&&r("FBLogger")("adsworker").warn("[%s] has too many remaining refs %s",l.name,l.$WorkerFuncChannel$p_2.size)},d),l}babelHelpers.inheritsLoose(a,t);var i=a.prototype;return i.__remoteInternalFunc=function(t,n){(t>p||this.$WorkerFuncChannel$p_1.get(t)!=null)&&r("FBLogger")("adsworker").mustfix("invalid internal func id %s",t),this.$WorkerFuncChannel$p_1.set(t,n);var e=this.$WorkerFuncChannel$p_5.function.deserialize({type:"function",value:t});return e},i.$WorkerFuncChannel$p_6=function(t){return t instanceof Int8Array||t instanceof Int16Array||t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Uint16Array||t instanceof Uint32Array||t instanceof Float32Array||t instanceof Float64Array},i.$WorkerFuncChannel$p_7=function(t){if(typeof t=="function")return"function";if(t===null||typeof t!="object"||Array.isArray(t)||this.$WorkerFuncChannel$p_6(t))return"raw";var e=t.constructor.name;return this.$WorkerFuncChannel$p_4[e]?"custom":t instanceof Error?"error":"object"},i.$WorkerFuncChannel$p_8=function(t,n){var e=this.$WorkerFuncChannel$p_7(t);return this.$WorkerFuncChannel$p_5[e].serialize(t,n)},i.$WorkerFuncChannel$p_9=function(t){var e=t;if(t!==null&&typeof t=="object"&&typeof t.type=="string"){var n=this.$WorkerFuncChannel$p_5[t.type];if(n)return n.deserialize(t)}return e},i.__onPostOutMessage=function(t){return t},i.__callCallback=function(t,n){t.apply(null,n.argList)},i.setOutMessagePort=function(o,a){var t=this,i=[];this.setCallMessageHandler(function(a){a.thisArg=t.name;var l=[];a.argList=a.argList.map(function(e){return t.$WorkerFuncChannel$p_8(e,l)});var s=new(e||(e=n("Promise")))(function(e,n){a.result={resolveFunc:t.$WorkerFuncChannel$p_8(e,l),rejectFunc:t.$WorkerFuncChannel$p_8(n,l)}}),u=t.__onPostOutMessage(a);return u!=null&&(i!=null?i.push({message:a,transferList:l}):o.postMessage(a,l)),s.catch(function(e){r("FBLogger")("worker").catching(e).mustfix("Error: channel %s, remote call of %s returned error %s",t.name,a.method,e.message)}),s}),r("promiseDone")(a||E.waitForRemote(this.name),function(){var e=i;i=null,e==null||e.forEach(function(e){o.postMessage(e.message,e.transferList)}),t.$WorkerFuncChannel$p_3==null||t.$WorkerFuncChannel$p_3()})},i.__messageToCall=function(t){var e=this;if(t.argList=t.argList.map(function(t){return e.$WorkerFuncChannel$p_9(t)}),t.result){var n=t.result,o=n.rejectFunc,a=n.resolveFunc;a=this.$WorkerFuncChannel$p_9(a),o=this.$WorkerFuncChannel$p_9(o),t.result={resolveFunc:a,rejectFunc:o}}var i=t.id;if(i===void 0)this.messageToCall(t);else{var l=this.$WorkerFuncChannel$p_1.get(i);l?this.__callCallback(l,t):r("FBLogger")("adsworker").mustfix("Error: callback is called but no longer available")}},i.setInMessagePort=function(t){var e=this;t.addMessageListener("call",function(t){typeof t.thisArg=="string"&&t.thisArg===e.name&&e.__messageToCall(t)}),E.notifyReady(this.name)},i.setMessagePort=function(t){return this.setInMessagePort(t),this.setOutMessagePort(t),this},a})(r("FuncChannel")),h=(function(e){function t(){return e.apply(this,arguments)||this}return babelHelpers.inheritsLoose(t,e),t})(o("WorkerMessagePort").WorkerMessagePort);function y(e,t,n,o){E.exportChannel(e,function(o){var a=o.remoteNativePort,i=o.syncPort,l=t();e===l.name||s(0,54247,e,l.name);var u;a?(u=new h(a,i.name+"("+l.name+")"),a.start(),u.onError.add(function(e){throw r("FBLogger")("worker").catching(e).mustfix("error caught in remotePort"),e})):u=i,l.setMessagePort(u).setBackend(n),r("promiseDone")(i.fullyConnected,function(){i.postMessage({type:"channelReady",channelName:l.name}),E.logState("EXPORTED",e)})})}function C(e,t,n,r){return r===void 0&&(r={}),y(n,function(){return new g(function(t){return e},n,null,r)},e,t)}var b=(function(e){function t(t,n){n===void 0&&(n="");var a=o("DateConsts").MS_PER_MIN*1;return e.call(this,function(){r("FBLogger")("worker").warn("Channel %s did not establish eventually. %s",t,n)},a)||this}return babelHelpers.inheritsLoose(t,e),t})(o("TimedOnceFunc").TimedOnceFunc);function v(e,t){var n,a=null,i,l;t.isWrappingVirtualMessagePort()?(l=new(o("VirtualMessageChannel")).VirtualMessageChannel(!0,!0),n="on virtual dedicated channel"):(l=new MessageChannel,n="on native dedicated channel",i=[l.port2]);var s=l.port1;a=l.port2,s.start();var u=new h(s,t.name+"("+e.name+")");return r("promiseDone")(t.fullyConnected,function(){E.logState("IMPORTING "+n+" ",e.name),e.setInMessagePort(u);var o=new b(e.name,n);r("promiseDone")(t.onMessageOnce("channelReady",function(t){return t.channelName===e.name}),function(t){e.setOutMessagePort(u),o.cancel(),E.logState("ESTABLISHED",e.name)}),t.postMessage({type:"channelImport",channelName:e.name,port:a},i)}),e.proxyMethods}function S(e,t,n,r){n===void 0&&(n=null),r===void 0&&(r={});var o=new g(function(t){return e},t,n,r);return o}function R(e,t,n,r,o){return r===void 0&&(r=null),o===void 0&&(o={}),v(S(e,n,r,o),t)}var L=(function(){function t(){this.name=self.name+"_P"+Math.round(10*Math.random()),this.$1=new Map,this.$2=new Set}var a=t.prototype;return a.logState=function(t,n){o("MainPageUrl").isWorkerLogEnabled()&&r("FBLogger")("worker").debug("%s-%s %s",this.name,t,n)},a.$3=function(t){var e=this.$1.get(t);return e==null&&(e={pendingPorts:null,onImportRequest:null},this.$1.set(t,e)),e},a.exportChannel=function(t,n){var e=this,o=this.$3(t);o.onImportRequest!=null&&r("FBLogger")("worker").debug("Re-exporting channel %s",t),o.onImportRequest=n,this.logState("REGISTERED",t);var a=o.pendingPorts;if(a!=null){var i=a.filter(function(t){return e.$2.has(t.syncPort)});i.forEach(n),i.length<a.length?o.pendingPorts=a.filter(function(t){return!e.$2.has(t.syncPort)}):o.pendingPorts=null}return o},a.activate=function(t,n,o){var e=this;if(this.$2.has(t)){r("FBLogger")("worker").debug("Port %sis already duplicated ",t.name);return}this.$2.add(t),t.addMessageListener("channelImport",function(n){var r=n.channelName,o=e.$3(r),a={syncPort:t,remoteNativePort:n.port};o.onImportRequest!=null?o.onImportRequest(a):o.pendingPorts!=null?o.pendingPorts.push(a):o.pendingPorts=[a],e.logState("IMPORT REQUEST",r)})},a.notifyReady=function(t){},a.waitForRemote=function(r){return(e||(e=n("Promise"))).resolve()},t})(),E=new L;function k(e,t,n){E.activate(e,t,n)}l.TransferableTransformer=c,l.WorkerFuncChannel=g,l.exportChannelOnPort=y,l.exportChannel=C,l.importChannelOnPort=v,l.makeChannel=S,l.importChannel=R,l.activateChannels=k}),98);
__d("WorkerBanzaiLazyQueueChannelClient",["BanzaiLazyQueue","WorkerFuncChannel"],(function(t,n,r,o,a,i,l){"use strict";function e(e){o("WorkerFuncChannel").exportChannel(r("BanzaiLazyQueue"),e,"banzai_lazyqueue_channel")}l.init=e}),98);
__d("WorkerQPLChannel",["WorkerFuncChannel","performanceAbsoluteNow"],(function(t,n,r,o,a,i,l){"use strict";var e,s=new(o("WorkerFuncChannel")).WorkerFuncChannel(function(t){return{markerStartFromNavStart:null,markerStart:function(o,a,i){return i===void 0&&(i=(e||(e=r("performanceAbsoluteNow")))()),t.markerStart(o,a,i)},markerAnnotate:function(n,r,o){return t.markerAnnotate(n,r,o)},markerPoint:function(o,a,i){var n=(i==null?void 0:i.timestamp)===void 0?babelHelpers.extends({},i,{timestamp:(e||(e=r("performanceAbsoluteNow")))()}):i;return t.markerPoint(o,a,n)},markerEnd:function(o,a,i,l){return l===void 0&&(l=(e||(e=r("performanceAbsoluteNow")))()),t.markerEnd(o,a,i,l)}}},"qpl");function u(e){s.setMessagePort(e)}function c(e){s.setBackend(e)}l.setMessagePort=u,l.initQPL=c}),98);
__d("WorkerClient",["WorkerBanzaiLazyQueueChannelClient","WorkerFuncChannel","WorkerQPLChannel"],(function(t,n,r,o,a,i,l){"use strict";function e(e){o("WorkerFuncChannel").activateChannels(e,"client","worker"),o("WorkerBanzaiLazyQueueChannelClient").init(e),o("WorkerQPLChannel").setMessagePort(e),a(["QuickPerformanceLogger"],function(e){return o("WorkerQPLChannel").initQPL(e)})}l.init=e}),98);
__d("WorkerRelayNetwork",["ActorURIConfig","MAWCurrentUser","RelayAPIConfig","WAResolvable","createRelayFBNetwork","createRelayFBNetworkFetch","relay-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e=new(o("WAResolvable")).Resolvable;function s(){var t=c(o("MAWCurrentUser").getID()),n={execute:t.execute};return e.resolve(n),n}function u(){return e.promise}function c(e,t){var n={actorID:e,batchResponseChunks:!0,getAdditionalData:function(){var t={};return e!=null&&(t[r("ActorURIConfig").PARAMETER_ACTOR]=e),r("RelayAPIConfig").useXController===!1&&r("RelayAPIConfig").accessToken!==""&&(t.access_token=r("RelayAPIConfig").accessToken),t},graphURI:t},a=r("createRelayFBNetworkFetch")(n),i=function(t,n,r){return o("relay-runtime").Observable.create(function(e){return e.complete()})};return r("createRelayFBNetwork")(a,i,null,null)}l.createWorkerNetworkExecute=s,l.getWorkerNetworkExecute=u}),98);
__d("executeGraphQLQuery",["DTSG","FBLogger","MAWBridge","asyncToGeneratorRuntime","relay-runtime"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var a=o("relay-runtime").getRequest(t);if(a.params.operationKind==="subscription")throw r("FBLogger")("messenger_web").mustfixThrow("executeGraphQLQuery: Expected query or mutation operation");var i={force:!0},l=o("DTSG").getToken();if(l==null||l===""||typeof l!="string"){if(l=yield o("MAWBridge").getBridge().sendAndReceive("event","getDTSGToken").catch(function(e){throw r("FBLogger")("messenger_web").mustfixThrow("executeGraphQLQuery: Failed to get DTSG token from the main thread",e)}),l==null||l===""||typeof l!="string")throw r("FBLogger")("messenger_web").mustfixThrow("executeGraphQLQuery: Received an empty DTSG token from the main thread");o("DTSG").setToken(l)}var s=o("relay-runtime").createOperationDescriptor(a,n,i);return e.execute(s.request.node.params,s.request.variables,i)}),s.apply(this,arguments)}l.executeGraphQLQuery=e}),98);
__d("createWorkerMutation",["FBLogger","WorkerRelayNetwork","asyncToGeneratorRuntime","executeGraphQLQuery","relay-runtime"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=o("relay-runtime").getRequest(e);if(t.params.operationKind!=="mutation")throw r("FBLogger")("messenger_web").mustfixThrow("createWorkerMutation: Expected mutation operation");var a=o("WorkerRelayNetwork").getWorkerNetworkExecute(),i=(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=yield a;return o("executeGraphQLQuery").executeGraphQLQuery(n,e,t).then(function(e){return e.toPromise()}).then(function(e){var t,n=Array.isArray(e)?(t=e[0])==null?void 0:t.data:e==null?void 0:e.data;return n==null?null:n})});return function(n){return t.apply(this,arguments)}})();return[i]}l.default=e}),98);
__d("createWorkerQuery",["FBLogger","IGDWebUtils","MAWRotateDTSG","WARetryableError","WorkerRelayNetwork","asyncToGeneratorRuntime","executeGraphQLQuery","relay-runtime"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var a=o("relay-runtime").getRequest(e);if(a.params.operationKind!=="query")throw r("FBLogger")("messenger_web").mustfixThrow("createWorkerQuery: Expected query operation");var i=yield o("WorkerRelayNetwork").getWorkerNetworkExecute();n==null||n.onExecute==null||n.onExecute();var l=o("IGDWebUtils").isOnInstagramWeb(),s=yield o("executeGraphQLQuery").executeGraphQLQuery(i,e,t).then(function(e){return e.toPromise()}).then(function(e){var t;n==null||n.onResponse==null||n.onResponse(e);var r=Array.isArray(e)?(t=e[0])==null?void 0:t.data:e==null?void 0:e.data;if(r!=null)return r}).catch(function(e){if(("code"in e&&e.code===1357004||"message"in e&&e.message.indexOf("1357004")!==-1||typeof e=="string"&&e.indexOf("1357004")!==-1)&&!l)return r("FBLogger")("messenger_web").info("Failed with expired DTSG, attempting to rotate."),o("MAWRotateDTSG").tryRotateDTSG().then(function(t){throw t?new(r("WARetryableError"))(e):e});throw e});return s}),s.apply(this,arguments)}l.default=e}),98);
__d("WorkerRelay",["WorkerRelayNetwork","createWorkerMutation","createWorkerQuery","executeGraphQLQuery","relay-runtime"],(function(t,n,r,o,a,i,l){"use strict";i.exports={createWorkerMutation:r("createWorkerMutation"),createWorkerQuery:r("createWorkerQuery"),executeGraphQLQuery:o("executeGraphQLQuery").executeGraphQLQuery,getWorkerRelayEnvironment:o("WorkerRelayNetwork").getWorkerNetworkExecute,graphql:o("relay-runtime").graphql}}),34);
__d("XPlatRelayEnvironment",["CometRelayEnvironment","err"],(function(t,n,r,o,a,i,l){"use strict";function e(e){throw r("err")("RelayEnvironment is already set")}function s(){return r("CometRelayEnvironment")}l.setRelayEnvironment=e,l.getRelayEnvironment=s}),98);
__d("cometIsMimeTypeForMedia",["FBLogger","UFICommentFileInputAcceptValues.experimental"],(function(t,n,r,o,a,i,l){"use strict";var e={file:null,photo:null,video:null},s={"image/gif":"video","image/webp":"video"};function u(e){return e.split(",").map(function(e){return e.trim()}).map(function(e){return e.replace(/\/\*$/,"/")})}function c(t,n,o){e[t]==null&&(e[t]=u(o));var a=e[t];if(a==null)throw r("FBLogger")("ufi2").mustfixThrow("CometIsMimeTypeForMedia prefixes can't be null");var i=s[n];return i!=null?i===t:a.some(function(e){return n.startsWith(e)})}function d(e){return c("photo",e,r("UFICommentFileInputAcceptValues.experimental").photos)}function m(e){return c("video",e,r("UFICommentFileInputAcceptValues.experimental").videos)}function p(e){return c("file",e,r("UFICommentFileInputAcceptValues.experimental").files)}l.mimeTypeAcceptStringToArray=u,l.isMimeTypeForPhoto=d,l.isMimeTypeForVideo=m,l.isMimeTypeForFile=p}),98);
__d("getMWLSRegion",["MessengerWebRegion"],(function(t,n,r,o,a,i,l){"use strict";function e(){var e=r("MessengerWebRegion").regionNullable;return e==null?"":e}l.default=e}),98);